(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{40:function(e,t,n){},41:function(e,t,n){},65:function(e,t,n){"use strict";n.r(t);var r=n(7),a=n.n(r),o=n(31),c=n.n(o),i=(n(40),n(41),n(5)),s=function(){return Object(i.jsxs)("div",{className:"header",children:[Object(i.jsx)("h1",{children:"GPS Improment System"}),Object(i.jsx)("p",{children:"This Website helps you to improve your GPS location when taking the Taipei MRT."})]})},u=n(9),l=n(19),d=n.n(l),b=function(e){var t=e.mapContainer,n=e.lng,r=e.lat,a=e.zoom;e.onMove;return Object(i.jsxs)("div",{children:[Object(i.jsxs)("div",{className:"sidebar",children:["Longitude: ",n," | Latitude: ",r," | Zoom: ",a]}),Object(i.jsx)("div",{ref:t,className:"map-container"})]})},j=n(32),f=function(e){var t=e.sendAudio,n=Object(r.useState)(!1),a=Object(u.a)(n,2),o=a[0],c=a[1];return Object(i.jsxs)("div",{children:[Object(i.jsx)(j.ReactMic,{record:o,mimeType:"audio/wav",className:"sound-wave",onStop:function(e){t(e)},onData:function(e){},strokeColor:"#000000",timeSlice:3e4,backgroundColor:"#FF4081"}),Object(i.jsx)("button",{onClick:function(){c(!0)},type:"button",children:"Start"}),Object(i.jsx)("button",{onClick:function(){c(!1)},type:"button",children:"Stop"})]})},p=n(10),m=n.n(p),g=n(14),h=n(20),O=n.n(h),v=function(){var e=Object(r.useState)(121.573145),t=Object(u.a)(e,2),n=t[0],a=t[1],o=Object(r.useState)(24.998241),c=Object(u.a)(o,2),i=c[0],s=c[1],l=function(){var e=Object(g.a)(m.a.mark((function e(t){var n,r;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new FormData).append("wav_file",t.blob),e.next=4,O.a.post("/audio",n,{headers:{Accept:"*/*","Content-Type":"multipart/form-data"}});case 4:r=e.sent,a(parseFloat(r.data[0])),s(parseFloat(r.data[1]));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),d=function(){var e=Object(g.a)(m.a.mark((function e(t){var n,r,a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new FormData,r=b(t),n.append("image_file",r),e.next=5,O.a.post("/image",n,{headers:{"Content-Type":"multipart/form-data;"}});case 5:a=e.sent,console.log(a);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),b=function(e,t){for(var n=e.split(","),r=n[0].match(/:(.*?);/)[1],a=atob(n[1]),o=a.length,c=new Uint8Array(o);o;)c[o-1]=a.charCodeAt(o-1),o-=1;return new File([c],t,{type:r})};return{lng:n,lat:i,sendAudio:l,sendPic:d,sendBearing:function(){var e=Object(g.a)(m.a.mark((function e(t){var n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("send Bearing",t),e.next=3,O.a.post("/bearing",{bearing:t});case 3:n=e.sent,console.log(n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}},x=n(16),w=n(34),y=n(22),S=n(35),C=function(){var e=Object(r.useState)(0),t=Object(u.a)(e,2),n=t[0],a=t[1];return{bearing:n,orientation:function(){var e=new S.a({frequency:60});Promise.all([navigator.permissions.query({name:"accelerometer"}),navigator.permissions.query({name:"magnetometer"}),navigator.permissions.query({name:"gyroscope"})]).then((function(t){t.every((function(e){return"granted"===e.state}))?(e.addEventListener("reading",(function(){var t=new y.a,n=Object(x.a)(y.b,Object(w.a)(e.quaternion));a(45*t.setFromQuaternion(n,"XYZ").z)})),e.addEventListener("error",(function(e){"NotReadableError"===e.error.name&&console.log("Sensor is not available.",e)})),e.start()):console.log("No permissions to use AbsoluteOrientationSensor.")}))}}},k=n(33),F=n.n(k),T={width:1280,height:720,facingMode:"user"},L=function(e){var t=e.sendPic,n=a.a.useRef(null),r=a.a.useCallback((function(){var e=n.current.getScreenshot();t(e)}),[n]);return Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)("button",{onClick:r,children:"Capture photo"}),Object(i.jsx)(F.a,{audio:!1,height:720,ref:n,screenshotFormat:"image/jpeg",width:1280,videoConstraints:T})]})};d.a.accessToken="pk.eyJ1Ijoic2hpbmUtY2hhbmciLCJhIjoiY2tvODhkdGw3MXU2dDJ2bHJrNDZmNHp6ZSJ9.-cSgmT-mTMNGs-to2jNmAw";var M=function(){var e=Object(r.useRef)(null),t=Object(r.useRef)(null),n=v(),a=n.lat,o=n.lng,c=n.sendAudio,s=n.sendPic,l=n.sendBearing,j=Object(r.useState)(null),p=Object(u.a)(j,2),m=p[0],g=p[1],h=Object(r.useState)(13),O=Object(u.a)(h,2),x=O[0],w=(O[1],C()),y=w.bearing,S=w.orientation,k=Object(r.useState)(0),F=Object(u.a)(k,2),T=F[0],M=F[1];return Object(r.useEffect)((function(){t.current&&(t.current.flyTo({center:[o,a],zoom:14}),g(m.setLngLat([o,a]).addTo(t.current)))}),[o,a,m]),Object(r.useEffect)((function(){t.current&&(t.current.setBearing(y),console.log("bearing: ",y,T),Math.abs(y-T)>50&&(M(y),l(y)))}),[y]),Object(r.useEffect)((function(){t.current||(t.current=new d.a.Map({container:e.current,style:"mapbox://styles/mapbox/streets-v11",center:[o,a],pitch:30,zoom:x}),S(),g(new d.a.Marker({color:"#1e90ff",draggable:!0}).setLngLat([o,a]).addTo(t.current)))})),Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)(b,{mapContainer:e,lng:o,lat:a,zoom:x}),Object(i.jsx)(f,{sendAudio:c}),Object(i.jsx)(L,{sendPic:s,videoConstraints:{facingMode:{exact:"environment"}}})]})};var N=function(){return Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)(s,{}),Object(i.jsx)(M,{})]})},A=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,66)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,o=t.getLCP,c=t.getTTFB;n(e),r(e),a(e),o(e),c(e)}))};c.a.render(Object(i.jsx)(a.a.StrictMode,{children:Object(i.jsx)(N,{})}),document.getElementById("root")),A()}},[[65,1,2]]]);
//# sourceMappingURL=main.e3325dfd.chunk.js.map