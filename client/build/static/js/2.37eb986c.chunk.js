/*! For license information please see 2.37eb986c.chunk.js.LICENSE.txt */
(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[2],[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.d(t,"a",(function(){return i}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var i=n(14);function r(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Object(i.a)(e,t)}},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var i=n(4),r=n(18),a=n(12);function o(e){var t=Object(r.a)();return function(){var n,r=Object(i.a)(e);if(t){var o=Object(i.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(a.a)(this,n)}}},function(e,t,n){"use strict";function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function r(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}n.d(t,"a",(function(){return i}))},function(e,t,n){"use strict";e.exports=n(43)},function(e,t,n){"use strict";function i(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}n.d(t,"a",(function(){return i}))},function(e,t,n){"use strict";e.exports=n(37)},function(e,t,n){e.exports=n(52)},function(e,t,n){"use strict";var i=n(24),r=Object.prototype.toString;function a(e){return"[object Array]"===r.call(e)}function o(e){return"undefined"===typeof e}function s(e){return null!==e&&"object"===typeof e}function l(e){if("[object Object]"!==r.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function c(e){return"[object Function]"===r.call(e)}function u(e,t){if(null!==e&&"undefined"!==typeof e)if("object"!==typeof e&&(e=[e]),a(e))for(var n=0,i=e.length;n<i;n++)t.call(null,e[n],n,e);else for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.call(null,e[r],r,e)}e.exports={isArray:a,isArrayBuffer:function(e){return"[object ArrayBuffer]"===r.call(e)},isBuffer:function(e){return null!==e&&!o(e)&&null!==e.constructor&&!o(e.constructor)&&"function"===typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){return"undefined"!==typeof FormData&&e instanceof FormData},isArrayBufferView:function(e){return"undefined"!==typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function(e){return"string"===typeof e},isNumber:function(e){return"number"===typeof e},isObject:s,isPlainObject:l,isUndefined:o,isDate:function(e){return"[object Date]"===r.call(e)},isFile:function(e){return"[object File]"===r.call(e)},isBlob:function(e){return"[object Blob]"===r.call(e)},isFunction:c,isStream:function(e){return s(e)&&c(e.pipe)},isURLSearchParams:function(e){return"undefined"!==typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"===typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&("undefined"!==typeof window&&"undefined"!==typeof document)},forEach:u,merge:function e(){var t={};function n(n,i){l(t[i])&&l(n)?t[i]=e(t[i],n):l(n)?t[i]=e({},n):a(n)?t[i]=n.slice():t[i]=n}for(var i=0,r=arguments.length;i<r;i++)u(arguments[i],n);return t},extend:function(e,t,n){return u(t,(function(t,r){e[r]=n&&"function"===typeof t?i(t,n):t})),e},trim:function(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")},stripBOM:function(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var i=n(13);function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e)){var n=[],i=!0,r=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);i=!0);}catch(l){r=!0,a=l}finally{try{i||null==s.return||s.return()}finally{if(r)throw a}}return n}}(e,t)||Object(i.a)(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},function(e,t,n){"use strict";function i(e,t,n,i,r,a,o){try{var s=e[a](o),l=s.value}catch(c){return void n(c)}s.done?t(l):Promise.resolve(l).then(i,r)}function r(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function s(e){i(o,r,a,s,l,"next",e)}function l(e){i(o,r,a,s,l,"throw",e)}s(void 0)}))}}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";function i(e){return(i="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}n.d(t,"a",(function(){return a}));var r=n(6);function a(e,t){return!t||"object"!==i(t)&&"function"!==typeof t?Object(r.a)(e):t}},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var i=n(16);function r(e,t){if(e){if("string"===typeof e)return Object(i.a)(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Object(i.a)(e,t):void 0}}},function(e,t,n){"use strict";function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}n.d(t,"a",(function(){return i}))},function(e,t,n){e.exports=n(53)},function(e,t,n){"use strict";function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}n.d(t,"a",(function(){return i}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var i=n(14),r=n(18);function a(e,t,n){return(a=Object(r.a)()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var a=new(Function.bind.apply(e,r));return n&&Object(i.a)(a,n.prototype),a}).apply(null,arguments)}},function(e,t,n){"use strict";function i(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}n.d(t,"a",(function(){return i}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var i=n(13);function r(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=Object(i.a)(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){l=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(l)throw o}}}}},function(e,t,n){e.exports=function(){"use strict";var e,t,n;function i(i,r){if(e)if(t){var a="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/api/#transpiling-v2'); }; var sharedChunk = {}; ("+e+")(sharedChunk); ("+t+")(sharedChunk); self.onerror = null;",o={};e(o),n=r(o),"undefined"!==typeof window&&(n.workerUrl=window.URL.createObjectURL(new Blob([a],{type:"text/javascript"})))}else t=r;else e=r}return i(["exports"],(function(e){var t="2.3.0",n=i;function i(e,t,n,i){this.cx=3*e,this.bx=3*(n-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(i-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=n,this.p2y=i}i.prototype.sampleCurveX=function(e){return((this.ax*e+this.bx)*e+this.cx)*e},i.prototype.sampleCurveY=function(e){return((this.ay*e+this.by)*e+this.cy)*e},i.prototype.sampleCurveDerivativeX=function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},i.prototype.solveCurveX=function(e,t){var n,i,r,a,o;for(void 0===t&&(t=1e-6),r=e,o=0;o<8;o++){if(a=this.sampleCurveX(r)-e,Math.abs(a)<t)return r;var s=this.sampleCurveDerivativeX(r);if(Math.abs(s)<1e-6)break;r-=a/s}if((r=e)<(n=0))return n;if(r>(i=1))return i;for(;n<i;){if(a=this.sampleCurveX(r),Math.abs(a-e)<t)return r;e>a?n=r:i=r,r=.5*(i-n)+n}return r},i.prototype.solve=function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))};var r=a;function a(e,t){this.x=e,this.y=t}a.prototype={clone:function(){return new a(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,n=e.y-this.y;return t*t+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),n=Math.sin(e),i=n*this.x+t*this.y;return this.x=t*this.x-n*this.y,this.y=i,this},_rotateAround:function(e,t){var n=Math.cos(e),i=Math.sin(e),r=t.y+i*(this.x-t.x)+n*(this.y-t.y);return this.x=t.x+n*(this.x-t.x)-i*(this.y-t.y),this.y=r,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},a.convert=function(e){return e instanceof a?e:Array.isArray(e)?new a(e[0],e[1]):e};var o="undefined"!=typeof self?self:{};const s=Math.pow(2,53)-1,l=Math.PI/180,c=180/Math.PI;function u(e){return e*l}const h=[[0,0],[1,0],[1,1],[0,1]];function d(e){if(e<=0)return 0;if(e>=1)return 1;const t=e*e,n=t*e;return 4*(e<.5?n:3*(e-t)+n-.75)}function p(e,t,i,r){const a=new n(e,t,i,r);return function(e){return a.solve(e)}}const f=p(.25,.1,.25,1);function m(e,t,n){return Math.min(n,Math.max(t,e))}function g(e,t,n){const i=n-t,r=((e-t)%i+i)%i+t;return r===t?n:r}function v(e,t,n){if(!e.length)return n(null,[]);let i=e.length;const r=new Array(e.length);let a=null;e.forEach(((e,o)=>{t(e,((e,t)=>{e&&(a=e),r[o]=t,0==--i&&n(a,r)}))}))}function y(e){const t=[];for(const n in e)t.push(e[n]);return t}function _(e,...t){for(const n of t)for(const t in n)e[t]=n[t];return e}let x=1;function b(){return x++}function w(){return function e(t){return t?(t^16*Math.random()>>t/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function S(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function T(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function E(e,t){e.forEach((e=>{t[e]&&(t[e]=t[e].bind(t))}))}function M(e,t){return-1!==e.indexOf(t,e.length-t.length)}function k(e,t,n){const i={};for(const r in e)i[r]=t.call(n||this,e[r],r,e);return i}function A(e,t,n){const i={};for(const r in e)t.call(n||this,e[r],r,e)&&(i[r]=e[r]);return i}function C(e){return Array.isArray(e)?e.map(C):"object"==typeof e&&e?k(e,C):e}const P={};function L(e){P[e]||("undefined"!=typeof console&&console.warn(e),P[e]=!0)}function I(e,t,n){return(n.y-e.y)*(t.x-e.x)>(t.y-e.y)*(n.x-e.x)}function R(e){let t=0;for(let n,i,r=0,a=e.length,o=a-1;r<a;o=r++)n=e[r],i=e[o],t+=(i.x-n.x)*(n.y+i.y);return t}function z(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function D(e){const t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((e,n,i,r)=>{const a=i||r;return t[n]=!a||a.toLowerCase(),""})),t["max-age"]){const e=parseInt(t["max-age"],10);isNaN(e)?delete t["max-age"]:t["max-age"]=e}return t}let O,B,F,N=null;function U(e){if(null==N){const t=e.navigator?e.navigator.userAgent:null;N=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return N}function V(e){try{const t=o[e];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch(e){return!1}}const j={now:()=>void 0!==F?F:o.performance.now(),setNow(e){F=e},restoreNow(){F=void 0},frame(e){const t=o.requestAnimationFrame(e);return{cancel:()=>o.cancelAnimationFrame(t)}},getImageData(e,t=0){const n=o.document.createElement("canvas"),i=n.getContext("2d");if(!i)throw new Error("failed to create canvas 2d context");return n.width=e.width,n.height=e.height,i.drawImage(e,0,0,e.width,e.height),i.getImageData(-t,-t,e.width+2*t,e.height+2*t)},resolveURL:e=>(O||(O=o.document.createElement("a")),O.href=e,O.href),get devicePixelRatio(){return o.devicePixelRatio},get prefersReducedMotion(){return!!o.matchMedia&&(null==B&&(B=o.matchMedia("(prefers-reduced-motion: reduce)")),B.matches)}};let G;const H={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==G){const e=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{G=null!=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).API_URL_REGEX?new RegExp(Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).API_URL_REGEX):e}catch(t){G=e}}return G},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},W={supported:!1,testSupport:function(e){!$&&Z&&(X?Y(e):q=e)}};let q,Z,$=!1,X=!1;function Y(e){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,Z),e.isContextLost())return;W.supported=!0}catch(e){}e.deleteTexture(t),$=!0}o.document&&(Z=o.document.createElement("img"),Z.onload=function(){q&&Y(q),q=null,X=!0},Z.onerror=function(){$=!0,q=null},Z.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const J="01",K="NO_ACCESS_TOKEN";function Q(e){return 0===e.indexOf("mapbox:")}function ee(e){return H.API_URL_REGEX.test(e)}const te=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ne(e){const t=e.match(te);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function ie(e){const t=e.params.length?`?${e.params.join("&")}`:"";return`${e.protocol}://${e.authority}${e.path}${t}`}function re(e){if(!e)return null;const t=e.split(".");if(!t||3!==t.length)return null;try{return JSON.parse(decodeURIComponent(o.atob(t[1]).split("").map((e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2))).join("")))}catch(e){return null}}class ae{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const t=re(H.ACCESS_TOKEN);let n="";return n=t&&t.u?o.btoa(encodeURIComponent(t.u).replace(/%([0-9A-F]{2})/g,((e,t)=>String.fromCharCode(Number("0x"+t))))):H.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${n}`:`mapbox.eventData:${n}`}fetchEventData(){const e=V("localStorage"),t=this.getStorageKey(),n=this.getStorageKey("uuid");if(e)try{const e=o.localStorage.getItem(t);e&&(this.eventData=JSON.parse(e));const i=o.localStorage.getItem(n);i&&(this.anonId=i)}catch(e){L("Unable to read from LocalStorage")}}saveEventData(){const e=V("localStorage"),t=this.getStorageKey(),n=this.getStorageKey("uuid");if(e)try{o.localStorage.setItem(n,this.anonId),Object.keys(this.eventData).length>=1&&o.localStorage.setItem(t,JSON.stringify(this.eventData))}catch(e){L("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,n,i,r){if(!H.EVENTS_URL)return;const a=ne(H.EVENTS_URL);a.params.push(`access_token=${r||H.ACCESS_TOKEN||""}`);const o={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:t,skuId:J,userId:this.anonId},s=n?_(o,n):o,l={url:ie(a),headers:{"Content-Type":"text/plain"},body:JSON.stringify([s])};this.pendingRequest=Me(l,(e=>{this.pendingRequest=null,i(e),this.saveEventData(),this.processRequests(r)}))}queueRequest(e,t){this.queue.push(e),this.processRequests(t)}}const oe=new class extends ae{constructor(e){super("appUserTurnstile"),this._customAccessToken=e}postTurnstileEvent(e,t){H.EVENTS_URL&&H.ACCESS_TOKEN&&Array.isArray(e)&&e.some((e=>Q(e)||ee(e)))&&this.queueRequest(Date.now(),t)}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=re(H.ACCESS_TOKEN),n=t?t.u:H.ACCESS_TOKEN;let i=n!==this.eventData.tokenU;T(this.anonId)||(this.anonId=w(),i=!0);const r=this.queue.shift();if(this.eventData.lastSuccess){const e=new Date(this.eventData.lastSuccess),t=new Date(r),n=(r-this.eventData.lastSuccess)/864e5;i=i||n>=1||n<-1||e.getDate()!==t.getDate()}else i=!0;if(!i)return this.processRequests();this.postEvent(r,{"enabled.telemetry":!1},(e=>{e||(this.eventData.lastSuccess=r,this.eventData.tokenU=n)}),e)}},se=oe.postTurnstileEvent.bind(oe),le=new class extends ae{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(e,t,n,i){this.skuToken=t,this.errorCb=i,H.EVENTS_URL&&(n||H.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},n):this.errorCb(new Error(K)))}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:n}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),T(this.anonId)||(this.anonId=w()),this.postEvent(n,{skuToken:this.skuToken},(e=>{e?this.errorCb(e):t&&(this.success[t]=!0)}),e))}},ce=le.postMapLoadEvent.bind(le),ue=new class extends ae{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(e,t,n,i){if(!H.API_URL||!H.SESSION_PATH)return;const r=ne(H.API_URL+H.SESSION_PATH);r.params.push(`sku=${t||""}`),r.params.push(`access_token=${i||H.ACCESS_TOKEN||""}`);const a={url:ie(r),headers:{"Content-Type":"text/plain"}};this.pendingRequest=ke(a,(e=>{this.pendingRequest=null,n(e),this.saveEventData(),this.processRequests(i)}))}getSessionAPI(e,t,n,i){this.skuToken=t,this.errorCb=i,H.SESSION_PATH&&H.API_URL&&(n||H.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},n):this.errorCb(new Error(K)))}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:n}=this.queue.shift();t&&this.success[t]||this.getSession(n,this.skuToken,(e=>{e?this.errorCb(e):t&&(this.success[t]=!0)}),e)}},he=ue.getSessionAPI.bind(ue),de=new Set,pe="mapbox-tiles";let fe,me,ge=500,ve=50;function ye(){o.caches&&!fe&&(fe=o.caches.open(pe))}function _e(e){const t=e.indexOf("?");return t<0?e:e.slice(0,t)}let xe=1/0;const be={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(be);class we extends Error{constructor(e,t,n){401===t&&ee(n)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(e),this.status=t,this.url=n}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Se=z()?()=>self.worker&&self.worker.referrer:()=>("blob:"===o.location.protocol?o.parent:o).location.href,Te=function(e,t){if(!(/^file:/.test(n=e.url)||/^file:/.test(Se())&&!/^\w+:/.test(n))){if(o.fetch&&o.Request&&o.AbortController&&o.Request.prototype.hasOwnProperty("signal"))return function(e,t){const n=new o.AbortController,i=new o.Request(e.url,{method:e.method||"GET",body:e.body,credentials:e.credentials,headers:e.headers,referrer:Se(),signal:n.signal});let r=!1,a=!1;const s=(l=i.url).indexOf("sku=")>0&&ee(l);var l;"json"===e.type&&i.headers.set("Accept","application/json");const c=(n,r,l)=>{if(a)return;if(n&&"SecurityError"!==n.message&&L(n),r&&l)return u(r);const c=Date.now();o.fetch(i).then((n=>{if(n.ok){const e=s?n.clone():null;return u(n,e,c)}return t(new we(n.statusText,n.status,e.url))})).catch((e=>{20!==e.code&&t(new Error(e.message))}))},u=(n,s,l)=>{("arrayBuffer"===e.type?n.arrayBuffer():"json"===e.type?n.json():n.text()).then((e=>{a||(s&&l&&function(e,t,n){if(ye(),!fe)return;const i={status:t.status,statusText:t.statusText,headers:new o.Headers};t.headers.forEach(((e,t)=>i.headers.set(t,e)));const r=D(t.headers.get("Cache-Control")||"");r["no-store"]||(r["max-age"]&&i.headers.set("Expires",new Date(n+1e3*r["max-age"]).toUTCString()),new Date(i.headers.get("Expires")).getTime()-n<42e4||function(e,t){if(void 0===me)try{new Response(new ReadableStream),me=!0}catch(e){me=!1}me?t(e.body):e.blob().then(t)}(t,(t=>{const n=new o.Response(t,i);ye(),fe&&fe.then((t=>t.put(_e(e.url),n))).catch((e=>L(e.message)))})))}(i,s,l),r=!0,t(null,e,n.headers.get("Cache-Control"),n.headers.get("Expires")))})).catch((e=>{a||t(new Error(e.message))}))};return s?function(e,t){if(ye(),!fe)return t(null);const n=_e(e.url);fe.then((e=>{e.match(n).then((i=>{const r=function(e){if(!e)return!1;const t=new Date(e.headers.get("Expires")||0),n=D(e.headers.get("Cache-Control")||"");return t>Date.now()&&!n["no-cache"]}(i);e.delete(n),r&&e.put(n,i.clone()),t(null,i,r)})).catch(t)})).catch(t)}(i,c):c(null,null),{cancel:()=>{a=!0,r||n.abort()}}}(e,t);if(z()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,t,void 0,!0)}var n;return function(e,t){const n=new o.XMLHttpRequest;n.open(e.method||"GET",e.url,!0),"arrayBuffer"===e.type&&(n.responseType="arraybuffer");for(const i in e.headers)n.setRequestHeader(i,e.headers[i]);return"json"===e.type&&(n.responseType="text",n.setRequestHeader("Accept","application/json")),n.withCredentials="include"===e.credentials,n.onerror=()=>{t(new Error(n.statusText))},n.onload=()=>{if((n.status>=200&&n.status<300||0===n.status)&&null!==n.response){let i=n.response;if("json"===e.type)try{i=JSON.parse(n.response)}catch(e){return t(e)}t(null,i,n.getResponseHeader("Cache-Control"),n.getResponseHeader("Expires"))}else t(new we(n.statusText,n.status,e.url))},n.send(e.body),{cancel:()=>n.abort()}}(e,t)},Ee=function(e,t){return Te(_(e,{type:"arrayBuffer"}),t)},Me=function(e,t){return Te(_(e,{method:"POST"}),t)},ke=function(e,t){return Te(_(e,{method:"GET"}),t)};function Ae(e){const t=o.document.createElement("a");return t.href=e,t.protocol===o.document.location.protocol&&t.host===o.document.location.host}const Ce="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Pe,Le;Pe=[],Le=0;const Ie=function(e,t){if(W.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),Le>=H.MAX_PARALLEL_IMAGE_REQUESTS){const n={requestParameters:e,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return Pe.push(n),n}Le++;let n=!1;const i=()=>{if(!n)for(n=!0,Le--;Pe.length&&Le<H.MAX_PARALLEL_IMAGE_REQUESTS;){const e=Pe.shift(),{requestParameters:t,callback:n,cancelled:i}=e;i||(e.cancel=Ie(t,n).cancel)}},r=Ee(e,((e,n,r,a)=>{i(),e?t(e):n&&(o.createImageBitmap?function(e,t){const n=new o.Blob([new Uint8Array(e)],{type:"image/png"});o.createImageBitmap(n).then((e=>{t(null,e)})).catch((e=>{t(new Error(`Could not load image because of ${e.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))}))}(n,((e,n)=>t(e,n,r,a))):function(e,t){const n=new o.Image,i=o.URL;n.onload=()=>{t(null,n),i.revokeObjectURL(n.src),n.onload=null,o.requestAnimationFrame((()=>{n.src=Ce}))},n.onerror=()=>t(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const r=new o.Blob([new Uint8Array(e)],{type:"image/png"});n.src=e.byteLength?i.createObjectURL(r):Ce}(n,((e,n)=>t(e,n,r,a))))}));return{cancel:()=>{r.cancel(),i()}}};function Re(e,t,n){n[e]&&-1!==n[e].indexOf(t)||(n[e]=n[e]||[],n[e].push(t))}function ze(e,t,n){if(n&&n[e]){const i=n[e].indexOf(t);-1!==i&&n[e].splice(i,1)}}class De{constructor(e,t={}){_(this,t),this.type=e}}class Oe extends De{constructor(e,t={}){super("error",_({error:e},t))}}class Be{on(e,t){return this._listeners=this._listeners||{},Re(e,t,this._listeners),this}off(e,t){return ze(e,t,this._listeners),ze(e,t,this._oneTimeListeners),this}once(e,t){return t?(this._oneTimeListeners=this._oneTimeListeners||{},Re(e,t,this._oneTimeListeners),this):new Promise((t=>this.once(e,t)))}fire(e,t){"string"==typeof e&&(e=new De(e,t||{}));const n=e.type;if(this.listens(n)){e.target=this;const t=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];for(const n of t)n.call(this,e);const i=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];for(const a of i)ze(n,a,this._oneTimeListeners),a.call(this,e);const r=this._eventedParent;r&&(_(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),r.fire(e))}else e instanceof Oe&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,t){return this._eventedParent=e,this._eventedParentData=t,this}}var Fe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},fog:{type:"fog"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{},sky:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_sky:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},fog:{range:{type:"array",default:[.5,10],minimum:-20,maximum:20,length:2,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.1,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number","property-type":"data-constant",default:1,minimum:0,maximum:1e3,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_sky:{"sky-type":{type:"enum",values:{gradient:{},atmosphere:{}},default:"atmosphere",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{type:"array",value:"number",length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,requires:[{"sky-type":"atmosphere"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{type:"number",requires:[{"sky-type":"atmosphere"}],default:10,minimum:0,maximum:100,transition:!1,"property-type":"data-constant"},"sky-gradient-center":{type:"array",requires:[{"sky-type":"gradient"}],value:"number",default:[0,0],length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{type:"number",requires:[{"sky-type":"gradient"}],default:90,minimum:0,maximum:180,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient":{type:"color",default:["interpolate",["linear"],["sky-radial-progress"],.8,"#87ceeb",1,"white"],transition:!1,requires:[{"sky-type":"gradient"}],expression:{interpolated:!0,parameters:["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{type:"color",default:"white",transition:!1,requires:[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{type:"color",default:"white",transition:!1,requires:[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class Ne{constructor(e,t,n,i){this.message=(e?`${e}: `:"")+n,i&&(this.identifier=i),null!=t&&t.__line__&&(this.line=t.__line__)}}function Ue(e){const t=e.value;return t?[new Ne(e.key,t,"constants have been deprecated as of v8")]:[]}function Ve(e,...t){for(const n of t)for(const t in n)e[t]=n[t];return e}function je(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function Ge(e){if(Array.isArray(e))return e.map(Ge);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){const t={};for(const n in e)t[n]=Ge(e[n]);return t}return je(e)}class He extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}class We{constructor(e,t=[]){this.parent=e,this.bindings={};for(const[n,i]of t)this.bindings[n]=i}concat(e){return new We(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const qe={kind:"null"},Ze={kind:"number"},$e={kind:"string"},Xe={kind:"boolean"},Ye={kind:"color"},Je={kind:"object"},Ke={kind:"value"},Qe={kind:"collator"},et={kind:"formatted"},tt={kind:"resolvedImage"};function nt(e,t){return{kind:"array",itemType:e,N:t}}function it(e){if("array"===e.kind){const t=it(e.itemType);return"number"==typeof e.N?`array<${t}, ${e.N}>`:"value"===e.itemType.kind?"array":`array<${t}>`}return e.kind}const rt=[qe,Ze,$e,Xe,Ye,et,Je,nt(Ke),tt];function at(e,t){if("error"===t.kind)return null;if("array"===e.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!at(e.itemType,t.itemType))&&("number"!=typeof e.N||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if("value"===e.kind)for(const e of rt)if(!at(e,t))return null}return`Expected ${it(e)} but found ${it(t)} instead.`}function ot(e,t){return t.some((t=>t.kind===e.kind))}function st(e,t){return t.some((t=>"null"===t?null===e:"array"===t?Array.isArray(e):"object"===t?e&&!Array.isArray(e)&&"object"==typeof e:t===typeof e))}function lt(e){var t={exports:{}};return e(t,t.exports),t.exports}var ct=lt((function(e,t){var n={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function i(e){return(e=Math.round(e))<0?0:e>255?255:e}function r(e){return i("%"===e[e.length-1]?parseFloat(e)/100*255:parseInt(e))}function a(e){return(t="%"===e[e.length-1]?parseFloat(e)/100:parseFloat(e))<0?0:t>1?1:t;var t}function o(e,t,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?e+(t-e)*n*6:2*n<1?t:3*n<2?e+(t-e)*(2/3-n)*6:e}try{t.parseCSSColor=function(e){var t,s=e.replace(/ /g,"").toLowerCase();if(s in n)return n[s].slice();if("#"===s[0])return 4===s.length?(t=parseInt(s.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:7===s.length&&(t=parseInt(s.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var l=s.indexOf("("),c=s.indexOf(")");if(-1!==l&&c+1===s.length){var u=s.substr(0,l),h=s.substr(l+1,c-(l+1)).split(","),d=1;switch(u){case"rgba":if(4!==h.length)return null;d=a(h.pop());case"rgb":return 3!==h.length?null:[r(h[0]),r(h[1]),r(h[2]),d];case"hsla":if(4!==h.length)return null;d=a(h.pop());case"hsl":if(3!==h.length)return null;var p=(parseFloat(h[0])%360+360)%360/360,f=a(h[1]),m=a(h[2]),g=m<=.5?m*(f+1):m+f-m*f,v=2*m-g;return[i(255*o(v,g,p+1/3)),i(255*o(v,g,p)),i(255*o(v,g,p-1/3)),d];default:return null}}return null}}catch(e){}}));class ut{constructor(e,t,n,i=1){this.r=e,this.g=t,this.b=n,this.a=i}static parse(e){if(!e)return;if(e instanceof ut)return e;if("string"!=typeof e)return;const t=ct.parseCSSColor(e);return t?new ut(t[0]/255*t[3],t[1]/255*t[3],t[2]/255*t[3],t[3]):void 0}toString(){const[e,t,n,i]=this.toArray();return`rgba(${Math.round(e)},${Math.round(t)},${Math.round(n)},${i})`}toArray(){const{r:e,g:t,b:n,a:i}=this;return 0===i?[0,0,0,0]:[255*e/i,255*t/i,255*n/i,i]}}ut.black=new ut(0,0,0,1),ut.white=new ut(1,1,1,1),ut.transparent=new ut(0,0,0,0),ut.red=new ut(1,0,0,1),ut.blue=new ut(0,0,1,1);class ht{constructor(e,t,n){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class dt{constructor(e,t,n,i,r){this.text=e,this.image=t,this.scale=n,this.fontStack=i,this.textColor=r}}class pt{constructor(e){this.sections=e}static fromString(e){return new pt([new dt(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some((e=>0!==e.text.length||e.image&&0!==e.image.name.length))}static factory(e){return e instanceof pt?e:pt.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map((e=>e.text)).join("")}serialize(){const e=["format"];for(const t of this.sections){if(t.image){e.push(["image",t.image.name]);continue}e.push(t.text);const n={};t.fontStack&&(n["text-font"]=["literal",t.fontStack.split(",")]),t.scale&&(n["font-scale"]=t.scale),t.textColor&&(n["text-color"]=["rgba"].concat(t.textColor.toArray())),e.push(n)}return e}}class ft{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new ft({name:e,available:!1}):null}serialize(){return["image",this.name]}}function mt(e,t,n,i){return"number"==typeof e&&e>=0&&e<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof n&&n>=0&&n<=255?void 0===i||"number"==typeof i&&i>=0&&i<=1?null:`Invalid rgba value [${[e,t,n,i].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof i?[e,t,n,i]:[e,t,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function gt(e){if(null===e)return!0;if("string"==typeof e)return!0;if("boolean"==typeof e)return!0;if("number"==typeof e)return!0;if(e instanceof ut)return!0;if(e instanceof ht)return!0;if(e instanceof pt)return!0;if(e instanceof ft)return!0;if(Array.isArray(e)){for(const t of e)if(!gt(t))return!1;return!0}if("object"==typeof e){for(const t in e)if(!gt(e[t]))return!1;return!0}return!1}function vt(e){if(null===e)return qe;if("string"==typeof e)return $e;if("boolean"==typeof e)return Xe;if("number"==typeof e)return Ze;if(e instanceof ut)return Ye;if(e instanceof ht)return Qe;if(e instanceof pt)return et;if(e instanceof ft)return tt;if(Array.isArray(e)){const t=e.length;let n;for(const i of e){const e=vt(i);if(n){if(n===e)continue;n=Ke;break}n=e}return nt(n||Ke,t)}return Je}function yt(e){const t=typeof e;return null===e?"":"string"===t||"number"===t||"boolean"===t?String(e):e instanceof ut||e instanceof pt||e instanceof ft?e.toString():JSON.stringify(e)}class _t{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(2!==e.length)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!gt(e[1]))return t.error("invalid value");const n=e[1];let i=vt(n);const r=t.expectedType;return"array"!==i.kind||0!==i.N||!r||"array"!==r.kind||"number"==typeof r.N&&0!==r.N||(i=r),new _t(i,n)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof ut?["rgba"].concat(this.value.toArray()):this.value instanceof pt?this.value.serialize():this.value}}class xt{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const bt={string:$e,number:Ze,boolean:Xe,object:Je};class wt{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let n,i=1;const r=e[0];if("array"===r){let r,a;if(e.length>2){const n=e[1];if("string"!=typeof n||!(n in bt)||"object"===n)return t.error('The item type argument of "array" must be one of string, number, boolean',1);r=bt[n],i++}else r=Ke;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);a=e[2],i++}n=nt(r,a)}else n=bt[r];const a=[];for(;i<e.length;i++){const n=t.parse(e[i],i,Ke);if(!n)return null;a.push(n)}return new wt(n,a)}evaluate(e){for(let t=0;t<this.args.length;t++){const n=this.args[t].evaluate(e);if(!at(this.type,vt(n)))return n;if(t===this.args.length-1)throw new xt(`Expected value to be of type ${it(this.type)}, but found ${it(vt(n))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=this.type,t=[e.kind];if("array"===e.kind){const n=e.itemType;if("string"===n.kind||"number"===n.kind||"boolean"===n.kind){t.push(n.kind);const i=e.N;("number"==typeof i||this.args.length>1)&&t.push(i)}}return t.concat(this.args.map((e=>e.serialize())))}}class St{constructor(e){this.type=et,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const n=e[1];if(!Array.isArray(n)&&"object"==typeof n)return t.error("First argument must be an image or text section.");const i=[];let r=!1;for(let a=1;a<=e.length-1;++a){const n=e[a];if(r&&"object"==typeof n&&!Array.isArray(n)){r=!1;let e=null;if(n["font-scale"]&&(e=t.parse(n["font-scale"],1,Ze),!e))return null;let a=null;if(n["text-font"]&&(a=t.parse(n["text-font"],1,nt($e)),!a))return null;let o=null;if(n["text-color"]&&(o=t.parse(n["text-color"],1,Ye),!o))return null;const s=i[i.length-1];s.scale=e,s.font=a,s.textColor=o}else{const n=t.parse(e[a],1,Ke);if(!n)return null;const o=n.type.kind;if("string"!==o&&"value"!==o&&"null"!==o&&"resolvedImage"!==o)return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");r=!0,i.push({content:n,scale:null,font:null,textColor:null})}}return new St(i)}evaluate(e){return new pt(this.sections.map((t=>{const n=t.content.evaluate(e);return vt(n)===tt?new dt("",n,null,null,null):new dt(yt(n),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)})))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const t of this.sections){e.push(t.content.serialize());const n={};t.scale&&(n["font-scale"]=t.scale.serialize()),t.font&&(n["text-font"]=t.font.serialize()),t.textColor&&(n["text-color"]=t.textColor.serialize()),e.push(n)}return e}}class Tt{constructor(e){this.type=tt,this.input=e}static parse(e,t){if(2!==e.length)return t.error("Expected two arguments.");const n=t.parse(e[1],1,$e);return n?new Tt(n):t.error("No image name provided.")}evaluate(e){const t=this.input.evaluate(e),n=ft.fromString(t);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(t)>-1),n}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Et={"to-boolean":Xe,"to-color":Ye,"to-number":Ze,"to-string":$e};class Mt{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const n=e[0];if(("to-boolean"===n||"to-string"===n)&&2!==e.length)return t.error("Expected one argument.");const i=Et[n],r=[];for(let a=1;a<e.length;a++){const n=t.parse(e[a],a,Ke);if(!n)return null;r.push(n)}return new Mt(i,r)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let t,n;for(const i of this.args){if(t=i.evaluate(e),n=null,t instanceof ut)return t;if("string"==typeof t){const n=e.parseColor(t);if(n)return n}else if(Array.isArray(t)&&(n=t.length<3||t.length>4?`Invalid rbga value ${JSON.stringify(t)}: expected an array containing either three or four numeric values.`:mt(t[0],t[1],t[2],t[3]),!n))return new ut(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new xt(n||`Could not parse color from value '${"string"==typeof t?t:String(JSON.stringify(t))}'`)}if("number"===this.type.kind){let t=null;for(const n of this.args){if(t=n.evaluate(e),null===t)return 0;const i=Number(t);if(!isNaN(i))return i}throw new xt(`Could not convert ${JSON.stringify(t)} to number.`)}return"formatted"===this.type.kind?pt.fromString(yt(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?ft.fromString(yt(this.args[0].evaluate(e))):yt(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){if("formatted"===this.type.kind)return new St([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Tt(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild((t=>{e.push(t.serialize())})),e}}const kt=["Unknown","Point","LineString","Polygon"];class At{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?kt[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=ut.parse(e)),t}}class Ct{constructor(e,t,n,i){this.name=e,this.type=t,this._evaluate=n,this.args=i}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((e=>e.serialize())))}static parse(e,t){const n=e[0],i=Ct.definitions[n];if(!i)return t.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0);const r=Array.isArray(i)?i[0]:i.type,a=Array.isArray(i)?[[i[1],i[2]]]:i.overloads,o=a.filter((([t])=>!Array.isArray(t)||t.length===e.length-1));let s=null;for(const[l,c]of o){s=new Kt(t.registry,t.path,null,t.scope);const i=[];let a=!1;for(let t=1;t<e.length;t++){const n=e[t],r=Array.isArray(l)?l[t-1]:l.type,o=s.parse(n,1+i.length,r);if(!o){a=!0;break}i.push(o)}if(!a)if(Array.isArray(l)&&l.length!==i.length)s.error(`Expected ${l.length} arguments, but found ${i.length} instead.`);else{for(let e=0;e<i.length;e++){const t=Array.isArray(l)?l[e]:l.type,n=i[e];s.concat(e+1).checkSubtype(t,n.type)}if(0===s.errors.length)return new Ct(n,r,c,i)}}if(1===o.length)t.errors.push(...s.errors);else{const n=(o.length?o:a).map((([e])=>{return t=e,Array.isArray(t)?`(${t.map(it).join(", ")})`:`(${it(t.type)}...)`;var t})).join(" | "),i=[];for(let r=1;r<e.length;r++){const n=t.parse(e[r],1+i.length);if(!n)return null;i.push(it(n.type))}t.error(`Expected arguments of type ${n}, but found (${i.join(", ")}) instead.`)}return null}static register(e,t){Ct.definitions=t;for(const n in t)e[n]=Ct}}class Pt{constructor(e,t,n){this.type=Qe,this.locale=n,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(2!==e.length)return t.error("Expected one argument.");const n=e[1];if("object"!=typeof n||Array.isArray(n))return t.error("Collator options argument must be an object.");const i=t.parse(void 0!==n["case-sensitive"]&&n["case-sensitive"],1,Xe);if(!i)return null;const r=t.parse(void 0!==n["diacritic-sensitive"]&&n["diacritic-sensitive"],1,Xe);if(!r)return null;let a=null;return n.locale&&(a=t.parse(n.locale,1,$e),!a)?null:new Pt(i,r,a)}evaluate(e){return new ht(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const Lt=8192;function It(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function Rt(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function zt(e,t){const n=(180+e[0])/360,i=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,r=Math.pow(2,t.z);return[Math.round(n*r*Lt),Math.round(i*r*Lt)]}function Dt(e,t,n){const i=e[0]-t[0],r=e[1]-t[1],a=e[0]-n[0],o=e[1]-n[1];return i*o-a*r==0&&i*a<=0&&r*o<=0}function Ot(e,t){let n=!1;for(let o=0,s=t.length;o<s;o++){const s=t[o];for(let t=0,o=s.length;t<o-1;t++){if(Dt(e,s[t],s[t+1]))return!1;(r=s[t])[1]>(i=e)[1]!=(a=s[t+1])[1]>i[1]&&i[0]<(a[0]-r[0])*(i[1]-r[1])/(a[1]-r[1])+r[0]&&(n=!n)}}var i,r,a;return n}function Bt(e,t){for(let n=0;n<t.length;n++)if(Ot(e,t[n]))return!0;return!1}function Ft(e,t,n,i){const r=i[0]-n[0],a=i[1]-n[1],o=(e[0]-n[0])*a-r*(e[1]-n[1]),s=(t[0]-n[0])*a-r*(t[1]-n[1]);return o>0&&s<0||o<0&&s>0}function Nt(e,t,n){for(const c of n)for(let n=0;n<c.length-1;++n)if(0!=(s=[(o=c[n+1])[0]-(a=c[n])[0],o[1]-a[1]])[0]*(l=[(r=t)[0]-(i=e)[0],r[1]-i[1]])[1]-s[1]*l[0]&&Ft(i,r,a,o)&&Ft(a,o,i,r))return!0;var i,r,a,o,s,l;return!1}function Ut(e,t){for(let n=0;n<e.length;++n)if(!Ot(e[n],t))return!1;for(let n=0;n<e.length-1;++n)if(Nt(e[n],e[n+1],t))return!1;return!0}function Vt(e,t){for(let n=0;n<t.length;n++)if(Ut(e,t[n]))return!0;return!1}function jt(e,t,n){const i=[];for(let r=0;r<e.length;r++){const a=[];for(let i=0;i<e[r].length;i++){const o=zt(e[r][i],n);It(t,o),a.push(o)}i.push(a)}return i}function Gt(e,t,n){const i=[];for(let r=0;r<e.length;r++){const a=jt(e[r],t,n);i.push(a)}return i}function Ht(e,t,n,i){if(e[0]<n[0]||e[0]>n[2]){const t=.5*i;let r=e[0]-n[0]>t?-i:n[0]-e[0]>t?i:0;0===r&&(r=e[0]-n[2]>t?-i:n[2]-e[0]>t?i:0),e[0]+=r}It(t,e)}function Wt(e,t,n,i){const r=Math.pow(2,i.z)*Lt,a=[i.x*Lt,i.y*Lt],o=[];for(const s of e)for(const e of s){const i=[e.x+a[0],e.y+a[1]];Ht(i,t,n,r),o.push(i)}return o}function qt(e,t,n,i){const r=Math.pow(2,i.z)*Lt,a=[i.x*Lt,i.y*Lt],o=[];for(const l of e){const e=[];for(const n of l){const i=[n.x+a[0],n.y+a[1]];It(t,i),e.push(i)}o.push(e)}if(t[2]-t[0]<=r/2){(s=t)[0]=s[1]=1/0,s[2]=s[3]=-1/0;for(const e of o)for(const i of e)Ht(i,t,n,r)}var s;return o}class Zt{constructor(e,t){this.type=Xe,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(gt(e[1])){const t=e[1];if("FeatureCollection"===t.type)for(let e=0;e<t.features.length;++e){const n=t.features[e].geometry.type;if("Polygon"===n||"MultiPolygon"===n)return new Zt(t,t.features[e].geometry)}else if("Feature"===t.type){const e=t.geometry.type;if("Polygon"===e||"MultiPolygon"===e)return new Zt(t,t.geometry)}else if("Polygon"===t.type||"MultiPolygon"===t.type)return new Zt(t,t)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(e,t){const n=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],r=e.canonicalID();if("Polygon"===t.type){const a=jt(t.coordinates,i,r),o=Wt(e.geometry(),n,i,r);if(!Rt(n,i))return!1;for(const e of o)if(!Ot(e,a))return!1}if("MultiPolygon"===t.type){const a=Gt(t.coordinates,i,r),o=Wt(e.geometry(),n,i,r);if(!Rt(n,i))return!1;for(const e of o)if(!Bt(e,a))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(e,t){const n=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],r=e.canonicalID();if("Polygon"===t.type){const a=jt(t.coordinates,i,r),o=qt(e.geometry(),n,i,r);if(!Rt(n,i))return!1;for(const e of o)if(!Ut(e,a))return!1}if("MultiPolygon"===t.type){const a=Gt(t.coordinates,i,r),o=qt(e.geometry(),n,i,r);if(!Rt(n,i))return!1;for(const e of o)if(!Vt(e,a))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function $t(e){if(e instanceof Ct){if("get"===e.name&&1===e.args.length)return!1;if("feature-state"===e.name)return!1;if("has"===e.name&&1===e.args.length)return!1;if("properties"===e.name||"geometry-type"===e.name||"id"===e.name)return!1;if(/^filter-/.test(e.name))return!1}if(e instanceof Zt)return!1;let t=!0;return e.eachChild((e=>{t&&!$t(e)&&(t=!1)})),t}function Xt(e){if(e instanceof Ct&&"feature-state"===e.name)return!1;let t=!0;return e.eachChild((e=>{t&&!Xt(e)&&(t=!1)})),t}function Yt(e,t){if(e instanceof Ct&&t.indexOf(e.name)>=0)return!1;let n=!0;return e.eachChild((e=>{n&&!Yt(e,t)&&(n=!1)})),n}class Jt{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(2!==e.length||"string"!=typeof e[1])return t.error("'var' expression requires exactly one string literal argument.");const n=e[1];return t.scope.has(n)?new Jt(n,t.scope.get(n)):t.error(`Unknown variable "${n}". Make sure "${n}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Kt{constructor(e,t=[],n,i=new We,r=[]){this.registry=e,this.path=t,this.key=t.map((e=>`[${e}]`)).join(""),this.scope=i,this.errors=r,this.expectedType=n}parse(e,t,n,i,r={}){return t?this.concat(t,n,i)._parse(e,r):this._parse(e,r)}_parse(e,t){function n(e,t,n){return"assert"===n?new wt(t,[e]):"coerce"===n?new Mt(t,[e]):e}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const i=e[0];if("string"!=typeof i)return this.error(`Expression name must be a string, but found ${typeof i} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const r=this.registry[i];if(r){let i=r.parse(e,this);if(!i)return null;if(this.expectedType){const e=this.expectedType,r=i.type;if("string"!==e.kind&&"number"!==e.kind&&"boolean"!==e.kind&&"object"!==e.kind&&"array"!==e.kind||"value"!==r.kind)if("color"!==e.kind&&"formatted"!==e.kind&&"resolvedImage"!==e.kind||"value"!==r.kind&&"string"!==r.kind){if(this.checkSubtype(e,r))return null}else i=n(i,e,t.typeAnnotation||"coerce");else i=n(i,e,t.typeAnnotation||"assert")}if(!(i instanceof _t)&&"resolvedImage"!==i.type.kind&&Qt(i)){const t=new At;try{i=new _t(i.type,i.evaluate(t))}catch(e){return this.error(e.message),null}}return i}return this.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,t,n){const i="number"==typeof e?this.path.concat(e):this.path,r=n?this.scope.concat(n):this.scope;return new Kt(this.registry,i,t||null,r,this.errors)}error(e,...t){const n=`${this.key}${t.map((e=>`[${e}]`)).join("")}`;this.errors.push(new He(n,e))}checkSubtype(e,t){const n=at(e,t);return n&&this.error(n),n}}function Qt(e){if(e instanceof Jt)return Qt(e.boundExpression);if(e instanceof Ct&&"error"===e.name)return!1;if(e instanceof Pt)return!1;if(e instanceof Zt)return!1;const t=e instanceof Mt||e instanceof wt;let n=!0;return e.eachChild((e=>{n=t?n&&Qt(e):n&&e instanceof _t})),!!n&&$t(e)&&Yt(e,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script"])}function en(e,t){const n=e.length-1;let i,r,a=0,o=n,s=0;for(;a<=o;)if(s=Math.floor((a+o)/2),i=e[s],r=e[s+1],i<=t){if(s===n||t<r)return s;a=s+1}else{if(!(i>t))throw new xt("Input is not a number.");o=s-1}return 0}class tn{constructor(e,t,n){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[i,r]of n)this.labels.push(i),this.outputs.push(r)}static parse(e,t){if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");const n=t.parse(e[1],1,Ze);if(!n)return null;const i=[];let r=null;t.expectedType&&"value"!==t.expectedType.kind&&(r=t.expectedType);for(let a=1;a<e.length;a+=2){const n=1===a?-1/0:e[a],o=e[a+1],s=a,l=a+1;if("number"!=typeof n)return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',s);if(i.length&&i[i.length-1][0]>=n)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',s);const c=t.parse(o,l,r);if(!c)return null;r=r||c.type,i.push([n,c])}return new tn(r,n,i)}evaluate(e){const t=this.labels,n=this.outputs;if(1===t.length)return n[0].evaluate(e);const i=this.input.evaluate(e);if(i<=t[0])return n[0].evaluate(e);const r=t.length;return i>=t[r-1]?n[r-1].evaluate(e):n[en(t,i)].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){const e=["step",this.input.serialize()];for(let t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e}}function nn(e,t,n){return e*(1-n)+t*n}var rn=Object.freeze({__proto__:null,number:nn,color:function(e,t,n){return new ut(nn(e.r,t.r,n),nn(e.g,t.g,n),nn(e.b,t.b,n),nn(e.a,t.a,n))},array:function(e,t,n){return e.map(((e,i)=>nn(e,t[i],n)))}});const an=.95047,on=1.08883,sn=4/29,ln=6/29,cn=3*ln*ln,un=Math.PI/180,hn=180/Math.PI;function dn(e){return e>.008856451679035631?Math.pow(e,1/3):e/cn+sn}function pn(e){return e>ln?e*e*e:cn*(e-sn)}function fn(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function mn(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function gn(e){const t=mn(e.r),n=mn(e.g),i=mn(e.b),r=dn((.4124564*t+.3575761*n+.1804375*i)/an),a=dn((.2126729*t+.7151522*n+.072175*i)/1);return{l:116*a-16,a:500*(r-a),b:200*(a-dn((.0193339*t+.119192*n+.9503041*i)/on)),alpha:e.a}}function vn(e){let t=(e.l+16)/116,n=isNaN(e.a)?t:t+e.a/500,i=isNaN(e.b)?t:t-e.b/200;return t=1*pn(t),n=an*pn(n),i=on*pn(i),new ut(fn(3.2404542*n-1.5371385*t-.4985314*i),fn(-.969266*n+1.8760108*t+.041556*i),fn(.0556434*n-.2040259*t+1.0572252*i),e.alpha)}function yn(e,t,n){const i=t-e;return e+n*(i>180||i<-180?i-360*Math.round(i/360):i)}const _n={forward:gn,reverse:vn,interpolate:function(e,t,n){return{l:nn(e.l,t.l,n),a:nn(e.a,t.a,n),b:nn(e.b,t.b,n),alpha:nn(e.alpha,t.alpha,n)}}},xn={forward:function(e){const{l:t,a:n,b:i}=gn(e),r=Math.atan2(i,n)*hn;return{h:r<0?r+360:r,c:Math.sqrt(n*n+i*i),l:t,alpha:e.a}},reverse:function(e){const t=e.h*un,n=e.c;return vn({l:e.l,a:Math.cos(t)*n,b:Math.sin(t)*n,alpha:e.alpha})},interpolate:function(e,t,n){return{h:yn(e.h,t.h,n),c:nn(e.c,t.c,n),l:nn(e.l,t.l,n),alpha:nn(e.alpha,t.alpha,n)}}};var bn=Object.freeze({__proto__:null,lab:_n,hcl:xn});class wn{constructor(e,t,n,i,r){this.type=e,this.operator=t,this.interpolation=n,this.input=i,this.labels=[],this.outputs=[];for(const[a,o]of r)this.labels.push(a),this.outputs.push(o)}static interpolationFactor(e,t,i,r){let a=0;if("exponential"===e.name)a=Sn(t,e.base,i,r);else if("linear"===e.name)a=Sn(t,1,i,r);else if("cubic-bezier"===e.name){const o=e.controlPoints;a=new n(o[0],o[1],o[2],o[3]).solve(Sn(t,1,i,r))}return a}static parse(e,t){let[n,i,r,...a]=e;if(!Array.isArray(i)||0===i.length)return t.error("Expected an interpolation type expression.",1);if("linear"===i[0])i={name:"linear"};else if("exponential"===i[0]){const e=i[1];if("number"!=typeof e)return t.error("Exponential interpolation requires a numeric base.",1,1);i={name:"exponential",base:e}}else{if("cubic-bezier"!==i[0])return t.error(`Unknown interpolation type ${String(i[0])}`,1,0);{const e=i.slice(1);if(4!==e.length||e.some((e=>"number"!=typeof e||e<0||e>1)))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);i={name:"cubic-bezier",controlPoints:e}}}if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(r=t.parse(r,2,Ze),!r)return null;const o=[];let s=null;"interpolate-hcl"===n||"interpolate-lab"===n?s=Ye:t.expectedType&&"value"!==t.expectedType.kind&&(s=t.expectedType);for(let l=0;l<a.length;l+=2){const e=a[l],n=a[l+1],i=l+3,r=l+4;if("number"!=typeof e)return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',i);if(o.length&&o[o.length-1][0]>=e)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',i);const c=t.parse(n,r,s);if(!c)return null;s=s||c.type,o.push([e,c])}return"number"===s.kind||"color"===s.kind||"array"===s.kind&&"number"===s.itemType.kind&&"number"==typeof s.N?new wn(s,n,i,r,o):t.error(`Type ${it(s)} is not interpolatable.`)}evaluate(e){const t=this.labels,n=this.outputs;if(1===t.length)return n[0].evaluate(e);const i=this.input.evaluate(e);if(i<=t[0])return n[0].evaluate(e);const r=t.length;if(i>=t[r-1])return n[r-1].evaluate(e);const a=en(t,i),o=wn.interpolationFactor(this.interpolation,i,t[a],t[a+1]),s=n[a].evaluate(e),l=n[a+1].evaluate(e);return"interpolate"===this.operator?rn[this.type.kind.toLowerCase()](s,l,o):"interpolate-hcl"===this.operator?xn.reverse(xn.interpolate(xn.forward(s),xn.forward(l),o)):_n.reverse(_n.interpolate(_n.forward(s),_n.forward(l),o))}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const t=[this.operator,e,this.input.serialize()];for(let n=0;n<this.labels.length;n++)t.push(this.labels[n],this.outputs[n].serialize());return t}}function Sn(e,t,n,i){const r=i-n,a=e-n;return 0===r?0:1===t?a/r:(Math.pow(t,a)-1)/(Math.pow(t,r)-1)}class Tn{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expectected at least one argument.");let n=null;const i=t.expectedType;i&&"value"!==i.kind&&(n=i);const r=[];for(const o of e.slice(1)){const e=t.parse(o,1+r.length,n,void 0,{typeAnnotation:"omit"});if(!e)return null;n=n||e.type,r.push(e)}const a=i&&r.some((e=>at(i,e.type)));return new Tn(a?Ke:n,r)}evaluate(e){let t,n=null,i=0;for(const r of this.args)if(i++,n=r.evaluate(e),n&&n instanceof ft&&!n.available&&(t||(t=n.name),n=null,i===this.args.length&&(n=t)),null!==n)break;return n}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=["coalesce"];return this.eachChild((t=>{e.push(t.serialize())})),e}}class En{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const n=[];for(let r=1;r<e.length-1;r+=2){const i=e[r];if("string"!=typeof i)return t.error(`Expected string, but found ${typeof i} instead.`,r);if(/[^a-zA-Z0-9_]/.test(i))return t.error("Variable names must contain only alphanumeric characters or '_'.",r);const a=t.parse(e[r+1],r+1);if(!a)return null;n.push([i,a])}const i=t.parse(e[e.length-1],e.length-1,t.expectedType,n);return i?new En(n,i):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[t,n]of this.bindings)e.push(t,n.serialize());return e.push(this.result.serialize()),e}}class Mn{constructor(e,t,n){this.type=e,this.index=t,this.input=n}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,Ze),i=t.parse(e[2],2,nt(t.expectedType||Ke));return n&&i?new Mn(i.type.itemType,n,i):null}evaluate(e){const t=this.index.evaluate(e),n=this.input.evaluate(e);if(t<0)throw new xt(`Array index out of bounds: ${t} < 0.`);if(t>=n.length)throw new xt(`Array index out of bounds: ${t} > ${n.length-1}.`);if(t!==Math.floor(t))throw new xt(`Array index must be an integer, but found ${t} instead.`);return n[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class kn{constructor(e,t){this.type=Xe,this.needle=e,this.haystack=t}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,Ke),i=t.parse(e[2],2,Ke);return n&&i?ot(n.type,[Xe,$e,Ze,qe,Ke])?new kn(n,i):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${it(n.type)} instead`):null}evaluate(e){const t=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!n)return!1;if(!st(t,["boolean","string","number","null"]))throw new xt(`Expected first argument to be of type boolean, string, number or null, but found ${it(vt(t))} instead.`);if(!st(n,["string","array"]))throw new xt(`Expected second argument to be of type array or string, but found ${it(vt(n))} instead.`);return n.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class An{constructor(e,t,n){this.type=Ze,this.needle=e,this.haystack=t,this.fromIndex=n}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,Ke),i=t.parse(e[2],2,Ke);if(!n||!i)return null;if(!ot(n.type,[Xe,$e,Ze,qe,Ke]))return t.error(`Expected first argument to be of type boolean, string, number or null, but found ${it(n.type)} instead`);if(4===e.length){const r=t.parse(e[3],3,Ze);return r?new An(n,i,r):null}return new An(n,i)}evaluate(e){const t=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!st(t,["boolean","string","number","null"]))throw new xt(`Expected first argument to be of type boolean, string, number or null, but found ${it(vt(t))} instead.`);if(!st(n,["string","array"]))throw new xt(`Expected second argument to be of type array or string, but found ${it(vt(n))} instead.`);if(this.fromIndex){const i=this.fromIndex.evaluate(e);return n.indexOf(t,i)}return n.indexOf(t)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Cn{constructor(e,t,n,i,r,a){this.inputType=e,this.type=t,this.input=n,this.cases=i,this.outputs=r,this.otherwise=a}static parse(e,t){if(e.length<5)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return t.error("Expected an even number of arguments.");let n,i;t.expectedType&&"value"!==t.expectedType.kind&&(i=t.expectedType);const r={},a=[];for(let l=2;l<e.length-1;l+=2){let o=e[l];const s=e[l+1];Array.isArray(o)||(o=[o]);const c=t.concat(l);if(0===o.length)return c.error("Expected at least one branch label.");for(const e of o){if("number"!=typeof e&&"string"!=typeof e)return c.error("Branch labels must be numbers or strings.");if("number"==typeof e&&Math.abs(e)>Number.MAX_SAFE_INTEGER)return c.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof e&&Math.floor(e)!==e)return c.error("Numeric branch labels must be integer values.");if(n){if(c.checkSubtype(n,vt(e)))return null}else n=vt(e);if(void 0!==r[String(e)])return c.error("Branch labels must be unique.");r[String(e)]=a.length}const u=t.parse(s,l,i);if(!u)return null;i=i||u.type,a.push(u)}const o=t.parse(e[1],1,Ke);if(!o)return null;const s=t.parse(e[e.length-1],e.length-1,i);return s?"value"!==o.type.kind&&t.concat(1).checkSubtype(n,o.type)?null:new Cn(n,i,o,r,a,s):null}evaluate(e){const t=this.input.evaluate(e);return(vt(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],t=Object.keys(this.cases).sort(),n=[],i={};for(const a of t){const e=i[this.cases[a]];void 0===e?(i[this.cases[a]]=n.length,n.push([this.cases[a],[a]])):n[e][1].push(a)}const r=e=>"number"===this.inputType.kind?Number(e):e;for(const[a,o]of n)e.push(1===o.length?r(o[0]):o.map(r)),e.push(this.outputs[a].serialize());return e.push(this.otherwise.serialize()),e}}class Pn{constructor(e,t,n){this.type=e,this.branches=t,this.otherwise=n}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return t.error("Expected an odd number of arguments.");let n;t.expectedType&&"value"!==t.expectedType.kind&&(n=t.expectedType);const i=[];for(let a=1;a<e.length-1;a+=2){const r=t.parse(e[a],a,Xe);if(!r)return null;const o=t.parse(e[a+1],a+1,n);if(!o)return null;i.push([r,o]),n=n||o.type}const r=t.parse(e[e.length-1],e.length-1,n);return r?new Pn(n,i,r):null}evaluate(e){for(const[t,n]of this.branches)if(t.evaluate(e))return n.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,n]of this.branches)e(t),e(n);e(this.otherwise)}outputDefined(){return this.branches.every((([e,t])=>t.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild((t=>{e.push(t.serialize())})),e}}class Ln{constructor(e,t,n,i){this.type=e,this.input=t,this.beginIndex=n,this.endIndex=i}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,Ke),i=t.parse(e[2],2,Ze);if(!n||!i)return null;if(!ot(n.type,[nt(Ke),$e,Ke]))return t.error(`Expected first argument to be of type array or string, but found ${it(n.type)} instead`);if(4===e.length){const r=t.parse(e[3],3,Ze);return r?new Ln(n.type,n,i,r):null}return new Ln(n.type,n,i)}evaluate(e){const t=this.input.evaluate(e),n=this.beginIndex.evaluate(e);if(!st(t,["string","array"]))throw new xt(`Expected first argument to be of type array or string, but found ${it(vt(t))} instead.`);if(this.endIndex){const i=this.endIndex.evaluate(e);return t.slice(n,i)}return t.slice(n)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function In(e,t){return"=="===e||"!="===e?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function Rn(e,t,n,i){return 0===i.compare(t,n)}function zn(e,t,n){const i="=="!==e&&"!="!==e;return class r{constructor(e,t,n){this.type=Xe,this.lhs=e,this.rhs=t,this.collator=n,this.hasUntypedArgument="value"===e.type.kind||"value"===t.type.kind}static parse(e,t){if(3!==e.length&&4!==e.length)return t.error("Expected two or three arguments.");const n=e[0];let a=t.parse(e[1],1,Ke);if(!a)return null;if(!In(n,a.type))return t.concat(1).error(`"${n}" comparisons are not supported for type '${it(a.type)}'.`);let o=t.parse(e[2],2,Ke);if(!o)return null;if(!In(n,o.type))return t.concat(2).error(`"${n}" comparisons are not supported for type '${it(o.type)}'.`);if(a.type.kind!==o.type.kind&&"value"!==a.type.kind&&"value"!==o.type.kind)return t.error(`Cannot compare types '${it(a.type)}' and '${it(o.type)}'.`);i&&("value"===a.type.kind&&"value"!==o.type.kind?a=new wt(o.type,[a]):"value"!==a.type.kind&&"value"===o.type.kind&&(o=new wt(a.type,[o])));let s=null;if(4===e.length){if("string"!==a.type.kind&&"string"!==o.type.kind&&"value"!==a.type.kind&&"value"!==o.type.kind)return t.error("Cannot use collator to compare non-string types.");if(s=t.parse(e[3],3,Qe),!s)return null}return new r(a,o,s)}evaluate(r){const a=this.lhs.evaluate(r),o=this.rhs.evaluate(r);if(i&&this.hasUntypedArgument){const t=vt(a),n=vt(o);if(t.kind!==n.kind||"string"!==t.kind&&"number"!==t.kind)throw new xt(`Expected arguments for "${e}" to be (string, string) or (number, number), but found (${t.kind}, ${n.kind}) instead.`)}if(this.collator&&!i&&this.hasUntypedArgument){const e=vt(a),n=vt(o);if("string"!==e.kind||"string"!==n.kind)return t(r,a,o)}return this.collator?n(r,a,o,this.collator.evaluate(r)):t(r,a,o)}eachChild(e){e(this.lhs),e(this.rhs),this.collator&&e(this.collator)}outputDefined(){return!0}serialize(){const t=[e];return this.eachChild((e=>{t.push(e.serialize())})),t}}}const Dn=zn("==",(function(e,t,n){return t===n}),Rn),On=zn("!=",(function(e,t,n){return t!==n}),(function(e,t,n,i){return!Rn(0,t,n,i)})),Bn=zn("<",(function(e,t,n){return t<n}),(function(e,t,n,i){return i.compare(t,n)<0})),Fn=zn(">",(function(e,t,n){return t>n}),(function(e,t,n,i){return i.compare(t,n)>0})),Nn=zn("<=",(function(e,t,n){return t<=n}),(function(e,t,n,i){return i.compare(t,n)<=0})),Un=zn(">=",(function(e,t,n){return t>=n}),(function(e,t,n,i){return i.compare(t,n)>=0}));class Vn{constructor(e,t,n,i,r){this.type=$e,this.number=e,this.locale=t,this.currency=n,this.minFractionDigits=i,this.maxFractionDigits=r}static parse(e,t){if(3!==e.length)return t.error("Expected two arguments.");const n=t.parse(e[1],1,Ze);if(!n)return null;const i=e[2];if("object"!=typeof i||Array.isArray(i))return t.error("NumberFormat options argument must be an object.");let r=null;if(i.locale&&(r=t.parse(i.locale,1,$e),!r))return null;let a=null;if(i.currency&&(a=t.parse(i.currency,1,$e),!a))return null;let o=null;if(i["min-fraction-digits"]&&(o=t.parse(i["min-fraction-digits"],1,Ze),!o))return null;let s=null;return i["max-fraction-digits"]&&(s=t.parse(i["max-fraction-digits"],1,Ze),!s)?null:new Vn(n,r,a,o,s)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class jn{constructor(e){this.type=Ze,this.input=e}static parse(e,t){if(2!==e.length)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const n=t.parse(e[1],1);return n?"array"!==n.type.kind&&"string"!==n.type.kind&&"value"!==n.type.kind?t.error(`Expected argument of type string or array, but found ${it(n.type)} instead.`):new jn(n):null}evaluate(e){const t=this.input.evaluate(e);if("string"==typeof t)return t.length;if(Array.isArray(t))return t.length;throw new xt(`Expected value to be of type string or array, but found ${it(vt(t))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild((t=>{e.push(t.serialize())})),e}}const Gn={"==":Dn,"!=":On,">":Fn,"<":Bn,">=":Un,"<=":Nn,array:wt,at:Mn,boolean:wt,case:Pn,coalesce:Tn,collator:Pt,format:St,image:Tt,in:kn,"index-of":An,interpolate:wn,"interpolate-hcl":wn,"interpolate-lab":wn,length:jn,let:En,literal:_t,match:Cn,number:wt,"number-format":Vn,object:wt,slice:Ln,step:tn,string:wt,"to-boolean":Mt,"to-color":Mt,"to-number":Mt,"to-string":Mt,var:Jt,within:Zt};function Hn(e,[t,n,i,r]){t=t.evaluate(e),n=n.evaluate(e),i=i.evaluate(e);const a=r?r.evaluate(e):1,o=mt(t,n,i,a);if(o)throw new xt(o);return new ut(t/255*a,n/255*a,i/255*a,a)}function Wn(e,t){return e in t}function qn(e,t){const n=t[e];return void 0===n?null:n}function Zn(e){return{type:e}}function $n(e){return{result:"success",value:e}}function Xn(e){return{result:"error",value:e}}function Yn(e){return"data-driven"===e["property-type"]||"cross-faded-data-driven"===e["property-type"]}function Jn(e){return!!e.expression&&e.expression.parameters.indexOf("zoom")>-1}function Kn(e){return!!e.expression&&e.expression.interpolated}function Qn(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":null===e?"null":typeof e}function ei(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function ti(e){return e}function ni(e,t){const n="color"===t.type,i=e.stops&&"object"==typeof e.stops[0][0],r=i||!(i||void 0!==e.property),a=e.type||(Kn(t)?"exponential":"interval");if(n&&((e=Ve({},e)).stops&&(e.stops=e.stops.map((e=>[e[0],ut.parse(e[1])]))),e.default=ut.parse(e.default?e.default:t.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!bn[e.colorSpace])throw new Error(`Unknown color space: ${e.colorSpace}`);let o,s,l;if("exponential"===a)o=oi;else if("interval"===a)o=ai;else if("categorical"===a){o=ri,s=Object.create(null);for(const t of e.stops)s[t[0]]=t[1];l=typeof e.stops[0][0]}else{if("identity"!==a)throw new Error(`Unknown function type "${a}"`);o=si}if(i){const n={},i=[];for(let t=0;t<e.stops.length;t++){const r=e.stops[t],a=r[0].zoom;void 0===n[a]&&(n[a]={zoom:a,type:e.type,property:e.property,default:e.default,stops:[]},i.push(a)),n[a].stops.push([r[0].value,r[1]])}const r=[];for(const e of i)r.push([n[e].zoom,ni(n[e],t)]);const a={name:"linear"};return{kind:"composite",interpolationType:a,interpolationFactor:wn.interpolationFactor.bind(void 0,a),zoomStops:r.map((e=>e[0])),evaluate:({zoom:n},i)=>oi({stops:r,base:e.base},t,n).evaluate(n,i)}}if(r){const n="exponential"===a?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return{kind:"camera",interpolationType:n,interpolationFactor:wn.interpolationFactor.bind(void 0,n),zoomStops:e.stops.map((e=>e[0])),evaluate:({zoom:n})=>o(e,t,n,s,l)}}return{kind:"source",evaluate(n,i){const r=i&&i.properties?i.properties[e.property]:void 0;return void 0===r?ii(e.default,t.default):o(e,t,r,s,l)}}}function ii(e,t,n){return void 0!==e?e:void 0!==t?t:void 0!==n?n:void 0}function ri(e,t,n,i,r){return ii(typeof n===r?i[n]:void 0,e.default,t.default)}function ai(e,t,n){if("number"!==Qn(n))return ii(e.default,t.default);const i=e.stops.length;if(1===i)return e.stops[0][1];if(n<=e.stops[0][0])return e.stops[0][1];if(n>=e.stops[i-1][0])return e.stops[i-1][1];const r=en(e.stops.map((e=>e[0])),n);return e.stops[r][1]}function oi(e,t,n){const i=void 0!==e.base?e.base:1;if("number"!==Qn(n))return ii(e.default,t.default);const r=e.stops.length;if(1===r)return e.stops[0][1];if(n<=e.stops[0][0])return e.stops[0][1];if(n>=e.stops[r-1][0])return e.stops[r-1][1];const a=en(e.stops.map((e=>e[0])),n),o=function(e,t,n,i){const r=i-n,a=e-n;return 0===r?0:1===t?a/r:(Math.pow(t,a)-1)/(Math.pow(t,r)-1)}(n,i,e.stops[a][0],e.stops[a+1][0]),s=e.stops[a][1],l=e.stops[a+1][1];let c=rn[t.type]||ti;if(e.colorSpace&&"rgb"!==e.colorSpace){const t=bn[e.colorSpace];c=(e,n)=>t.reverse(t.interpolate(t.forward(e),t.forward(n),o))}return"function"==typeof s.evaluate?{evaluate(...e){const t=s.evaluate.apply(void 0,e),n=l.evaluate.apply(void 0,e);if(void 0!==t&&void 0!==n)return c(t,n,o)}}:c(s,l,o)}function si(e,t,n){return"color"===t.type?n=ut.parse(n):"formatted"===t.type?n=pt.fromString(n.toString()):"resolvedImage"===t.type?n=ft.fromString(n.toString()):Qn(n)===t.type||"enum"===t.type&&t.values[n]||(n=void 0),ii(n,e.default,t.default)}Ct.register(Gn,{error:[{kind:"error"},[$e],(e,[t])=>{throw new xt(t.evaluate(e))}],typeof:[$e,[Ke],(e,[t])=>it(vt(t.evaluate(e)))],"to-rgba":[nt(Ze,4),[Ye],(e,[t])=>t.evaluate(e).toArray()],rgb:[Ye,[Ze,Ze,Ze],Hn],rgba:[Ye,[Ze,Ze,Ze,Ze],Hn],has:{type:Xe,overloads:[[[$e],(e,[t])=>Wn(t.evaluate(e),e.properties())],[[$e,Je],(e,[t,n])=>Wn(t.evaluate(e),n.evaluate(e))]]},get:{type:Ke,overloads:[[[$e],(e,[t])=>qn(t.evaluate(e),e.properties())],[[$e,Je],(e,[t,n])=>qn(t.evaluate(e),n.evaluate(e))]]},"feature-state":[Ke,[$e],(e,[t])=>qn(t.evaluate(e),e.featureState||{})],properties:[Je,[],e=>e.properties()],"geometry-type":[$e,[],e=>e.geometryType()],id:[Ke,[],e=>e.id()],zoom:[Ze,[],e=>e.globals.zoom],"heatmap-density":[Ze,[],e=>e.globals.heatmapDensity||0],"line-progress":[Ze,[],e=>e.globals.lineProgress||0],"sky-radial-progress":[Ze,[],e=>e.globals.skyRadialProgress||0],accumulated:[Ke,[],e=>void 0===e.globals.accumulated?null:e.globals.accumulated],"+":[Ze,Zn(Ze),(e,t)=>{let n=0;for(const i of t)n+=i.evaluate(e);return n}],"*":[Ze,Zn(Ze),(e,t)=>{let n=1;for(const i of t)n*=i.evaluate(e);return n}],"-":{type:Ze,overloads:[[[Ze,Ze],(e,[t,n])=>t.evaluate(e)-n.evaluate(e)],[[Ze],(e,[t])=>-t.evaluate(e)]]},"/":[Ze,[Ze,Ze],(e,[t,n])=>t.evaluate(e)/n.evaluate(e)],"%":[Ze,[Ze,Ze],(e,[t,n])=>t.evaluate(e)%n.evaluate(e)],ln2:[Ze,[],()=>Math.LN2],pi:[Ze,[],()=>Math.PI],e:[Ze,[],()=>Math.E],"^":[Ze,[Ze,Ze],(e,[t,n])=>Math.pow(t.evaluate(e),n.evaluate(e))],sqrt:[Ze,[Ze],(e,[t])=>Math.sqrt(t.evaluate(e))],log10:[Ze,[Ze],(e,[t])=>Math.log(t.evaluate(e))/Math.LN10],ln:[Ze,[Ze],(e,[t])=>Math.log(t.evaluate(e))],log2:[Ze,[Ze],(e,[t])=>Math.log(t.evaluate(e))/Math.LN2],sin:[Ze,[Ze],(e,[t])=>Math.sin(t.evaluate(e))],cos:[Ze,[Ze],(e,[t])=>Math.cos(t.evaluate(e))],tan:[Ze,[Ze],(e,[t])=>Math.tan(t.evaluate(e))],asin:[Ze,[Ze],(e,[t])=>Math.asin(t.evaluate(e))],acos:[Ze,[Ze],(e,[t])=>Math.acos(t.evaluate(e))],atan:[Ze,[Ze],(e,[t])=>Math.atan(t.evaluate(e))],min:[Ze,Zn(Ze),(e,t)=>Math.min(...t.map((t=>t.evaluate(e))))],max:[Ze,Zn(Ze),(e,t)=>Math.max(...t.map((t=>t.evaluate(e))))],abs:[Ze,[Ze],(e,[t])=>Math.abs(t.evaluate(e))],round:[Ze,[Ze],(e,[t])=>{const n=t.evaluate(e);return n<0?-Math.round(-n):Math.round(n)}],floor:[Ze,[Ze],(e,[t])=>Math.floor(t.evaluate(e))],ceil:[Ze,[Ze],(e,[t])=>Math.ceil(t.evaluate(e))],"filter-==":[Xe,[$e,Ke],(e,[t,n])=>e.properties()[t.value]===n.value],"filter-id-==":[Xe,[Ke],(e,[t])=>e.id()===t.value],"filter-type-==":[Xe,[$e],(e,[t])=>e.geometryType()===t.value],"filter-<":[Xe,[$e,Ke],(e,[t,n])=>{const i=e.properties()[t.value],r=n.value;return typeof i==typeof r&&i<r}],"filter-id-<":[Xe,[Ke],(e,[t])=>{const n=e.id(),i=t.value;return typeof n==typeof i&&n<i}],"filter->":[Xe,[$e,Ke],(e,[t,n])=>{const i=e.properties()[t.value],r=n.value;return typeof i==typeof r&&i>r}],"filter-id->":[Xe,[Ke],(e,[t])=>{const n=e.id(),i=t.value;return typeof n==typeof i&&n>i}],"filter-<=":[Xe,[$e,Ke],(e,[t,n])=>{const i=e.properties()[t.value],r=n.value;return typeof i==typeof r&&i<=r}],"filter-id-<=":[Xe,[Ke],(e,[t])=>{const n=e.id(),i=t.value;return typeof n==typeof i&&n<=i}],"filter->=":[Xe,[$e,Ke],(e,[t,n])=>{const i=e.properties()[t.value],r=n.value;return typeof i==typeof r&&i>=r}],"filter-id->=":[Xe,[Ke],(e,[t])=>{const n=e.id(),i=t.value;return typeof n==typeof i&&n>=i}],"filter-has":[Xe,[Ke],(e,[t])=>t.value in e.properties()],"filter-has-id":[Xe,[],e=>null!==e.id()&&void 0!==e.id()],"filter-type-in":[Xe,[nt($e)],(e,[t])=>t.value.indexOf(e.geometryType())>=0],"filter-id-in":[Xe,[nt(Ke)],(e,[t])=>t.value.indexOf(e.id())>=0],"filter-in-small":[Xe,[$e,nt(Ke)],(e,[t,n])=>n.value.indexOf(e.properties()[t.value])>=0],"filter-in-large":[Xe,[$e,nt(Ke)],(e,[t,n])=>function(e,t,n,i){for(;n<=i;){const r=n+i>>1;if(t[r]===e)return!0;t[r]>e?i=r-1:n=r+1}return!1}(e.properties()[t.value],n.value,0,n.value.length-1)],all:{type:Xe,overloads:[[[Xe,Xe],(e,[t,n])=>t.evaluate(e)&&n.evaluate(e)],[Zn(Xe),(e,t)=>{for(const n of t)if(!n.evaluate(e))return!1;return!0}]]},any:{type:Xe,overloads:[[[Xe,Xe],(e,[t,n])=>t.evaluate(e)||n.evaluate(e)],[Zn(Xe),(e,t)=>{for(const n of t)if(n.evaluate(e))return!0;return!1}]]},"!":[Xe,[Xe],(e,[t])=>!t.evaluate(e)],"is-supported-script":[Xe,[$e],(e,[t])=>{const n=e.globals&&e.globals.isSupportedScript;return!n||n(t.evaluate(e))}],upcase:[$e,[$e],(e,[t])=>t.evaluate(e).toUpperCase()],downcase:[$e,[$e],(e,[t])=>t.evaluate(e).toLowerCase()],concat:[$e,Zn(Ke),(e,t)=>t.map((t=>yt(t.evaluate(e)))).join("")],"resolved-locale":[$e,[Qe],(e,[t])=>t.evaluate(e).resolvedLocale()]});class li{constructor(e,t){this.expression=e,this._warningHistory={},this._evaluator=new At,this._defaultValue=t?function(e){return"color"===e.type&&ei(e.default)?new ut(0,0,0,0):"color"===e.type?ut.parse(e.default)||null:void 0===e.default?null:e.default}(t):null,this._enumValues=t&&"enum"===t.type?t.values:null}evaluateWithoutErrorHandling(e,t,n,i,r,a){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=n,this._evaluator.canonical=i,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=a,this.expression.evaluate(this._evaluator)}evaluate(e,t,n,i,r,a){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=n||null,this._evaluator.canonical=i,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=a||null;try{const e=this.expression.evaluate(this._evaluator);if(null==e||"number"==typeof e&&e!=e)return this._defaultValue;if(this._enumValues&&!(e in this._enumValues))throw new xt(`Expected value to be one of ${Object.keys(this._enumValues).map((e=>JSON.stringify(e))).join(", ")}, but found ${JSON.stringify(e)} instead.`);return e}catch(e){return this._warningHistory[e.message]||(this._warningHistory[e.message]=!0,"undefined"!=typeof console&&console.warn(e.message)),this._defaultValue}}}function ci(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]&&e[0]in Gn}function ui(e,t){const n=new Kt(Gn,[],t?function(e){const t={color:Ye,string:$e,number:Ze,enum:$e,boolean:Xe,formatted:et,resolvedImage:tt};return"array"===e.type?nt(t[e.value]||Ke,e.length):t[e.type]}(t):void 0),i=n.parse(e,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return i?$n(new li(i,t)):Xn(n.errors)}class hi{constructor(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent="constant"!==e&&!Xt(t.expression)}evaluateWithoutErrorHandling(e,t,n,i,r,a){return this._styleExpression.evaluateWithoutErrorHandling(e,t,n,i,r,a)}evaluate(e,t,n,i,r,a){return this._styleExpression.evaluate(e,t,n,i,r,a)}}class di{constructor(e,t,n,i){this.kind=e,this.zoomStops=n,this._styleExpression=t,this.isStateDependent="camera"!==e&&!Xt(t.expression),this.interpolationType=i}evaluateWithoutErrorHandling(e,t,n,i,r,a){return this._styleExpression.evaluateWithoutErrorHandling(e,t,n,i,r,a)}evaluate(e,t,n,i,r,a){return this._styleExpression.evaluate(e,t,n,i,r,a)}interpolationFactor(e,t,n){return this.interpolationType?wn.interpolationFactor(this.interpolationType,e,t,n):0}}function pi(e,t){if("error"===(e=ui(e,t)).result)return e;const n=e.value.expression,i=$t(n);if(!i&&!Yn(t))return Xn([new He("","data expressions not supported")]);const r=Yt(n,["zoom"]);if(!r&&!Jn(t))return Xn([new He("","zoom expressions not supported")]);const a=mi(n);return a||r?a instanceof He?Xn([a]):a instanceof wn&&!Kn(t)?Xn([new He("",'"interpolate" expressions cannot be used with this property')]):$n(a?new di(i?"camera":"composite",e.value,a.labels,a instanceof wn?a.interpolation:void 0):new hi(i?"constant":"source",e.value)):Xn([new He("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class fi{constructor(e,t){this._parameters=e,this._specification=t,Ve(this,ni(this._parameters,this._specification))}static deserialize(e){return new fi(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function mi(e){let t=null;if(e instanceof En)t=mi(e.result);else if(e instanceof Tn){for(const n of e.args)if(t=mi(n),t)break}else(e instanceof tn||e instanceof wn)&&e.input instanceof Ct&&"zoom"===e.input.name&&(t=e);return t instanceof He||e.eachChild((e=>{const n=mi(e);n instanceof He?t=n:!t&&n?t=new He("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&n&&t!==n&&(t=new He("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),t}function gi(e){const t=e.key,n=e.value,i=e.valueSpec||{},r=e.objectElementValidators||{},a=e.style,o=e.styleSpec;let s=[];const l=Qn(n);if("object"!==l)return[new Ne(t,n,`object expected, ${l} found`)];for(const c in n){const e=c.split(".")[0],l=i[e]||i["*"];let u;if(r[e])u=r[e];else if(i[e])u=Wi;else if(r["*"])u=r["*"];else{if(!i["*"]){s.push(new Ne(t,n[c],`unknown property "${c}"`));continue}u=Wi}s=s.concat(u({key:(t?`${t}.`:t)+c,value:n[c],valueSpec:l,style:a,styleSpec:o,object:n,objectKey:c},n))}for(const c in i)r[c]||i[c].required&&void 0===i[c].default&&void 0===n[c]&&s.push(new Ne(t,n,`missing required property "${c}"`));return s}function vi(e){const t=e.value,n=e.valueSpec,i=e.style,r=e.styleSpec,a=e.key,o=e.arrayElementValidator||Wi;if("array"!==Qn(t))return[new Ne(a,t,`array expected, ${Qn(t)} found`)];if(n.length&&t.length!==n.length)return[new Ne(a,t,`array length ${n.length} expected, length ${t.length} found`)];if(n["min-length"]&&t.length<n["min-length"])return[new Ne(a,t,`array length at least ${n["min-length"]} expected, length ${t.length} found`)];let s={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum};r.$version<7&&(s.function=n.function),"object"===Qn(n.value)&&(s=n.value);let l=[];for(let c=0;c<t.length;c++)l=l.concat(o({array:t,arrayIndex:c,value:t[c],valueSpec:s,style:i,styleSpec:r,key:`${a}[${c}]`}));return l}function yi(e){const t=e.key,n=e.value,i=e.valueSpec;let r=Qn(n);if("number"===r&&n!=n&&(r="NaN"),"number"!==r)return[new Ne(t,n,`number expected, ${r} found`)];if("minimum"in i){let r=i.minimum;if("array"===Qn(i.minimum)&&(r=i.minimum[e.arrayIndex]),n<r)return[new Ne(t,n,`${n} is less than the minimum value ${r}`)]}if("maximum"in i){let r=i.maximum;if("array"===Qn(i.maximum)&&(r=i.maximum[e.arrayIndex]),n>r)return[new Ne(t,n,`${n} is greater than the maximum value ${r}`)]}return[]}function _i(e){const t=e.valueSpec,n=je(e.value.type);let i,r,a,o={};const s="categorical"!==n&&void 0===e.value.property,l=!s,c="array"===Qn(e.value.stops)&&"array"===Qn(e.value.stops[0])&&"object"===Qn(e.value.stops[0][0]),u=gi({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(e){if("identity"===n)return[new Ne(e.key,e.value,'identity function may not have a "stops" property')];let t=[];const i=e.value;return t=t.concat(vi({key:e.key,value:i,valueSpec:e.valueSpec,style:e.style,styleSpec:e.styleSpec,arrayElementValidator:h})),"array"===Qn(i)&&0===i.length&&t.push(new Ne(e.key,i,"array must have at least one stop")),t},default:function(e){return Wi({key:e.key,value:e.value,valueSpec:t,style:e.style,styleSpec:e.styleSpec})}}});return"identity"===n&&s&&u.push(new Ne(e.key,e.value,'missing required property "property"')),"identity"===n||e.value.stops||u.push(new Ne(e.key,e.value,'missing required property "stops"')),"exponential"===n&&e.valueSpec.expression&&!Kn(e.valueSpec)&&u.push(new Ne(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(l&&!Yn(e.valueSpec)?u.push(new Ne(e.key,e.value,"property functions not supported")):s&&!Jn(e.valueSpec)&&u.push(new Ne(e.key,e.value,"zoom functions not supported"))),"categorical"!==n&&!c||void 0!==e.value.property||u.push(new Ne(e.key,e.value,'"property" property is required')),u;function h(e){let n=[];const i=e.value,s=e.key;if("array"!==Qn(i))return[new Ne(s,i,`array expected, ${Qn(i)} found`)];if(2!==i.length)return[new Ne(s,i,`array length 2 expected, length ${i.length} found`)];if(c){if("object"!==Qn(i[0]))return[new Ne(s,i,`object expected, ${Qn(i[0])} found`)];if(void 0===i[0].zoom)return[new Ne(s,i,"object stop key must have zoom")];if(void 0===i[0].value)return[new Ne(s,i,"object stop key must have value")];if(a&&a>je(i[0].zoom))return[new Ne(s,i[0].zoom,"stop zoom values must appear in ascending order")];je(i[0].zoom)!==a&&(a=je(i[0].zoom),r=void 0,o={}),n=n.concat(gi({key:`${s}[0]`,value:i[0],valueSpec:{zoom:{}},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{zoom:yi,value:d}}))}else n=n.concat(d({key:`${s}[0]`,value:i[0],valueSpec:{},style:e.style,styleSpec:e.styleSpec},i));return ci(Ge(i[1]))?n.concat([new Ne(`${s}[1]`,i[1],"expressions are not allowed in function stops.")]):n.concat(Wi({key:`${s}[1]`,value:i[1],valueSpec:t,style:e.style,styleSpec:e.styleSpec}))}function d(e,a){const s=Qn(e.value),l=je(e.value),c=null!==e.value?e.value:a;if(i){if(s!==i)return[new Ne(e.key,c,`${s} stop domain type must match previous stop domain type ${i}`)]}else i=s;if("number"!==s&&"string"!==s&&"boolean"!==s)return[new Ne(e.key,c,"stop domain value must be a number, string, or boolean")];if("number"!==s&&"categorical"!==n){let i=`number expected, ${s} found`;return Yn(t)&&void 0===n&&(i+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ne(e.key,c,i)]}return"categorical"!==n||"number"!==s||isFinite(l)&&Math.floor(l)===l?"categorical"!==n&&"number"===s&&void 0!==r&&l<r?[new Ne(e.key,c,"stop domain values must appear in ascending order")]:(r=l,"categorical"===n&&l in o?[new Ne(e.key,c,"stop domain values must be unique")]:(o[l]=!0,[])):[new Ne(e.key,c,`integer expected, found ${l}`)]}}function xi(e){const t=("property"===e.expressionContext?pi:ui)(Ge(e.value),e.valueSpec);if("error"===t.result)return t.value.map((t=>new Ne(`${e.key}${t.key}`,e.value,t.message)));const n=t.value.expression||t.value._styleExpression.expression;if("property"===e.expressionContext&&"text-font"===e.propertyKey&&!n.outputDefined())return[new Ne(e.key,e.value,`Invalid data expression for "${e.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===e.expressionContext&&"layout"===e.propertyType&&!Xt(n))return[new Ne(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===e.expressionContext&&!Xt(n))return[new Ne(e.key,e.value,'"feature-state" data expressions are not supported with filters.')];if(e.expressionContext&&0===e.expressionContext.indexOf("cluster")){if(!Yt(n,["zoom","feature-state"]))return[new Ne(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===e.expressionContext&&!$t(n))return[new Ne(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function bi(e){const t=e.key,n=e.value,i=e.valueSpec,r=[];return Array.isArray(i.values)?-1===i.values.indexOf(je(n))&&r.push(new Ne(t,n,`expected one of [${i.values.join(", ")}], ${JSON.stringify(n)} found`)):-1===Object.keys(i.values).indexOf(je(n))&&r.push(new Ne(t,n,`expected one of [${Object.keys(i.values).join(", ")}], ${JSON.stringify(n)} found`)),r}function wi(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":return e.length>=2&&"$id"!==e[1]&&"$type"!==e[1];case"in":return e.length>=3&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(const t of e.slice(1))if(!wi(t)&&"boolean"!=typeof t)return!1;return!0;default:return!0}}const Si={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Ti(e){if(null==e)return{filter:()=>!0,needGeometry:!1};wi(e)||(e=ki(e));const t=ui(e,Si);if("error"===t.result)throw new Error(t.value.map((e=>`${e.key}: ${e.message}`)).join(", "));return{filter:(e,n,i)=>t.value.evaluate(e,n,{},i),needGeometry:Mi(e)}}function Ei(e,t){return e<t?-1:e>t?1:0}function Mi(e){if(!Array.isArray(e))return!1;if("within"===e[0])return!0;for(let t=1;t<e.length;t++)if(Mi(e[t]))return!0;return!1}function ki(e){if(!e)return!0;const t=e[0];return e.length<=1?"any"!==t:"=="===t?Ai(e[1],e[2],"=="):"!="===t?Li(Ai(e[1],e[2],"==")):"<"===t||">"===t||"<="===t||">="===t?Ai(e[1],e[2],t):"any"===t?(n=e.slice(1),["any"].concat(n.map(ki))):"all"===t?["all"].concat(e.slice(1).map(ki)):"none"===t?["all"].concat(e.slice(1).map(ki).map(Li)):"in"===t?Ci(e[1],e.slice(2)):"!in"===t?Li(Ci(e[1],e.slice(2))):"has"===t?Pi(e[1]):"!has"===t?Li(Pi(e[1])):"within"!==t||e;var n}function Ai(e,t,n){switch(e){case"$type":return[`filter-type-${n}`,t];case"$id":return[`filter-id-${n}`,t];default:return[`filter-${n}`,e,t]}}function Ci(e,t){if(0===t.length)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some((e=>typeof e!=typeof t[0]))?["filter-in-large",e,["literal",t.sort(Ei)]]:["filter-in-small",e,["literal",t]]}}function Pi(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function Li(e){return["!",e]}function Ii(e){return wi(Ge(e.value))?xi(Ve({},e,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Ri(e)}function Ri(e){const t=e.value,n=e.key;if("array"!==Qn(t))return[new Ne(n,t,`array expected, ${Qn(t)} found`)];const i=e.styleSpec;let r,a=[];if(t.length<1)return[new Ne(n,t,"filter array must have at least 1 element")];switch(a=a.concat(bi({key:`${n}[0]`,value:t[0],valueSpec:i.filter_operator,style:e.style,styleSpec:e.styleSpec})),je(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&"$type"===je(t[1])&&a.push(new Ne(n,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":3!==t.length&&a.push(new Ne(n,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(r=Qn(t[1]),"string"!==r&&a.push(new Ne(`${n}[1]`,t[1],`string expected, ${r} found`)));for(let o=2;o<t.length;o++)r=Qn(t[o]),"$type"===je(t[1])?a=a.concat(bi({key:`${n}[${o}]`,value:t[o],valueSpec:i.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==r&&"number"!==r&&"boolean"!==r&&a.push(new Ne(`${n}[${o}]`,t[o],`string, number, or boolean expected, ${r} found`));break;case"any":case"all":case"none":for(let i=1;i<t.length;i++)a=a.concat(Ri({key:`${n}[${i}]`,value:t[i],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":r=Qn(t[1]),2!==t.length?a.push(new Ne(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):"string"!==r&&a.push(new Ne(`${n}[1]`,t[1],`string expected, ${r} found`));break;case"within":r=Qn(t[1]),2!==t.length?a.push(new Ne(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):"object"!==r&&a.push(new Ne(`${n}[1]`,t[1],`object expected, ${r} found`))}return a}function zi(e,t){const n=e.key,i=e.style,r=e.styleSpec,a=e.value,o=e.objectKey,s=r[`${t}_${e.layerType}`];if(!s)return[];const l=o.match(/^(.*)-transition$/);if("paint"===t&&l&&s[l[1]]&&s[l[1]].transition)return Wi({key:n,value:a,valueSpec:r.transition,style:i,styleSpec:r});const c=e.valueSpec||s[o];if(!c)return[new Ne(n,a,`unknown property "${o}"`)];let u;if("string"===Qn(a)&&Yn(c)&&!c.tokens&&(u=/^{([^}]+)}$/.exec(a)))return[new Ne(n,a,`"${o}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(u[1])} }\`.`)];const h=[];return"symbol"===e.layerType&&("text-field"===o&&i&&!i.glyphs&&h.push(new Ne(n,a,'use of "text-field" requires a style "glyphs" property')),"text-font"===o&&ei(Ge(a))&&"identity"===je(a.type)&&h.push(new Ne(n,a,'"text-font" does not support identity functions'))),h.concat(Wi({key:e.key,value:a,valueSpec:c,style:i,styleSpec:r,expressionContext:"property",propertyType:t,propertyKey:o}))}function Di(e){return zi(e,"paint")}function Oi(e){return zi(e,"layout")}function Bi(e){let t=[];const n=e.value,i=e.key,r=e.style,a=e.styleSpec;n.type||n.ref||t.push(new Ne(i,n,'either "type" or "ref" is required'));let o=je(n.type);const s=je(n.ref);if(n.id){const a=je(n.id);for(let o=0;o<e.arrayIndex;o++){const e=r.layers[o];je(e.id)===a&&t.push(new Ne(i,n.id,`duplicate layer id "${n.id}", previously used at line ${e.id.__line__}`))}}if("ref"in n){let e;["type","source","source-layer","filter","layout"].forEach((e=>{e in n&&t.push(new Ne(i,n[e],`"${e}" is prohibited for ref layers`))})),r.layers.forEach((t=>{je(t.id)===s&&(e=t)})),e?e.ref?t.push(new Ne(i,n.ref,"ref cannot reference another ref layer")):o=je(e.type):t.push(new Ne(i,n.ref,`ref layer "${s}" not found`))}else if("background"!==o&&"sky"!==o)if(n.source){const e=r.sources&&r.sources[n.source],a=e&&je(e.type);e?"vector"===a&&"raster"===o?t.push(new Ne(i,n.source,`layer "${n.id}" requires a raster source`)):"raster"===a&&"raster"!==o?t.push(new Ne(i,n.source,`layer "${n.id}" requires a vector source`)):"vector"!==a||n["source-layer"]?"raster-dem"===a&&"hillshade"!==o?t.push(new Ne(i,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==o||!n.paint||!n.paint["line-gradient"]||"geojson"===a&&e.lineMetrics||t.push(new Ne(i,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Ne(i,n,`layer "${n.id}" must specify a "source-layer"`)):t.push(new Ne(i,n.source,`source "${n.source}" not found`))}else t.push(new Ne(i,n,'missing required property "source"'));return t=t.concat(gi({key:i,value:n,valueSpec:a.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Wi({key:`${i}.type`,value:n.type,valueSpec:a.layer.type,style:e.style,styleSpec:e.styleSpec,object:n,objectKey:"type"}),filter:Ii,layout:e=>gi({layer:n,key:e.key,value:e.value,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":e=>Oi(Ve({layerType:o},e))}}),paint:e=>gi({layer:n,key:e.key,value:e.value,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":e=>Di(Ve({layerType:o},e))}})}})),t}function Fi(e){const t=e.value,n=e.key,i=Qn(t);return"string"!==i?[new Ne(n,t,`string expected, ${i} found`)]:[]}const Ni={promoteId:function({key:e,value:t}){if("string"===Qn(t))return Fi({key:e,value:t});{const n=[];for(const i in t)n.push(...Fi({key:`${e}.${i}`,value:t[i]}));return n}}};function Ui(e){const t=e.value,n=e.key,i=e.styleSpec,r=e.style;if(!t.type)return[new Ne(n,t,'"type" is required')];const a=je(t.type);let o;switch(a){case"vector":case"raster":case"raster-dem":return o=gi({key:n,value:t,valueSpec:i[`source_${a.replace("-","_")}`],style:e.style,styleSpec:i,objectElementValidators:Ni}),o;case"geojson":if(o=gi({key:n,value:t,valueSpec:i.source_geojson,style:r,styleSpec:i,objectElementValidators:Ni}),t.cluster)for(const e in t.clusterProperties){const[i,r]=t.clusterProperties[e],a="string"==typeof i?[i,["accumulated"],["get",e]]:i;o.push(...xi({key:`${n}.${e}.map`,value:r,expressionContext:"cluster-map"})),o.push(...xi({key:`${n}.${e}.reduce`,value:a,expressionContext:"cluster-reduce"}))}return o;case"video":return gi({key:n,value:t,valueSpec:i.source_video,style:r,styleSpec:i});case"image":return gi({key:n,value:t,valueSpec:i.source_image,style:r,styleSpec:i});case"canvas":return[new Ne(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return bi({key:`${n}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:r,styleSpec:i})}}function Vi(e){const t=e.value,n=e.styleSpec,i=n.light,r=e.style;let a=[];const o=Qn(t);if(void 0===t)return a;if("object"!==o)return a=a.concat([new Ne("light",t,`object expected, ${o} found`)]),a;for(const s in t){const e=s.match(/^(.*)-transition$/);a=a.concat(e&&i[e[1]]&&i[e[1]].transition?Wi({key:s,value:t[s],valueSpec:n.transition,style:r,styleSpec:n}):i[s]?Wi({key:s,value:t[s],valueSpec:i[s],style:r,styleSpec:n}):[new Ne(s,t[s],`unknown property "${s}"`)])}return a}function ji(e){const t=e.value,n=e.key,i=e.style,r=e.styleSpec,a=r.terrain;let o=[];const s=Qn(t);if(void 0===t)return o;if("object"!==s)return o=o.concat([new Ne("terrain",t,`object expected, ${s} found`)]),o;for(const l in t){const e=l.match(/^(.*)-transition$/);o=o.concat(e&&a[e[1]]&&a[e[1]].transition?Wi({key:l,value:t[l],valueSpec:r.transition,style:i,styleSpec:r}):a[l]?Wi({key:l,value:t[l],valueSpec:a[l],style:i,styleSpec:r}):[new Ne(l,t[l],`unknown property "${l}"`)])}if(t.source){const e=i.sources&&i.sources[t.source],r=e&&je(e.type);e?"raster-dem"!==r&&o.push(new Ne(n,t.source,`terrain cannot be used with a source of type ${r}, it only be used with a "raster-dem" source type`)):o.push(new Ne(n,t.source,`source "${t.source}" not found`))}else o.push(new Ne(n,t,'terrain is missing required property "source"'));return o}function Gi(e){const t=e.value,n=e.style,i=e.styleSpec,r=i.fog;let a=[];const o=Qn(t);if(void 0===t)return a;if("object"!==o)return a=a.concat([new Ne("fog",t,`object expected, ${o} found`)]),a;t.range&&!ci(Ge(t.range))&&t.range[0]>=t.range[1]&&(a=a.concat([new Ne("fog",t,"fog.range[0] can't be greater than or equal to fog.range[1]")]));for(const s in t){const e=s.match(/^(.*)-transition$/);a=a.concat(e&&r[e[1]]&&r[e[1]].transition?Wi({key:s,value:t[s],valueSpec:i.transition,style:n,styleSpec:i}):r[s]?Wi({key:s,value:t[s],valueSpec:r[s],style:n,styleSpec:i}):[new Ne(s,t[s],`unknown property "${s}"`)])}return a}const Hi={"*":()=>[],array:vi,boolean:function(e){const t=e.value,n=e.key,i=Qn(t);return"boolean"!==i?[new Ne(n,t,`boolean expected, ${i} found`)]:[]},number:yi,color:function(e){const t=e.key,n=e.value,i=Qn(n);return"string"!==i?[new Ne(t,n,`color expected, ${i} found`)]:null===ct.parseCSSColor(n)?[new Ne(t,n,`color expected, "${n}" found`)]:[]},constants:Ue,enum:bi,filter:Ii,function:_i,layer:Bi,object:gi,source:Ui,light:Vi,terrain:ji,fog:Gi,string:Fi,formatted:function(e){return 0===Fi(e).length?[]:xi(e)},resolvedImage:function(e){return 0===Fi(e).length?[]:xi(e)}};function Wi(e){const t=e.value,n=e.valueSpec,i=e.styleSpec;return n.expression&&ei(je(t))?_i(e):n.expression&&ci(Ge(t))?xi(e):n.type&&Hi[n.type]?Hi[n.type](e):gi(Ve({},e,{valueSpec:n.type?i[n.type]:n}))}function qi(e){const t=e.value,n=e.key,i=Fi(e);return i.length||(-1===t.indexOf("{fontstack}")&&i.push(new Ne(n,t,'"glyphs" url must include a "{fontstack}" token')),-1===t.indexOf("{range}")&&i.push(new Ne(n,t,'"glyphs" url must include a "{range}" token'))),i}function Zi(e,t=Fe){let n=[];return n=n.concat(Wi({key:"",value:e,valueSpec:t.$root,styleSpec:t,style:e,objectElementValidators:{glyphs:qi,"*":()=>[]}})),e.constants&&(n=n.concat(Ue({key:"constants",value:e.constants,style:e,styleSpec:t}))),$i(n)}function $i(e){return[].concat(e).sort(((e,t)=>e.line-t.line))}function Xi(e){return function(...t){return $i(e.apply(this,t))}}Zi.source=Xi(Ui),Zi.light=Xi(Vi),Zi.terrain=Xi(ji),Zi.fog=Xi(Gi),Zi.layer=Xi(Bi),Zi.filter=Xi(Ii),Zi.paintProperty=Xi(Di),Zi.layoutProperty=Xi(Oi);const Yi=Zi,Ji=Yi.light,Ki=Yi.fog,Qi=Yi.paintProperty,er=Yi.layoutProperty;function tr(e,t){let n=!1;if(t&&t.length)for(const i of t)e.fire(new Oe(new Error(i.message))),n=!0;return n}var nr=ir;function ir(e,t,n){var i=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var r=new Int32Array(this.arrayBuffer);e=r[0],this.d=(t=r[1])+2*(n=r[2]);for(var a=0;a<this.d*this.d;a++){var o=r[3+a],s=r[3+a+1];i.push(o===s?null:r.subarray(o,s))}var l=r[3+i.length+1];this.keys=r.subarray(r[3+i.length],l),this.bboxes=r.subarray(l),this.insert=this._insertReadonly}else{this.d=t+2*n;for(var c=0;c<this.d*this.d;c++)i.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=n,this.scale=t/e,this.uid=0;var u=n/t*e;this.min=-u,this.max=e+u}ir.prototype.insert=function(e,t,n,i,r){this._forEachCell(t,n,i,r,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(r)},ir.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ir.prototype._insertCell=function(e,t,n,i,r,a){this.cells[r].push(a)},ir.prototype.query=function(e,t,n,i,r){var a=this.min,o=this.max;if(e<=a&&t<=a&&o<=n&&o<=i&&!r)return Array.prototype.slice.call(this.keys);var s=[];return this._forEachCell(e,t,n,i,this._queryCell,s,{},r),s},ir.prototype._queryCell=function(e,t,n,i,r,a,o,s){var l=this.cells[r];if(null!==l)for(var c=this.keys,u=this.bboxes,h=0;h<l.length;h++){var d=l[h];if(void 0===o[d]){var p=4*d;(s?s(u[p+0],u[p+1],u[p+2],u[p+3]):e<=u[p+2]&&t<=u[p+3]&&n>=u[p+0]&&i>=u[p+1])?(o[d]=!0,a.push(c[d])):o[d]=!1}}},ir.prototype._forEachCell=function(e,t,n,i,r,a,o,s){for(var l=this._convertToCellCoord(e),c=this._convertToCellCoord(t),u=this._convertToCellCoord(n),h=this._convertToCellCoord(i),d=l;d<=u;d++)for(var p=c;p<=h;p++){var f=this.d*p+d;if((!s||s(this._convertFromCellCoord(d),this._convertFromCellCoord(p),this._convertFromCellCoord(d+1),this._convertFromCellCoord(p+1)))&&r.call(this,e,t,n,i,f,a,o,s))return}},ir.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},ir.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},ir.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=3+this.cells.length+1+1,n=0,i=0;i<this.cells.length;i++)n+=this.cells[i].length;var r=new Int32Array(t+n+this.keys.length+this.bboxes.length);r[0]=this.extent,r[1]=this.n,r[2]=this.padding;for(var a=t,o=0;o<e.length;o++){var s=e[o];r[3+o]=a,r.set(s,a),a+=s.length}return r[3+e.length]=a,r.set(this.keys,a),r[3+e.length+1]=a+=this.keys.length,r.set(this.bboxes,a),a+=this.bboxes.length,r.buffer};const{ImageData:rr,ImageBitmap:ar}=o,or={};function sr(e,t,n={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),or[e]={klass:t,omit:n.omit||[],shallow:n.shallow||[]}}sr("Object",Object),nr.serialize=function(e,t){const n=e.toArrayBuffer();return t&&t.push(n),{buffer:n}},nr.deserialize=function(e){return new nr(e.buffer)},sr("Grid",nr),sr("Color",ut),sr("Error",Error),sr("ResolvedImage",ft),sr("StylePropertyFunction",fi),sr("StyleExpression",li,{omit:["_evaluator"]}),sr("ZoomDependentExpression",di),sr("ZoomConstantExpression",hi),sr("CompoundExpression",Ct,{omit:["_evaluate"]});for(const Cd in Gn)Gn[Cd]._classRegistryKey||sr(`Expression_${Cd}`,Gn[Cd]);function lr(e){return e&&"undefined"!=typeof ArrayBuffer&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}function cr(e){return ar&&e instanceof ar}function ur(e,t){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(lr(e)||cr(e))return t&&t.push(e),e;if(ArrayBuffer.isView(e)){const n=e;return t&&t.push(n.buffer),n}if(e instanceof rr)return t&&t.push(e.data.buffer),e;if(Array.isArray(e)){const n=[];for(const i of e)n.push(ur(i,t));return n}if("object"==typeof e){const n=e.constructor,i=n._classRegistryKey;if(!i)throw new Error("can't serialize object of unregistered class");const r=n.serialize?n.serialize(e,t):{};if(!n.serialize){for(const n in e){if(!e.hasOwnProperty(n))continue;if(or[i].omit.indexOf(n)>=0)continue;const a=e[n];r[n]=or[i].shallow.indexOf(n)>=0?a:ur(a,t)}e instanceof Error&&(r.message=e.message)}if(r.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==i&&(r.$name=i),r}throw new Error("can't serialize object of type "+typeof e)}function hr(e){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||lr(e)||cr(e)||ArrayBuffer.isView(e)||e instanceof rr)return e;if(Array.isArray(e))return e.map(hr);if("object"==typeof e){const t=e.$name||"Object",{klass:n}=or[t];if(!n)throw new Error(`can't deserialize unregistered class ${t}`);if(n.deserialize)return n.deserialize(e);const i=Object.create(n.prototype);for(const r of Object.keys(e)){if("$name"===r)continue;const n=e[r];i[r]=or[t].shallow.indexOf(r)>=0?n:hr(n)}return i}throw new Error("can't deserialize object of type "+typeof e)}class dr{constructor(){this.first=!0}update(e,t){const n=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=n,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=n,!0):(this.lastFloorZoom>n?(this.lastIntegerZoom=n+1,this.lastIntegerZoomTime=t):this.lastFloorZoom<n&&(this.lastIntegerZoom=n,this.lastIntegerZoomTime=t),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=n,!0))}}const pr=e=>e>=1536&&e<=1791,fr=e=>e>=1872&&e<=1919,mr=e=>e>=2208&&e<=2303,gr=e=>e>=11904&&e<=12031,vr=e=>e>=12032&&e<=12255,yr=e=>e>=12272&&e<=12287,_r=e=>e>=12288&&e<=12351,xr=e=>e>=12352&&e<=12447,br=e=>e>=12448&&e<=12543,wr=e=>e>=12544&&e<=12591,Sr=e=>e>=12704&&e<=12735,Tr=e=>e>=12736&&e<=12783,Er=e=>e>=12784&&e<=12799,Mr=e=>e>=12800&&e<=13055,kr=e=>e>=13056&&e<=13311,Ar=e=>e>=13312&&e<=19903,Cr=e=>e>=19968&&e<=40959,Pr=e=>e>=40960&&e<=42127,Lr=e=>e>=42128&&e<=42191,Ir=e=>e>=44032&&e<=55215,Rr=e=>e>=63744&&e<=64255,zr=e=>e>=64336&&e<=65023,Dr=e=>e>=65040&&e<=65055,Or=e=>e>=65072&&e<=65103,Br=e=>e>=65104&&e<=65135,Fr=e=>e>=65136&&e<=65279,Nr=e=>e>=65280&&e<=65519;function Ur(e){for(const t of e)if(Gr(t.charCodeAt(0)))return!0;return!1}function Vr(e){for(const t of e)if(!jr(t.charCodeAt(0)))return!1;return!0}function jr(e){return!(pr(e)||fr(e)||mr(e)||zr(e)||Fr(e))}function Gr(e){return!(746!==e&&747!==e&&(e<4352||!(Sr(e)||wr(e)||Or(e)&&!(e>=65097&&e<=65103)||Rr(e)||kr(e)||gr(e)||Tr(e)||!(!_r(e)||e>=12296&&e<=12305||e>=12308&&e<=12319||12336===e)||Ar(e)||Cr(e)||Mr(e)||(e=>e>=12592&&e<=12687)(e)||(e=>e>=43360&&e<=43391)(e)||(e=>e>=55216&&e<=55295)(e)||(e=>e>=4352&&e<=4607)(e)||Ir(e)||xr(e)||yr(e)||(e=>e>=12688&&e<=12703)(e)||vr(e)||Er(e)||br(e)&&12540!==e||!(!Nr(e)||65288===e||65289===e||65293===e||e>=65306&&e<=65310||65339===e||65341===e||65343===e||e>=65371&&e<=65503||65507===e||e>=65512&&e<=65519)||!(!Br(e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||(e=>e>=5120&&e<=5759)(e)||(e=>e>=6320&&e<=6399)(e)||Dr(e)||(e=>e>=19904&&e<=19967)(e)||Pr(e)||Lr(e))))}function Hr(e){return!(Gr(e)||function(e){return!!((e=>e>=128&&e<=255)(e)&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||(e=>e>=8192&&e<=8303)(e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||(e=>e>=8448&&e<=8527)(e)||(e=>e>=8528&&e<=8591)(e)||(e=>e>=8960&&e<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||(e=>e>=9216&&e<=9279)(e)&&9251!==e||(e=>e>=9280&&e<=9311)(e)||(e=>e>=9312&&e<=9471)(e)||(e=>e>=9632&&e<=9727)(e)||(e=>e>=9728&&e<=9983)(e)&&!(e>=9754&&e<=9759)||(e=>e>=11008&&e<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||_r(e)||br(e)||(e=>e>=57344&&e<=63743)(e)||Or(e)||Br(e)||Nr(e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e)}(e))}function Wr(e){return e>=1424&&e<=2303||zr(e)||Fr(e)}function qr(e,t){return!(!t&&Wr(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||(e=>e>=6016&&e<=6143)(e))}function Zr(e){for(const t of e)if(Wr(t.charCodeAt(0)))return!0;return!1}const $r="deferred",Xr="loading",Yr="loaded";let Jr=null,Kr="unavailable",Qr=null;const ea=function(e){e&&"string"==typeof e&&e.indexOf("NetworkError")>-1&&(Kr="error"),Jr&&Jr(e)};function ta(){na.fire(new De("pluginStateChange",{pluginStatus:Kr,pluginURL:Qr}))}const na=new Be,ia=function(){return Kr},ra=function(){if(Kr!==$r||!Qr)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Kr=Xr,ta(),Qr&&Ee({url:Qr},(e=>{e?ea(e):(Kr=Yr,ta())}))},aa={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Kr===Yr||null!=aa.applyArabicShaping,isLoading:()=>Kr===Xr,setState(e){Kr=e.pluginStatus,Qr=e.pluginURL},isParsed:()=>null!=aa.applyArabicShaping&&null!=aa.processBidirectionalText&&null!=aa.processStyledBidirectionalText,getPluginURL:()=>Qr};class oa{constructor(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.zoomHistory=t.zoomHistory,this.transition=t.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new dr,this.transition={})}isSupportedScript(e){return function(e,t){for(const n of e)if(!qr(n.charCodeAt(0),t))return!1;return!0}(e,aa.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,t=e-Math.floor(e),n=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:t+(1-t)*n}:{fromScale:.5,toScale:1,t:1-(1-n)*t}}}class sa{constructor(e,t){this.property=e,this.value=t,this.expression=function(e,t){if(ei(e))return new fi(e,t);if(ci(e)){const n=pi(e,t);if("error"===n.result)throw new Error(n.value.map((e=>`${e.key}: ${e.message}`)).join(", "));return n.value}{let n=e;return"string"==typeof e&&"color"===t.type&&(n=ut.parse(e)),{kind:"constant",evaluate:()=>n}}}(void 0===t?e.specification.default:t,e.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,t,n){return this.property.possiblyEvaluate(this,e,t,n)}}class la{constructor(e){this.property=e,this.value=new sa(e,void 0)}transitioned(e,t){return new ua(this.property,this.value,t,_({},e.transition,this.transition),e.now)}untransitioned(){return new ua(this.property,this.value,null,{},0)}}class ca{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return C(this._values[e].value.value)}setValue(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new la(this._values[e].property)),this._values[e].value=new sa(this._values[e].property,null===t?void 0:C(t))}getTransition(e){return C(this._values[e].transition)}setTransition(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new la(this._values[e].property)),this._values[e].transition=C(t)||void 0}serialize(){const e={};for(const t of Object.keys(this._values)){const n=this.getValue(t);void 0!==n&&(e[t]=n);const i=this.getTransition(t);void 0!==i&&(e[`${t}-transition`]=i)}return e}transitioned(e,t){const n=new ha(this._properties);for(const i of Object.keys(this._values))n._values[i]=this._values[i].transitioned(e,t._values[i]);return n}untransitioned(){const e=new ha(this._properties);for(const t of Object.keys(this._values))e._values[t]=this._values[t].untransitioned();return e}}class ua{constructor(e,t,n,i,r){const a=i.delay||0,o=i.duration||0;r=r||0,this.property=e,this.value=t,this.begin=r+a,this.end=this.begin+o,e.specification.transition&&(i.delay||i.duration)&&(this.prior=n)}possiblyEvaluate(e,t,n){const i=e.now||0,r=this.value.possiblyEvaluate(e,t,n),a=this.prior;if(a){if(i>this.end)return this.prior=null,r;if(this.value.isDataDriven())return this.prior=null,r;if(i<this.begin)return a.possiblyEvaluate(e,t,n);{const o=(i-this.begin)/(this.end-this.begin);return this.property.interpolate(a.possiblyEvaluate(e,t,n),r,d(o))}}return r}}class ha{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,t,n){const i=new fa(this._properties);for(const r of Object.keys(this._values))i._values[r]=this._values[r].possiblyEvaluate(e,t,n);return i}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class da{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return C(this._values[e].value)}setValue(e,t){this._values[e]=new sa(this._values[e].property,null===t?void 0:C(t))}serialize(){const e={};for(const t of Object.keys(this._values)){const n=this.getValue(t);void 0!==n&&(e[t]=n)}return e}possiblyEvaluate(e,t,n){const i=new fa(this._properties);for(const r of Object.keys(this._values))i._values[r]=this._values[r].possiblyEvaluate(e,t,n);return i}}class pa{constructor(e,t,n){this.property=e,this.value=t,this.parameters=n}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,t,n,i){return this.property.evaluate(this.value,this.parameters,e,t,n,i)}}class fa{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class ma{constructor(e){this.specification=e}possiblyEvaluate(e,t){return e.expression.evaluate(t)}interpolate(e,t,n){const i=rn[this.specification.type];return i?i(e,t,n):e}}class ga{constructor(e,t){this.specification=e,this.overrides=t}possiblyEvaluate(e,t,n,i){return new pa(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(t,null,{},n,i)}:e.expression,t)}interpolate(e,t,n){if("constant"!==e.value.kind||"constant"!==t.value.kind)return e;if(void 0===e.value.value||void 0===t.value.value)return new pa(this,{kind:"constant",value:void 0},e.parameters);const i=rn[this.specification.type];return i?new pa(this,{kind:"constant",value:i(e.value.value,t.value.value,n)},e.parameters):e}evaluate(e,t,n,i,r,a){return"constant"===e.kind?e.value:e.evaluate(t,n,i,r,a)}}class va extends ga{possiblyEvaluate(e,t,n,i){if(void 0===e.value)return new pa(this,{kind:"constant",value:void 0},t);if("constant"===e.expression.kind){const r=e.expression.evaluate(t,null,{},n,i),a="resolvedImage"===e.property.specification.type&&"string"!=typeof r?r.name:r,o=this._calculate(a,a,a,t);return new pa(this,{kind:"constant",value:o},t)}if("camera"===e.expression.kind){const n=this._calculate(e.expression.evaluate({zoom:t.zoom-1}),e.expression.evaluate({zoom:t.zoom}),e.expression.evaluate({zoom:t.zoom+1}),t);return new pa(this,{kind:"constant",value:n},t)}return new pa(this,e.expression,t)}evaluate(e,t,n,i,r,a){if("source"===e.kind){const o=e.evaluate(t,n,i,r,a);return this._calculate(o,o,o,t)}return"composite"===e.kind?this._calculate(e.evaluate({zoom:Math.floor(t.zoom)-1},n,i),e.evaluate({zoom:Math.floor(t.zoom)},n,i),e.evaluate({zoom:Math.floor(t.zoom)+1},n,i),t):e.value}_calculate(e,t,n,i){return i.zoom>i.zoomHistory.lastIntegerZoom?{from:e,to:t,other:n}:{from:n,to:t,other:e}}interpolate(e){return e}}class ya{constructor(e){this.specification=e}possiblyEvaluate(e,t,n,i){if(void 0!==e.value){if("constant"===e.expression.kind){const r=e.expression.evaluate(t,null,{},n,i);return this._calculate(r,r,r,t)}return this._calculate(e.expression.evaluate(new oa(Math.floor(t.zoom-1),t)),e.expression.evaluate(new oa(Math.floor(t.zoom),t)),e.expression.evaluate(new oa(Math.floor(t.zoom+1),t)),t)}}_calculate(e,t,n,i){return i.zoom>i.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:n,to:t}}interpolate(e){return e}}class _a{constructor(e){this.specification=e}possiblyEvaluate(e,t,n,i){return!!e.expression.evaluate(t,null,{},n,i)}interpolate(){return!1}}class xa{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const t in e){const n=e[t];n.specification.overridable&&this.overridableProperties.push(t);const i=this.defaultPropertyValues[t]=new sa(n,void 0),r=this.defaultTransitionablePropertyValues[t]=new la(n);this.defaultTransitioningPropertyValues[t]=r.untransitioned(),this.defaultPossiblyEvaluatedValues[t]=i.possiblyEvaluate({})}}}function ba(e,t){return 256*(e=m(Math.floor(e),0,255))+m(Math.floor(t),0,255)}sr("DataDrivenProperty",ga),sr("DataConstantProperty",ma),sr("CrossFadedDataDrivenProperty",va),sr("CrossFadedProperty",ya),sr("ColorRampProperty",_a);const wa={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Sa{constructor(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ta{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,t){return e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Ea(e,t=1){let n=0,i=0;return{members:e.map((e=>{const r=wa[e.type].BYTES_PER_ELEMENT,a=n=Ma(n,Math.max(t,r)),o=e.components||1;return i=Math.max(i,r),n+=r*o,{name:e.name,type:e.type,components:o,offset:a}})),size:Ma(n,Math.max(i,t)),alignment:t}}function Ma(e,t){return Math.ceil(e/t)*t}class ka extends Ta{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t){const n=this.length;return this.resize(n+1),this.emplace(n,e,t)}emplace(e,t,n){const i=2*e;return this.int16[i+0]=t,this.int16[i+1]=n,e}}ka.prototype.bytesPerElement=4,sr("StructArrayLayout2i4",ka);class Aa extends Ta{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,n,i)}emplace(e,t,n,i,r){const a=4*e;return this.int16[a+0]=t,this.int16[a+1]=n,this.int16[a+2]=i,this.int16[a+3]=r,e}}Aa.prototype.bytesPerElement=8,sr("StructArrayLayout4i8",Aa);class Ca extends Ta{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,a,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,n,i,r,a,o)}emplace(e,t,n,i,r,a,o,s){const l=6*e,c=12*e,u=3*e;return this.int16[l+0]=t,this.int16[l+1]=n,this.uint8[c+4]=i,this.uint8[c+5]=r,this.uint8[c+6]=a,this.uint8[c+7]=o,this.float32[u+2]=s,e}}Ca.prototype.bytesPerElement=12,sr("StructArrayLayout2i4ub1f12",Ca);class Pa extends Ta{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t){const n=this.length;return this.resize(n+1),this.emplace(n,e,t)}emplace(e,t,n){const i=2*e;return this.float32[i+0]=t,this.float32[i+1]=n,e}}Pa.prototype.bytesPerElement=8,sr("StructArrayLayout2f8",Pa);class La extends Ta{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,a,o,s,l,c){const u=this.length;return this.resize(u+1),this.emplace(u,e,t,n,i,r,a,o,s,l,c)}emplace(e,t,n,i,r,a,o,s,l,c,u){const h=10*e;return this.uint16[h+0]=t,this.uint16[h+1]=n,this.uint16[h+2]=i,this.uint16[h+3]=r,this.uint16[h+4]=a,this.uint16[h+5]=o,this.uint16[h+6]=s,this.uint16[h+7]=l,this.uint16[h+8]=c,this.uint16[h+9]=u,e}}La.prototype.bytesPerElement=20,sr("StructArrayLayout10ui20",La);class Ia extends Ta{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,a,o,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,t,n,i,r,a,o,s)}emplace(e,t,n,i,r,a,o,s,l){const c=8*e;return this.uint16[c+0]=t,this.uint16[c+1]=n,this.uint16[c+2]=i,this.uint16[c+3]=r,this.uint16[c+4]=a,this.uint16[c+5]=o,this.uint16[c+6]=s,this.uint16[c+7]=l,e}}Ia.prototype.bytesPerElement=16,sr("StructArrayLayout8ui16",Ia);class Ra extends Ta{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,a,o,s,l,c,u,h){const d=this.length;return this.resize(d+1),this.emplace(d,e,t,n,i,r,a,o,s,l,c,u,h)}emplace(e,t,n,i,r,a,o,s,l,c,u,h,d){const p=12*e;return this.int16[p+0]=t,this.int16[p+1]=n,this.int16[p+2]=i,this.int16[p+3]=r,this.uint16[p+4]=a,this.uint16[p+5]=o,this.uint16[p+6]=s,this.uint16[p+7]=l,this.int16[p+8]=c,this.int16[p+9]=u,this.int16[p+10]=h,this.int16[p+11]=d,e}}Ra.prototype.bytesPerElement=24,sr("StructArrayLayout4i4ui4i24",Ra);class za extends Ta{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,n)}emplace(e,t,n,i){const r=3*e;return this.float32[r+0]=t,this.float32[r+1]=n,this.float32[r+2]=i,e}}za.prototype.bytesPerElement=12,sr("StructArrayLayout3f12",za);class Da extends Ta{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint32[1*e+0]=t,e}}Da.prototype.bytesPerElement=4,sr("StructArrayLayout1ul4",Da);class Oa extends Ta{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,a,o,s,l,c){const u=this.length;return this.resize(u+1),this.emplace(u,e,t,n,i,r,a,o,s,l,c)}emplace(e,t,n,i,r,a,o,s,l,c,u){const h=16*e,d=8*e;return this.int16[h+0]=t,this.int16[h+1]=n,this.float32[d+1]=i,this.float32[d+2]=r,this.float32[d+3]=a,this.float32[d+4]=o,this.int16[h+10]=s,this.uint32[d+6]=l,this.uint16[h+14]=c,this.uint16[h+15]=u,e}}Oa.prototype.bytesPerElement=32,sr("StructArrayLayout2i4f1i1ul2ui32",Oa);class Ba extends Ta{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,a){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,n,i,r,a)}emplace(e,t,n,i,r,a,o){const s=6*e;return this.int16[s+0]=t,this.int16[s+1]=n,this.int16[s+2]=i,this.int16[s+3]=r,this.int16[s+4]=a,this.int16[s+5]=o,e}}Ba.prototype.bytesPerElement=12,sr("StructArrayLayout2i2i2i12",Ba);class Fa extends Ta{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,n,i,r)}emplace(e,t,n,i,r,a){const o=4*e,s=8*e;return this.float32[o+0]=t,this.float32[o+1]=n,this.float32[o+2]=i,this.int16[s+6]=r,this.int16[s+7]=a,e}}Fa.prototype.bytesPerElement=16,sr("StructArrayLayout2f1f2i16",Fa);class Na extends Ta{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,n,i)}emplace(e,t,n,i,r){const a=12*e,o=3*e;return this.uint8[a+0]=t,this.uint8[a+1]=n,this.float32[o+1]=i,this.float32[o+2]=r,e}}Na.prototype.bytesPerElement=12,sr("StructArrayLayout2ub2f12",Na);class Ua extends Ta{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,n)}emplace(e,t,n,i){const r=3*e;return this.uint16[r+0]=t,this.uint16[r+1]=n,this.uint16[r+2]=i,e}}Ua.prototype.bytesPerElement=6,sr("StructArrayLayout3ui6",Ua);class Va extends Ta{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,a,o,s,l,c,u,h,d,p,f,m,g){const v=this.length;return this.resize(v+1),this.emplace(v,e,t,n,i,r,a,o,s,l,c,u,h,d,p,f,m,g)}emplace(e,t,n,i,r,a,o,s,l,c,u,h,d,p,f,m,g,v){const y=24*e,_=12*e,x=48*e;return this.int16[y+0]=t,this.int16[y+1]=n,this.uint16[y+2]=i,this.uint16[y+3]=r,this.uint32[_+2]=a,this.uint32[_+3]=o,this.uint32[_+4]=s,this.uint16[y+10]=l,this.uint16[y+11]=c,this.uint16[y+12]=u,this.float32[_+7]=h,this.float32[_+8]=d,this.uint8[x+36]=p,this.uint8[x+37]=f,this.uint8[x+38]=m,this.uint32[_+10]=g,this.int16[y+22]=v,e}}Va.prototype.bytesPerElement=48,sr("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Va);class ja extends Ta{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,a,o,s,l,c,u,h,d,p,f,m,g,v,y,_,x,b,w,S,T,E,M,k){const A=this.length;return this.resize(A+1),this.emplace(A,e,t,n,i,r,a,o,s,l,c,u,h,d,p,f,m,g,v,y,_,x,b,w,S,T,E,M,k)}emplace(e,t,n,i,r,a,o,s,l,c,u,h,d,p,f,m,g,v,y,_,x,b,w,S,T,E,M,k,A){const C=34*e,P=17*e;return this.int16[C+0]=t,this.int16[C+1]=n,this.int16[C+2]=i,this.int16[C+3]=r,this.int16[C+4]=a,this.int16[C+5]=o,this.int16[C+6]=s,this.int16[C+7]=l,this.uint16[C+8]=c,this.uint16[C+9]=u,this.uint16[C+10]=h,this.uint16[C+11]=d,this.uint16[C+12]=p,this.uint16[C+13]=f,this.uint16[C+14]=m,this.uint16[C+15]=g,this.uint16[C+16]=v,this.uint16[C+17]=y,this.uint16[C+18]=_,this.uint16[C+19]=x,this.uint16[C+20]=b,this.uint16[C+21]=w,this.uint16[C+22]=S,this.uint32[P+12]=T,this.float32[P+13]=E,this.float32[P+14]=M,this.float32[P+15]=k,this.float32[P+16]=A,e}}ja.prototype.bytesPerElement=68,sr("StructArrayLayout8i15ui1ul4f68",ja);class Ga extends Ta{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.float32[1*e+0]=t,e}}Ga.prototype.bytesPerElement=4,sr("StructArrayLayout1f4",Ga);class Ha extends Ta{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,n)}emplace(e,t,n,i){const r=3*e;return this.int16[r+0]=t,this.int16[r+1]=n,this.int16[r+2]=i,e}}Ha.prototype.bytesPerElement=6,sr("StructArrayLayout3i6",Ha);class Wa extends Ta{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,n,i)}emplace(e,t,n,i,r){const a=6*e;return this.uint32[3*e+0]=t,this.uint16[a+2]=n,this.uint16[a+3]=i,this.uint16[a+4]=r,e}}Wa.prototype.bytesPerElement=12,sr("StructArrayLayout1ul3ui12",Wa);class qa extends Ta{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t){const n=this.length;return this.resize(n+1),this.emplace(n,e,t)}emplace(e,t,n){const i=2*e;return this.uint16[i+0]=t,this.uint16[i+1]=n,e}}qa.prototype.bytesPerElement=4,sr("StructArrayLayout2ui4",qa);class Za extends Ta{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint16[1*e+0]=t,e}}Za.prototype.bytesPerElement=2,sr("StructArrayLayout1ui2",Za);class $a extends Ta{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,n,i)}emplace(e,t,n,i,r){const a=4*e;return this.float32[a+0]=t,this.float32[a+1]=n,this.float32[a+2]=i,this.float32[a+3]=r,e}}$a.prototype.bytesPerElement=16,sr("StructArrayLayout4f16",$a);class Xa extends Sa{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.float32[this._pos4+1]}get y1(){return this._structArray.float32[this._pos4+2]}get x2(){return this._structArray.float32[this._pos4+3]}get y2(){return this._structArray.float32[this._pos4+4]}get padding(){return this._structArray.int16[this._pos2+10]}get featureIndex(){return this._structArray.uint32[this._pos4+6]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+14]}get bucketIndex(){return this._structArray.uint16[this._pos2+15]}get anchorPoint(){return new r(this.anchorPointX,this.anchorPointY)}}Xa.prototype.size=32;class Ya extends Oa{get(e){return new Xa(this,e)}}sr("CollisionBoxArray",Ya);class Ja extends Sa{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}Ja.prototype.size=48;class Ka extends Va{get(e){return new Ja(this,e)}}sr("PlacedSymbolArray",Ka);class Qa extends Sa{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}Qa.prototype.size=68;class eo extends ja{get(e){return new Qa(this,e)}}sr("SymbolInstanceArray",eo);class to extends Ga{getoffsetX(e){return this.float32[1*e+0]}}sr("GlyphOffsetArray",to);class no extends Ha{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}sr("SymbolLineVertexArray",no);class io extends Sa{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}io.prototype.size=12;class ro extends Wa{get(e){return new io(this,e)}}sr("FeatureIndexArray",ro);class ao extends Sa{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}ao.prototype.size=4;class oo extends qa{get(e){return new ao(this,e)}}sr("FillExtrusionCentroidArray",oo);const so=Ea([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),lo=Ea([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var co=lt((function(e){e.exports=function(e,t){var n,i,r,a,o,s,l,c;for(i=e.length-(n=3&e.length),r=t,o=3432918353,s=461845907,c=0;c<i;)l=255&e.charCodeAt(c)|(255&e.charCodeAt(++c))<<8|(255&e.charCodeAt(++c))<<16|(255&e.charCodeAt(++c))<<24,++c,r=27492+(65535&(a=5*(65535&(r=(r^=l=(65535&(l=(l=(65535&l)*o+(((l>>>16)*o&65535)<<16)&4294967295)<<15|l>>>17))*s+(((l>>>16)*s&65535)<<16)&4294967295)<<13|r>>>19))+((5*(r>>>16)&65535)<<16)&4294967295))+((58964+(a>>>16)&65535)<<16);switch(l=0,n){case 3:l^=(255&e.charCodeAt(c+2))<<16;case 2:l^=(255&e.charCodeAt(c+1))<<8;case 1:r^=l=(65535&(l=(l=(65535&(l^=255&e.charCodeAt(c)))*o+(((l>>>16)*o&65535)<<16)&4294967295)<<15|l>>>17))*s+(((l>>>16)*s&65535)<<16)&4294967295}return r^=e.length,r=2246822507*(65535&(r^=r>>>16))+((2246822507*(r>>>16)&65535)<<16)&4294967295,r=3266489909*(65535&(r^=r>>>13))+((3266489909*(r>>>16)&65535)<<16)&4294967295,(r^=r>>>16)>>>0}})),uo=lt((function(e){e.exports=function(e,t){for(var n,i=e.length,r=t^i,a=0;i>=4;)n=1540483477*(65535&(n=255&e.charCodeAt(a)|(255&e.charCodeAt(++a))<<8|(255&e.charCodeAt(++a))<<16|(255&e.charCodeAt(++a))<<24))+((1540483477*(n>>>16)&65535)<<16),r=1540483477*(65535&r)+((1540483477*(r>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),i-=4,++a;switch(i){case 3:r^=(255&e.charCodeAt(a+2))<<16;case 2:r^=(255&e.charCodeAt(a+1))<<8;case 1:r=1540483477*(65535&(r^=255&e.charCodeAt(a)))+((1540483477*(r>>>16)&65535)<<16)}return r=1540483477*(65535&(r^=r>>>13))+((1540483477*(r>>>16)&65535)<<16),(r^=r>>>15)>>>0}})),ho=co,po=uo;ho.murmur3=co,ho.murmur2=po;class fo{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,t,n,i){this.ids.push(mo(e)),this.positions.push(t,n,i)}getPositions(e){const t=mo(e);let n=0,i=this.ids.length-1;for(;n<i;){const e=n+i>>1;this.ids[e]>=t?i=e:n=e+1}const r=[];for(;this.ids[n]===t;)r.push({index:this.positions[3*n],start:this.positions[3*n+1],end:this.positions[3*n+2]}),n++;return r}static serialize(e,t){const n=new Float64Array(e.ids),i=new Uint32Array(e.positions);return go(n,i,0,n.length-1),t&&t.push(n.buffer,i.buffer),{ids:n,positions:i}}static deserialize(e){const t=new fo;return t.ids=e.ids,t.positions=e.positions,t.indexed=!0,t}}function mo(e){const t=+e;return!isNaN(t)&&t<=s?t:ho(String(e))}function go(e,t,n,i){for(;n<i;){const r=e[n+i>>1];let a=n-1,o=i+1;for(;;){do{a++}while(e[a]<r);do{o--}while(e[o]>r);if(a>=o)break;vo(e,a,o),vo(t,3*a,3*o),vo(t,3*a+1,3*o+1),vo(t,3*a+2,3*o+2)}o-n<i-o?(go(e,t,n,o),n=o+1):(go(e,t,o+1,i),i=o)}}function vo(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}sr("FeaturePositionMap",fo);class yo{constructor(e,t){this.gl=e.gl,this.location=t}}class _o extends yo{constructor(e,t){super(e,t),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class xo extends yo{constructor(e,t){super(e,t),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class bo extends yo{constructor(e,t){super(e,t),this.current=ut.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const wo=new Float32Array(16),So=new Float32Array(9);function To(e){return[ba(255*e.r,255*e.g),ba(255*e.b,255*e.a)]}class Eo{constructor(e,t,n){this.value=e,this.uniformNames=t.map((e=>`u_${e}`)),this.type=n}setUniform(e,t,n){e.set(n.constantOr(this.value))}getBinding(e,t,n){return"color"===this.type?new bo(e,t):new _o(e,t)}}class Mo{constructor(e,t){this.uniformNames=t.map((e=>`u_${e}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,t){this.pixelRatioFrom=t.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=t.tl.concat(t.br),this.patternTo=e.tl.concat(e.br)}setUniform(e,t,n,i){const r="u_pattern_to"===i||"u_dash_to"===i?this.patternTo:"u_pattern_from"===i||"u_dash_from"===i?this.patternFrom:"u_pixel_ratio_to"===i?this.pixelRatioTo:"u_pixel_ratio_from"===i?this.pixelRatioFrom:null;r&&e.set(r)}getBinding(e,t,n){return"u_pattern_from"===n||"u_pattern_to"===n||"u_dash_from"===n||"u_dash_to"===n?new xo(e,t):new _o(e,t)}}class ko{constructor(e,t,n,i){this.expression=e,this.type=n,this.maxValue=0,this.paintVertexAttributes=t.map((e=>({name:`a_${e}`,type:"Float32",components:"color"===n?2:1,offset:0}))),this.paintVertexArray=new i}populatePaintArray(e,t,n,i,r){const a=this.paintVertexArray.length,o=this.expression.evaluate(new oa(0),t,{},i,[],r);this.paintVertexArray.resize(e),this._setPaintValue(a,e,o)}updatePaintArray(e,t,n,i){const r=this.expression.evaluate({zoom:0},n,i);this._setPaintValue(e,t,r)}_setPaintValue(e,t,n){if("color"===this.type){const i=To(n);for(let n=e;n<t;n++)this.paintVertexArray.emplace(n,i[0],i[1])}else{for(let i=e;i<t;i++)this.paintVertexArray.emplace(i,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ao{constructor(e,t,n,i,r,a){this.expression=e,this.uniformNames=t.map((e=>`u_${e}_t`)),this.type=n,this.useIntegerZoom=i,this.zoom=r,this.maxValue=0,this.paintVertexAttributes=t.map((e=>({name:`a_${e}`,type:"Float32",components:"color"===n?4:2,offset:0}))),this.paintVertexArray=new a}populatePaintArray(e,t,n,i,r){const a=this.expression.evaluate(new oa(this.zoom),t,{},i,[],r),o=this.expression.evaluate(new oa(this.zoom+1),t,{},i,[],r),s=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(s,e,a,o)}updatePaintArray(e,t,n,i){const r=this.expression.evaluate({zoom:this.zoom},n,i),a=this.expression.evaluate({zoom:this.zoom+1},n,i);this._setPaintValue(e,t,r,a)}_setPaintValue(e,t,n,i){if("color"===this.type){const r=To(n),a=To(i);for(let n=e;n<t;n++)this.paintVertexArray.emplace(n,r[0],r[1],a[0],a[1])}else{for(let r=e;r<t;r++)this.paintVertexArray.emplace(r,n,i);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(i))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,t){const n=this.useIntegerZoom?Math.floor(t.zoom):t.zoom,i=m(this.expression.interpolationFactor(n,this.zoom,this.zoom+1),0,1);e.set(i)}getBinding(e,t,n){return new _o(e,t)}}class Co{constructor(e,t,n,i,r,a,o){this.expression=e,this.type=n,this.useIntegerZoom=i,this.zoom=r,this.layerId=o,this.paintVertexAttributes=("array"===n?lo:so).members;for(let s=0;s<t.length;++s);this.zoomInPaintVertexArray=new a,this.zoomOutPaintVertexArray=new a}populatePaintArray(e,t,n){const i=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(i,e,t.patterns&&t.patterns[this.layerId],n)}updatePaintArray(e,t,n,i,r){this._setPaintValues(e,t,n.patterns&&n.patterns[this.layerId],r)}_setPaintValues(e,t,n,i){if(!i||!n)return;const{min:r,mid:a,max:o}=n,s=i[r],l=i[a],c=i[o];if(s&&l&&c)for(let u=e;u<t;u++)this._setPaintValue(this.zoomInPaintVertexArray,u,l,s),this._setPaintValue(this.zoomOutPaintVertexArray,u,l,c)}_setPaintValue(e,t,n,i){e.emplace(t,n.tl[0],n.tl[1],n.br[0],n.br[1],i.tl[0],i.tl[1],i.br[0],i.br[1],n.pixelRatio,i.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Po{constructor(e,t,n=(()=>!0)){this.binders={},this._buffers=[];const i=[];for(const r in e.paint._values){if(!n(r))continue;const a=e.paint.get(r);if(!(a instanceof pa&&Yn(a.property.specification)))continue;const o=Ro(r,e.type),s=a.value,l=a.property.specification.type,c=a.property.useIntegerZoom,u=a.property.specification["property-type"],h="cross-faded"===u||"cross-faded-data-driven"===u,d="line-dasharray"===String(r)&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==s.kind||d)if("source"===s.kind||d||h){const n=Oo(r,l,"source");this.binders[r]=h?new Co(s,o,l,c,t,n,e.id):new ko(s,o,l,n),i.push(`/a_${r}`)}else{const e=Oo(r,l,"composite");this.binders[r]=new Ao(s,o,l,c,t,e),i.push(`/z_${r}`)}else this.binders[r]=h?new Mo(s.value,o):new Eo(s.value,o,l),i.push(`/u_${r}`)}this.cacheKey=i.sort().join("")}getMaxValue(e){const t=this.binders[e];return t instanceof ko||t instanceof Ao?t.maxValue:0}populatePaintArrays(e,t,n,i,r){for(const a in this.binders){const o=this.binders[a];(o instanceof ko||o instanceof Ao||o instanceof Co)&&o.populatePaintArray(e,t,n,i,r)}}setConstantPatternPositions(e,t){for(const n in this.binders){const i=this.binders[n];i instanceof Mo&&i.setConstantPatternPositions(e,t)}}updatePaintArrays(e,t,n,i,r){let a=!1;for(const o in e){const s=t.getPositions(o);for(const t of s){const s=n.feature(t.index);for(const n in this.binders){const l=this.binders[n];if((l instanceof ko||l instanceof Ao||l instanceof Co)&&!0===l.expression.isStateDependent){const c=i.paint.get(n);l.expression=c.value,l.updatePaintArray(t.start,t.end,s,e[o],r),a=!0}}}}return a}defines(){const e=[];for(const t in this.binders){const n=this.binders[t];(n instanceof Eo||n instanceof Mo)&&e.push(...n.uniformNames.map((e=>`#define HAS_UNIFORM_${e}`)))}return e}getBinderAttributes(){const e=[];for(const t in this.binders){const n=this.binders[t];if(n instanceof ko||n instanceof Ao||n instanceof Co)for(let t=0;t<n.paintVertexAttributes.length;t++)e.push(n.paintVertexAttributes[t].name)}return e}getBinderUniforms(){const e=[];for(const t in this.binders){const n=this.binders[t];if(n instanceof Eo||n instanceof Mo||n instanceof Ao)for(const t of n.uniformNames)e.push(t)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,t){const n=[];for(const i in this.binders){const r=this.binders[i];if(r instanceof Eo||r instanceof Mo||r instanceof Ao)for(const a of r.uniformNames)if(t[a]){const o=r.getBinding(e,t[a],a);n.push({name:a,property:i,binding:o})}}return n}setUniforms(e,t,n,i){for(const{name:r,property:a,binding:o}of t)this.binders[a].setUniform(o,i,n.get(a),r)}updatePaintBuffers(e){this._buffers=[];for(const t in this.binders){const n=this.binders[t];if(e&&n instanceof Co){const t=2===e.fromScale?n.zoomInPaintVertexBuffer:n.zoomOutPaintVertexBuffer;t&&this._buffers.push(t)}else(n instanceof ko||n instanceof Ao)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(e){for(const t in this.binders){const n=this.binders[t];(n instanceof ko||n instanceof Ao||n instanceof Co)&&n.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const t=this.binders[e];(t instanceof ko||t instanceof Ao||t instanceof Co)&&t.destroy()}}}class Lo{constructor(e,t,n=(()=>!0)){this.programConfigurations={};for(const i of e)this.programConfigurations[i.id]=new Po(i,t,n);this.needsUpload=!1,this._featureMap=new fo,this._bufferOffset=0}populatePaintArrays(e,t,n,i,r,a){for(const o in this.programConfigurations)this.programConfigurations[o].populatePaintArrays(e,t,i,r,a);void 0!==t.id&&this._featureMap.add(t.id,n,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,t,n,i){for(const r of n)this.needsUpload=this.programConfigurations[r.id].updatePaintArrays(e,this._featureMap,t,r,i)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Io={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function Ro(e,t){return Io[e]||[e.replace(`${t}-`,"").replace(/-/g,"_")]}const zo={"line-pattern":{source:La,composite:La},"fill-pattern":{source:La,composite:La},"fill-extrusion-pattern":{source:La,composite:La},"line-dasharray":{source:Ia,composite:Ia}},Do={color:{source:Pa,composite:$a},number:{source:Ga,composite:Pa}};function Oo(e,t,n){const i=zo[e];return i&&i[n]||Do[t][n]}sr("ConstantBinder",Eo),sr("CrossFadedConstantBinder",Mo),sr("SourceExpressionBinder",ko),sr("CrossFadedCompositeBinder",Co),sr("CompositeExpressionBinder",Ao),sr("ProgramConfiguration",Po,{omit:["_buffers"]}),sr("ProgramConfigurationSet",Lo);const Bo="-transition";class Fo extends Be{constructor(e,t){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},"custom"!==e.type&&(this.metadata=(e=e).metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),t.layout&&(this._unevaluatedLayout=new da(t.layout)),t.paint)){this._transitionablePaint=new ca(t.paint);for(const t in e.paint)this.setPaintProperty(t,e.paint[t],{validate:!1});for(const t in e.layout)this.setLayoutProperty(t,e.layout[t],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new fa(t.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,t,n={}){null!=t&&this._validate(er,`layers.${this.id}.layout.${e}`,e,t,n)||("visibility"!==e?this._unevaluatedLayout.setValue(e,t):this.visibility=t)}getPaintProperty(e){return M(e,Bo)?this._transitionablePaint.getTransition(e.slice(0,-Bo.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,t,n={}){if(null!=t&&this._validate(Qi,`layers.${this.id}.paint.${e}`,e,t,n))return!1;if(M(e,Bo))return this._transitionablePaint.setTransition(e.slice(0,-Bo.length),t||void 0),!1;{const n=this._transitionablePaint._values[e],i="cross-faded-data-driven"===n.property.specification["property-type"],r=n.value.isDataDriven(),a=n.value;this._transitionablePaint.setValue(e,t),this._handleSpecialPaintPropertyUpdate(e);const o=this._transitionablePaint._values[e].value;return o.isDataDriven()||r||i||this._handleOverridablePaintPropertyUpdate(e,a,o)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,t,n){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,t){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,t)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,t)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),A(e,((e,t)=>!(void 0===e||"layout"===t&&!Object.keys(e).length||"paint"===t&&!Object.keys(e).length)))}_validate(e,t,n,i,r={}){return(!r||!1!==r.validate)&&tr(this,e.call(Yi,{key:t,layerType:this.type,objectKey:n,value:i,styleSpec:Fe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const t=this.paint.get(e);if(t instanceof pa&&Yn(t.property.specification)&&("source"===t.value.kind||"composite"===t.value.kind)&&t.value.isStateDependent)return!0}return!1}}const No=Ea([{name:"a_pos",components:2,type:"Int16"}],4),{members:Uo}=No;class Vo{constructor(e=[]){this.segments=e}prepareSegment(e,t,n,i){let r=this.segments[this.segments.length-1];return e>Vo.MAX_VERTEX_ARRAY_LENGTH&&L(`Max vertices per segment is ${Vo.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!r||r.vertexLength+e>Vo.MAX_VERTEX_ARRAY_LENGTH||r.sortKey!==i)&&(r={vertexOffset:t.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0},void 0!==i&&(r.sortKey=i),this.segments.push(r)),r}get(){return this.segments}destroy(){for(const e of this.segments)for(const t in e.vaos)e.vaos[t].destroy()}static simpleSegment(e,t,n,i){return new Vo([{vertexOffset:e,primitiveOffset:t,vertexLength:n,primitiveLength:i,vaos:{},sortKey:0}])}}Vo.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,sr("SegmentVector",Vo);var jo=8192;const Go=Math.pow(2,14)-1,Ho=-Go-1;function Wo(e){const t=jo/e.extent,n=e.loadGeometry();for(let i=0;i<n.length;i++){const e=n[i];for(let n=0;n<e.length;n++){const i=e[n],r=Math.round(i.x*t),a=Math.round(i.y*t);i.x=m(r,Ho,Go),i.y=m(a,Ho,Go),(r<i.x||r>i.x+1||a<i.y||a>i.y+1)&&L("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function qo(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?Wo(e):[]}}function Zo(e,t,n,i,r){e.emplaceBack(2*t+(i+1)/2,2*n+(r+1)/2)}class $o{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new ka,this.indexArray=new Ua,this.segments=new Vo,this.programConfigurations=new Lo(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,t,n){const i=this.layers[0],r=[];let a=null;"circle"===i.type&&(a=i.layout.get("circle-sort-key"));for(const{feature:o,id:s,index:l,sourceLayerIndex:c}of e){const e=this.layers[0]._featureFilter.needGeometry,t=qo(o,e);if(!this.layers[0]._featureFilter.filter(new oa(this.zoom),t,n))continue;const i=a?a.evaluate(t,{},n):void 0,u={id:s,properties:o.properties,type:o.type,sourceLayerIndex:c,index:l,geometry:e?t.geometry:Wo(o),patterns:{},sortKey:i};r.push(u)}a&&r.sort(((e,t)=>e.sortKey-t.sortKey));for(const o of r){const{geometry:i,index:r,sourceLayerIndex:a}=o,s=e[r].feature;this.addFeature(o,i,r,n),t.featureIndex.insert(s,i,r,a,this.index)}}update(e,t,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Uo),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,t,n,i){for(const r of t)for(const t of r){const n=t.x,i=t.y;if(n<0||n>=jo||i<0||i>=jo)continue;const r=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),a=r.vertexLength;Zo(this.layoutVertexArray,n,i,-1,-1),Zo(this.layoutVertexArray,n,i,1,-1),Zo(this.layoutVertexArray,n,i,1,1),Zo(this.layoutVertexArray,n,i,-1,1),this.indexArray.emplaceBack(a,a+1,a+2),this.indexArray.emplaceBack(a,a+3,a+2),r.vertexLength+=4,r.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,{},i)}}function Xo(e,t){for(let n=0;n<e.length;n++)if(rs(t,e[n]))return!0;for(let n=0;n<t.length;n++)if(rs(e,t[n]))return!0;return!!Qo(e,t)}function Yo(e,t,n){return!!rs(e,t)||!!ts(t,e,n)}function Jo(e,t){if(1===e.length)return is(t,e[0]);for(let n=0;n<t.length;n++){const i=t[n];for(let t=0;t<i.length;t++)if(rs(e,i[t]))return!0}for(let n=0;n<e.length;n++)if(is(t,e[n]))return!0;for(let n=0;n<t.length;n++)if(Qo(e,t[n]))return!0;return!1}function Ko(e,t,n){if(e.length>1){if(Qo(e,t))return!0;for(let i=0;i<t.length;i++)if(ts(t[i],e,n))return!0}for(let i=0;i<e.length;i++)if(ts(e[i],t,n))return!0;return!1}function Qo(e,t){if(0===e.length||0===t.length)return!1;for(let n=0;n<e.length-1;n++){const i=e[n],r=e[n+1];for(let e=0;e<t.length-1;e++)if(es(i,r,t[e],t[e+1]))return!0}return!1}function es(e,t,n,i){return I(e,n,i)!==I(t,n,i)&&I(e,t,n)!==I(e,t,i)}function ts(e,t,n){const i=n*n;if(1===t.length)return e.distSqr(t[0])<i;for(let r=1;r<t.length;r++)if(ns(e,t[r-1],t[r])<i)return!0;return!1}function ns(e,t,n){const i=t.distSqr(n);if(0===i)return e.distSqr(t);const r=((e.x-t.x)*(n.x-t.x)+(e.y-t.y)*(n.y-t.y))/i;return e.distSqr(r<0?t:r>1?n:n.sub(t)._mult(r)._add(t))}function is(e,t){let n,i,r,a=!1;for(let o=0;o<e.length;o++){n=e[o];for(let e=0,o=n.length-1;e<n.length;o=e++)i=n[e],r=n[o],i.y>t.y!=r.y>t.y&&t.x<(r.x-i.x)*(t.y-i.y)/(r.y-i.y)+i.x&&(a=!a)}return a}function rs(e,t){let n=!1;for(let i=0,r=e.length-1;i<e.length;r=i++){const a=e[i],o=e[r];a.y>t.y!=o.y>t.y&&t.x<(o.x-a.x)*(t.y-a.y)/(o.y-a.y)+a.x&&(n=!n)}return n}function as(e,t,n,i,a){for(const r of e)if(t<=r.x&&n<=r.y&&i>=r.x&&a>=r.y)return!0;const o=[new r(t,n),new r(t,a),new r(i,a),new r(i,n)];if(e.length>2)for(const r of o)if(rs(e,r))return!0;for(let r=0;r<e.length-1;r++)if(os(e[r],e[r+1],o))return!0;return!1}function os(e,t,n){const i=n[0],r=n[2];if(e.x<i.x&&t.x<i.x||e.x>r.x&&t.x>r.x||e.y<i.y&&t.y<i.y||e.y>r.y&&t.y>r.y)return!1;const a=I(e,t,n[0]);return a!==I(e,t,n[1])||a!==I(e,t,n[2])||a!==I(e,t,n[3])}function ss(e,t,n){const i=t.paint.get(e).value;return"constant"===i.kind?i.value:n.programConfigurations.get(t.id).getMaxValue(e)}function ls(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function cs(e,t,n,i,a){if(!t[0]&&!t[1])return e;const o=r.convert(t)._mult(a);"viewport"===n&&o._rotate(-i);const s=[];for(let r=0;r<e.length;r++)s.push(e[r].sub(o));return s}function us(e,t,n,i){const a=r.convert(e)._mult(i);return"viewport"===t&&a._rotate(-n),a}sr("CircleBucket",$o,{omit:["layers"]});const hs=new xa({"circle-sort-key":new ga(Fe.layout_circle["circle-sort-key"])});var ds={paint:new xa({"circle-radius":new ga(Fe.paint_circle["circle-radius"]),"circle-color":new ga(Fe.paint_circle["circle-color"]),"circle-blur":new ga(Fe.paint_circle["circle-blur"]),"circle-opacity":new ga(Fe.paint_circle["circle-opacity"]),"circle-translate":new ma(Fe.paint_circle["circle-translate"]),"circle-translate-anchor":new ma(Fe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ma(Fe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ma(Fe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ga(Fe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ga(Fe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ga(Fe.paint_circle["circle-stroke-opacity"])}),layout:hs},ps="undefined"!=typeof Float32Array?Float32Array:Array;function fs(){var e=new ps(9);return ps!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function ms(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function gs(e,t,n){var i=t[0],r=t[1],a=t[2],o=t[3],s=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],p=t[10],f=t[11],m=t[12],g=t[13],v=t[14],y=t[15],_=n[0],x=n[1],b=n[2],w=n[3];return e[0]=_*i+x*s+b*h+w*m,e[1]=_*r+x*l+b*d+w*g,e[2]=_*a+x*c+b*p+w*v,e[3]=_*o+x*u+b*f+w*y,e[4]=(_=n[4])*i+(x=n[5])*s+(b=n[6])*h+(w=n[7])*m,e[5]=_*r+x*l+b*d+w*g,e[6]=_*a+x*c+b*p+w*v,e[7]=_*o+x*u+b*f+w*y,e[8]=(_=n[8])*i+(x=n[9])*s+(b=n[10])*h+(w=n[11])*m,e[9]=_*r+x*l+b*d+w*g,e[10]=_*a+x*c+b*p+w*v,e[11]=_*o+x*u+b*f+w*y,e[12]=(_=n[12])*i+(x=n[13])*s+(b=n[14])*h+(w=n[15])*m,e[13]=_*r+x*l+b*d+w*g,e[14]=_*a+x*c+b*p+w*v,e[15]=_*o+x*u+b*f+w*y,e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var vs=gs;function ys(){var e=new ps(3);return ps!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function _s(e){return Math.hypot(e[0],e[1],e[2])}function xs(e,t,n){var i=new ps(3);return i[0]=e,i[1]=t,i[2]=n,i}function bs(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function ws(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function Ss(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e}function Ts(e,t){var n=t[0],i=t[1],r=t[2],a=n*n+i*i+r*r;return a>0&&(a=1/Math.sqrt(a)),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a,e}function Es(e,t,n){var i=n[0],r=n[1],a=n[2],o=t[0],s=t[1],l=t[2],c=r*l-a*s,u=a*o-i*l,h=i*s-r*o,d=r*h-a*u,p=a*c-i*h,f=i*u-r*c,m=2*n[3];return u*=m,h*=m,p*=2,f*=2,e[0]=o+(c*=m)+(d*=2),e[1]=s+u+p,e[2]=l+h+f,e}var Ms,ks=bs,As=ws,Cs=_s;function Ps(e,t,n){var i=t[0],r=t[1],a=t[2],o=t[3];return e[0]=n[0]*i+n[4]*r+n[8]*a+n[12]*o,e[1]=n[1]*i+n[5]*r+n[9]*a+n[13]*o,e[2]=n[2]*i+n[6]*r+n[10]*a+n[14]*o,e[3]=n[3]*i+n[7]*r+n[11]*a+n[15]*o,e}function Ls(){var e=new ps(4);return ps!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function Is(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function Rs(e,t,n){n*=.5;var i=t[0],r=t[1],a=t[2],o=t[3],s=Math.sin(n),l=Math.cos(n);return e[0]=i*l+o*s,e[1]=r*l+a*s,e[2]=a*l-r*s,e[3]=o*l-i*s,e}function zs(e,t,n){const i=Ps([],[e.x,e.y,t,1],n);return new r(i[0]/i[3],i[1]/i[3])}ys(),Ms=new ps(4),ps!=Float32Array&&(Ms[0]=0,Ms[1]=0,Ms[2]=0,Ms[3]=0),ys(),xs(1,0,0),xs(0,1,0),Ls(),Ls(),fs();const Ds=xs(0,0,0),Os=xs(0,0,1);function Bs(e,t){const n=ys();return Ds[2]=t,e.intersectsPlane(Ds,Os,n),new r(n[0],n[1])}class Fs extends $o{}function Ns(e,{width:t,height:n},i,r){if(r){if(r instanceof Uint8ClampedArray)r=new Uint8Array(r.buffer);else if(r.length!==t*n*i)throw new RangeError("mismatched image size")}else r=new Uint8Array(t*n*i);return e.width=t,e.height=n,e.data=r,e}function Us(e,{width:t,height:n},i){if(t===e.width&&n===e.height)return;const r=Ns({},{width:t,height:n},i);Vs(e,r,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,t),height:Math.min(e.height,n)},i),e.width=t,e.height=n,e.data=r.data}function Vs(e,t,n,i,r,a){if(0===r.width||0===r.height)return t;if(r.width>e.width||r.height>e.height||n.x>e.width-r.width||n.y>e.height-r.height)throw new RangeError("out of range source coordinates for image copy");if(r.width>t.width||r.height>t.height||i.x>t.width-r.width||i.y>t.height-r.height)throw new RangeError("out of range destination coordinates for image copy");const o=e.data,s=t.data;for(let l=0;l<r.height;l++){const c=((n.y+l)*e.width+n.x)*a,u=((i.y+l)*t.width+i.x)*a;for(let e=0;e<r.width*a;e++)s[u+e]=o[c+e]}return t}sr("HeatmapBucket",Fs,{omit:["layers"]});class js{constructor(e,t){Ns(this,e,1,t)}resize(e){Us(this,e,1)}clone(){return new js({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,n,i,r){Vs(e,t,n,i,r,1)}}class Gs{constructor(e,t){Ns(this,e,4,t)}resize(e){Us(this,e,4)}replace(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Gs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,n,i,r){Vs(e,t,n,i,r,4)}}sr("AlphaImage",js),sr("RGBAImage",Gs);var Hs={paint:new xa({"heatmap-radius":new ga(Fe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ga(Fe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ma(Fe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new _a(Fe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ma(Fe.paint_heatmap["heatmap-opacity"])})};function Ws(e){const t={},n=e.resolution||256,i=e.clips?e.clips.length:1,r=e.image||new Gs({width:n,height:i}),a=(n,i,a)=>{t[e.evaluationKey]=a;const o=e.expression.evaluate(t);r.data[n+i+0]=Math.floor(255*o.r/o.a),r.data[n+i+1]=Math.floor(255*o.g/o.a),r.data[n+i+2]=Math.floor(255*o.b/o.a),r.data[n+i+3]=Math.floor(255*o.a)};if(e.clips)for(let o=0,s=0;o<i;++o,s+=4*n)for(let t=0,i=0;t<n;t++,i+=4){const r=t/(n-1),{start:l,end:c}=e.clips[o];a(s,i,l*(1-r)+c*r)}else for(let o=0,s=0;o<n;o++,s+=4)a(0,s,o/(n-1));return r}var qs={paint:new xa({"hillshade-illumination-direction":new ma(Fe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ma(Fe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ma(Fe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ma(Fe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ma(Fe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ma(Fe.paint_hillshade["hillshade-accent-color"])})};const Zs=Ea([{name:"a_pos",components:2,type:"Int16"}],4),{members:$s}=Zs;var Xs=Js,Ys=Js;function Js(e,t,n){n=n||2;var i,r,a,o,s,l,c,u=t&&t.length,h=u?t[0]*n:e.length,d=Ks(e,0,h,n,!0),p=[];if(!d||d.next===d.prev)return p;if(u&&(d=function(e,t,n,i){var r,a,o,s=[];for(r=0,a=t.length;r<a;r++)(o=Ks(e,t[r]*i,r<a-1?t[r+1]*i:e.length,i,!1))===o.next&&(o.steiner=!0),s.push(cl(o));for(s.sort(al),r=0;r<s.length;r++)ol(s[r],n),n=Qs(n,n.next);return n}(e,t,d,n)),e.length>80*n){i=a=e[0],r=o=e[1];for(var f=n;f<h;f+=n)(s=e[f])<i&&(i=s),(l=e[f+1])<r&&(r=l),s>a&&(a=s),l>o&&(o=l);c=0!==(c=Math.max(a-i,o-r))?1/c:0}return el(d,p,n,i,r,c),p}function Ks(e,t,n,i,r){var a,o;if(r===wl(e,t,n,i)>0)for(a=t;a<n;a+=i)o=_l(a,e[a],e[a+1],o);else for(a=n-i;a>=t;a-=i)o=_l(a,e[a],e[a+1],o);return o&&pl(o,o.next)&&(xl(o),o=o.next),o}function Qs(e,t){if(!e)return e;t||(t=e);var n,i=e;do{if(n=!1,i.steiner||!pl(i,i.next)&&0!==dl(i.prev,i,i.next))i=i.next;else{if(xl(i),(i=t=i.prev)===i.next)break;n=!0}}while(n||i!==t);return t}function el(e,t,n,i,r,a,o){if(e){!o&&a&&function(e,t,n,i){var r=e;do{null===r.z&&(r.z=ll(r.x,r.y,t,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){var t,n,i,r,a,o,s,l,c=1;do{for(n=e,e=null,a=null,o=0;n;){for(o++,i=n,s=0,t=0;t<c&&(s++,i=i.nextZ);t++);for(l=c;s>0||l>0&&i;)0!==s&&(0===l||!i||n.z<=i.z)?(r=n,n=n.nextZ,s--):(r=i,i=i.nextZ,l--),a?a.nextZ=r:e=r,r.prevZ=a,a=r;n=i}a.nextZ=null,c*=2}while(o>1)}(r)}(e,i,r,a);for(var s,l,c=e;e.prev!==e.next;)if(s=e.prev,l=e.next,a?nl(e,i,r,a):tl(e))t.push(s.i/n),t.push(e.i/n),t.push(l.i/n),xl(e),e=l.next,c=l.next;else if((e=l)===c){o?1===o?el(e=il(Qs(e),t,n),t,n,i,r,a,2):2===o&&rl(e,t,n,i,r,a):el(Qs(e),t,n,i,r,a,1);break}}}function tl(e){var t=e.prev,n=e,i=e.next;if(dl(t,n,i)>=0)return!1;for(var r=e.next.next;r!==e.prev;){if(ul(t.x,t.y,n.x,n.y,i.x,i.y,r.x,r.y)&&dl(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function nl(e,t,n,i){var r=e.prev,a=e,o=e.next;if(dl(r,a,o)>=0)return!1;for(var s=r.x>a.x?r.x>o.x?r.x:o.x:a.x>o.x?a.x:o.x,l=r.y>a.y?r.y>o.y?r.y:o.y:a.y>o.y?a.y:o.y,c=ll(r.x<a.x?r.x<o.x?r.x:o.x:a.x<o.x?a.x:o.x,r.y<a.y?r.y<o.y?r.y:o.y:a.y<o.y?a.y:o.y,t,n,i),u=ll(s,l,t,n,i),h=e.prevZ,d=e.nextZ;h&&h.z>=c&&d&&d.z<=u;){if(h!==e.prev&&h!==e.next&&ul(r.x,r.y,a.x,a.y,o.x,o.y,h.x,h.y)&&dl(h.prev,h,h.next)>=0)return!1;if(h=h.prevZ,d!==e.prev&&d!==e.next&&ul(r.x,r.y,a.x,a.y,o.x,o.y,d.x,d.y)&&dl(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(;h&&h.z>=c;){if(h!==e.prev&&h!==e.next&&ul(r.x,r.y,a.x,a.y,o.x,o.y,h.x,h.y)&&dl(h.prev,h,h.next)>=0)return!1;h=h.prevZ}for(;d&&d.z<=u;){if(d!==e.prev&&d!==e.next&&ul(r.x,r.y,a.x,a.y,o.x,o.y,d.x,d.y)&&dl(d.prev,d,d.next)>=0)return!1;d=d.nextZ}return!0}function il(e,t,n){var i=e;do{var r=i.prev,a=i.next.next;!pl(r,a)&&fl(r,i,i.next,a)&&vl(r,a)&&vl(a,r)&&(t.push(r.i/n),t.push(i.i/n),t.push(a.i/n),xl(i),xl(i.next),i=e=a),i=i.next}while(i!==e);return Qs(i)}function rl(e,t,n,i,r,a){var o=e;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&hl(o,s)){var l=yl(o,s);return o=Qs(o,o.next),l=Qs(l,l.next),el(o,t,n,i,r,a),void el(l,t,n,i,r,a)}s=s.next}o=o.next}while(o!==e)}function al(e,t){return e.x-t.x}function ol(e,t){if(t=function(e,t){var n,i=t,r=e.x,a=e.y,o=-1/0;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){var s=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(s<=r&&s>o){if(o=s,s===r){if(a===i.y)return i;if(a===i.next.y)return i.next}n=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!n)return null;if(r===o)return n;var l,c=n,u=n.x,h=n.y,d=1/0;i=n;do{r>=i.x&&i.x>=u&&r!==i.x&&ul(a<h?r:o,a,u,h,a<h?o:r,a,i.x,i.y)&&(l=Math.abs(a-i.y)/(r-i.x),vl(i,e)&&(l<d||l===d&&(i.x>n.x||i.x===n.x&&sl(n,i)))&&(n=i,d=l)),i=i.next}while(i!==c);return n}(e,t)){var n=yl(t,e);Qs(t,t.next),Qs(n,n.next)}}function sl(e,t){return dl(e.prev,e,t.prev)<0&&dl(t.next,e,e.next)<0}function ll(e,t,n,i,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*r)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function cl(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function ul(e,t,n,i,r,a,o,s){return(r-o)*(t-s)-(e-o)*(a-s)>=0&&(e-o)*(i-s)-(n-o)*(t-s)>=0&&(n-o)*(a-s)-(r-o)*(i-s)>=0}function hl(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&fl(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(vl(e,t)&&vl(t,e)&&function(e,t){var n=e,i=!1,r=(e.x+t.x)/2,a=(e.y+t.y)/2;do{n.y>a!=n.next.y>a&&n.next.y!==n.y&&r<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}(e,t)&&(dl(e.prev,e,t.prev)||dl(e,t.prev,t))||pl(e,t)&&dl(e.prev,e,e.next)>0&&dl(t.prev,t,t.next)>0)}function dl(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function pl(e,t){return e.x===t.x&&e.y===t.y}function fl(e,t,n,i){var r=gl(dl(e,t,n)),a=gl(dl(e,t,i)),o=gl(dl(n,i,e)),s=gl(dl(n,i,t));return r!==a&&o!==s||!(0!==r||!ml(e,n,t))||!(0!==a||!ml(e,i,t))||!(0!==o||!ml(n,e,i))||!(0!==s||!ml(n,t,i))}function ml(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function gl(e){return e>0?1:e<0?-1:0}function vl(e,t){return dl(e.prev,e,e.next)<0?dl(e,t,e.next)>=0&&dl(e,e.prev,t)>=0:dl(e,t,e.prev)<0||dl(e,e.next,t)<0}function yl(e,t){var n=new bl(e.i,e.x,e.y),i=new bl(t.i,t.x,t.y),r=e.next,a=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,i.next=n,n.prev=i,a.next=i,i.prev=a,i}function _l(e,t,n,i){var r=new bl(e,t,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function xl(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function bl(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function wl(e,t,n,i){for(var r=0,a=t,o=n-i;a<n;a+=i)r+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return r}function Sl(e,t,n,i,r){Tl(e,t,n||0,i||e.length-1,r||Ml)}function Tl(e,t,n,i,r){for(;i>n;){if(i-n>600){var a=i-n+1,o=t-n+1,s=Math.log(a),l=.5*Math.exp(2*s/3),c=.5*Math.sqrt(s*l*(a-l)/a)*(o-a/2<0?-1:1);Tl(e,t,Math.max(n,Math.floor(t-o*l/a+c)),Math.min(i,Math.floor(t+(a-o)*l/a+c)),r)}var u=e[t],h=n,d=i;for(El(e,n,t),r(e[i],u)>0&&El(e,n,i);h<d;){for(El(e,h,d),h++,d--;r(e[h],u)<0;)h++;for(;r(e[d],u)>0;)d--}0===r(e[n],u)?El(e,n,d):El(e,++d,i),d<=t&&(n=d+1),t<=d&&(i=d-1)}}function El(e,t,n){var i=e[t];e[t]=e[n],e[n]=i}function Ml(e,t){return e<t?-1:e>t?1:0}function kl(e,t){const n=e.length;if(n<=1)return[e];const i=[];let r,a;for(let o=0;o<n;o++){const t=R(e[o]);0!==t&&(e[o].area=Math.abs(t),void 0===a&&(a=t<0),a===t<0?(r&&i.push(r),r=[e[o]]):r.push(e[o]))}if(r&&i.push(r),t>1)for(let o=0;o<i.length;o++)i[o].length<=t||(Sl(i[o],t,1,i[o].length-1,Al),i[o]=i[o].slice(0,t));return i}function Al(e,t){return t.area-e.area}function Cl(e,t,n){const i=n.patternDependencies;let r=!1;for(const a of t){const t=a.paint.get(`${e}-pattern`);t.isConstant()||(r=!0);const n=t.constantOr(null);n&&(r=!0,i[n.to]=!0,i[n.from]=!0)}return r}function Pl(e,t,n,i,r){const a=r.patternDependencies;for(const o of t){const t=o.paint.get(`${e}-pattern`).value;if("constant"!==t.kind){let e=t.evaluate({zoom:i-1},n,{},r.availableImages),s=t.evaluate({zoom:i},n,{},r.availableImages),l=t.evaluate({zoom:i+1},n,{},r.availableImages);e=e&&e.name?e.name:e,s=s&&s.name?s.name:s,l=l&&l.name?l.name:l,a[e]=!0,a[s]=!0,a[l]=!0,n.patterns[o.id]={min:e,mid:s,max:l}}}return n}Js.deviation=function(e,t,n,i){var r=t&&t.length,a=Math.abs(wl(e,0,r?t[0]*n:e.length,n));if(r)for(var o=0,s=t.length;o<s;o++)a-=Math.abs(wl(e,t[o]*n,o<s-1?t[o+1]*n:e.length,n));var l=0;for(o=0;o<i.length;o+=3){var c=i[o]*n,u=i[o+1]*n,h=i[o+2]*n;l+=Math.abs((e[c]-e[h])*(e[u+1]-e[c+1])-(e[c]-e[u])*(e[h+1]-e[c+1]))}return 0===a&&0===l?0:Math.abs((l-a)/a)},Js.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},i=0,r=0;r<e.length;r++){for(var a=0;a<e[r].length;a++)for(var o=0;o<t;o++)n.vertices.push(e[r][a][o]);r>0&&n.holes.push(i+=e[r-1].length)}return n},Xs.default=Ys;class Ll{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ka,this.indexArray=new Ua,this.indexArray2=new qa,this.programConfigurations=new Lo(e.layers,e.zoom),this.segments=new Vo,this.segments2=new Vo,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,t,n){this.hasPattern=Cl("fill",this.layers,t);const i=this.layers[0].layout.get("fill-sort-key"),r=[];for(const{feature:a,id:o,index:s,sourceLayerIndex:l}of e){const e=this.layers[0]._featureFilter.needGeometry,c=qo(a,e);if(!this.layers[0]._featureFilter.filter(new oa(this.zoom),c,n))continue;const u=i?i.evaluate(c,{},n,t.availableImages):void 0,h={id:o,properties:a.properties,type:a.type,sourceLayerIndex:l,index:s,geometry:e?c.geometry:Wo(a),patterns:{},sortKey:u};r.push(h)}i&&r.sort(((e,t)=>e.sortKey-t.sortKey));for(const a of r){const{geometry:i,index:r,sourceLayerIndex:o}=a;if(this.hasPattern){const e=Pl("fill",this.layers,a,this.zoom,t);this.patternFeatures.push(e)}else this.addFeature(a,i,r,n,{});t.featureIndex.insert(e[r].feature,i,r,o,this.index)}}update(e,t,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n)}addFeatures(e,t,n){for(const i of this.patternFeatures)this.addFeature(i,i.geometry,i.index,t,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,$s),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,t,n,i,r){for(const a of kl(t,500)){let e=0;for(const s of a)e+=s.length;const t=this.segments.prepareSegment(e,this.layoutVertexArray,this.indexArray),n=t.vertexLength,i=[],r=[];for(const s of a){if(0===s.length)continue;s!==a[0]&&r.push(i.length/2);const e=this.segments2.prepareSegment(s.length,this.layoutVertexArray,this.indexArray2),t=e.vertexLength;this.layoutVertexArray.emplaceBack(s[0].x,s[0].y),this.indexArray2.emplaceBack(t+s.length-1,t),i.push(s[0].x),i.push(s[0].y);for(let n=1;n<s.length;n++)this.layoutVertexArray.emplaceBack(s[n].x,s[n].y),this.indexArray2.emplaceBack(t+n-1,t+n),i.push(s[n].x),i.push(s[n].y);e.vertexLength+=s.length,e.primitiveLength+=s.length}const o=Xs(i,r);for(let a=0;a<o.length;a+=3)this.indexArray.emplaceBack(n+o[a],n+o[a+1],n+o[a+2]);t.vertexLength+=e,t.primitiveLength+=o.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,r,i)}}sr("FillBucket",Ll,{omit:["layers","patternFeatures"]});const Il=new xa({"fill-sort-key":new ga(Fe.layout_fill["fill-sort-key"])});var Rl={paint:new xa({"fill-antialias":new ma(Fe.paint_fill["fill-antialias"]),"fill-opacity":new ga(Fe.paint_fill["fill-opacity"]),"fill-color":new ga(Fe.paint_fill["fill-color"]),"fill-outline-color":new ga(Fe.paint_fill["fill-outline-color"]),"fill-translate":new ma(Fe.paint_fill["fill-translate"]),"fill-translate-anchor":new ma(Fe.paint_fill["fill-translate-anchor"]),"fill-pattern":new va(Fe.paint_fill["fill-pattern"])}),layout:Il};const zl=Ea([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Dl=Ea([{name:"a_centroid_pos",components:2,type:"Uint16"}]),{members:Ol}=zl;var Bl=Fl;function Fl(e,t,n,i,r){this.properties={},this.extent=n,this.type=0,this._pbf=e,this._geometry=-1,this._keys=i,this._values=r,e.readFields(Nl,this,t)}function Nl(e,t,n){1==e?t.id=n.readVarint():2==e?function(e,t){for(var n=e.readVarint()+e.pos;e.pos<n;){var i=t._keys[e.readVarint()],r=t._values[e.readVarint()];t.properties[i]=r}}(n,t):3==e?t.type=n.readVarint():4==e&&(t._geometry=n.pos)}function Ul(e){for(var t,n,i=0,r=0,a=e.length,o=a-1;r<a;o=r++)i+=((n=e[o]).x-(t=e[r]).x)*(t.y+n.y);return i}Fl.types=["Unknown","Point","LineString","Polygon"],Fl.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,n=e.readVarint()+e.pos,i=1,a=0,o=0,s=0,l=[];e.pos<n;){if(a<=0){var c=e.readVarint();i=7&c,a=c>>3}if(a--,1===i||2===i)o+=e.readSVarint(),s+=e.readSVarint(),1===i&&(t&&l.push(t),t=[]),t.push(new r(o,s));else{if(7!==i)throw new Error("unknown command "+i);t&&t.push(t[0].clone())}}return t&&l.push(t),l},Fl.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,n=1,i=0,r=0,a=0,o=1/0,s=-1/0,l=1/0,c=-1/0;e.pos<t;){if(i<=0){var u=e.readVarint();n=7&u,i=u>>3}if(i--,1===n||2===n)(r+=e.readSVarint())<o&&(o=r),r>s&&(s=r),(a+=e.readSVarint())<l&&(l=a),a>c&&(c=a);else if(7!==n)throw new Error("unknown command "+n)}return[o,l,s,c]},Fl.prototype.toGeoJSON=function(e,t,n){var i,r,a=this.extent*Math.pow(2,n),o=this.extent*e,s=this.extent*t,l=this.loadGeometry(),c=Fl.types[this.type];function u(e){for(var t=0;t<e.length;t++){var n=e[t];e[t]=[360*(n.x+o)/a-180,360/Math.PI*Math.atan(Math.exp((180-360*(n.y+s)/a)*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(i=0;i<l.length;i++)h[i]=l[i][0];u(l=h);break;case 2:for(i=0;i<l.length;i++)u(l[i]);break;case 3:for(l=function(e){var t=e.length;if(t<=1)return[e];for(var n,i,r=[],a=0;a<t;a++){var o=Ul(e[a]);0!==o&&(void 0===i&&(i=o<0),i===o<0?(n&&r.push(n),n=[e[a]]):n.push(e[a]))}return n&&r.push(n),r}(l),i=0;i<l.length;i++)for(r=0;r<l[i].length;r++)u(l[i][r])}1===l.length?l=l[0]:c="Multi"+c;var d={type:"Feature",geometry:{type:c,coordinates:l},properties:this.properties};return"id"in this&&(d.id=this.id),d};var Vl=jl;function jl(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Gl,this,t),this.length=this._features.length}function Gl(e,t,n){15===e?t.version=n.readVarint():1===e?t.name=n.readString():5===e?t.extent=n.readVarint():2===e?t._features.push(n.pos):3===e?t._keys.push(n.readString()):4===e&&t._values.push(function(e){for(var t=null,n=e.readVarint()+e.pos;e.pos<n;){var i=e.readVarint()>>3;t=1===i?e.readString():2===i?e.readFloat():3===i?e.readDouble():4===i?e.readVarint64():5===i?e.readVarint():6===i?e.readSVarint():7===i?e.readBoolean():null}return t}(n))}function Hl(e,t,n){if(3===e){var i=new Vl(n,n.readVarint()+n.pos);i.length&&(t[i.name]=i)}}jl.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new Bl(this._pbf,t,this.extent,this._keys,this._values)};var Wl={VectorTile:function(e,t){this.layers=e.readFields(Hl,{},t)},VectorTileFeature:Bl,VectorTileLayer:Vl};const ql=Wl.VectorTileFeature.types,Zl=Math.pow(2,13);function $l(e,t,n,i,r,a,o,s){e.emplaceBack((t<<1)+o,(n<<1)+a,(Math.floor(i*Zl)<<1)+r,Math.round(s))}class Xl{constructor(){this.acc=new r(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new r(e.x,e.y),this.max=new r(e.x,e.y))}append(e,t){this.currentPolyCount.edges++,this.acc._add(e);let n=!!this.borders;const i=this.min,r=this.max;e.x<i.x?(i.x=e.x,n=!0):e.x>r.x&&(r.x=e.x,n=!0),e.y<i.y?(i.y=e.y,n=!0):e.y>r.y&&(r.y=e.y,n=!0),((0===e.x||e.x===jo)&&e.x===t.x)!=((0===e.y||e.y===jo)&&e.y===t.y)&&this.processBorderOverlap(e,t),n&&this.checkBorderIntersection(e,t)}checkBorderIntersection(e,t){t.x<0!=e.x<0&&this.addBorderIntersection(0,nn(t.y,e.y,(0-t.x)/(e.x-t.x))),t.x>jo!=e.x>jo&&this.addBorderIntersection(1,nn(t.y,e.y,(jo-t.x)/(e.x-t.x))),t.y<0!=e.y<0&&this.addBorderIntersection(2,nn(t.x,e.x,(0-t.y)/(e.y-t.y))),t.y>jo!=e.y>jo&&this.addBorderIntersection(3,nn(t.x,e.x,(jo-t.y)/(e.y-t.y)))}addBorderIntersection(e,t){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const n=this.borders[e];t<n[0]&&(n[0]=t),t>n[1]&&(n[1]=t)}processBorderOverlap(e,t){if(e.x===t.x){if(e.y===t.y)return;const n=0===e.x?0:1;this.addBorderIntersection(n,t.y),this.addBorderIntersection(n,e.y)}else{const n=0===e.y?2:3;this.addBorderIntersection(n,t.x),this.addBorderIntersection(n,e.x)}}centroid(){const e=this.polyCount.reduce(((e,t)=>e+t.edges),0);return 0!==e?this.acc.div(e)._round():new r(0,0)}span(){return new r(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce(((e,t)=>e+ +(t[0]!==Number.MAX_VALUE)),0)}}class Yl{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Aa,this.centroidVertexArray=new oo,this.indexArray=new Ua,this.programConfigurations=new Lo(e.layers,e.zoom),this.segments=new Vo,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.enableTerrain=e.enableTerrain}populate(e,t,n){this.features=[],this.hasPattern=Cl("fill-extrusion",this.layers,t),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDone=[!1,!1,!1,!1],this.tileToMeter=function(e){const t=Math.exp(Math.PI*(1-e.y/(1<<e.z)*2));return 80150034*t/(t*t+1)/jo/(1<<e.z)}(n);for(const{feature:i,id:r,index:a,sourceLayerIndex:o}of e){const e=this.layers[0]._featureFilter.needGeometry,s=qo(i,e);if(!this.layers[0]._featureFilter.filter(new oa(this.zoom),s,n))continue;const l={id:r,sourceLayerIndex:o,index:a,geometry:e?s.geometry:Wo(i),properties:i.properties,type:i.type,patterns:{}},c=this.layoutVertexArray.length;this.hasPattern?this.features.push(Pl("fill-extrusion",this.layers,l,this.zoom,t)):this.addFeature(l,l.geometry,a,n,{}),t.featureIndex.insert(i,l.geometry,a,o,this.index,c)}this.sortBorders()}addFeatures(e,t,n){for(const i of this.features){const{geometry:e}=i;this.addFeature(i,e,i.index,t,n)}this.sortBorders()}update(e,t,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ol),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Dl.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,t,n,i,r){const a=this.enableTerrain&&e.properties&&"Polygon"===ql[e.type]?new Xl:null;for(const s of kl(t,500)){let t=0,n=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);if(0===s.length||(o=s[0]).every((e=>e.x<=0))||o.every((e=>e.x>=jo))||o.every((e=>e.y<=0))||o.every((e=>e.y>=jo)))continue;for(let e=0;e<s.length;e++){const i=s[e];if(0===i.length)continue;t+=i.length;let r=0;a&&a.startRing(i[0]);for(let e=0;e<i.length;e++){const t=i[e];if(e>=1){const o=i[e-1];if(!Jl(t,o)){a&&a.append(t,o),n.vertexLength+4>Vo.MAX_VERTEX_ARRAY_LENGTH&&(n=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const e=t.sub(o)._perp(),i=e.x/(Math.abs(e.x)+Math.abs(e.y)),s=e.y>0?1:0,l=o.dist(t);r+l>32768&&(r=0),$l(this.layoutVertexArray,t.x,t.y,i,s,0,0,r),$l(this.layoutVertexArray,t.x,t.y,i,s,0,1,r),r+=l,$l(this.layoutVertexArray,o.x,o.y,i,s,0,0,r),$l(this.layoutVertexArray,o.x,o.y,i,s,0,1,r);const c=n.vertexLength;this.indexArray.emplaceBack(c,c+2,c+1),this.indexArray.emplaceBack(c+1,c+2,c+3),n.vertexLength+=4,n.primitiveLength+=2}}}}if(n.vertexLength+t>Vo.MAX_VERTEX_ARRAY_LENGTH&&(n=this.segments.prepareSegment(t,this.layoutVertexArray,this.indexArray)),"Polygon"!==ql[e.type])continue;const i=[],r=[],l=n.vertexLength;for(let e=0;e<s.length;e++){const t=s[e];if(0!==t.length){t!==s[0]&&r.push(i.length/2);for(let e=0;e<t.length;e++){const n=t[e];$l(this.layoutVertexArray,n.x,n.y,0,0,1,1,0),i.push(n.x),i.push(n.y),a&&a.currentPolyCount.top++}}}const c=Xs(i,r);for(let e=0;e<c.length;e+=3)this.indexArray.emplaceBack(l+c[e],l+c[e+2],l+c[e+1]);n.primitiveLength+=c.length/3,n.vertexLength+=t}var o;if(a&&a.polyCount.length>0){if(a.borders){a.vertexArrayOffset=this.centroidVertexArray.length;const e=a.borders,t=this.featuresOnBorder.push(a)-1;for(let n=0;n<4;n++)e[n][0]!==Number.MAX_VALUE&&this.borders[n].push(t)}this.encodeCentroid(a.borders?void 0:a.centroid(),a)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,r,i)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort(((t,n)=>this.featuresOnBorder[t].borders[e][0]-this.featuresOnBorder[n].borders[e][0]))}encodeCentroid(e,t,n=!0){let i,r;if(e)if(0!==e.y){const n=t.span()._mult(this.tileToMeter);i=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(n.x/10)),r=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(n.y/10))}else i=Math.ceil(7*(e.x+450)),r=0;else i=0,r=+n;let a=n?this.centroidVertexArray.length:t.vertexArrayOffset;for(const o of t.polyCount){n&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*o.edges+o.top);for(let e=0;e<2*o.edges;e++)this.centroidVertexArray.emplace(a++,0,r),this.centroidVertexArray.emplace(a++,i,r);for(let e=0;e<o.top;e++)this.centroidVertexArray.emplace(a++,i,r)}}}function Jl(e,t){return e.x===t.x&&(e.x<0||e.x>jo)||e.y===t.y&&(e.y<0||e.y>jo)}sr("FillExtrusionBucket",Yl,{omit:["layers","features"]}),sr("PartMetadata",Xl);var Kl={paint:new xa({"fill-extrusion-opacity":new ma(Fe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ga(Fe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ma(Fe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ma(Fe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new va(Fe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ga(Fe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ga(Fe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ma(Fe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Ql(e,t){return e.x*t.x+e.y*t.y}function ec(e,t){if(1===e.length){let n=0;const i=t[n++];let r;for(;!r||i.equals(r);)if(r=t[n++],!r)return 1/0;for(;n<t.length;n++){const a=t[n],o=e[0],s=r.sub(i),l=a.sub(i),c=o.sub(i),u=Ql(s,s),h=Ql(s,l),d=Ql(l,l),p=Ql(c,s),f=Ql(c,l),m=u*d-h*h,g=(d*p-h*f)/m,v=(u*f-h*p)/m,y=i.z*(1-g-v)+r.z*g+a.z*v;if(isFinite(y))return y}return 1/0}{let e=1/0;for(const n of t)e=Math.min(e,n.z);return e}}function tc(e){const t=new r(e[0],e[1]);return t.z=e[2],t}function nc(e,t,n,i,r,a,o,s){const l=o*r.getElevationAt(e,t,!0,!0),c=0!==a[0],u=c?0===a[1]?o*(a[0]/7-450):o*function(e,t,n){const i=Math.floor(t[0]/8),r=Math.floor(t[1]/8),a=10*(t[0]-8*i),o=10*(t[1]-8*r),s=e.getElevationAt(i,r,!0,!0),l=e.getMeterToDEM(n),c=Math.floor(.5*(a*l-1)),u=Math.floor(.5*(o*l-1)),h=e.tileCoordToPixel(i,r),d=2*c+1,p=2*u+1,f=function(e,t,n,i,r){return[e.getElevationAtPixel(t,n,!0),e.getElevationAtPixel(t+r,n,!0),e.getElevationAtPixel(t,n+r,!0),e.getElevationAtPixel(t+i,n+r,!0)]}(e,h.x-c,h.y-u,d,p),m=Math.abs(f[0]-f[1]),g=Math.abs(f[2]-f[3]),v=Math.abs(f[0]-f[2])+Math.abs(f[1]-f[3]),y=Math.min(.25,.5*l*(m+g)/d),_=Math.min(.25,.5*l*v/p);return s+Math.max(y*a,_*o)}(r,a,s):l;return{base:l+(0===n)?-1:n,top:c?Math.max(u+i,l+n+2):l+i}}const ic=Ea([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:rc}=ic,ac=Ea([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:oc}=ac,sc=Wl.VectorTileFeature.types,lc=Math.cos(Math.PI/180*37.5);class cc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((e=>{this.gradients[e.id]={}})),this.layoutVertexArray=new Ca,this.layoutVertexArray2=new Pa,this.indexArray=new Ua,this.programConfigurations=new Lo(e.layers,e.zoom),this.segments=new Vo,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,t,n){this.hasPattern=Cl("line",this.layers,t);const i=this.layers[0].layout.get("line-sort-key"),r=[];for(const{feature:l,id:c,index:u,sourceLayerIndex:h}of e){const e=this.layers[0]._featureFilter.needGeometry,t=qo(l,e);if(!this.layers[0]._featureFilter.filter(new oa(this.zoom),t,n))continue;const a=i?i.evaluate(t,{},n):void 0,o={id:c,properties:l.properties,type:l.type,sourceLayerIndex:h,index:u,geometry:e?t.geometry:Wo(l),patterns:{},sortKey:a};r.push(o)}i&&r.sort(((e,t)=>e.sortKey-t.sortKey));const{lineAtlas:a,featureIndex:o}=t,s=this.addConstantDashes(a);for(const l of r){const{geometry:i,index:r,sourceLayerIndex:c}=l;if(s&&this.addFeatureDashes(l,a),this.hasPattern){const e=Pl("line",this.layers,l,this.zoom,t);this.patternFeatures.push(e)}else this.addFeature(l,i,r,n,a.positions);o.insert(e[r].feature,i,r,c,this.index)}}addConstantDashes(e){let t=!1;for(const n of this.layers){const i=n.paint.get("line-dasharray").value,r=n.layout.get("line-cap").value;if("constant"!==i.kind||"constant"!==r.kind)t=!0;else{const t=r.value,n=i.value;if(!n)continue;e.addDash(n.from,t),e.addDash(n.to,t),n.other&&e.addDash(n.other,t)}}return t}addFeatureDashes(e,t){const n=this.zoom;for(const i of this.layers){const r=i.paint.get("line-dasharray").value,a=i.layout.get("line-cap").value;if("constant"===r.kind&&"constant"===a.kind)continue;let o,s,l,c,u,h;if("constant"===r.kind){const e=r.value;if(!e)continue;o=e.other||e.to,s=e.to,l=e.from}else o=r.evaluate({zoom:n-1},e),s=r.evaluate({zoom:n},e),l=r.evaluate({zoom:n+1},e);"constant"===a.kind?c=u=h=a.value:(c=a.evaluate({zoom:n-1},e),u=a.evaluate({zoom:n},e),h=a.evaluate({zoom:n+1},e)),t.addDash(o,c),t.addDash(s,u),t.addDash(l,h);const d=t.getKey(o,c),p=t.getKey(s,u),f=t.getKey(l,h);e.patterns[i.id]={min:d,mid:p,max:f}}}update(e,t,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n)}addFeatures(e,t,n){for(const i of this.patternFeatures)this.addFeature(i,i.geometry,i.index,t,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,oc)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,rc),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,t,n,i,r){const a=this.layers[0].layout,o=a.get("line-join").evaluate(e,{}),s=a.get("line-cap").evaluate(e,{}),l=a.get("line-miter-limit"),c=a.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const u of t)this.addLine(u,e,o,s,l,c);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,r,i)}addLine(e,t,n,i,r,a){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let t=0;t<e.length-1;t++)this.totalDistance+=e[t].dist(e[t+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const o="Polygon"===sc[t.type];let s=e.length;for(;s>=2&&e[s-1].equals(e[s-2]);)s--;let l=0;for(;l<s-1&&e[l].equals(e[l+1]);)l++;if(s<(o?3:2))return;"bevel"===n&&(r=1.05);const c=this.overscaling<=16?122880/(512*this.overscaling):0,u=this.segments.prepareSegment(10*s,this.layoutVertexArray,this.indexArray);let h,d,p,f,m;this.e1=this.e2=-1,o&&(h=e[s-2],m=e[l].sub(h)._unit()._perp());for(let g=l;g<s;g++){if(p=g===s-1?o?e[l+1]:void 0:e[g+1],p&&e[g].equals(p))continue;m&&(f=m),h&&(d=h),h=e[g],m=p?p.sub(h)._unit()._perp():f,f=f||m;let t=f.add(m);0===t.x&&0===t.y||t._unit();const v=f.x*m.x+f.y*m.y,y=t.x*m.x+t.y*m.y,_=0!==y?1/y:1/0,x=2*Math.sqrt(2-2*y),b=y<lc&&d&&p,w=f.x*m.y-f.y*m.x>0;if(b&&g>l){const e=h.dist(d);if(e>2*c){const t=h.sub(h.sub(d)._mult(c/e)._round());this.updateDistance(d,t),this.addCurrentVertex(t,f,0,0,u),d=t}}const S=d&&p;let T=S?n:o?"butt":i;if(S&&"round"===T&&(_<a?T="miter":_<=2&&(T="fakeround")),"miter"===T&&_>r&&(T="bevel"),"bevel"===T&&(_>2&&(T="flipbevel"),_<r&&(T="miter")),d&&this.updateDistance(d,h),"miter"===T)t._mult(_),this.addCurrentVertex(h,t,0,0,u);else if("flipbevel"===T){if(_>100)t=m.mult(-1);else{const e=_*f.add(m).mag()/f.sub(m).mag();t._perp()._mult(e*(w?-1:1))}this.addCurrentVertex(h,t,0,0,u),this.addCurrentVertex(h,t.mult(-1),0,0,u)}else if("bevel"===T||"fakeround"===T){const e=-Math.sqrt(_*_-1),t=w?e:0,n=w?0:e;if(d&&this.addCurrentVertex(h,f,t,n,u),"fakeround"===T){const e=Math.round(180*x/Math.PI/20);for(let t=1;t<e;t++){let n=t/e;if(.5!==n){const e=n-.5;n+=n*e*(n-1)*((1.0904+v*(v*(3.55645-1.43519*v)-3.2452))*e*e+(.848013+v*(.215638*v-1.06021)))}const i=m.sub(f)._mult(n)._add(f)._unit()._mult(w?-1:1);this.addHalfVertex(h,i.x,i.y,!1,w,0,u)}}p&&this.addCurrentVertex(h,m,-t,-n,u)}else if("butt"===T)this.addCurrentVertex(h,t,0,0,u);else if("square"===T){const e=d?1:-1;d||this.addCurrentVertex(h,t,e,e,u),this.addCurrentVertex(h,t,0,0,u),d&&this.addCurrentVertex(h,t,e,e,u)}else"round"===T&&(d&&(this.addCurrentVertex(h,f,0,0,u),this.addCurrentVertex(h,f,1,1,u,!0)),p&&(this.addCurrentVertex(h,m,-1,-1,u,!0),this.addCurrentVertex(h,m,0,0,u)));if(b&&g<s-1){const e=h.dist(p);if(e>2*c){const t=h.add(p.sub(h)._mult(c/e)._round());this.updateDistance(h,t),this.addCurrentVertex(t,m,0,0,u),h=t}}}}addCurrentVertex(e,t,n,i,r,a=!1){const o=t.y*i-t.x,s=-t.y-t.x*i;this.addHalfVertex(e,t.x+t.y*n,t.y-t.x*n,a,!1,n,r),this.addHalfVertex(e,o,s,a,!0,-i,r)}addHalfVertex({x:e,y:t},n,i,r,a,o,s){this.layoutVertexArray.emplaceBack((e<<1)+(r?1:0),(t<<1)+(a?1:0),Math.round(63*n)+128,Math.round(63*i)+128,1+(0===o?0:o<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length);const l=s.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,l),s.primitiveLength++),a?this.e2=l:this.e1=l}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,t){this.distance+=e.dist(t),this.updateScaledDistance()}}sr("LineBucket",cc,{omit:["layers","patternFeatures"]});const uc=new xa({"line-cap":new ga(Fe.layout_line["line-cap"]),"line-join":new ga(Fe.layout_line["line-join"]),"line-miter-limit":new ma(Fe.layout_line["line-miter-limit"]),"line-round-limit":new ma(Fe.layout_line["line-round-limit"]),"line-sort-key":new ga(Fe.layout_line["line-sort-key"])});var hc={paint:new xa({"line-opacity":new ga(Fe.paint_line["line-opacity"]),"line-color":new ga(Fe.paint_line["line-color"]),"line-translate":new ma(Fe.paint_line["line-translate"]),"line-translate-anchor":new ma(Fe.paint_line["line-translate-anchor"]),"line-width":new ga(Fe.paint_line["line-width"]),"line-gap-width":new ga(Fe.paint_line["line-gap-width"]),"line-offset":new ga(Fe.paint_line["line-offset"]),"line-blur":new ga(Fe.paint_line["line-blur"]),"line-dasharray":new va(Fe.paint_line["line-dasharray"]),"line-pattern":new va(Fe.paint_line["line-pattern"]),"line-gradient":new _a(Fe.paint_line["line-gradient"])}),layout:uc};const dc=new class extends ga{possiblyEvaluate(e,t){return t=new oa(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,zoomHistory:t.zoomHistory,transition:t.transition}),super.possiblyEvaluate(e,t)}evaluate(e,t,n,i){return t=_({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,n,i)}}(hc.paint.properties["line-width"].specification);function pc(e,t){return t>0?t+2*e:e}dc.useIntegerZoom=!0;const fc=Ea([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),mc=Ea([{name:"a_projected_pos",components:3,type:"Float32"}],4);Ea([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const gc=Ea([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),vc=Ea([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Ea([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const yc=Ea([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),_c=Ea([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Ea([{name:"triangle",components:3,type:"Uint16"}]),Ea([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Ea([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Ea([{type:"Float32",name:"offsetX"}]),Ea([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var xc=24;const bc=128;function wc(e,t){const{expression:n}=t;if("constant"===n.kind)return{kind:"constant",layoutSize:n.evaluate(new oa(e+1))};if("source"===n.kind)return{kind:"source"};{const{zoomStops:t,interpolationType:i}=n;let r=0;for(;r<t.length&&t[r]<=e;)r++;r=Math.max(0,r-1);let a=r;for(;a<t.length&&t[a]<e+1;)a++;a=Math.min(t.length-1,a);const o=t[r],s=t[a];return"composite"===n.kind?{kind:"composite",minZoom:o,maxZoom:s,interpolationType:i}:{kind:"camera",minZoom:o,maxZoom:s,minSize:n.evaluate(new oa(o)),maxSize:n.evaluate(new oa(s)),interpolationType:i}}}function Sc(e,{uSize:t,uSizeT:n},{lowerSize:i,upperSize:r}){return"source"===e.kind?i/bc:"composite"===e.kind?nn(i/bc,r/bc,n):t}function Tc(e,t){let n=0,i=0;if("constant"===e.kind)i=e.layoutSize;else if("source"!==e.kind){const{interpolationType:r,minZoom:a,maxZoom:o}=e,s=r?m(wn.interpolationFactor(r,t,a,o),0,1):0;"camera"===e.kind?i=nn(e.minSize,e.maxSize,s):n=s}return{uSizeT:n,uSize:i}}var Ec=Object.freeze({__proto__:null,getSizeData:wc,evaluateSizeForFeature:Sc,evaluateSizeForZoom:Tc,SIZE_PACK_FACTOR:bc});function Mc(e,t,n){return e.sections.forEach((e=>{e.text=function(e,t,n){const i=t.layout.get("text-transform").evaluate(n,{});return"uppercase"===i?e=e.toLocaleUpperCase():"lowercase"===i&&(e=e.toLocaleLowerCase()),aa.applyArabicShaping&&(e=aa.applyArabicShaping(e)),e}(e.text,t,n)})),e}const kc={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};var Ac=function(e,t,n,i,r){var a,o,s=8*r-i-1,l=(1<<s)-1,c=l>>1,u=-7,h=n?r-1:0,d=n?-1:1,p=e[t+h];for(h+=d,a=p&(1<<-u)-1,p>>=-u,u+=s;u>0;a=256*a+e[t+h],h+=d,u-=8);for(o=a&(1<<-u)-1,a>>=-u,u+=i;u>0;o=256*o+e[t+h],h+=d,u-=8);if(0===a)a=1-c;else{if(a===l)return o?NaN:1/0*(p?-1:1);o+=Math.pow(2,i),a-=c}return(p?-1:1)*o*Math.pow(2,a-i)},Cc=function(e,t,n,i,r,a){var o,s,l,c=8*a-r-1,u=(1<<c)-1,h=u>>1,d=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,p=i?0:a-1,f=i?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=u):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),(t+=o+h>=1?d/l:d*Math.pow(2,1-h))*l>=2&&(o++,l/=2),o+h>=u?(s=0,o=u):o+h>=1?(s=(t*l-1)*Math.pow(2,r),o+=h):(s=t*Math.pow(2,h-1)*Math.pow(2,r),o=0));r>=8;e[n+p]=255&s,p+=f,s/=256,r-=8);for(o=o<<r|s,c+=r;c>0;e[n+p]=255&o,p+=f,o/=256,c-=8);e[n+p-f]|=128*m},Pc=Lc;function Lc(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}Lc.Varint=0,Lc.Fixed64=1,Lc.Bytes=2,Lc.Fixed32=5;var Ic=4294967296,Rc=1/Ic,zc="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function Dc(e){return e.type===Lc.Bytes?e.readVarint()+e.pos:e.pos+1}function Oc(e,t,n){return n?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function Bc(e,t,n){var i=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(i);for(var r=n.pos-1;r>=e;r--)n.buf[r+i]=n.buf[r]}function Fc(e,t){for(var n=0;n<e.length;n++)t.writeVarint(e[n])}function Nc(e,t){for(var n=0;n<e.length;n++)t.writeSVarint(e[n])}function Uc(e,t){for(var n=0;n<e.length;n++)t.writeFloat(e[n])}function Vc(e,t){for(var n=0;n<e.length;n++)t.writeDouble(e[n])}function jc(e,t){for(var n=0;n<e.length;n++)t.writeBoolean(e[n])}function Gc(e,t){for(var n=0;n<e.length;n++)t.writeFixed32(e[n])}function Hc(e,t){for(var n=0;n<e.length;n++)t.writeSFixed32(e[n])}function Wc(e,t){for(var n=0;n<e.length;n++)t.writeFixed64(e[n])}function qc(e,t){for(var n=0;n<e.length;n++)t.writeSFixed64(e[n])}function Zc(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function $c(e,t,n){e[n]=t,e[n+1]=t>>>8,e[n+2]=t>>>16,e[n+3]=t>>>24}function Xc(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}function Yc(e,t,n){1===e&&n.readMessage(Jc,t)}function Jc(e,t,n){if(3===e){const{id:e,bitmap:i,width:r,height:a,left:o,top:s,advance:l}=n.readMessage(Kc,{});t.push({id:e,bitmap:new js({width:r+6,height:a+6},i),metrics:{width:r,height:a,left:o,top:s,advance:l}})}}function Kc(e,t,n){1===e?t.id=n.readVarint():2===e?t.bitmap=n.readBytes():3===e?t.width=n.readVarint():4===e?t.height=n.readVarint():5===e?t.left=n.readSVarint():6===e?t.top=n.readSVarint():7===e&&(t.advance=n.readVarint())}function Qc(e){let t=0,n=0;for(const o of e)t+=o.w*o.h,n=Math.max(n,o.w);e.sort(((e,t)=>t.h-e.h));const i=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),n),h:1/0}];let r=0,a=0;for(const o of e)for(let e=i.length-1;e>=0;e--){const t=i[e];if(!(o.w>t.w||o.h>t.h)){if(o.x=t.x,o.y=t.y,a=Math.max(a,o.y+o.h),r=Math.max(r,o.x+o.w),o.w===t.w&&o.h===t.h){const t=i.pop();e<i.length&&(i[e]=t)}else o.h===t.h?(t.x+=o.w,t.w-=o.w):o.w===t.w?(t.y+=o.h,t.h-=o.h):(i.push({x:t.x+o.w,y:t.y,w:t.w-o.w,h:o.h}),t.y+=o.h,t.h-=o.h);break}}return{w:r,h:a,fill:t/(r*a)||0}}Lc.prototype={destroy:function(){this.buf=null},readFields:function(e,t,n){for(n=n||this.length;this.pos<n;){var i=this.readVarint(),r=i>>3,a=this.pos;this.type=7&i,e(r,t,this),this.pos===a&&this.skip(i)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=Zc(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=Xc(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=Zc(this.buf,this.pos)+Zc(this.buf,this.pos+4)*Ic;return this.pos+=8,e},readSFixed64:function(){var e=Zc(this.buf,this.pos)+Xc(this.buf,this.pos+4)*Ic;return this.pos+=8,e},readFloat:function(){var e=Ac(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=Ac(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,n,i=this.buf;return t=127&(n=i[this.pos++]),n<128?t:(t|=(127&(n=i[this.pos++]))<<7,n<128?t:(t|=(127&(n=i[this.pos++]))<<14,n<128?t:(t|=(127&(n=i[this.pos++]))<<21,n<128?t:function(e,t,n){var i,r,a=n.buf;if(i=(112&(r=a[n.pos++]))>>4,r<128)return Oc(e,i,t);if(i|=(127&(r=a[n.pos++]))<<3,r<128)return Oc(e,i,t);if(i|=(127&(r=a[n.pos++]))<<10,r<128)return Oc(e,i,t);if(i|=(127&(r=a[n.pos++]))<<17,r<128)return Oc(e,i,t);if(i|=(127&(r=a[n.pos++]))<<24,r<128)return Oc(e,i,t);if(i|=(1&(r=a[n.pos++]))<<31,r<128)return Oc(e,i,t);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(n=i[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&zc?function(e,t,n){return zc.decode(e.subarray(t,n))}(this.buf,t,e):function(e,t,n){for(var i="",r=t;r<n;){var a,o,s,l=e[r],c=null,u=l>239?4:l>223?3:l>191?2:1;if(r+u>n)break;1===u?l<128&&(c=l):2===u?128==(192&(a=e[r+1]))&&(c=(31&l)<<6|63&a)<=127&&(c=null):3===u?(o=e[r+2],128==(192&(a=e[r+1]))&&128==(192&o)&&((c=(15&l)<<12|(63&a)<<6|63&o)<=2047||c>=55296&&c<=57343)&&(c=null)):4===u&&(o=e[r+2],s=e[r+3],128==(192&(a=e[r+1]))&&128==(192&o)&&128==(192&s)&&((c=(15&l)<<18|(63&a)<<12|(63&o)<<6|63&s)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,u=1):c>65535&&(c-=65536,i+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),i+=String.fromCharCode(c),r+=u}return i}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==Lc.Bytes)return e.push(this.readVarint(t));var n=Dc(this);for(e=e||[];this.pos<n;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==Lc.Bytes)return e.push(this.readSVarint());var t=Dc(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==Lc.Bytes)return e.push(this.readBoolean());var t=Dc(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==Lc.Bytes)return e.push(this.readFloat());var t=Dc(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==Lc.Bytes)return e.push(this.readDouble());var t=Dc(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==Lc.Bytes)return e.push(this.readFixed32());var t=Dc(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==Lc.Bytes)return e.push(this.readSFixed32());var t=Dc(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==Lc.Bytes)return e.push(this.readFixed64());var t=Dc(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==Lc.Bytes)return e.push(this.readSFixed64());var t=Dc(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===Lc.Varint)for(;this.buf[this.pos++]>127;);else if(t===Lc.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Lc.Fixed32)this.pos+=4;else{if(t!==Lc.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var n=new Uint8Array(t);n.set(this.buf),this.buf=n,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),$c(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),$c(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),$c(this.buf,-1&e,this.pos),$c(this.buf,Math.floor(e*Rc),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),$c(this.buf,-1&e,this.pos),$c(this.buf,Math.floor(e*Rc),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(e,t){var n,i;if(e>=0?(n=e%4294967296|0,i=e/4294967296|0):(i=~(-e/4294967296),4294967295^(n=~(-e%4294967296))?n=n+1|0:(n=0,i=i+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,n){n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,n.buf[n.pos]=127&(e>>>=7)}(n,0,t),function(e,t){var n=(7&e)<<4;t.buf[t.pos++]|=n|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e)))))}(i,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(e,t,n){for(var i,r,a=0;a<t.length;a++){if((i=t.charCodeAt(a))>55295&&i<57344){if(!r){i>56319||a+1===t.length?(e[n++]=239,e[n++]=191,e[n++]=189):r=i;continue}if(i<56320){e[n++]=239,e[n++]=191,e[n++]=189,r=i;continue}i=r-55296<<10|i-56320|65536,r=null}else r&&(e[n++]=239,e[n++]=191,e[n++]=189,r=null);i<128?e[n++]=i:(i<2048?e[n++]=i>>6|192:(i<65536?e[n++]=i>>12|224:(e[n++]=i>>18|240,e[n++]=i>>12&63|128),e[n++]=i>>6&63|128),e[n++]=63&i|128)}return n}(this.buf,e,this.pos);var n=this.pos-t;n>=128&&Bc(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n},writeFloat:function(e){this.realloc(4),Cc(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),Cc(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var n=0;n<t;n++)this.buf[this.pos++]=e[n]},writeRawMessage:function(e,t){this.pos++;var n=this.pos;e(t,this);var i=this.pos-n;i>=128&&Bc(n,i,this),this.pos=n-1,this.writeVarint(i),this.pos+=i},writeMessage:function(e,t,n){this.writeTag(e,Lc.Bytes),this.writeRawMessage(t,n)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,Fc,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,Nc,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,jc,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,Uc,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,Vc,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,Gc,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,Hc,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,Wc,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,qc,t)},writeBytesField:function(e,t){this.writeTag(e,Lc.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,Lc.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,Lc.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,Lc.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,Lc.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,Lc.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,Lc.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,Lc.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,Lc.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,Lc.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};class eu{constructor(e,{pixelRatio:t,version:n,stretchX:i,stretchY:r,content:a}){this.paddedRect=e,this.pixelRatio=t,this.stretchX=i,this.stretchY=r,this.content=a,this.version=n}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class tu{constructor(e,t){const n={},i={};this.haveRenderCallbacks=[];const r=[];this.addImages(e,n,r),this.addImages(t,i,r);const{w:a,h:o}=Qc(r),s=new Gs({width:a||1,height:o||1});for(const l in e){const t=e[l],i=n[l].paddedRect;Gs.copy(t.data,s,{x:0,y:0},{x:i.x+1,y:i.y+1},t.data)}for(const l in t){const e=t[l],n=i[l].paddedRect,r=n.x+1,a=n.y+1,o=e.data.width,c=e.data.height;Gs.copy(e.data,s,{x:0,y:0},{x:r,y:a},e.data),Gs.copy(e.data,s,{x:0,y:c-1},{x:r,y:a-1},{width:o,height:1}),Gs.copy(e.data,s,{x:0,y:0},{x:r,y:a+c},{width:o,height:1}),Gs.copy(e.data,s,{x:o-1,y:0},{x:r-1,y:a},{width:1,height:c}),Gs.copy(e.data,s,{x:0,y:0},{x:r+o,y:a},{width:1,height:c})}this.image=s,this.iconPositions=n,this.patternPositions=i}addImages(e,t,n){for(const i in e){const r=e[i],a={x:0,y:0,w:r.data.width+2,h:r.data.height+2};n.push(a),t[i]=new eu(a,r),r.hasRenderCallback&&this.haveRenderCallbacks.push(i)}}patchUpdatedImages(e,t){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const n in e.updatedImages)this.patchUpdatedImage(this.iconPositions[n],e.getImage(n),t),this.patchUpdatedImage(this.patternPositions[n],e.getImage(n),t)}patchUpdatedImage(e,t,n){if(!e||!t)return;if(e.version===t.version)return;e.version=t.version;const[i,r]=e.tl;n.update(t.data,void 0,{x:i,y:r})}}sr("ImagePosition",eu),sr("ImageAtlas",tu);const nu={horizontal:1,vertical:2,horizontalOnly:3},iu=-17;class ru{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,t){const n=new ru;return n.scale=e||1,n.fontStack=t,n}static forImage(e){const t=new ru;return t.imageName=e,t}}class au{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,t){const n=new au;for(let i=0;i<e.sections.length;i++){const r=e.sections[i];r.image?n.addImageSection(r):n.addTextSection(r,t)}return n}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let t="";for(let n=0;n<e.length;n++){const i=e.charCodeAt(n+1)||null,r=e.charCodeAt(n-1)||null;t+=i&&Hr(i)&&!kc[e[n+1]]||r&&Hr(r)&&!kc[e[n-1]]||!kc[e[n]]?e[n]:kc[e[n]]}return t}(this.text)}trim(){let e=0;for(let n=0;n<this.text.length&&su[this.text.charCodeAt(n)];n++)e++;let t=this.text.length;for(let n=this.text.length-1;n>=0&&n>=e&&su[this.text.charCodeAt(n)];n--)t--;this.text=this.text.substring(e,t),this.sectionIndex=this.sectionIndex.slice(e,t)}substring(e,t){const n=new au;return n.text=this.text.substring(e,t),n.sectionIndex=this.sectionIndex.slice(e,t),n.sections=this.sections,n}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,t)=>Math.max(e,this.sections[t].scale)),0)}addTextSection(e,t){this.text+=e.text,this.sections.push(ru.forText(e.scale,e.fontStack||t));const n=this.sections.length-1;for(let i=0;i<e.text.length;++i)this.sectionIndex.push(n)}addImageSection(e){const t=e.image?e.image.name:"";if(0===t.length)return void L("Can't add FormattedSection with an empty image.");const n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCharCode(n),this.sections.push(ru.forImage(t)),this.sectionIndex.push(this.sections.length-1)):L("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function ou(e,t,n,i,r,a,o,s,l,c,u,h,d,p,f,m){const g=au.fromFeature(e,r);let v;h===nu.vertical&&g.verticalizePunctuation();const{processBidirectionalText:y,processStyledBidirectionalText:_}=aa;if(y&&1===g.sections.length){v=[];const e=y(g.toString(),fu(g,c,a,t,i,p,f));for(const t of e){const e=new au;e.text=t,e.sections=g.sections;for(let n=0;n<t.length;n++)e.sectionIndex.push(0);v.push(e)}}else if(_){v=[];const e=_(g.text,g.sectionIndex,fu(g,c,a,t,i,p,f));for(const t of e){const e=new au;e.text=t[0],e.sectionIndex=t[1],e.sections=g.sections,v.push(e)}}else v=function(e,t){const n=[],i=e.text;let r=0;for(const a of t)n.push(e.substring(r,a)),r=a;return r<i.length&&n.push(e.substring(r,i.length)),n}(g,fu(g,c,a,t,i,p,f));const x=[],b={positionedLines:x,text:g.toString(),top:u[1],bottom:u[1],left:u[0],right:u[0],writingMode:h,iconsInText:!1,verticalizable:!1};return function(e,t,n,i,r,a,o,s,l,c,u,h){let d=0,p=iu,f=0,m=0;const g="right"===s?1:"left"===s?0:.5;let v=0;for(const w of r){w.trim();const r=w.getMaxScale(),o=(r-1)*xc,s={positionedGlyphs:[],lineOffset:0};e.positionedLines[v]=s;const _=s.positionedGlyphs;let x=0;if(!w.length()){p+=a,++v;continue}for(let a=0;a<w.length();a++){const s=w.getSection(a),f=w.getSectionIndex(a),m=w.getCharCode(a);let g=0,v=null,b=null,S=null,T=xc;const E=!(l===nu.horizontal||!u&&!Gr(m)||u&&(su[m]||(y=m,pr(y)||fr(y)||mr(y)||zr(y)||Fr(y))));if(s.imageName){const t=i[s.imageName];if(!t)continue;S=s.imageName,e.iconsInText=e.iconsInText||!0,b=t.paddedRect;const n=t.displaySize;s.scale=s.scale*xc/h,v={width:n[0],height:n[1],left:1,top:-3,advance:E?n[1]:n[0],localGlyph:!1},g=o+(xc-n[1]*s.scale),T=v.advance;const a=E?n[0]*s.scale-xc*r:n[1]*s.scale-xc*r;a>0&&a>x&&(x=a)}else{const e=n[s.fontStack],i=e&&e[m];if(i&&i.rect)b=i.rect,v=i.metrics;else{const e=t[s.fontStack],n=e&&e[m];if(!n)continue;v=n.metrics}g=(r-s.scale)*xc}E?(e.verticalizable=!0,_.push({glyph:m,imageName:S,x:d,y:p+g,vertical:E,scale:s.scale,localGlyph:v.localGlyph,fontStack:s.fontStack,sectionIndex:f,metrics:v,rect:b}),d+=T*s.scale+c):(_.push({glyph:m,imageName:S,x:d,y:p+g,vertical:E,scale:s.scale,localGlyph:v.localGlyph,fontStack:s.fontStack,sectionIndex:f,metrics:v,rect:b}),d+=v.advance*s.scale+c)}0!==_.length&&(f=Math.max(d-c,f),gu(_,0,_.length-1,g,x)),d=0;const b=a*r+x;s.lineOffset=Math.max(x,o),p+=b,m=Math.max(b,m),++v}var y;const _=p-iu,{horizontalAlign:x,verticalAlign:b}=mu(o);(function(e,t,n,i,r,a,o,s,l){const c=(t-n)*r;let u=0;u=a!==o?-s*i-iu:(-i*l+.5)*o;for(const h of e)for(const e of h.positionedGlyphs)e.x+=c,e.y+=u})(e.positionedLines,g,x,b,f,m,a,_,r.length),e.top+=-b*_,e.bottom=e.top+_,e.left+=-x*f,e.right=e.left+f}(b,t,n,i,v,o,s,l,h,c,d,m),!function(e){for(const t of e)if(0!==t.positionedGlyphs.length)return!1;return!0}(x)&&b}const su={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},lu={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function cu(e,t,n,i,r,a){if(t.imageName){const e=i[t.imageName];return e?e.displaySize[0]*t.scale*xc/a+r:0}{const i=n[t.fontStack],a=i&&i[e];return a?a.metrics.advance*t.scale+r:0}}function uu(e,t,n,i){const r=Math.pow(e-t,2);return i?e<t?r/2:2*r:r+Math.abs(n)*n}function hu(e,t,n){let i=0;return 10===e&&(i-=1e4),n&&(i+=150),40!==e&&65288!==e||(i+=50),41!==t&&65289!==t||(i+=50),i}function du(e,t,n,i,r,a){let o=null,s=uu(t,n,r,a);for(const l of i){const e=uu(t-l.x,n,r,a)+l.badness;e<=s&&(o=l,s=e)}return{index:e,x:t,priorBreak:o,badness:s}}function pu(e){return e?pu(e.priorBreak).concat(e.index):[]}function fu(e,t,n,i,r,a,o){if("point"!==a)return[];if(!e)return[];const s=[],l=function(e,t,n,i,r,a){let o=0;for(let s=0;s<e.length();s++){const n=e.getSection(s);o+=cu(e.getCharCode(s),n,i,r,t,a)}return o/Math.max(1,Math.ceil(o/n))}(e,t,n,i,r,o),c=e.text.indexOf("\u200b")>=0;let u=0;for(let d=0;d<e.length();d++){const n=e.getSection(d),a=e.getCharCode(d);if(su[a]||(u+=cu(a,n,i,r,t,o)),d<e.length()-1){const t=!((h=a)<11904||!(Sr(h)||wr(h)||Or(h)||Rr(h)||kr(h)||gr(h)||Tr(h)||_r(h)||Ar(h)||Cr(h)||Mr(h)||Nr(h)||xr(h)||yr(h)||vr(h)||Er(h)||br(h)||Dr(h)||Lr(h)||Pr(h)));(lu[a]||t||n.imageName)&&s.push(du(d+1,u,l,s,hu(a,e.getCharCode(d+1),t&&c),!1))}}var h;return pu(du(e.length(),u,l,s,0,!0))}function mu(e){let t=.5,n=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:t,verticalAlign:n}}function gu(e,t,n,i,r){if(!i&&!r)return;const a=e[n],o=(e[n].x+a.metrics.advance*a.scale)*i;for(let s=t;s<=n;s++)e[s].x-=o,e[s].y+=r}function vu(e,t,n){const{horizontalAlign:i,verticalAlign:r}=mu(n),a=t[0]-e.displaySize[0]*i,o=t[1]-e.displaySize[1]*r;return{image:e,top:o,bottom:o+e.displaySize[1],left:a,right:a+e.displaySize[0]}}function yu(e,t,n,i,r,a){const o=e.image;let s;if(o.content){const e=o.content,t=o.pixelRatio||1;s=[e[0]/t,e[1]/t,o.displaySize[0]-e[2]/t,o.displaySize[1]-e[3]/t]}const l=t.left*a,c=t.right*a;let u,h,d,p;"width"===n||"both"===n?(p=r[0]+l-i[3],h=r[0]+c+i[1]):(p=r[0]+(l+c-o.displaySize[0])/2,h=p+o.displaySize[0]);const f=t.top*a,m=t.bottom*a;return"height"===n||"both"===n?(u=r[1]+f-i[0],d=r[1]+m+i[2]):(u=r[1]+(f+m-o.displaySize[1])/2,d=u+o.displaySize[1]),{image:o,top:u,right:h,bottom:d,left:p,collisionPadding:s}}class _u extends r{constructor(e,t,n,i){super(e,t),this.angle=n,void 0!==i&&(this.segment=i)}clone(){return new _u(this.x,this.y,this.angle,this.segment)}}function xu(e,t,n,i,r){if(void 0===t.segment)return!0;let a=t,o=t.segment+1,s=0;for(;s>-n/2;){if(o--,o<0)return!1;s-=e[o].dist(a),a=e[o]}s+=e[o].dist(e[o+1]),o++;const l=[];let c=0;for(;s<n/2;){const t=e[o],n=e[o+1];if(!n)return!1;let a=e[o-1].angleTo(t)-t.angleTo(n);for(a=Math.abs((a+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:s,angleDelta:a}),c+=a;s-l[0].distance>i;)c-=l.shift().angleDelta;if(c>r)return!1;o++,s+=t.dist(n)}return!0}function bu(e){let t=0;for(let n=0;n<e.length-1;n++)t+=e[n].dist(e[n+1]);return t}function wu(e,t,n){return e?.6*t*n:0}function Su(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function Tu(e,t,n,i,r,a){const o=wu(n,r,a),s=Su(n,i)*a;let l=0;const c=bu(e)/2;for(let u=0;u<e.length-1;u++){const n=e[u],i=e[u+1],r=n.dist(i);if(l+r>c){const a=(c-l)/r,h=nn(n.x,i.x,a),d=nn(n.y,i.y,a),p=new _u(h,d,i.angleTo(n),u);return p._round(),!o||xu(e,p,s,o,t)?p:void 0}l+=r}}function Eu(e,t,n,i,r,a,o,s,l){const c=wu(i,a,o),u=Su(i,r),h=u*o,d=0===e[0].x||e[0].x===l||0===e[0].y||e[0].y===l;return t-h<t/4&&(t=h+t/4),Mu(e,d?t/2*s%t:(u/2+2*a)*o*s%t,t,c,n,h,d,!1,l)}function Mu(e,t,n,i,r,a,o,s,l){const c=a/2,u=bu(e);let h=0,d=t-n,p=[];for(let f=0;f<e.length-1;f++){const t=e[f],o=e[f+1],s=t.dist(o),m=o.angleTo(t);for(;d+n<h+s;){d+=n;const g=(d-h)/s,v=nn(t.x,o.x,g),y=nn(t.y,o.y,g);if(v>=0&&v<l&&y>=0&&y<l&&d-c>=0&&d+c<=u){const t=new _u(v,y,m,f);t._round(),i&&!xu(e,t,a,i,r)||p.push(t)}}h+=s}return s||p.length||o||(p=Mu(e,h/2,n,i,r,a,o,!0,l)),p}function ku(e,t,n,i,a){const o=[];for(let s=0;s<e.length;s++){const l=e[s];let c;for(let e=0;e<l.length-1;e++){let s=l[e],u=l[e+1];s.x<t&&u.x<t||(s.x<t?s=new r(t,s.y+(t-s.x)/(u.x-s.x)*(u.y-s.y))._round():u.x<t&&(u=new r(t,s.y+(t-s.x)/(u.x-s.x)*(u.y-s.y))._round()),s.y<n&&u.y<n||(s.y<n?s=new r(s.x+(n-s.y)/(u.y-s.y)*(u.x-s.x),n)._round():u.y<n&&(u=new r(s.x+(n-s.y)/(u.y-s.y)*(u.x-s.x),n)._round()),s.x>=i&&u.x>=i||(s.x>=i?s=new r(i,s.y+(i-s.x)/(u.x-s.x)*(u.y-s.y))._round():u.x>=i&&(u=new r(i,s.y+(i-s.x)/(u.x-s.x)*(u.y-s.y))._round()),s.y>=a&&u.y>=a||(s.y>=a?s=new r(s.x+(a-s.y)/(u.y-s.y)*(u.x-s.x),a)._round():u.y>=a&&(u=new r(s.x+(a-s.y)/(u.y-s.y)*(u.x-s.x),a)._round()),c&&s.equals(c[c.length-1])||(c=[s],o.push(c)),c.push(u)))))}}return o}sr("Anchor",_u);var Au=Lu,Cu=Lu,Pu=1e20;function Lu(e,t,n,i,r,a){this.fontSize=e||24,this.buffer=void 0===t?3:t,this.cutoff=i||.25,this.fontFamily=r||"sans-serif",this.fontWeight=a||"normal",this.radius=n||8;var o=this.size=this.fontSize+2*this.buffer,s=o+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=o,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(s*s),this.gridInner=new Float64Array(s*s),this.f=new Float64Array(s),this.z=new Float64Array(s+1),this.v=new Uint16Array(s),this.useMetrics=void 0!==this.ctx.measureText("A").actualBoundingBoxLeft,this.middle=Math.round(o/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Iu(e,t,n,i,r,a){for(var o=0;o<t;o++)Ru(e,o,t,n,i,r,a);for(var s=0;s<n;s++)Ru(e,s*t,1,t,i,r,a)}function Ru(e,t,n,i,r,a,o){var s,l,c,u;for(a[0]=0,o[0]=-Pu,o[1]=Pu,s=0;s<i;s++)r[s]=e[t+s*n];for(s=1,l=0,c=0;s<i;s++){do{c=(r[s]-r[u=a[l]]+s*s-u*u)/(s-u)/2}while(c<=o[l]&&--l>-1);a[++l]=s,o[l]=c,o[l+1]=Pu}for(s=0,l=0;s<i;s++){for(;o[l+1]<s;)l++;e[t+s*n]=r[u=a[l]]+(s-u)*(s-u)}}Lu.prototype._draw=function(e,t){var n,i,r,a,o,s,l,c,u,h=this.ctx.measureText(e),d=h.width,p=2*this.buffer;t&&this.useMetrics?(o=Math.floor(h.actualBoundingBoxAscent),c=this.buffer+Math.ceil(h.actualBoundingBoxAscent),s=this.buffer,l=this.buffer,n=(i=Math.min(this.size,Math.ceil(h.actualBoundingBoxRight-h.actualBoundingBoxLeft)))+p,r=(a=Math.min(this.size-s,Math.ceil(h.actualBoundingBoxAscent+h.actualBoundingBoxDescent)))+p,this.ctx.textBaseline="alphabetic"):(n=i=this.size,r=a=this.size,o=19*this.fontSize/24,s=l=0,c=this.middle,this.ctx.textBaseline="middle"),i&&a&&(this.ctx.clearRect(l,s,i,a),this.ctx.fillText(e,this.buffer,c),u=this.ctx.getImageData(l,s,i,a));var f=new Uint8ClampedArray(n*r);return function(e,t,n,i,r,a,o){a.fill(Pu,0,t*n),o.fill(0,0,t*n);for(var s=(t-i)/2,l=0;l<r;l++)for(var c=0;c<i;c++){var u=(l+s)*t+c+s,h=e.data[4*(l*i+c)+3]/255;if(1===h)a[u]=0,o[u]=Pu;else if(0===h)a[u]=Pu,o[u]=0;else{var d=Math.max(0,.5-h),p=Math.max(0,h-.5);a[u]=d*d,o[u]=p*p}}}(u,n,r,i,a,this.gridOuter,this.gridInner),Iu(this.gridOuter,n,r,this.f,this.v,this.z),Iu(this.gridInner,n,r,this.f,this.v,this.z),function(e,t,n,i,r,a,o){for(var s=0;s<t*n;s++){var l=Math.sqrt(i[s])-Math.sqrt(r[s]);e[s]=Math.round(255-255*(l/a+o))}}(f,n,r,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:f,metrics:{width:i,height:a,sdfWidth:n,sdfHeight:r,top:o,left:0,advance:d}}},Lu.prototype.draw=function(e){return this._draw(e,!1).data},Lu.prototype.drawWithMetrics=function(e){return this._draw(e,!0)},Au.default=Cu;const zu={none:0,ideographs:1,all:2};class Du{constructor(e,t,n){this.requestManager=e,this.localGlyphMode=t,this.localFontFamily=n,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,t){const n=[];for(const i in e)for(const t of e[i])n.push({stack:i,id:t});v(n,(({stack:e,id:t},n)=>{let i=this.entries[e];i||(i=this.entries[e]={glyphs:{},requests:{},ranges:{}});let r=i.glyphs[t];if(void 0!==r)return void n(null,{stack:e,id:t,glyph:r});if(r=this._tinySDF(i,e,t),r)return i.glyphs[t]=r,void n(null,{stack:e,id:t,glyph:r});const a=Math.floor(t/256);if(256*a>65535)return void n(new Error("glyphs > 65535 not supported"));if(i.ranges[a])return void n(null,{stack:e,id:t,glyph:r});let o=i.requests[a];o||(o=i.requests[a]=[],Du.loadGlyphRange(e,a,this.url,this.requestManager,((e,t)=>{if(t){for(const e in t)this._doesCharSupportLocalGlyph(+e)||(i.glyphs[+e]=t[+e]);i.ranges[a]=!0}for(const n of o)n(e,t);delete i.requests[a]}))),o.push(((i,r)=>{i?n(i):r&&n(null,{stack:e,id:t,glyph:r[t]||null})}))}),((e,n)=>{if(e)t(e);else if(n){const e={};for(const{stack:t,id:i,glyph:r}of n)(e[t]||(e[t]={}))[i]=r&&{id:r.id,bitmap:r.bitmap.clone(),metrics:r.metrics};t(null,e)}}))}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==zu.none&&(this.localGlyphMode===zu.all?!!this.localFontFamily:!!this.localFontFamily&&(Cr(e)||Ir(e)||xr(e)||br(e)))}_tinySDF(e,t,n){const i=this.localFontFamily;if(!i)return;if(!this._doesCharSupportLocalGlyph(n))return;let r=e.tinySDF;if(!r){let n="400";/bold/i.test(t)?n="900":/medium/i.test(t)?n="500":/light/i.test(t)&&(n="200"),r=e.tinySDF=new Du.TinySDF(48,6,16,.25,i,n)}if(this.localGlyphs[r.fontWeight][n])return this.localGlyphs[r.fontWeight][n];const{data:a,metrics:o}=r.drawWithMetrics(String.fromCharCode(n)),{sdfWidth:s,sdfHeight:l,width:c,height:u,left:h,top:d,advance:p}=o;return this.localGlyphs[r.fontWeight][n]={id:n,bitmap:new js({width:s,height:l},a),metrics:{width:c/2,height:u/2,left:h/2,top:d/2-27,advance:p/2,localGlyph:!0}}}}function Ou(e,t,n,i){const a=[],o=e.image,s=o.pixelRatio,l=o.paddedRect.w-2,c=o.paddedRect.h-2,u=e.right-e.left,h=e.bottom-e.top,d=o.stretchX||[[0,l]],p=o.stretchY||[[0,c]],f=(e,t)=>e+t[1]-t[0],m=d.reduce(f,0),g=p.reduce(f,0),v=l-m,y=c-g;let _=0,x=m,b=0,w=g,S=0,T=v,E=0,M=y;if(o.content&&i){const e=o.content;_=Bu(d,0,e[0]),b=Bu(p,0,e[1]),x=Bu(d,e[0],e[2]),w=Bu(p,e[1],e[3]),S=e[0]-_,E=e[1]-b,T=e[2]-e[0]-x,M=e[3]-e[1]-w}const k=(i,a,l,c)=>{const d=Nu(i.stretch-_,x,u,e.left),p=Uu(i.fixed-S,T,i.stretch,m),f=Nu(a.stretch-b,w,h,e.top),v=Uu(a.fixed-E,M,a.stretch,g),y=Nu(l.stretch-_,x,u,e.left),k=Uu(l.fixed-S,T,l.stretch,m),A=Nu(c.stretch-b,w,h,e.top),C=Uu(c.fixed-E,M,c.stretch,g),P=new r(d,f),L=new r(y,f),I=new r(y,A),R=new r(d,A),z=new r(p/s,v/s),D=new r(k/s,C/s),O=t*Math.PI/180;if(O){const e=Math.sin(O),t=Math.cos(O),n=[t,-e,e,t];P._matMult(n),L._matMult(n),R._matMult(n),I._matMult(n)}const B=i.stretch+i.fixed,F=a.stretch+a.fixed;return{tl:P,tr:L,bl:R,br:I,tex:{x:o.paddedRect.x+1+B,y:o.paddedRect.y+1+F,w:l.stretch+l.fixed-B,h:c.stretch+c.fixed-F},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:z,pixelOffsetBR:D,minFontScaleX:T/s/u,minFontScaleY:M/s/h,isSDF:n}};if(i&&(o.stretchX||o.stretchY)){const e=Fu(d,v,m),t=Fu(p,y,g);for(let n=0;n<e.length-1;n++){const i=e[n],r=e[n+1];for(let e=0;e<t.length-1;e++)a.push(k(i,t[e],r,t[e+1]))}}else a.push(k({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:l+1},{fixed:0,stretch:c+1}));return a}function Bu(e,t,n){let i=0;for(const r of e)i+=Math.max(t,Math.min(n,r[1]))-Math.max(t,Math.min(n,r[0]));return i}function Fu(e,t,n){const i=[{fixed:-1,stretch:0}];for(const[r,a]of e){const e=i[i.length-1];i.push({fixed:r-e.stretch,stretch:e.stretch}),i.push({fixed:r-e.stretch,stretch:e.stretch+(a-r)})}return i.push({fixed:t+1,stretch:n}),i}function Nu(e,t,n,i){return e/t*n+i}function Uu(e,t,n,i){return e-t*n/i}Du.loadGlyphRange=function(e,t,n,i,r){const a=256*t,o=a+255,s=i.transformRequest(i.normalizeGlyphsURL(n).replace("{fontstack}",e).replace("{range}",`${a}-${o}`),be.Glyphs);Ee(s,((e,t)=>{if(e)r(e);else if(t){const e={};for(const n of function(e){return new Pc(e).readFields(Yc,[])}(t))e[n.id]=n;r(null,e)}}))},Du.TinySDF=Au;class Vu{constructor(e=[],t=ju){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:n}=this,i=t[e];for(;e>0;){const r=e-1>>1,a=t[r];if(n(i,a)>=0)break;t[e]=a,e=r}t[e]=i}_down(e){const{data:t,compare:n}=this,i=this.length>>1,r=t[e];for(;e<i;){let i=1+(e<<1),a=t[i];const o=i+1;if(o<this.length&&n(t[o],a)<0&&(i=o,a=t[o]),n(a,r)>=0)break;t[e]=a,e=i}t[e]=r}}function ju(e,t){return e<t?-1:e>t?1:0}function Gu(e,t=1,n=!1){let i=1/0,a=1/0,o=-1/0,s=-1/0;const l=e[0];for(let r=0;r<l.length;r++){const e=l[r];(!r||e.x<i)&&(i=e.x),(!r||e.y<a)&&(a=e.y),(!r||e.x>o)&&(o=e.x),(!r||e.y>s)&&(s=e.y)}const c=Math.min(o-i,s-a);let u=c/2;const h=new Vu([],Hu);if(0===c)return new r(i,a);for(let r=i;r<o;r+=c)for(let t=a;t<s;t+=c)h.push(new Wu(r+u,t+u,u,e));let d=function(e){let t=0,n=0,i=0;const r=e[0];for(let a=0,o=r.length,s=o-1;a<o;s=a++){const e=r[a],o=r[s],l=e.x*o.y-o.x*e.y;n+=(e.x+o.x)*l,i+=(e.y+o.y)*l,t+=3*l}return new Wu(n/t,i/t,0,e)}(e),p=h.length;for(;h.length;){const i=h.pop();(i.d>d.d||!d.d)&&(d=i,n&&console.log("found best %d after %d probes",Math.round(1e4*i.d)/1e4,p)),i.max-d.d<=t||(u=i.h/2,h.push(new Wu(i.p.x-u,i.p.y-u,u,e)),h.push(new Wu(i.p.x+u,i.p.y-u,u,e)),h.push(new Wu(i.p.x-u,i.p.y+u,u,e)),h.push(new Wu(i.p.x+u,i.p.y+u,u,e)),p+=4)}return n&&(console.log(`num probes: ${p}`),console.log(`best distance: ${d.d}`)),d.p}function Hu(e,t){return t.max-e.max}function Wu(e,t,n,i){this.p=new r(e,t),this.h=n,this.d=function(e,t){let n=!1,i=1/0;for(let r=0;r<t.length;r++){const a=t[r];for(let t=0,r=a.length,o=r-1;t<r;o=t++){const r=a[t],s=a[o];r.y>e.y!=s.y>e.y&&e.x<(s.x-r.x)*(e.y-r.y)/(s.y-r.y)+r.x&&(n=!n),i=Math.min(i,ns(e,r,s))}}return(n?1:-1)*Math.sqrt(i)}(this.p,i),this.max=this.d+this.h*Math.SQRT2}const qu=Number.POSITIVE_INFINITY;function Zu(e,t){return t[1]!==qu?function(e,t,n){let i=0,r=0;switch(t=Math.abs(t),n=Math.abs(n),e){case"top-right":case"top-left":case"top":r=n-7;break;case"bottom-right":case"bottom-left":case"bottom":r=7-n}switch(e){case"top-right":case"bottom-right":case"right":i=-t;break;case"top-left":case"bottom-left":case"left":i=t}return[i,r]}(e,t[0],t[1]):function(e,t){let n=0,i=0;t<0&&(t=0);const r=t/Math.sqrt(2);switch(e){case"top-right":case"top-left":i=r-7;break;case"bottom-right":case"bottom-left":i=7-r;break;case"bottom":i=7-t;break;case"top":i=t-7}switch(e){case"top-right":case"bottom-right":n=-r;break;case"top-left":case"bottom-left":n=r;break;case"left":n=t;break;case"right":n=-t}return[n,i]}(e,t[0])}function $u(e,t,n,i,r,a,o,s){e.createArrays(),e.tilePixelRatio=jo/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;const l=e.layers[0].layout,c=e.layers[0]._unevaluatedLayout._values,u={};if("composite"===e.textSizeData.kind){const{minZoom:t,maxZoom:n}=e.textSizeData;u.compositeTextSizes=[c["text-size"].possiblyEvaluate(new oa(t),o),c["text-size"].possiblyEvaluate(new oa(n),o)]}if("composite"===e.iconSizeData.kind){const{minZoom:t,maxZoom:n}=e.iconSizeData;u.compositeIconSizes=[c["icon-size"].possiblyEvaluate(new oa(t),o),c["icon-size"].possiblyEvaluate(new oa(n),o)]}u.layoutTextSize=c["text-size"].possiblyEvaluate(new oa(s+1),o),u.layoutIconSize=c["icon-size"].possiblyEvaluate(new oa(s+1),o),u.textMaxSize=c["text-size"].possiblyEvaluate(new oa(18),o);const h="map"===l.get("text-rotation-alignment")&&"point"!==l.get("symbol-placement"),d=l.get("text-keep-upright"),p=l.get("text-size");for(const f of e.features){const a=l.get("text-font").evaluate(f,{},o).join(","),s=p.evaluate(f,{},o),c=u.layoutTextSize.evaluate(f,{},o),m=(u.layoutIconSize.evaluate(f,{},o),{horizontal:{},vertical:void 0}),g=f.text;let v,y=[0,0];if(g){const i=g.toString(),u=l.get("text-letter-spacing").evaluate(f,{},o)*xc,p=l.get("text-line-height").evaluate(f,{},o)*xc,v=Vr(i)?u:0,_=l.get("text-anchor").evaluate(f,{},o),x=l.get("text-variable-anchor");if(!x){const e=l.get("text-radial-offset").evaluate(f,{},o);y=e?Zu(_,[e*xc,qu]):l.get("text-offset").evaluate(f,{},o).map((e=>e*xc))}let b=h?"center":l.get("text-justify").evaluate(f,{},o);const w=l.get("symbol-placement"),S="point"===w?l.get("text-max-width").evaluate(f,{},o)*xc:0,T=()=>{e.allowVerticalPlacement&&Ur(i)&&(m.vertical=ou(g,t,n,r,a,S,p,_,"left",v,y,nu.vertical,!0,w,c,s))};if(!h&&x){const e="auto"===b?x.map((e=>Xu(e))):[b];let i=!1;for(let o=0;o<e.length;o++){const l=e[o];if(!m.horizontal[l])if(i)m.horizontal[l]=m.horizontal[0];else{const e=ou(g,t,n,r,a,S,p,"center",l,v,y,nu.horizontal,!1,w,c,s);e&&(m.horizontal[l]=e,i=1===e.positionedLines.length)}}T()}else{"auto"===b&&(b=Xu(_));const e=ou(g,t,n,r,a,S,p,_,b,v,y,nu.horizontal,!1,w,c,s);e&&(m.horizontal[b]=e),T(),Ur(i)&&h&&d&&(m.vertical=ou(g,t,n,r,a,S,p,_,b,v,y,nu.vertical,!1,w,c,s))}}let _=!1;if(f.icon&&f.icon.name){const t=i[f.icon.name];t&&(v=vu(r[f.icon.name],l.get("icon-offset").evaluate(f,{},o),l.get("icon-anchor").evaluate(f,{},o)),_=t.sdf,void 0===e.sdfIcons?e.sdfIcons=t.sdf:e.sdfIcons!==t.sdf&&L("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(t.pixelRatio!==e.pixelRatio||0!==l.get("icon-rotate").constantOr(1))&&(e.iconsNeedLinear=!0))}const x=Qu(m.horizontal)||m.vertical;e.iconsInText||(e.iconsInText=!!x&&x.iconsInText),(x||v)&&Yu(e,f,m,v,i,u,c,0,y,_,o)}a&&e.generateCollisionDebugBuffers(s,e.collisionBoxArray)}function Xu(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Yu(e,t,n,i,r,a,o,s,l,c,h){let d=a.textMaxSize.evaluate(t,{},h);void 0===d&&(d=o);const p=e.layers[0].layout,f=p.get("icon-offset").evaluate(t,{},h),m=Qu(n.horizontal),g=o/24,v=e.tilePixelRatio*g,y=e.tilePixelRatio*d/24,_=e.tilePixelRatio*p.get("symbol-spacing"),x=p.get("text-padding")*e.tilePixelRatio,b=p.get("icon-padding")*e.tilePixelRatio,w=u(p.get("text-max-angle")),S="map"===p.get("text-rotation-alignment")&&"point"!==p.get("symbol-placement"),T="map"===p.get("icon-rotation-alignment")&&"point"!==p.get("symbol-placement"),E=p.get("symbol-placement"),M=_/2,k=p.get("icon-text-fit");let A;i&&"none"!==k&&(e.allowVerticalPlacement&&n.vertical&&(A=yu(i,n.vertical,k,p.get("icon-text-fit-padding"),f,g)),m&&(i=yu(i,m,k,p.get("icon-text-fit-padding"),f,g)));const C=(s,u)=>{u.x<0||u.x>=jo||u.y<0||u.y>=jo||function(e,t,n,i,r,a,o,s,l,c,u,h,d,p,f,m,g,v,y,_,x,b,w,S,T){const E=e.addToLineVertexArray(t,n);let M,k,A,C,P,I,R,z=0,D=0,O=0,B=0,F=-1,N=-1;const U={};let V=ho(""),j=0,G=0;if(void 0===s._unevaluatedLayout.getValue("text-radial-offset")?[j,G]=s.layout.get("text-offset").evaluate(x,{},S).map((e=>e*xc)):(j=s.layout.get("text-radial-offset").evaluate(x,{},S)*xc,G=qu),e.allowVerticalPlacement&&i.vertical){const e=i.vertical;if(f)I=th(e),o&&(R=th(o));else{const n=s.layout.get("text-rotate").evaluate(x,{},S)+90;A=eh(l,t,c,u,h,e,0,p,n),o&&(C=eh(l,t,c,u,h,o,0,v,n))}}if(r){const n=s.layout.get("icon-rotate").evaluate(x,{},S),i="none"!==s.layout.get("icon-text-fit"),a=Ou(r,n,w,i),d=o?Ou(o,n,w,i):void 0;k=eh(l,t,c,u,h,r,0,v,n),z=4*a.length;const p=e.iconSizeData;let f=null;"source"===p.kind?(f=[bc*s.layout.get("icon-size").evaluate(x,{},S)],f[0]>Ju&&L(`${e.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===p.kind&&(f=[bc*b.compositeIconSizes[0].evaluate(x,{},S),bc*b.compositeIconSizes[1].evaluate(x,{},S)],(f[0]>Ju||f[1]>Ju)&&L(`${e.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),e.addSymbols(e.icon,a,f,_,y,x,!1,t,E.lineStartIndex,E.lineLength,-1,S),F=e.icon.placedSymbolArray.length-1,d&&(D=4*d.length,e.addSymbols(e.icon,d,f,_,y,x,nu.vertical,t,E.lineStartIndex,E.lineLength,-1,S),N=e.icon.placedSymbolArray.length-1)}for(const L in i.horizontal){const n=i.horizontal[L];M||(V=ho(n.text),f?P=th(n):M=eh(l,t,c,u,h,n,0,p,s.layout.get("text-rotate").evaluate(x,{},S)));const r=1===n.positionedLines.length;if(O+=Ku(e,t,n,a,s,f,x,m,E,i.vertical?nu.horizontal:nu.horizontalOnly,r?Object.keys(i.horizontal):[L],U,F,b,S),r)break}i.vertical&&(B+=Ku(e,t,i.vertical,a,s,f,x,m,E,nu.vertical,["vertical"],U,N,b,S));let H=-1;const W=(e,t)=>e?Math.max(e,t):t;H=W(P,H),H=W(I,H),H=W(R,H);const q=H>-1?1:0;q&&(H*=T/xc),e.glyphOffsetArray.length>=uh.MAX_GLYPHS&&L("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==x.sortKey&&e.addToSortKeyRanges(e.symbolInstances.length,x.sortKey),e.symbolInstances.emplaceBack(t.x,t.y,U.right>=0?U.right:-1,U.center>=0?U.center:-1,U.left>=0?U.left:-1,U.vertical||-1,F,N,V,void 0!==M?M:e.collisionBoxArray.length,void 0!==M?M+1:e.collisionBoxArray.length,void 0!==A?A:e.collisionBoxArray.length,void 0!==A?A+1:e.collisionBoxArray.length,void 0!==k?k:e.collisionBoxArray.length,void 0!==k?k+1:e.collisionBoxArray.length,C||e.collisionBoxArray.length,C?C+1:e.collisionBoxArray.length,c,O,B,z,D,q,0,d,j,G,H)}(e,u,s,n,i,r,A,e.layers[0],e.collisionBoxArray,t.index,t.sourceLayerIndex,e.index,v,x,S,l,0,b,T,f,t,a,c,h,o)};if("line"===E)for(const u of ku(t.geometry,0,0,jo,jo)){const t=Eu(u,_,w,n.vertical||m,i,24,y,e.overscaling,jo);for(const n of t){const t=m;t&&nh(e,t.text,M,n)||C(u,n)}}else if("line-center"===E){for(const u of t.geometry)if(u.length>1){const e=Tu(u,w,n.vertical||m,i,24,y);e&&C(u,e)}}else if("Polygon"===t.type)for(const u of kl(t.geometry,0)){const e=Gu(u,16);C(u[0],new _u(e.x,e.y,0))}else if("LineString"===t.type)for(const u of t.geometry)C(u,new _u(u[0].x,u[0].y,0));else if("Point"===t.type)for(const u of t.geometry)for(const e of u)C([e],new _u(e.x,e.y,0))}const Ju=32640;function Ku(e,t,n,i,a,o,s,l,c,u,h,d,p,f,m){const g=function(e,t,n,i,a,o,s,l){const c=i.layout.get("text-rotate").evaluate(o,{})*Math.PI/180,u=[];for(const h of t.positionedLines)for(const e of h.positionedGlyphs){if(!e.rect)continue;const i=e.rect||{};let o=4,d=!0,p=1,f=0;const m=(a||l)&&e.vertical,g=e.metrics.advance*e.scale/2;if(l&&t.verticalizable){const t=(e.scale-1)*xc,n=(xc-e.metrics.width*e.scale)/2;f=h.lineOffset/2-(e.imageName?-n:t)}if(e.imageName){const t=s[e.imageName];d=t.sdf,p=t.pixelRatio,o=1/p}const v=a?[e.x+g,e.y]:[0,0];let y=a?[0,0]:[e.x+g+n[0],e.y+n[1]-f],_=[0,0];m&&(_=y,y=[0,0]);const x=(e.metrics.left-o)*e.scale-g+y[0],b=(-e.metrics.top-o)*e.scale+y[1],w=x+i.w*e.scale/(p*(e.localGlyph?2:1)),S=b+i.h*e.scale/(p*(e.localGlyph?2:1)),T=new r(x,b),E=new r(w,b),M=new r(x,S),k=new r(w,S);if(m){const t=new r(-g,g-iu),n=-Math.PI/2,i=12-g,a=new r(22-i,-(e.imageName?i:0)),o=new r(..._);T._rotateAround(n,t)._add(a)._add(o),E._rotateAround(n,t)._add(a)._add(o),M._rotateAround(n,t)._add(a)._add(o),k._rotateAround(n,t)._add(a)._add(o)}if(c){const e=Math.sin(c),t=Math.cos(c),n=[t,-e,e,t];T._matMult(n),E._matMult(n),M._matMult(n),k._matMult(n)}const A=new r(0,0),C=new r(0,0);u.push({tl:T,tr:E,bl:M,br:k,tex:i,writingMode:t.writingMode,glyphOffset:v,sectionIndex:e.sectionIndex,isSDF:d,pixelOffsetTL:A,pixelOffsetBR:C,minFontScaleX:0,minFontScaleY:0})}return u}(0,n,l,a,o,s,i,e.allowVerticalPlacement),v=e.textSizeData;let y=null;"source"===v.kind?(y=[bc*a.layout.get("text-size").evaluate(s,{},m)],y[0]>Ju&&L(`${e.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===v.kind&&(y=[bc*f.compositeTextSizes[0].evaluate(s,{},m),bc*f.compositeTextSizes[1].evaluate(s,{},m)],(y[0]>Ju||y[1]>Ju)&&L(`${e.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),e.addSymbols(e.text,g,y,l,o,s,u,t,c.lineStartIndex,c.lineLength,p,m);for(const r of h)d[r]=e.text.placedSymbolArray.length-1;return 4*g.length}function Qu(e){for(const t in e)return e[t];return null}function eh(e,t,n,i,a,o,s,l,c){let h=o.top,d=o.bottom,p=o.left,f=o.right;const m=o.collisionPadding;if(m&&(p-=m[0],h-=m[1],f+=m[2],d+=m[3]),c){const e=new r(p,h),t=new r(f,h),n=new r(p,d),i=new r(f,d),a=u(c);e._rotate(a),t._rotate(a),n._rotate(a),i._rotate(a),p=Math.min(e.x,t.x,n.x,i.x),f=Math.max(e.x,t.x,n.x,i.x),h=Math.min(e.y,t.y,n.y,i.y),d=Math.max(e.y,t.y,n.y,i.y)}return e.emplaceBack(t.x,t.y,p,h,f,d,l,n,i,a),e.length-1}function th(e){e.collisionPadding&&(e.top-=e.collisionPadding[1],e.bottom+=e.collisionPadding[3]);const t=e.bottom-e.top;return t>0?Math.max(10,t):null}function nh(e,t,n,i){const r=e.compareText;if(t in r){const e=r[t];for(let t=e.length-1;t>=0;t--)if(i.dist(e[t])<n)return!0}else r[t]=[];return r[t].push(i),!1}const ih=Wl.VectorTileFeature.types,rh=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ah(e,t,n,i,r,a,o,s,l,c,u,h,d){const p=s?Math.min(Ju,Math.round(s[0])):0,f=s?Math.min(Ju,Math.round(s[1])):0;e.emplaceBack(t,n,Math.round(32*i),Math.round(32*r),a,o,(p<<1)+(l?1:0),f,16*c,16*u,256*h,256*d)}function oh(e,t,n){e.emplaceBack(t.x,t.y,n),e.emplaceBack(t.x,t.y,n),e.emplaceBack(t.x,t.y,n),e.emplaceBack(t.x,t.y,n)}function sh(e){for(const t of e.sections)if(Zr(t.text))return!0;return!1}class lh{constructor(e){this.layoutVertexArray=new Ra,this.indexArray=new Ua,this.programConfigurations=e,this.segments=new Vo,this.dynamicLayoutVertexArray=new za,this.opacityVertexArray=new Da,this.placedSymbolArray=new Ka}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(e,t,n,i){this.isEmpty()||(n&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,fc.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,mc.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,rh,!0),this.opacityVertexBuffer.itemSize=1),(n||i)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}sr("SymbolBuffers",lh);class ch{constructor(e,t,n){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new n,this.segments=new Vo,this.collisionVertexArray=new Na,this.collisionVertexArrayExt=new za}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,gc.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,vc.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}sr("CollisionBuffers",ch);class uh{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ms([]),this.placementViewportMatrix=ms([]);const t=this.layers[0]._unevaluatedLayout._values;this.textSizeData=wc(this.zoom,t["text-size"]),this.iconSizeData=wc(this.zoom,t["icon-size"]);const n=this.layers[0].layout,i=n.get("symbol-sort-key"),r=n.get("symbol-z-order");this.canOverlap=n.get("text-allow-overlap")||n.get("icon-allow-overlap")||n.get("text-ignore-placement")||n.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==r&&void 0!==i.constantOr(1),this.sortFeaturesByY=("viewport-y"===r||"auto"===r&&!this.sortFeaturesByKey)&&this.canOverlap,"point"===n.get("symbol-placement")&&(this.writingModes=n.get("text-writing-mode").map((e=>nu[e]))),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.sourceID=e.sourceID}createArrays(){this.text=new lh(new Lo(this.layers,this.zoom,(e=>/^text/.test(e)))),this.icon=new lh(new Lo(this.layers,this.zoom,(e=>/^icon/.test(e)))),this.glyphOffsetArray=new to,this.lineVertexArray=new no,this.symbolInstances=new eo}calculateGlyphDependencies(e,t,n,i,r){for(let a=0;a<e.length;a++)if(t[e.charCodeAt(a)]=!0,(n||i)&&r){const n=kc[e.charAt(a)];n&&(t[n.charCodeAt(0)]=!0)}}populate(e,t,n){const i=this.layers[0],r=i.layout,a=r.get("text-font"),o=r.get("text-field"),s=r.get("icon-image"),l=("constant"!==o.value.kind||o.value.value instanceof pt&&!o.value.value.isEmpty()||o.value.value.toString().length>0)&&("constant"!==a.value.kind||a.value.value.length>0),c="constant"!==s.value.kind||!!s.value.value||Object.keys(s.parameters).length>0,u=r.get("symbol-sort-key");if(this.features=[],!l&&!c)return;const h=t.iconDependencies,d=t.glyphDependencies,p=t.availableImages,f=new oa(this.zoom);for(const{feature:m,id:g,index:v,sourceLayerIndex:y}of e){const e=i._featureFilter.needGeometry,t=qo(m,e);if(!i._featureFilter.filter(f,t,n))continue;let o,s;if(e||(t.geometry=Wo(m)),l){const e=i.getValueAndResolveTokens("text-field",t,n,p),r=pt.factory(e);sh(r)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===ia()||this.hasRTLText&&aa.isParsed())&&(o=Mc(r,i,t))}if(c){const e=i.getValueAndResolveTokens("icon-image",t,n,p);s=e instanceof ft?e:ft.fromString(e)}if(!o&&!s)continue;const _=this.sortFeaturesByKey?u.evaluate(t,{},n):void 0;if(this.features.push({id:g,text:o,icon:s,index:v,sourceLayerIndex:y,geometry:t.geometry,properties:m.properties,type:ih[m.type],sortKey:_}),s&&(h[s.name]=!0),o){const e=a.evaluate(t,{},n).join(","),i="map"===r.get("text-rotation-alignment")&&"point"!==r.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(nu.vertical)>=0;for(const t of o.sections)if(t.image)h[t.image.name]=!0;else{const n=Ur(o.toString()),r=t.fontStack||e,a=d[r]=d[r]||{};this.calculateGlyphDependencies(t.text,a,i,this.allowVerticalPlacement,n)}}}"line"===r.get("symbol-placement")&&(this.features=function(e){const t={},n={},i=[];let r=0;function a(t){i.push(e[t]),r++}function o(e,t,r){const a=n[e];return delete n[e],n[t]=a,i[a].geometry[0].pop(),i[a].geometry[0]=i[a].geometry[0].concat(r[0]),a}function s(e,n,r){const a=t[n];return delete t[n],t[e]=a,i[a].geometry[0].shift(),i[a].geometry[0]=r[0].concat(i[a].geometry[0]),a}function l(e,t,n){const i=n?t[0][t[0].length-1]:t[0][0];return`${e}:${i.x}:${i.y}`}for(let c=0;c<e.length;c++){const u=e[c],h=u.geometry,d=u.text?u.text.toString():null;if(!d){a(c);continue}const p=l(d,h),f=l(d,h,!0);if(p in n&&f in t&&n[p]!==t[f]){const e=s(p,f,h),r=o(p,f,i[e].geometry);delete t[p],delete n[f],n[l(d,i[r].geometry,!0)]=r,i[e].geometry=null}else p in n?o(p,f,h):f in t?s(p,f,h):(a(c),t[p]=r-1,n[f]=r-1)}return i.filter((e=>e.geometry))}(this.features)),this.sortFeaturesByKey&&this.features.sort(((e,t)=>e.sortKey-t.sortKey))}update(e,t,n){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers,n),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers,n))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,t){const n=this.lineVertexArray.length;if(void 0!==e.segment){let n=e.dist(t[e.segment+1]),i=e.dist(t[e.segment]);const r={};for(let a=e.segment+1;a<t.length;a++)r[a]={x:t[a].x,y:t[a].y,tileUnitDistanceFromAnchor:n},a<t.length-1&&(n+=t[a+1].dist(t[a]));for(let a=e.segment||0;a>=0;a--)r[a]={x:t[a].x,y:t[a].y,tileUnitDistanceFromAnchor:i},a>0&&(i+=t[a-1].dist(t[a]));for(let e=0;e<t.length;e++){const t=r[e];this.lineVertexArray.emplaceBack(t.x,t.y,t.tileUnitDistanceFromAnchor)}}return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}}addSymbols(e,t,n,i,r,a,o,s,l,c,u,h){const d=e.indexArray,p=e.layoutVertexArray,f=e.segments.prepareSegment(4*t.length,p,d,this.canOverlap?a.sortKey:void 0),m=this.glyphOffsetArray.length,g=f.vertexLength,v=this.allowVerticalPlacement&&o===nu.vertical?Math.PI/2:0,y=a.text&&a.text.sections;for(let _=0;_<t.length;_++){const{tl:i,tr:r,bl:o,br:l,tex:c,pixelOffsetTL:u,pixelOffsetBR:m,minFontScaleX:g,minFontScaleY:x,glyphOffset:b,isSDF:w,sectionIndex:S}=t[_],T=f.vertexLength,E=b[1];ah(p,s.x,s.y,i.x,E+i.y,c.x,c.y,n,w,u.x,u.y,g,x),ah(p,s.x,s.y,r.x,E+r.y,c.x+c.w,c.y,n,w,m.x,u.y,g,x),ah(p,s.x,s.y,o.x,E+o.y,c.x,c.y+c.h,n,w,u.x,m.y,g,x),ah(p,s.x,s.y,l.x,E+l.y,c.x+c.w,c.y+c.h,n,w,m.x,m.y,g,x),oh(e.dynamicLayoutVertexArray,s,v),d.emplaceBack(T,T+1,T+2),d.emplaceBack(T+1,T+2,T+3),f.vertexLength+=4,f.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(b[0]),_!==t.length-1&&S===t[_+1].sectionIndex||e.programConfigurations.populatePaintArrays(p.length,a,a.index,{},h,y&&y[S])}e.placedSymbolArray.emplaceBack(s.x,s.y,m,this.glyphOffsetArray.length-m,g,l,c,s.segment,n?n[0]:0,n?n[1]:0,i[0],i[1],o,0,!1,0,u)}_commitLayoutVertex(e,t,n,i,r){e.emplaceBack(t.x,t.y,n,i,Math.round(r.x),Math.round(r.y))}_addCollisionDebugVertices(e,t,n,i,a){const o=n.segments.prepareSegment(4,n.layoutVertexArray,n.indexArray),s=o.vertexLength,l=a.anchorX,c=a.anchorY;for(let r=0;r<4;r++)n.collisionVertexArray.emplaceBack(0,0,0,0);n.collisionVertexArrayExt.emplaceBack(t,-e.padding,-e.padding),n.collisionVertexArrayExt.emplaceBack(t,e.padding,-e.padding),n.collisionVertexArrayExt.emplaceBack(t,e.padding,e.padding),n.collisionVertexArrayExt.emplaceBack(t,-e.padding,e.padding),this._commitLayoutVertex(n.layoutVertexArray,i,l,c,new r(e.x1,e.y1)),this._commitLayoutVertex(n.layoutVertexArray,i,l,c,new r(e.x2,e.y1)),this._commitLayoutVertex(n.layoutVertexArray,i,l,c,new r(e.x2,e.y2)),this._commitLayoutVertex(n.layoutVertexArray,i,l,c,new r(e.x1,e.y2)),o.vertexLength+=4;const u=n.indexArray;u.emplaceBack(s,s+1),u.emplaceBack(s+1,s+2),u.emplaceBack(s+2,s+3),u.emplaceBack(s+3,s),o.primitiveLength+=4}_addTextDebugCollisionBoxes(e,t,n,i,r,a){for(let o=i;o<r;o++){const i=n.get(o),r=this.getSymbolInstanceTextSize(e,a,t,o);this._addCollisionDebugVertices(i,r,this.textCollisionBox,i.anchorPoint,a)}}_addIconDebugCollisionBoxes(e,t,n,i,r,a){for(let o=i;o<r;o++){const i=n.get(o),r=this.getSymbolInstanceIconSize(e,t,o);this._addCollisionDebugVertices(i,r,this.iconCollisionBox,i.anchorPoint,a)}}generateCollisionDebugBuffers(e,t){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new ch(Ba,yc.members,qa),this.iconCollisionBox=new ch(Ba,yc.members,qa);const n=Tc(this.iconSizeData,e),i=Tc(this.textSizeData,e);for(let r=0;r<this.symbolInstances.length;r++){const a=this.symbolInstances.get(r);this._addTextDebugCollisionBoxes(i,e,t,a.textBoxStartIndex,a.textBoxEndIndex,a),this._addTextDebugCollisionBoxes(i,e,t,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a),this._addIconDebugCollisionBoxes(n,e,t,a.iconBoxStartIndex,a.iconBoxEndIndex,a),this._addIconDebugCollisionBoxes(n,e,t,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex,a)}}getSymbolInstanceTextSize(e,t,n,i){const r=this.text.placedSymbolArray.get(t.rightJustifiedTextSymbolIndex>=0?t.rightJustifiedTextSymbolIndex:t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.leftJustifiedTextSymbolIndex>=0?t.leftJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex>=0?t.verticalPlacedTextSymbolIndex:i),a=Sc(this.textSizeData,e,r)/xc;return this.tilePixelRatio*a}getSymbolInstanceIconSize(e,t,n){const i=this.icon.placedSymbolArray.get(n),r=Sc(this.iconSizeData,e,i);return this.tilePixelRatio*r}_commitDebugCollisionVertexUpdate(e,t,n){e.emplaceBack(t,-n,-n),e.emplaceBack(t,n,-n),e.emplaceBack(t,n,n),e.emplaceBack(t,-n,n)}_updateTextDebugCollisionBoxes(e,t,n,i,r,a){for(let o=i;o<r;o++){const i=n.get(o),r=this.getSymbolInstanceTextSize(e,a,t,o);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,r,i.padding)}}_updateIconDebugCollisionBoxes(e,t,n,i,r){for(let a=i;a<r;a++){const i=n.get(a),r=this.getSymbolInstanceIconSize(e,t,a);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,r,i.padding)}}updateCollisionDebugBuffers(e,t){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const n=Tc(this.iconSizeData,e),i=Tc(this.textSizeData,e);for(let r=0;r<this.symbolInstances.length;r++){const a=this.symbolInstances.get(r);this._updateTextDebugCollisionBoxes(i,e,t,a.textBoxStartIndex,a.textBoxEndIndex,a),this._updateTextDebugCollisionBoxes(i,e,t,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a),this._updateIconDebugCollisionBoxes(n,e,t,a.iconBoxStartIndex,a.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(n,e,t,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,t,n,i,r,a,o,s,l){const c={};for(let u=t;u<n;u++){const t=e.get(u);c.textBox={x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2,padding:t.padding,anchorPointX:t.anchorPointX,anchorPointY:t.anchorPointY},c.textFeatureIndex=t.featureIndex;break}for(let u=i;u<r;u++){const t=e.get(u);c.verticalTextBox={x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2,padding:t.padding,anchorPointX:t.anchorPointX,anchorPointY:t.anchorPointY},c.verticalTextFeatureIndex=t.featureIndex;break}for(let u=a;u<o;u++){const t=e.get(u);c.iconBox={x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2,padding:t.padding,anchorPointX:t.anchorPointX,anchorPointY:t.anchorPointY},c.iconFeatureIndex=t.featureIndex;break}for(let u=s;u<l;u++){const t=e.get(u);c.verticalIconBox={x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2,padding:t.padding,anchorPointX:t.anchorPointX,anchorPointY:t.anchorPointY},c.verticalIconFeatureIndex=t.featureIndex;break}return c}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let t=0;t<this.symbolInstances.length;t++){const n=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,n.textBoxStartIndex,n.textBoxEndIndex,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,t){const n=e.placedSymbolArray.get(t),i=n.vertexStartIndex+4*n.numGlyphs;for(let r=n.vertexStartIndex;r<i;r+=4)e.indexArray.emplaceBack(r,r+1,r+2),e.indexArray.emplaceBack(r+1,r+2,r+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const t=Math.sin(e),n=Math.cos(e),i=[],r=[],a=[];for(let o=0;o<this.symbolInstances.length;++o){a.push(o);const e=this.symbolInstances.get(o);i.push(0|Math.round(t*e.anchorX+n*e.anchorY)),r.push(e.featureIndex)}return a.sort(((e,t)=>i[e]-i[t]||r[t]-r[e])),a}addToSortKeyRanges(e,t){const n=this.sortKeyRanges[this.sortKeyRanges.length-1];n&&n.sortKey===t?n.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const e of this.symbolInstanceIndexes){const t=this.symbolInstances.get(e);this.featureSortOrder.push(t.featureIndex),[t.rightJustifiedTextSymbolIndex,t.centerJustifiedTextSymbolIndex,t.leftJustifiedTextSymbolIndex].forEach(((e,t,n)=>{e>=0&&n.indexOf(e)===t&&this.addIndicesForPlacedSymbol(this.text,e)})),t.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,t.verticalPlacedTextSymbolIndex),t.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,t.placedIconSymbolIndex),t.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,t.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}sr("SymbolBucket",uh,{omit:["layers","collisionBoxArray","features","compareText"]}),uh.MAX_GLYPHS=65535,uh.addDynamicAttributes=oh;const hh=new xa({"symbol-placement":new ma(Fe.layout_symbol["symbol-placement"]),"symbol-spacing":new ma(Fe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ma(Fe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ga(Fe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ma(Fe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ma(Fe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new ma(Fe.layout_symbol["icon-ignore-placement"]),"icon-optional":new ma(Fe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ma(Fe.layout_symbol["icon-rotation-alignment"]),"icon-size":new ga(Fe.layout_symbol["icon-size"]),"icon-text-fit":new ma(Fe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ma(Fe.layout_symbol["icon-text-fit-padding"]),"icon-image":new ga(Fe.layout_symbol["icon-image"]),"icon-rotate":new ga(Fe.layout_symbol["icon-rotate"]),"icon-padding":new ma(Fe.layout_symbol["icon-padding"]),"icon-keep-upright":new ma(Fe.layout_symbol["icon-keep-upright"]),"icon-offset":new ga(Fe.layout_symbol["icon-offset"]),"icon-anchor":new ga(Fe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ma(Fe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ma(Fe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ma(Fe.layout_symbol["text-rotation-alignment"]),"text-field":new ga(Fe.layout_symbol["text-field"]),"text-font":new ga(Fe.layout_symbol["text-font"]),"text-size":new ga(Fe.layout_symbol["text-size"]),"text-max-width":new ga(Fe.layout_symbol["text-max-width"]),"text-line-height":new ga(Fe.layout_symbol["text-line-height"]),"text-letter-spacing":new ga(Fe.layout_symbol["text-letter-spacing"]),"text-justify":new ga(Fe.layout_symbol["text-justify"]),"text-radial-offset":new ga(Fe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ma(Fe.layout_symbol["text-variable-anchor"]),"text-anchor":new ga(Fe.layout_symbol["text-anchor"]),"text-max-angle":new ma(Fe.layout_symbol["text-max-angle"]),"text-writing-mode":new ma(Fe.layout_symbol["text-writing-mode"]),"text-rotate":new ga(Fe.layout_symbol["text-rotate"]),"text-padding":new ma(Fe.layout_symbol["text-padding"]),"text-keep-upright":new ma(Fe.layout_symbol["text-keep-upright"]),"text-transform":new ga(Fe.layout_symbol["text-transform"]),"text-offset":new ga(Fe.layout_symbol["text-offset"]),"text-allow-overlap":new ma(Fe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new ma(Fe.layout_symbol["text-ignore-placement"]),"text-optional":new ma(Fe.layout_symbol["text-optional"])});var dh={paint:new xa({"icon-opacity":new ga(Fe.paint_symbol["icon-opacity"]),"icon-color":new ga(Fe.paint_symbol["icon-color"]),"icon-halo-color":new ga(Fe.paint_symbol["icon-halo-color"]),"icon-halo-width":new ga(Fe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ga(Fe.paint_symbol["icon-halo-blur"]),"icon-translate":new ma(Fe.paint_symbol["icon-translate"]),"icon-translate-anchor":new ma(Fe.paint_symbol["icon-translate-anchor"]),"text-opacity":new ga(Fe.paint_symbol["text-opacity"]),"text-color":new ga(Fe.paint_symbol["text-color"],{runtimeType:Ye,getOverride:e=>e.textColor,hasOverride:e=>!!e.textColor}),"text-halo-color":new ga(Fe.paint_symbol["text-halo-color"]),"text-halo-width":new ga(Fe.paint_symbol["text-halo-width"]),"text-halo-blur":new ga(Fe.paint_symbol["text-halo-blur"]),"text-translate":new ma(Fe.paint_symbol["text-translate"]),"text-translate-anchor":new ma(Fe.paint_symbol["text-translate-anchor"])}),layout:hh};class ph{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:qe,this.defaultValue=e}evaluate(e){if(e.formattedSection){const t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}sr("FormatSectionOverride",ph,{omit:["defaultValue"]});class fh extends Fo{constructor(e){super(e,dh)}recalculate(e,t){if(super.recalculate(e,t),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){const e=this.layout.get("text-writing-mode");if(e){const t=[];for(const n of e)t.indexOf(n)<0&&t.push(n);this.layout._values["text-writing-mode"]=t}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,t,n,i){const r=this.layout.get(e).evaluate(t,{},n,i),a=this._unevaluatedLayout._values[e];return a.isDataDriven()||ci(a.value)||!r?r:function(e,t){return t.replace(/{([^{}]+)}/g,((t,n)=>n in e?String(e[n]):""))}(t.properties,r)}createBucket(e){return new uh(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of dh.paint.overridableProperties){if(!fh.hasPaintOverride(this.layout,e))continue;const t=this.paint.get(e),n=new ph(t),i=new li(n,t.property.specification);let r=null;r="constant"===t.value.kind||"source"===t.value.kind?new hi("source",i):new di("composite",i,t.value.zoomStops,t.value._interpolationType),this.paint._values[e]=new pa(t.property,r,t.parameters)}}_handleOverridablePaintPropertyUpdate(e,t,n){return!(!this.layout||t.isDataDriven()||n.isDataDriven())&&fh.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,t){const n=e.get("text-field"),i=dh.paint.properties[t];let r=!1;const a=e=>{for(const t of e)if(i.overrides&&i.overrides.hasOverride(t))return void(r=!0)};if("constant"===n.value.kind&&n.value.value instanceof pt)a(n.value.value.sections);else if("source"===n.value.kind){const e=t=>{r||(t instanceof _t&&vt(t.value)===et?a(t.value.sections):t instanceof St?a(t.sections):t.eachChild(e))},t=n.value;t._styleExpression&&e(t._styleExpression.expression)}return r}getProgramConfiguration(e){return new Po(this,e)}}var mh={paint:new xa({"background-color":new ma(Fe.paint_background["background-color"]),"background-pattern":new ya(Fe.paint_background["background-pattern"]),"background-opacity":new ma(Fe.paint_background["background-opacity"])})},gh={paint:new xa({"raster-opacity":new ma(Fe.paint_raster["raster-opacity"]),"raster-hue-rotate":new ma(Fe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ma(Fe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ma(Fe.paint_raster["raster-brightness-max"]),"raster-saturation":new ma(Fe.paint_raster["raster-saturation"]),"raster-contrast":new ma(Fe.paint_raster["raster-contrast"]),"raster-resampling":new ma(Fe.paint_raster["raster-resampling"]),"raster-fade-duration":new ma(Fe.paint_raster["raster-fade-duration"])})};class vh extends Fo{constructor(e){super(e,{}),this.implementation=e}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var yh={paint:new xa({"sky-type":new ma(Fe.paint_sky["sky-type"]),"sky-atmosphere-sun":new ma(Fe.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new ma(Fe.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new ma(Fe.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new ma(Fe.paint_sky["sky-gradient-radius"]),"sky-gradient":new _a(Fe.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new ma(Fe.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new ma(Fe.paint_sky["sky-atmosphere-color"]),"sky-opacity":new ma(Fe.paint_sky["sky-opacity"])})};function _h(e,t,n){const i=xs(0,0,1),r=Is(Ls());return function(e,t,n){n*=.5;var i=t[0],r=t[1],a=t[2],o=t[3],s=Math.sin(n),l=Math.cos(n);e[0]=i*l-a*s,e[1]=r*l+o*s,e[2]=a*l+i*s,e[3]=o*l-r*s}(r,r,n?-u(e)+Math.PI:u(e)),Rs(r,r,-u(t)),Es(i,i,r),Ts(i,i)}const xh={circle:class extends Fo{constructor(e){super(e,ds)}createBucket(e){return new $o(e)}queryRadius(e){const t=e;return ss("circle-radius",this,t)+ss("circle-stroke-width",this,t)+ls(this.paint.get("circle-translate"))}queryIntersectsFeature(e,t,n,i,r,a,o,s){const l="map"===this.paint.get("circle-pitch-alignment");if(l&&e.queryGeometry.isAboveHorizon)return!1;const c=us(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),a.angle,e.pixelToTileUnitsFactor),u=this.paint.get("circle-radius").evaluate(t,n)+this.paint.get("circle-stroke-width").evaluate(t,n),h=l?u*e.pixelToTileUnitsFactor:u;for(const d of i)for(const t of d){const n=t.add(c),i=s&&a.elevation?a.elevation.exaggeration()*s.getElevationAt(n.x,n.y,!0):0,r=l?n:zs(n,i,o),u=l?e.tilespaceRays.map((e=>Bs(e,i))):e.queryGeometry.screenGeometry;let d=h;const p=Ps([],[t.x,t.y,i,1],o);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?d*=p[3]/a.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(d*=a.cameraToCenterDistance/p[3]),Yo(u,r,d))return!0}return!1}getProgramIds(){return["circle"]}getProgramConfiguration(e){return new Po(this,e)}},heatmap:class extends Fo{createBucket(e){return new Fs(e)}constructor(e){super(e,Hs),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"heatmap-color"===e&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Ws({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(e){return new Po(this,e)}},hillshade:class extends Fo{constructor(e){super(e,qs)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getProgramConfiguration(e){return new Po(this,e)}},fill:class extends Fo{constructor(e){super(e,Rl)}getProgramIds(){const e=this.paint.get("fill-pattern"),t=e&&e.constantOr(1),n=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getProgramConfiguration(e){return new Po(this,e)}recalculate(e,t){super.recalculate(e,t);const n=this.paint._values["fill-outline-color"];"constant"===n.value.kind&&void 0===n.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new Ll(e)}queryRadius(){return ls(this.paint.get("fill-translate"))}queryIntersectsFeature(e,t,n,i,r,a){return!e.queryGeometry.isAboveHorizon&&Jo(cs(e.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),a.angle,e.pixelToTileUnitsFactor),i)}isTileClipped(){return!0}},"fill-extrusion":class extends Fo{constructor(e){super(e,Kl)}createBucket(e){return new Yl(e)}queryRadius(){return ls(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(e){return new Po(this,e)}queryIntersectsFeature(e,t,n,i,a,o,s,l,c){const u=us(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),h=this.paint.get("fill-extrusion-height").evaluate(t,n),d=this.paint.get("fill-extrusion-base").evaluate(t,n),p=[0,0],f=l&&o.elevation,m=o.elevation?o.elevation.exaggeration():1;if(f){const t=e.tile.getBucket(this).centroidVertexArray,n=c+1;if(n<t.length){const e=t.get(n);p[0]=e.a_centroid_pos0,p[1]=e.a_centroid_pos1}}if(0===p[0]&&1===p[1])return!1;const g=function(e,t,n,i,a,o,s,l,c){return o?function(e,t,n,i,r,a,o,s,l){const c=[],u=[],h=[0,0,0,1];for(const d of e){const e=[],p=[];for(const c of d){const u=c.x+i.x,d=c.y+i.y,f=nc(u,d,t,n,a,o,s,l);h[0]=u,h[1]=d,h[2]=f.base,h[3]=1,Ps(h,h,r),h[3]=Math.max(h[3],1e-5);const m=tc([h[0]/h[3],h[1]/h[3],h[2]/h[3]]);h[0]=u,h[1]=d,h[2]=f.top,h[3]=1,Ps(h,h,r),h[3]=Math.max(h[3],1e-5);const g=tc([h[0]/h[3],h[1]/h[3],h[2]/h[3]]);e.push(m),p.push(g)}c.push(e),u.push(p)}return[c,u]}(e,t,n,i,a,o,s,l,c):function(e,t,n,i,a){const o=[],s=[],l=a[8]*t,c=a[9]*t,u=a[10]*t,h=a[11]*t,d=a[8]*n,p=a[9]*n,f=a[10]*n,m=a[11]*n;for(const g of e){const e=[],t=[];for(const n of g){const o=n.x+i.x,s=n.y+i.y,g=a[0]*o+a[4]*s+a[12],v=a[1]*o+a[5]*s+a[13],y=a[2]*o+a[6]*s+a[14],_=a[3]*o+a[7]*s+a[15],x=g+l,b=v+c,w=y+u,S=Math.max(_+h,1e-5),T=g+d,E=v+p,M=y+f,k=Math.max(_+m,1e-5),A=new r(x/S,b/S);A.z=w/S,e.push(A);const C=new r(T/k,E/k);C.z=M/k,t.push(C)}o.push(e),s.push(t)}return[o,s]}(e,t,n,i,a)}(i,d,h,u,s,f?l:null,p,m,o.center.lat),v=e.queryGeometry;return function(e,t,n){let i=1/0;Jo(n,t)&&(i=ec(n,t[0]));for(let r=0;r<t.length;r++){const a=t[r],o=e[r];for(let e=0;e<a.length-1;e++){const t=a[e],r=[t,a[e+1],o[e+1],o[e],t];Xo(n,r)&&(i=Math.min(i,ec(n,r)))}}return i!==1/0&&i}(g[0],g[1],v.isPointQuery()?v.screenBounds:v.screenGeometry)}},line:class extends Fo{constructor(e){super(e,hc),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(e){if("line-gradient"===e){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof tn,this.gradientVersion=(this.gradientVersion+1)%s}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,t){super.recalculate(e,t),this.paint._values["line-floorwidth"]=dc.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new cc(e)}getProgramIds(){const e=this.paint.get("line-dasharray"),t=this.paint.get("line-pattern").constantOr(1),n=this.paint.get("line-gradient");return[t?"linePattern":e?"lineSDF":n?"lineGradient":"line"]}getProgramConfiguration(e){return new Po(this,e)}queryRadius(e){const t=e,n=pc(ss("line-width",this,t),ss("line-gap-width",this,t)),i=ss("line-offset",this,t);return n/2+Math.abs(i)+ls(this.paint.get("line-translate"))}queryIntersectsFeature(e,t,n,i,a,o){if(e.queryGeometry.isAboveHorizon)return!1;const s=cs(e.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),l=e.pixelToTileUnitsFactor/2*pc(this.paint.get("line-width").evaluate(t,n),this.paint.get("line-gap-width").evaluate(t,n)),c=this.paint.get("line-offset").evaluate(t,n);return c&&(i=function(e,t){const n=[],i=new r(0,0);for(let r=0;r<e.length;r++){const a=e[r],o=[];for(let e=0;e<a.length;e++){const n=a[e-1],r=a[e],s=a[e+1],l=0===e?i:r.sub(n)._unit()._perp(),c=e===a.length-1?i:s.sub(r)._unit()._perp(),u=l._add(c)._unit();u._mult(1/(u.x*c.x+u.y*c.y)),o.push(u._mult(t)._add(r))}n.push(o)}return n}(i,c*e.pixelToTileUnitsFactor)),function(e,t,n){for(let i=0;i<t.length;i++){const r=t[i];if(e.length>=3)for(let t=0;t<r.length;t++)if(rs(e,r[t]))return!0;if(Ko(e,r,n))return!0}return!1}(s,i,l)}isTileClipped(){return!0}},symbol:fh,background:class extends Fo{constructor(e){super(e,mh)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Fo{constructor(e){super(e,gh)}getProgramIds(){return["raster"]}},sky:class extends Fo{constructor(e){super(e,yh),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"sky-gradient"===e?this._updateColorRamp():"sky-atmosphere-sun"!==e&&"sky-atmosphere-halo-color"!==e&&"sky-atmosphere-color"!==e&&"sky-atmosphere-sun-intensity"!==e||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Ws({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(e){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=e.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}}getCenter(e,t){const n=this.paint.get("sky-type");if("atmosphere"===n){const n=this.paint.get("sky-atmosphere-sun"),i=!n,r=e.style.light,a=r.properties.get("position");return i&&"viewport"===r.properties.get("anchor")&&L("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),i?_h(a.azimuthal,90-a.polar,t):_h(n[0],90-n[1],t)}if("gradient"===n){const e=this.paint.get("sky-gradient-center");return _h(e[0],90-e[1],t)}}is3D(){return!1}isSky(){return!0}markSkyboxValid(e){this._skyboxInvalidated=!1,this._lightPosition=e.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const e=this.paint.get("sky-type");return"atmosphere"===e?["skyboxCapture","skybox"]:"gradient"===e?["skyboxGradient"]:null}}},{HTMLImageElement:bh,HTMLCanvasElement:wh,HTMLVideoElement:Sh,ImageData:Th,ImageBitmap:Eh}=o;class Mh{constructor(e,t,n,i){this.context=e,this.format=n,this.texture=e.gl.createTexture(),this.update(t,i)}update(e,t,n){const{width:i,height:r}=e,a=!(this.size&&this.size[0]===i&&this.size[1]===r||n),{context:o}=this,{gl:s}=o;if(this.useMipmap=Boolean(t&&t.useMipmap),s.bindTexture(s.TEXTURE_2D,this.texture),o.pixelStoreUnpackFlipY.set(!1),o.pixelStoreUnpack.set(1),o.pixelStoreUnpackPremultiplyAlpha.set(this.format===s.RGBA&&(!t||!1!==t.premultiply)),a)this.size=[i,r],e instanceof bh||e instanceof wh||e instanceof Sh||e instanceof Th||Eh&&e instanceof Eh?s.texImage2D(s.TEXTURE_2D,0,this.format,this.format,s.UNSIGNED_BYTE,e):s.texImage2D(s.TEXTURE_2D,0,this.format,i,r,0,this.format,s.UNSIGNED_BYTE,e.data);else{const{x:t,y:a}=n||{x:0,y:0};e instanceof bh||e instanceof wh||e instanceof Sh||e instanceof Th||Eh&&e instanceof Eh?s.texSubImage2D(s.TEXTURE_2D,0,t,a,s.RGBA,s.UNSIGNED_BYTE,e):s.texSubImage2D(s.TEXTURE_2D,0,t,a,i,r,s.RGBA,s.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&s.generateMipmap(s.TEXTURE_2D)}bind(e,t,n){const{context:i}=this,{gl:r}=i;r.bindTexture(r.TEXTURE_2D,this.texture),n!==r.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(n=r.LINEAR),e!==this.filter&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,n||e),this.filter=e),t!==this.wrap&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,t),this.wrap=t)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class kh{constructor(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Ch?new Ch(e.lng,e.lat):Ch.convert(e),this}setSouthWest(e){return this._sw=e instanceof Ch?new Ch(e.lng,e.lat):Ch.convert(e),this}extend(e){const t=this._sw,n=this._ne;let i,r;if(e instanceof Ch)i=e,r=e;else{if(!(e instanceof kh))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(kh.convert(e)):this.extend(Ch.convert(e)):this;if(i=e._sw,r=e._ne,!i||!r)return this}return t||n?(t.lng=Math.min(i.lng,t.lng),t.lat=Math.min(i.lat,t.lat),n.lng=Math.max(r.lng,n.lng),n.lat=Math.max(r.lat,n.lat)):(this._sw=new Ch(i.lng,i.lat),this._ne=new Ch(r.lng,r.lat)),this}getCenter(){return new Ch((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Ch(this.getWest(),this.getNorth())}getSouthEast(){return new Ch(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:t,lat:n}=Ch.convert(e);let i=this._sw.lng<=t&&t<=this._ne.lng;return this._sw.lng>this._ne.lng&&(i=this._sw.lng>=t&&t>=this._ne.lng),this._sw.lat<=n&&n<=this._ne.lat&&i}static convert(e){return!e||e instanceof kh?e:new kh(e)}}const Ah=6371008.8;class Ch{constructor(e,t){if(isNaN(e)||isNaN(t))throw new Error(`Invalid LngLat object: (${e}, ${t})`);if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ch(g(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const t=Math.PI/180,n=this.lat*t,i=e.lat*t,r=Math.sin(n)*Math.sin(i)+Math.cos(n)*Math.cos(i)*Math.cos((e.lng-this.lng)*t);return Ah*Math.acos(Math.min(r,1))}toBounds(e=0){const t=360*e/40075017,n=t/Math.cos(Math.PI/180*this.lat);return new kh(new Ch(this.lng-n,this.lat-t),new Ch(this.lng+n,this.lat+t))}static convert(e){if(e instanceof Ch)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new Ch(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new Ch(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Ph=2*Math.PI*Ah;function Lh(e){return Ph*Math.cos(e*Math.PI/180)}function Ih(e){return(180+e)/360}function Rh(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function zh(e,t){return e/Lh(t)}function Dh(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function Oh(e,t){return e*Lh(Dh(t))}class Bh{constructor(e,t,n=0){this.x=+e,this.y=+t,this.z=+n}static fromLngLat(e,t=0){const n=Ch.convert(e);return new Bh(Ih(n.lng),Rh(n.lat),zh(t,n.lat))}toLngLat(){return new Ch(360*this.x-180,Dh(this.y))}toAltitude(){return Oh(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Ph*(e=Dh(this.y),1/Math.cos(e*Math.PI/180));var e}}class Fh{constructor(e,t){this.width=e,this.height=t,this.nextRow=0,this.image=new js({width:e,height:t}),this.positions={},this.uploaded=!1}getDash(e,t){const n=this.getKey(e,t);return this.positions[n]}trim(){const e=this.width,t=this.height=S(this.nextRow);this.image.resize({width:e,height:t})}getKey(e,t){return e.join(",")+t}getDashRanges(e,t,n){const i=[];let r=e.length%2==1?-e[e.length-1]*n:0,a=e[0]*n,o=!0;i.push({left:r,right:a,isDash:o,zeroLength:0===e[0]});let s=e[0];for(let l=1;l<e.length;l++){o=!o;const t=e[l];r=s*n,s+=t,a=s*n,i.push({left:r,right:a,isDash:o,zeroLength:0===t})}return i}addRoundDash(e,t,n){const i=t/2;for(let r=-n;r<=n;r++){const t=this.width*(this.nextRow+n+r);let a=0,o=e[a];for(let s=0;s<this.width;s++){s/o.right>1&&(o=e[++a]);const l=Math.abs(s-o.left),c=Math.abs(s-o.right),u=Math.min(l,c);let h;const d=r/n*(i+1);if(o.isDash){const e=i-Math.abs(d);h=Math.sqrt(u*u+e*e)}else h=i-Math.sqrt(u*u+d*d);this.image.data[t+s]=Math.max(0,Math.min(255,h+128))}}}addRegularDash(e,t){for(let s=e.length-1;s>=0;--s){const t=e[s],n=e[s+1];t.zeroLength?e.splice(s,1):n&&n.isDash===t.isDash&&(n.left=t.left,e.splice(s,1))}const n=e[0],i=e[e.length-1];n.isDash===i.isDash&&(n.left=i.left-this.width,i.right=n.right+this.width);const r=this.width*this.nextRow;let a=0,o=e[a];for(let s=0;s<this.width;s++){s/o.right>1&&(o=e[++a]);const n=Math.abs(s-o.left),i=Math.abs(s-o.right),l=Math.min(n,i);this.image.data[r+s]=Math.max(0,Math.min(255,(o.isDash?l:-l)+t+128))}}addDash(e,t){const n=this.getKey(e,t);if(this.positions[n])return this.positions[n];const i="round"===t,r=i?7:0,a=2*r+1;if(this.nextRow+a>this.height)return L("LineAtlas out of space"),null;0===e.length&&e.push(1);let o=0;for(let c=0;c<e.length;c++)e[c]<0&&(L("Negative value is found in line dasharray, replacing values with 0"),e[c]=0),o+=e[c];if(0!==o){const n=this.width/o,a=this.getDashRanges(e,this.width,n);i?this.addRoundDash(a,n,r):this.addRegularDash(a,"square"===t?.5*n:0)}const s=this.nextRow+r;this.nextRow+=a;const l={tl:[s,r],br:[o,0]};return this.positions[n]=l,l}}sr("LineAtlas",Fh);class Nh{constructor(e){this._callback=e,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))}remove(){delete this._channel,this._callback=()=>{}}}const Uh=o.performance;function Vh(e){const t=e?e.url.toString():void 0;return Uh.getEntriesByName(t)}class jh{constructor(){this.tasks={},this.taskQueue=[],E(["process"],this),this.invoker=new Nh(this.process),this.nextId=0}add(e,t){const n=this.nextId++,i=function({type:e,isSymbolTile:t,zoom:n}){return n=n||0,"message"===e?0:"maybePrepare"!==e||t?"parseTile"!==e||t?"parseTile"===e&&t?300-n:"maybePrepare"===e&&t?400-n:500:200-n:100-n}(t);if(0===i){z();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[n]={fn:e,metadata:t,priority:i,id:n},this.taskQueue.push(n),this.invoker.trigger(),{cancel:()=>{delete this.tasks[n]}}}process(){z();try{if(this.taskQueue=this.taskQueue.filter((e=>!!this.tasks[e])),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const t=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!t)return;t.fn()}finally{}}pick(){let e=null,t=1/0;for(let i=0;i<this.taskQueue.length;i++){const n=this.tasks[this.taskQueue[i]];n.priority<t&&(t=n.priority,e=i)}if(null===e)return null;const n=this.taskQueue[e];return this.taskQueue.splice(e,1),n}remove(){this.invoker.remove()}}function Gh(e,t,n){var i=2*Math.PI*6378137/256/Math.pow(2,n);return[e*i-2*Math.PI*6378137/2,t*i-2*Math.PI*6378137/2]}class Hh{constructor(e,t,n){this.z=e,this.x=t,this.y=n,this.key=Zh(0,e,e,t,n)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,t){const n=(r=this.y,a=this.z,o=Gh(256*(i=this.x),256*(r=Math.pow(2,a)-r-1),a),s=Gh(256*(i+1),256*(r+1),a),o[0]+","+o[1]+","+s[0]+","+s[1]);var i,r,a,o,s;const l=function(e,t,n){let i,r="";for(let a=e;a>0;a--)i=1<<a-1,r+=(t&i?1:0)+(n&i?2:0);return r}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===t?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",l).replace("{bbox-epsg-3857}",n)}getTilePoint(e){const t=Math.pow(2,this.z);return new r((e.x*t-this.x)*jo,(e.y*t-this.y)*jo)}getTileVec3(e){const t=Math.pow(2,this.z);return xs((e.x*t-this.x)*jo,(e.y*t-this.y)*jo,Oh(e.z,e.y))}toString(){return`${this.z}/${this.x}/${this.y}`}}class Wh{constructor(e,t){this.wrap=e,this.canonical=t,this.key=Zh(e,t.z,t.z,t.x,t.y)}}class qh{constructor(e,t,n,i,r){this.overscaledZ=e,this.wrap=t,this.canonical=new Hh(n,+i,+r),this.key=0===t&&e===n?this.canonical.key:Zh(t,e,n,i,r)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const t=this.canonical.z-e;return e>this.canonical.z?new qh(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new qh(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)}calculateScaledKey(e,t=!0){if(this.overscaledZ===e&&t)return this.key;if(e>this.canonical.z)return Zh(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y);{const n=this.canonical.z-e;return Zh(this.wrap*+t,e,e,this.canonical.x>>n,this.canonical.y>>n)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const t=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t}children(e){if(this.overscaledZ>=e)return[new qh(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const t=this.canonical.z+1,n=2*this.canonical.x,i=2*this.canonical.y;return[new qh(t,this.wrap,t,n,i),new qh(t,this.wrap,t,n+1,i),new qh(t,this.wrap,t,n,i+1),new qh(t,this.wrap,t,n+1,i+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new qh(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new qh(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Wh(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new Bh(e.x-this.wrap,e.y))}getTileVec3(e){return this.canonical.getTileVec3(new Bh(e.x-this.wrap,e.y,e.z))}}function Zh(e,t,n,i,r){const a=1<<Math.min(n,22);let o=a*(r%a)+i%a;return e&&n<22&&(o+=a*a*((e<0?-2*e-1:2*e)%(1<<2*(22-n)))),16*(32*o+n)+(t-n)}sr("CanonicalTileID",Hh),sr("OverscaledTileID",qh,{omit:["projMatrix"]});class $h{constructor(e){this._stringToNumber={},this._numberToString=[];for(let t=0;t<e.length;t++){const n=e[t];this._stringToNumber[n]=t,this._numberToString[t]=n}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class Xh{constructor(e,t,n,i,r){this.type="Feature",this._vectorTileFeature=e,e._z=t,e._x=n,e._y=i,this.properties=e.properties,this.id=r}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const t in this)"_geometry"!==t&&"_vectorTileFeature"!==t&&(e[t]=this[t]);return e}}var Yh=Ea([{name:"a_pos",type:"Int16",components:2}]);class Jh{constructor(e,t,n){this.tileID=e,this.uid=b(),this.uses=0,this.tileSize=t,this.tileZoom=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const t=e+this.timeAdded;t<j.now()||this.fadeEndTime&&t<this.fadeEndTime||(this.fadeEndTime=t)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}loadVectorData(e,t,n){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(e,t){const n={};if(!t)return n;for(const i of e){const e=i.layerIds.map((e=>t.getLayer(e))).filter(Boolean);if(0!==e.length){i.layers=e,i.stateDependentLayerIds&&(i.stateDependentLayers=i.stateDependentLayerIds.map((t=>e.filter((e=>e.id===t))[0])));for(const t of e)n[t.id]=i}}return n}(e.buckets,t.style),this.hasSymbolBuckets=!1;for(const e in this.buckets){const t=this.buckets[e];if(t instanceof uh){if(this.hasSymbolBuckets=!0,!n)break;t.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const e in this.buckets){const t=this.buckets[e];if(t instanceof uh&&t.hasRTLText){this.hasRTLText=!0,aa.isLoading()||aa.isLoaded()||"deferred"!==ia()||ra();break}}this.queryPadding=0;for(const e in this.buckets){const n=this.buckets[e];this.queryPadding=Math.max(this.queryPadding,t.style.getLayer(e).queryRadius(n))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new Ya}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const n in this.buckets){const t=this.buckets[n];t.uploadPending()&&t.upload(e)}const t=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Mh(e,this.imageAtlas.image,t.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Mh(e,this.glyphAtlasImage,t.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Mh(e,this.lineAtlas.image,t.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,t,n,i,r,a,o,s){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:i,pixelPosMatrix:o,transform:a,params:r},e,t,n):{}}querySourceFeatures(e,t){const n=this.latestFeatureIndex;if(!n||!n.rawTileData)return;const i=n.loadVTLayers(),r=t?t.sourceLayer:"",a=i._geojsonTileLayer||i[r];if(!a)return;const o=Ti(t&&t.filter),{z:s,x:l,y:c}=this.tileID.canonical,u={z:s,x:l,y:c};for(let h=0;h<a.length;h++){const t=a.feature(h);if(o.needGeometry){const e=qo(t,!0);if(!o.filter(new oa(this.tileID.overscaledZ),e,this.tileID.canonical))continue}else if(!o.filter(new oa(this.tileID.overscaledZ),t))continue;const i=n.getId(t,r),d=new Xh(t,s,l,c,i);d.tile=u,e.push(d)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const t=this.expirationTime;if(e.cacheControl){const t=D(e.cacheControl);t["max-age"]&&(this.expirationTime=Date.now()+1e3*t["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const e=Date.now();let n=!1;if(this.expirationTime>e)n=!1;else if(t)if(this.expirationTime<t)n=!0;else{const i=this.expirationTime-t;i?this.expirationTime=e+Math.max(i,3e4):n=!0}else n=!0;n?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,t){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(e).length)return;const n=this.latestFeatureIndex.loadVTLayers();for(const i in this.buckets){if(!t.style.hasLayer(i))continue;const r=this.buckets[i],a=r.layers[0].sourceLayer||"_geojsonTileLayer",o=n[a],s=e[a];if(!o||!s||0===Object.keys(s).length)continue;r.update(s,o,this.imageAtlas&&this.imageAtlas.patternPositions||{});const l=t&&t.style&&t.style.getLayer(i);l&&(this.queryPadding=Math.max(this.queryPadding,l.queryRadius(r)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<j.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=j.now()+e}setDependencies(e,t){const n={};for(const i of t)n[i]=!0;this.dependencies[e]=n}hasDependency(e,t){for(const n of e){const e=this.dependencies[n];if(e)for(const n of t)if(e[n])return!0}return!1}clearQueryDebugViz(){}}class Kh{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,t,n){const i=String(t);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][i]=this.stateChanges[e][i]||{},_(this.stateChanges[e][i],n),null===this.deletedStates[e]){this.deletedStates[e]={};for(const t in this.state[e])t!==i&&(this.deletedStates[e][t]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][i]){this.deletedStates[e][i]={};for(const t in this.state[e][i])n[t]||(this.deletedStates[e][i][t]=null)}else for(const r in n)this.deletedStates[e]&&this.deletedStates[e][i]&&null===this.deletedStates[e][i][r]&&delete this.deletedStates[e][i][r]}removeFeatureState(e,t,n){if(null===this.deletedStates[e])return;const i=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},n&&void 0!==t)null!==this.deletedStates[e][i]&&(this.deletedStates[e][i]=this.deletedStates[e][i]||{},this.deletedStates[e][i][n]=null);else if(void 0!==t)if(this.stateChanges[e]&&this.stateChanges[e][i])for(n in this.deletedStates[e][i]={},this.stateChanges[e][i])this.deletedStates[e][i][n]=null;else this.deletedStates[e][i]=null;else this.deletedStates[e]=null}getState(e,t){const n=String(t),i=_({},(this.state[e]||{})[n],(this.stateChanges[e]||{})[n]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const n=this.deletedStates[e][t];if(null===n)return{};for(const e in n)delete i[e]}return i}initializeTileState(e,t){e.setFeatureState(this.state,t)}coalesceChanges(e,t){const n={};for(const i in this.stateChanges){this.state[i]=this.state[i]||{};const e={};for(const t in this.stateChanges[i])this.state[i][t]||(this.state[i][t]={}),_(this.state[i][t],this.stateChanges[i][t]),e[t]=this.state[i][t];n[i]=e}for(const i in this.deletedStates){this.state[i]=this.state[i]||{};const e={};if(null===this.deletedStates[i])for(const t in this.state[i])e[t]={},this.state[i][t]={};else for(const t in this.deletedStates[i]){if(null===this.deletedStates[i][t])this.state[i][t]={};else for(const e of Object.keys(this.deletedStates[i][t]))delete this.state[i][t][e];e[t]=this.state[i][t]}n[i]=n[i]||{},_(n[i],e)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(n).length)for(const i in e)e[i].setFeatureState(n,t)}}class Qh{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,t){const n=this.toIdx(e,t);return{min:this.minimums[n],max:this.maximums[n]}}isLeaf(e,t){return this.leaves[this.toIdx(e,t)]}toIdx(e,t){return t*this.size+e}}function ed(e,t,n,i){let r=0,a=Number.MAX_VALUE;for(let o=0;o<3;o++)if(Math.abs(i[o])<1e-15){if(n[o]<e[o]||n[o]>t[o])return null}else{const s=1/i[o];let l=(e[o]-n[o])*s,c=(t[o]-n[o])*s;if(l>c){const e=l;l=c,c=e}if(l>r&&(r=l),c<a&&(a=c),r>a)return null}return r}function td(e,t,n,i,r,a,o,s,l,c,u){const h=i-e,d=r-t,p=a-n,f=o-e,m=s-t,g=l-n,v=u[1]*g-u[2]*m,y=u[2]*f-u[0]*g,_=u[0]*m-u[1]*f,x=h*v+d*y+p*_;if(Math.abs(x)<1e-15)return null;const b=1/x,w=c[0]-e,S=c[1]-t,T=c[2]-n,E=(w*v+S*y+T*_)*b;if(E<0||E>1)return null;const M=S*p-T*d,k=T*h-w*p,A=w*d-S*h,C=(u[0]*M+u[1]*k+u[2]*A)*b;return C<0||E+C>1?null:(f*M+m*k+g*A)*b}function nd(e,t,n){return(e-t)/(n-t)}function id(e,t,n,i,r,a,o,s,l){const c=1<<n,u=a-i,h=o-r,d=(e+1)/c*u+i,p=(t+0)/c*h+r,f=(t+1)/c*h+r;s[0]=(e+0)/c*u+i,s[1]=p,l[0]=d,l[1]=f}class rd{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const t=function(e){const t=Math.ceil(Math.log2(e.dim/8)),n=[];let i=Math.ceil(Math.pow(2,t));const r=1/i,a=(e,t,n,i,r)=>{const a=i?1:0,o=(e+1)*n-a,s=t*n,l=(t+1)*n-a;r[0]=e*n,r[1]=s,r[2]=o,r[3]=l};let o=new Qh(i);const s=[];for(let l=0;l<i*i;l++){a(l%i,Math.floor(l/i),r,!1,s);const t=od(s[0],s[1],e),n=od(s[2],s[1],e),c=od(s[2],s[3],e),u=od(s[0],s[3],e);o.minimums.push(Math.min(t,n,c,u)),o.maximums.push(Math.max(t,n,c,u)),o.leaves.push(1)}for(n.push(o),i/=2;i>=1;i/=2){const e=n[n.length-1];o=new Qh(i);for(let t=0;t<i*i;t++){a(t%i,Math.floor(t/i),2,!0,s);const n=e.getElevation(s[0],s[1]),r=e.getElevation(s[2],s[1]),l=e.getElevation(s[2],s[3]),c=e.getElevation(s[0],s[3]),u=e.isLeaf(s[0],s[1]),h=e.isLeaf(s[2],s[1]),d=e.isLeaf(s[2],s[3]),p=e.isLeaf(s[0],s[3]),f=Math.min(n.min,r.min,l.min,c.min),m=Math.max(n.max,r.max,l.max,c.max),g=u&&h&&d&&p;o.maximums.push(m),o.minimums.push(f),o.leaves.push(m-f<=5&&g?1:0)}n.push(o)}return n}(this.dem),n=t.length-1,i=t[n];this._addNode(i.minimums[0],i.maximums[0],i.leaves[0]),this._construct(t,0,0,n,0)}raycastRoot(e,t,n,i,r,a,o=1){return ed([e,t,-100],[n,i,this.maximums[0]*o],r,a)}raycast(e,t,n,i,r,a,o=1){if(!this.nodeCount)return null;const s=this.raycastRoot(e,t,n,i,r,a,o);if(null==s)return null;const l=[],c=[],u=[],h=[],d=[{idx:0,t:s,nodex:0,nodey:0,depth:0}];for(;d.length>0;){const{idx:s,t:p,nodex:f,nodey:m,depth:g}=d.pop();if(this.leaves[s]){id(f,m,g,e,t,n,i,u,h);const s=1<<g,l=(f+0)/s,c=(f+1)/s,d=(m+0)/s,v=(m+1)/s,y=od(l,d,this.dem)*o,_=od(c,d,this.dem)*o,x=od(c,v,this.dem)*o,b=od(l,v,this.dem)*o,w=td(u[0],u[1],y,h[0],u[1],_,h[0],h[1],x,r,a),S=td(h[0],h[1],x,u[0],h[1],b,u[0],u[1],y,r,a),T=Math.min(null!==w?w:Number.MAX_VALUE,null!==S?S:Number.MAX_VALUE);if(T!==Number.MAX_VALUE)return T;{const e=Ss([],r,a,p);if(ad(y,_,b,x,nd(e[0],u[0],h[0]),nd(e[1],u[1],h[1]))>=e[2])return p}continue}let v=0;for(let d=0;d<this._siblingOffset.length;d++){id((f<<1)+this._siblingOffset[d][0],(m<<1)+this._siblingOffset[d][1],g+1,e,t,n,i,u,h),u[2]=-100,h[2]=this.maximums[this.childOffsets[s]+d]*o;const p=ed(u,h,r,a);if(null!=p){const e=p;l[d]=e;let t=!1;for(let n=0;n<v&&!t;n++)e>=l[c[n]]&&(c.splice(n,0,d),t=!0);t||(c[v]=d),v++}}for(let e=0;e<v;e++){const t=c[e];d.push({idx:this.childOffsets[s]+t,t:l[t],nodex:(f<<1)+this._siblingOffset[t][0],nodey:(m<<1)+this._siblingOffset[t][1],depth:g+1})}}return null}_addNode(e,t,n){return this.minimums.push(e),this.maximums.push(t),this.leaves.push(n),this.childOffsets.push(0),this.nodeCount++}_construct(e,t,n,i,r){if(1===e[i].isLeaf(t,n))return;this.childOffsets[r]||(this.childOffsets[r]=this.nodeCount);const a=i-1,o=e[a];let s,l=0;for(let c=0;c<this._siblingOffset.length;c++){const e=2*t+this._siblingOffset[c][0],i=2*n+this._siblingOffset[c][1],r=o.getElevation(e,i),a=o.isLeaf(e,i),u=this._addNode(r.min,r.max,a);a&&(l|=1<<c),s||(s=u)}for(let c=0;c<this._siblingOffset.length;c++)l&1<<c||this._construct(e,2*t+this._siblingOffset[c][0],2*n+this._siblingOffset[c][1],a,s+c)}}function ad(e,t,n,i,r,a){return nn(nn(e,n,a),nn(t,i,a),r)}function od(e,t,n){const i=n.dim,r=m(e*i-.5,0,i-1),a=m(t*i-.5,0,i-1),o=Math.floor(r),s=Math.floor(a),l=Math.min(o+1,i-1),c=Math.min(s+1,i-1);return ad(n.get(o,s),n.get(l,s),n.get(o,c),n.get(l,c),r-o,a-s)}const sd={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class ld{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,t,n,i=!1,r=!1){if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(n&&"mapbox"!==n&&"terrarium"!==n)return L(`"${n}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=t.height;const a=this.dim=t.height-2;if(this.data=new Uint32Array(t.data.buffer),this.encoding=n||"mapbox",this.borderReady=i,!i){for(let e=0;e<a;e++)this.data[this._idx(-1,e)]=this.data[this._idx(0,e)],this.data[this._idx(a,e)]=this.data[this._idx(a-1,e)],this.data[this._idx(e,-1)]=this.data[this._idx(e,0)],this.data[this._idx(e,a)]=this.data[this._idx(e,a-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(a,-1)]=this.data[this._idx(a-1,0)],this.data[this._idx(-1,a)]=this.data[this._idx(0,a-1)],this.data[this._idx(a,a)]=this.data[this._idx(a-1,a-1)],r&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new rd(this)}get(e,t,n=!1){const i=new Uint8Array(this.data.buffer);n&&(e=m(e,-1,this.dim),t=m(t,-1,this.dim));const r=4*this._idx(e,t);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(i[r],i[r+1],i[r+2])}static getUnpackVector(e){return sd[e]}get unpackVector(){return sd[this.encoding]}_idx(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)}_unpackMapbox(e,t,n){return(256*e*256+256*t+n)/10-1e4}_unpackTerrarium(e,t,n){return 256*e+t+n/256-32768}static pack(e,t){const n=[0,0,0,0],i=ld.getUnpackVector(t);let r=Math.floor((e+i[3])/i[2]);return n[2]=r%256,r=Math.floor(r/256),n[1]=r%256,r=Math.floor(r/256),n[0]=r,n}getPixels(){return new Gs({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,t,n){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let i=t*this.dim,r=t*this.dim+this.dim,a=n*this.dim,o=n*this.dim+this.dim;switch(t){case-1:i=r-1;break;case 1:r=i+1}switch(n){case-1:a=o-1;break;case 1:o=a+1}const s=-t*this.dim,l=-n*this.dim;for(let c=a;c<o;c++)for(let t=i;t<r;t++)this.data[this._idx(t,c)]=e.data[this._idx(t+s,c+l)]}onDeserialize(){this._tree&&(this._tree.dem=this)}}sr("DEMData",ld),sr("DemMinMaxQuadTree",rd,{omit:["dem"]});class cd{constructor(e,t){this.max=e,this.onRemove=t,this.reset()}reset(){for(const e in this.data)for(const t of this.data[e])t.timeout&&clearTimeout(t.timeout),this.onRemove(t.value);return this.data={},this.order=[],this}add(e,t,n){const i=e.wrapped().key;void 0===this.data[i]&&(this.data[i]=[]);const r={value:t,timeout:void 0};if(void 0!==n&&(r.timeout=setTimeout((()=>{this.remove(e,r)}),n)),this.data[i].push(r),this.order.push(i),this.order.length>this.max){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const t=this.data[e].shift();return t.timeout&&clearTimeout(t.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),t.value}getByKey(e){const t=this.data[e];return t?t[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,t){if(!this.has(e))return this;const n=e.wrapped().key,i=void 0===t?0:this.data[n].indexOf(t),r=this.data[n][i];return this.data[n].splice(i,1),r.timeout&&clearTimeout(r.timeout),0===this.data[n].length&&delete this.data[n],this.onRemove(r.value),this.order.splice(this.order.indexOf(n),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(e){const t=[];for(const n in this.data)for(const i of this.data[n])e(i.value)||t.push(i);for(const n of t)this.remove(n.value.tileID,n)}}class ud{constructor(e,t,n){this.func=e,this.mask=t,this.range=n}}ud.ReadOnly=!1,ud.ReadWrite=!0,ud.disabled=new ud(519,ud.ReadOnly,[0,1]);const hd=7680;class dd{constructor(e,t,n,i,r,a){this.test=e,this.ref=t,this.mask=n,this.fail=i,this.depthFail=r,this.pass=a}}dd.disabled=new dd({func:519,mask:0},0,0,hd,hd,hd);class pd{constructor(e,t,n){this.blendFunction=e,this.blendColor=t,this.mask=n}}pd.Replace=[1,0],pd.disabled=new pd(pd.Replace,ut.transparent,[!1,!1,!1,!1]),pd.unblended=new pd(pd.Replace,ut.transparent,[!0,!0,!0,!0]),pd.alphaBlended=new pd([1,771],ut.transparent,[!0,!0,!0,!0]);const fd=1029,md=2305;class gd{constructor(e,t,n){this.enable=e,this.mode=t,this.frontFace=n}}gd.disabled=new gd(!1,fd,md),gd.backCCW=new gd(!0,fd,md),gd.backCW=new gd(!0,fd,2304),gd.frontCW=new gd(!0,1028,2304),gd.frontCCW=new gd(!0,1028,md);class vd extends Be{constructor(e,t,n){super(),this.id=e,this._onlySymbols=n,t.on("data",(e=>{"source"===e.dataType&&"metadata"===e.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===e.dataType&&"content"===e.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))})),t.on("error",(()=>{this._sourceErrored=!0})),this._source=t,this._tiles={},this._cache=new cd(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Kh}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;for(const e in this._tiles){const t=this._tiles[e];if("loaded"!==t.state&&"errored"!==t.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,t){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,t)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,(()=>{}))}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,(()=>{}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const t in this._tiles){const n=this._tiles[t];n.upload(e),n.prepare(this.map.style.imageManager)}}getIds(){return y(this._tiles).map((e=>e.tileID)).sort(yd).map((e=>e.key))}getRenderableIds(e){const t=[];for(const n in this._tiles)this._isIdRenderable(+n,e)&&t.push(this._tiles[n]);return e?t.sort(((e,t)=>{const n=e.tileID,i=t.tileID,a=new r(n.canonical.x,n.canonical.y)._rotate(this.transform.angle),o=new r(i.canonical.x,i.canonical.y)._rotate(this.transform.angle);return n.overscaledZ-i.overscaledZ||o.y-a.y||o.x-a.x})).map((e=>e.tileID.key)):t.map((e=>e.tileID)).sort(yd).map((e=>e.key))}hasRenderableParent(e){const t=this.findLoadedParent(e,0);return!!t&&this._isIdRenderable(t.tileID.key)}_isIdRenderable(e,t){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(t||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,t){const n=this._tiles[e];n&&("loading"!==n.state&&(n.state=t),this._loadTile(n,this._tileLoaded.bind(this,n,e,t)))}_tileLoaded(e,t,n,i){if(i)return e.state="errored",void(404!==i.status?this._source.fire(new Oe(i,{tile:e})):this.update(this.transform));e.timeAdded=j.now(),"expired"===n&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(t,e),"raster-dem"===this.getSource().type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new De("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const t=this.getRenderableIds();for(let i=0;i<t.length;i++){const r=t[i];if(e.neighboringTiles&&e.neighboringTiles[r]){const t=this.getTileByID(r);n(e,t),n(t,e)}}function n(e,t){if(!e.dem||e.dem.borderReady)return;e.needsHillshadePrepare=!0,e.needsDEMTextureUpload=!0;let n=t.tileID.canonical.x-e.tileID.canonical.x;const i=t.tileID.canonical.y-e.tileID.canonical.y,r=Math.pow(2,e.tileID.canonical.z),a=t.tileID.key;0===n&&0===i||Math.abs(i)>1||(Math.abs(n)>1&&(1===Math.abs(n+r)?n+=r:1===Math.abs(n-r)&&(n-=r)),t.dem&&e.dem&&(e.dem.backfillBorder(t.dem,n,i),e.neighboringTiles&&e.neighboringTiles[a]&&(e.neighboringTiles[a].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,t,n,i){for(const r in this._tiles){let a=this._tiles[r];if(i[r]||!a.hasData()||a.tileID.overscaledZ<=t||a.tileID.overscaledZ>n)continue;let o=a.tileID;for(;a&&a.tileID.overscaledZ>t+1;){const e=a.tileID.scaledTo(a.tileID.overscaledZ-1);a=this._tiles[e.key],a&&a.hasData()&&(o=e)}let s=o;for(;s.overscaledZ>t;)if(s=s.scaledTo(s.overscaledZ-1),e[s.key]){i[o.key]=o;break}}}findLoadedParent(e,t){if(e.key in this._loadedParentTiles){const n=this._loadedParentTiles[e.key];return n&&n.tileID.overscaledZ>=t?n:null}for(let n=e.overscaledZ-1;n>=t;n--){const t=e.scaledTo(n),i=this._getLoadedTile(t);if(i)return i}}_getLoadedTile(e){const t=this._tiles[e.key];return t&&t.hasData()?t:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,t){t=t||this._source.tileSize;const n=Math.ceil(e.width/t)+1,i=Math.ceil(e.height/t)+1,r=Math.floor(n*i*5),a="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,r):r;this._cache.setMaxSize(a)}handleWrapJump(e){const t=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,t){const e={};for(const n in this._tiles){const i=this._tiles[n];i.tileID=i.tileID.unwrapTo(i.tileID.wrap+t),e[i.tileID.key]=i}this._tiles=e;for(const t in this._timers)clearTimeout(this._timers[t]),delete this._timers[t];for(const t in this._tiles)this._setTileReloadTimer(+t,this._tiles[t])}}update(e,t,n){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage)return;if(this.usedForTerrain&&!n)return;let i;this.updateCacheSize(e,t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?i=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((e=>new qh(e.canonical.z,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y))):(i=e.coveringTiles({tileSize:t||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!n,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(i=i.filter((e=>this._source.hasTile(e))))):i=[];const r=this._updateRetainedTiles(i);if(_d(this._source.type)&&0!==i.length){const e={},t={},n=Object.keys(r);for(const i of n){const n=r[i],a=this._tiles[i];if(!a||a.fadeEndTime&&a.fadeEndTime<=j.now())continue;const o=this.findLoadedParent(n,Math.max(n.overscaledZ-vd.maxOverzooming,this._source.minzoom));o&&(this._addTile(o.tileID),e[o.tileID.key]=o.tileID),t[i]=n}const a=i[i.length-1].overscaledZ;for(const i in this._tiles){const e=this._tiles[i];if(r[i]||!e.hasData())continue;let n=e.tileID;for(;n.overscaledZ>a;){n=n.scaledTo(n.overscaledZ-1);const a=this._tiles[n.key];if(a&&a.hasData()&&t[n.key]){r[i]=e.tileID;break}}}for(const i in e)r[i]||(this._coveredTiles[i]=!0,r[i]=e[i])}for(const o in r)this._tiles[o].clearFadeHold();const a=function(e,t){const n=[];for(const i in e)i in t||n.push(i);return n}(this._tiles,r);for(const o of a){const e=this._tiles[o];e.hasSymbolBuckets&&!e.holdingForFade()?e.setHoldDuration(this.map._fadeDuration):e.hasSymbolBuckets&&!e.symbolFadeFinished()||this._removeTile(+o)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const t={};if(0===e.length)return t;const n={},i=e[e.length-1].overscaledZ,r=e[0].overscaledZ,a=Math.max(r-vd.maxOverzooming,this._source.minzoom),o=Math.max(r+vd.maxUnderzooming,this._source.minzoom),s={};for(const l of e){const e=this._addTile(l);t[l.key]=l,e.hasData()||i<this._source.maxzoom&&(s[l.key]=l)}this._retainLoadedChildren(s,i,o,t);for(const l of e){let e=this._tiles[l.key];if(e.hasData())continue;if(l.canonical.z>=this._source.maxzoom){const e=l.children(this._source.maxzoom)[0],n=this.getTile(e);if(n&&n.hasData()){t[e.key]=e;continue}}else{const e=l.children(this._source.maxzoom);if(t[e[0].key]&&t[e[1].key]&&t[e[2].key]&&t[e[3].key])continue}let i=e.wasRequested();for(let r=l.overscaledZ-1;r>=a;--r){const a=l.scaledTo(r);if(n[a.key])break;if(n[a.key]=!0,e=this.getTile(a),!e&&i&&(e=this._addTile(a)),e&&(t[a.key]=a,i=e.wasRequested(),e.hasData()))break}}return t}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const t=[];let n,i=this._tiles[e].tileID;for(;i.overscaledZ>0;){if(i.key in this._loadedParentTiles){n=this._loadedParentTiles[i.key];break}t.push(i.key);const e=i.scaledTo(i.overscaledZ-1);if(n=this._getLoadedTile(e),n)break;i=e}for(const e of t)this._loadedParentTiles[e]=n}}_addTile(e){let t=this._tiles[e.key];if(t)return t;t=this._cache.getAndRemove(e),t&&(this._setTileReloadTimer(e.key,t),t.tileID=e,this._state.initializeTileState(t,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,t)));const n=Boolean(t);return n||(t=new Jh(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom),this._loadTile(t,this._tileLoaded.bind(this,t,e.key,t.state))),t?(t.uses++,this._tiles[e.key]=t,n||this._source.fire(new De("dataloading",{tile:t,coord:t.tileID,dataType:"source"})),t):null}_setTileReloadTimer(e,t){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const n=t.getExpiryTimeout();n&&(this._timers[e]=setTimeout((()=>{this._reloadTile(e,"expired"),delete this._timers[e]}),n))}_removeTile(e){const t=this._tiles[e];t&&(t.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),t.uses>0||(t.hasData()&&"reloading"!==t.state?this._cache.add(t.tileID,t,t.getExpiryTimeout()):(t.aborted=!0,this._abortTile(t),this._unloadTile(t))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._cache.reset()}tilesIn(e,t,n){const i=[],r=this.transform;if(!r)return i;for(const a in this._tiles){const o=this._tiles[a];if(n&&o.clearQueryDebugViz(),o.holdingForFade())continue;const s=e.containsTile(o,r,t);s&&i.push(s)}return i}getVisibleCoordinates(e){const t=this.getRenderableIds(e).map((e=>this._tiles[e].tileID));for(const n of t)n.projMatrix=this.transform.calculateProjMatrix(n.toUnwrapped());return t}hasTransition(){if(this._source.hasTransition())return!0;if(_d(this._source.type))for(const e in this._tiles){const t=this._tiles[e];if(void 0!==t.fadeEndTime&&t.fadeEndTime>=j.now())return!0}return!1}setFeatureState(e,t,n){this._state.updateState(e=e||"_geojsonTileLayer",t,n)}removeFeatureState(e,t,n){this._state.removeFeatureState(e=e||"_geojsonTileLayer",t,n)}getFeatureState(e,t){return this._state.getState(e=e||"_geojsonTileLayer",t)}setDependencies(e,t,n){const i=this._tiles[e];i&&i.setDependencies(t,n)}reloadTilesForDependencies(e,t){for(const n in this._tiles)this._tiles[n].hasDependency(e,t)&&this._reloadTile(+n,"reloading");this._cache.filter((n=>!n.hasDependency(e,t)))}}function yd(e,t){const n=Math.abs(2*e.wrap)-+(e.wrap<0),i=Math.abs(2*t.wrap)-+(t.wrap<0);return e.overscaledZ-t.overscaledZ||i-n||t.canonical.y-e.canonical.y||t.canonical.x-e.canonical.x}function _d(e){return"raster"===e||"image"===e||"video"===e}vd.maxOverzooming=10,vd.maxUnderzooming=3;class xd{constructor(e,t,n){this._demTile=e,this._dem=this._demTile.dem,this._scale=t,this._offset=n}static create(e,t,n){const i=n||e.findDEMTileFor(t);if(!i||!i.dem)return;const r=i.dem,a=i.tileID,o=1<<t.canonical.z-a.canonical.z;return new xd(i,i.tileSize/jo/o,[(t.canonical.x/o-a.canonical.x)*r.dim,(t.canonical.y/o-a.canonical.y)*r.dim])}tileCoordToPixel(e,t){const n=t*this._scale+this._offset[1],i=Math.floor(e*this._scale+this._offset[0]),a=Math.floor(n);return new r(i,a)}getElevationAt(e,t,n,i){const r=e*this._scale+this._offset[0],a=t*this._scale+this._offset[1],o=Math.floor(r),s=Math.floor(a),l=this._dem;return i=!!i,n?nn(nn(l.get(o,s,i),l.get(o,s+1,i),a-s),nn(l.get(o+1,s,i),l.get(o+1,s+1,i),a-s),r-o):l.get(o,s,i)}getElevationAtPixel(e,t,n){return this._dem.get(e,t,!!n)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*zh(1,e)*this._dem.stride}}class bd{constructor(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new nr(jo,16,0),this.featureIndexArray=new ro,this.promoteId=t}insert(e,t,n,i,r,a=0){const o=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,i,r,a);const s=this.grid;for(let l=0;l<t.length;l++){const e=t[l],n=[1/0,1/0,-1/0,-1/0];for(let t=0;t<e.length;t++){const i=e[t];n[0]=Math.min(n[0],i.x),n[1]=Math.min(n[1],i.y),n[2]=Math.max(n[2],i.x),n[3]=Math.max(n[3],i.y)}n[0]<jo&&n[1]<jo&&n[2]>=0&&n[3]>=0&&s.insert(o,n[0],n[1],n[2],n[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Wl.VectorTile(new Pc(this.rawTileData)).layers,this.sourceLayerCoder=new $h(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,t,n,i){this.loadVTLayers();const r=e.params||{},a=Ti(r.filter),o=e.tileResult,s=e.transform,l=o.bufferedTilespaceBounds,c=this.grid.query(l.min.x,l.min.y,l.max.x,l.max.y,((e,t,n,i)=>as(o.bufferedTilespaceGeometry,e,t,n,i)));c.sort(Sd);let u=null;s.elevation&&c.length>0&&(u=xd.create(s.elevation,this.tileID));const h={};let d;for(let p=0;p<c.length;p++){const s=c[p];if(s===d)continue;d=s;const l=this.featureIndexArray.get(s);let f=null;this.loadMatchingFeature(h,l,a,r.layers,r.availableImages,t,n,i,((t,n,i,r=0)=>(f||(f=Wo(t)),n.queryIntersectsFeature(o,t,i,f,this.z,e.transform,e.pixelPosMatrix,u,r))))}return h}loadMatchingFeature(e,t,n,i,r,a,o,s,l){const{featureIndex:c,bucketIndex:u,sourceLayerIndex:h,layoutVertexArrayOffset:d}=t,p=this.bucketLayerIDs[u];if(i&&!function(e,t){for(let n=0;n<e.length;n++)if(t.indexOf(e[n])>=0)return!0;return!1}(i,p))return;const f=this.sourceLayerCoder.decode(h),m=this.vtLayers[f].feature(c);if(n.needGeometry){const e=qo(m,!0);if(!n.filter(new oa(this.tileID.overscaledZ),e,this.tileID.canonical))return}else if(!n.filter(new oa(this.tileID.overscaledZ),m))return;const g=this.getId(m,f);for(let v=0;v<p.length;v++){const t=p[v];if(i&&i.indexOf(t)<0)continue;const n=a[t];if(!n)continue;let u={};void 0!==g&&s&&(u=s.getState(n.sourceLayer||"_geojsonTileLayer",g));const h=_({},o[t]);h.paint=wd(h.paint,n.paint,m,u,r),h.layout=wd(h.layout,n.layout,m,u,r);const f=!l||l(m,n,u,d);if(!f)continue;const y=new Xh(m,this.z,this.x,this.y,g);y.layer=h;let x=e[t];void 0===x&&(x=e[t]=[]),x.push({featureIndex:c,feature:y,intersectionZ:f})}}lookupSymbolFeatures(e,t,n,i,r,a,o,s){const l={};this.loadVTLayers();const c=Ti(r);for(const u of e)this.loadMatchingFeature(l,{bucketIndex:n,sourceLayerIndex:i,featureIndex:u,layoutVertexArrayOffset:0},c,a,o,s,t);return l}hasLayer(e){for(const t of this.bucketLayerIDs)for(const n of t)if(e===n)return!0;return!1}getId(e,t){let n=e.id;return this.promoteId&&(n=e.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[t]],"boolean"==typeof n&&(n=Number(n))),n}}function wd(e,t,n,i,r){return k(e,((e,a)=>{const o=t instanceof fa?t.get(a):null;return o&&o.evaluate?o.evaluate(n,i,r):o}))}function Sd(e,t){return t-e}sr("FeatureIndex",bd,{omit:["rawTileData","sourceLayerCoder"]});class Td{constructor(e){const t={},n=[];for(const o in e){const i=e[o],r=t[o]={};for(const e in i){const t=i[+e];if(!t||0===t.bitmap.width||0===t.bitmap.height)continue;const a=t.metrics.localGlyph?2:1,o={x:0,y:0,w:t.bitmap.width+2*a,h:t.bitmap.height+2*a};n.push(o),r[e]={rect:o,metrics:t.metrics}}}const{w:i,h:r}=Qc(n),a=new js({width:i||1,height:r||1});for(const o in e){const n=e[o];for(const e in n){const i=n[+e];if(!i||0===i.bitmap.width||0===i.bitmap.height)continue;const r=t[o][e].rect,s=i.metrics.localGlyph?2:1;js.copy(i.bitmap,a,{x:0,y:0},{x:r.x+s,y:r.y+s},i.bitmap)}}this.image=a,this.positions=t}}sr("GlyphAtlas",Td);class Ed{constructor(e){this.tileID=new qh(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile}parse(e,t,n,i,r){this.status="parsing",this.data=e,this.collisionBoxArray=new Ya;const a=new $h(Object.keys(e.layers).sort()),o=new bd(this.tileID,this.promoteId);o.bucketLayerIDs=[];const s={},l=new Fh(256,256),c={featureIndex:o,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:l,availableImages:n},u=t.familiesBySource[this.source];for(const y in u){const t=e.layers[y];if(!t)continue;let i=!1,r=!1;for(const e of u[y])"symbol"===e[0].type?i=!0:r=!0;if(!0===this.isSymbolTile&&!i)continue;if(!1===this.isSymbolTile&&!r)continue;1===t.version&&L(`Vector tile source "${this.source}" layer "${y}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const l=a.encode(y),h=[];for(let e=0;e<t.length;e++){const n=t.feature(e),i=o.getId(n,y);h.push({feature:n,id:i,index:e,sourceLayerIndex:l})}for(const e of u[y]){const t=e[0];void 0!==this.isSymbolTile&&"symbol"===t.type!==this.isSymbolTile||t.minzoom&&this.zoom<Math.floor(t.minzoom)||t.maxzoom&&this.zoom>=t.maxzoom||"none"!==t.visibility&&(Md(e,this.zoom,n),(s[t.id]=t.createBucket({index:o.bucketLayerIDs.length,layers:e,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:l,sourceID:this.source,enableTerrain:this.enableTerrain})).populate(h,c,this.tileID.canonical),o.bucketLayerIDs.push(e.map((e=>e.id))))}}let h,d,p,f;l.trim();const m={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},g=k(c.glyphDependencies,(e=>Object.keys(e).map(Number)));Object.keys(g).length?i.send("getGlyphs",{uid:this.uid,stacks:g},((e,t)=>{h||(h=e,d=t,x.call(this))}),void 0,!1,m):d={};const v=Object.keys(c.iconDependencies);v.length?i.send("getImages",{icons:v,source:this.source,tileID:this.tileID,type:"icons"},((e,t)=>{h||(h=e,p=t,x.call(this))}),void 0,!1,m):p={};const _=Object.keys(c.patternDependencies);function x(){if(h)return r(h);if(d&&p&&f){const e=new Td(d),t=new tu(p,f);for(const i in s){const r=s[i];r instanceof uh?(Md(r.layers,this.zoom,n),$u(r,d,e.positions,p,t.iconPositions,this.showCollisionBoxes,this.tileID.canonical,this.tileZoom)):r.hasPattern&&(r instanceof cc||r instanceof Ll||r instanceof Yl)&&(Md(r.layers,this.zoom,n),r.addFeatures(c,this.tileID.canonical,t.patternPositions))}this.status="done",r(null,{buckets:y(s).filter((e=>!e.isEmpty())),featureIndex:o,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:e.image,lineAtlas:l,imageAtlas:t,glyphMap:this.returnDependencies?d:null,iconMap:this.returnDependencies?p:null,glyphPositions:this.returnDependencies?e.positions:null})}}_.length?i.send("getImages",{icons:_,source:this.source,tileID:this.tileID,type:"patterns"},((e,t)=>{h||(h=e,f=t,x.call(this))}),void 0,!1,m):f={},x.call(this)}}function Md(e,t,n){const i=new oa(t);for(const r of e)r.recalculate(i,n)}class kd{constructor(e){this.entries={},this.scheduler=e}request(e,t,n,i){const r=this.entries[e]=this.entries[e]||{callbacks:[]};if(r.result){const[e,n]=r.result;return this.scheduler?this.scheduler.add((()=>{i(e,n)}),t):i(e,n),()=>{}}return r.callbacks.push(i),r.cancel||(r.cancel=n(((n,i)=>{r.result=[n,i];for(const e of r.callbacks)this.scheduler?this.scheduler.add((()=>{e(n,i)}),t):e(n,i);setTimeout((()=>delete this.entries[e]),3e3)}))),()=>{r.result||(r.callbacks=r.callbacks.filter((e=>e!==i)),r.callbacks.length||(r.cancel(),delete this.entries[e]))}}}function Ad(e,t,n){const i=JSON.stringify(e.request);return e.data&&(this.deduped.entries[i]={result:[null,e.data]}),this.deduped.request(i,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom},(t=>{const i=Ee(e.request,((e,i,r,a)=>{e?t(e):i&&t(null,{vectorTile:n?void 0:new Wl.VectorTile(new Pc(i)),rawData:i,cacheControl:r,expires:a})}));return()=>{i.cancel(),t()}}),t)}e.ARRAY_TYPE=ps,e.AUTH_ERR_MSG=K,e.Actor=class{constructor(e,t,n){this.target=e,this.parent=t,this.mapId=n,this.callbacks={},this.cancelCallbacks={},E(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=z()?e:o,this.scheduler=new jh}send(e,t,n,i,r=!1,a){const o=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(n.metadata=a,this.callbacks[o]=n);const s=U(this.globalScope)?void 0:[];return this.target.postMessage({id:o,type:e,hasCallback:!!n,targetMapId:i,mustQueue:r,sourceMapId:this.mapId,data:ur(t,s)},s),{cancel:()=>{n&&delete this.callbacks[o],this.target.postMessage({id:o,type:"<cancel>",targetMapId:i,sourceMapId:this.mapId})}}}receive(e){const t=e.data,n=t.id;if(n&&(!t.targetMapId||this.mapId===t.targetMapId))if("<cancel>"===t.type){const e=this.cancelCallbacks[n];delete this.cancelCallbacks[n],e&&e.cancel()}else if(t.mustQueue||z()){const e=this.callbacks[n];this.cancelCallbacks[n]=this.scheduler.add((()=>this.processTask(n,t)),e&&e.metadata||{type:"message"})}else this.processTask(n,t)}processTask(e,t){if("<response>"===t.type){const n=this.callbacks[e];delete this.callbacks[e],n&&(t.error?n(hr(t.error)):n(null,hr(t.data)))}else{const n=U(this.globalScope)?void 0:[],i=t.hasCallback?(t,i)=>{delete this.cancelCallbacks[e],this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:t?ur(t):null,data:ur(i,n)},n)}:e=>{},r=hr(t.data);if(this.parent[t.type])this.parent[t.type](t.sourceMapId,r,i);else if(this.parent.getWorkerSource){const e=t.type.split(".");this.parent.getWorkerSource(t.sourceMapId,e[0],r.source)[e[1]](r,i)}else i(new Error(`Could not find function ${t.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},e.CanonicalTileID=Hh,e.Color=ut,e.ColorMode=pd,e.CullFaceMode=gd,e.DEMData=ld,e.DataConstantProperty=ma,e.DedupedRequest=kd,e.DepthMode=ud,e.EXTENT=jo,e.Elevation=class{getAtPointOrZero(e,t=0){return this.getAtPoint(e,t)||0}getAtPoint(e,t,n=!0){null==t&&(t=null);const i=this._source();if(!i)return t;if(e.y<0||e.y>1)return t;const r=i.getSource().maxzoom,a=1<<r,o=Math.floor(e.x),s=e.x-o,l=new qh(r,o,r,Math.floor(s*a),Math.floor(e.y*a)),c=this.findDEMTileFor(l);if(!c||!c.dem)return t;const u=c.dem,h=1<<c.tileID.canonical.z,d=(s*h-c.tileID.canonical.x)*u.dim,p=(e.y*h-c.tileID.canonical.y)*u.dim,f=Math.floor(d),m=Math.floor(p);return(n?this.exaggeration():1)*nn(nn(u.get(f,m),u.get(f,m+1),p-m),nn(u.get(f+1,m),u.get(f+1,m+1),p-m),d-f)}getAtTileOffset(e,t,n){const i=1<<e.canonical.z;return this.getAtPointOrZero(new Bh(e.wrap+(e.canonical.x+t/jo)/i,(e.canonical.y+n/jo)/i))}getForTilePoints(e,t,n,i){const r=xd.create(this,e,i);return!!r&&(t.forEach((e=>{e[2]=this.exaggeration()*r.getElevationAt(e[0],e[1],n)})),!0)}getMinMaxForTile(e){const t=this.findDEMTileFor(e);if(!t||!t.dem)return null;const n=t.dem.tree,i=t.tileID,r=1<<e.canonical.z-i.canonical.z;let a=e.canonical.x/r-i.canonical.x,o=e.canonical.y/r-i.canonical.y,s=0;for(let l=0;l<e.canonical.z-i.canonical.z&&!n.leaves[s];l++){a*=2,o*=2;const e=2*Math.floor(o)+Math.floor(a);s=n.childOffsets[s]+e,a%=1,o%=1}return{min:this.exaggeration()*n.minimums[s],max:this.exaggeration()*n.maximums[s]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(e,t,n){throw new Error("Pure virtual method called.")}pointCoordinate(e){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(e){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},e.ErrorEvent=Oe,e.EvaluationParameters=oa,e.Event=De,e.Evented=Be,e.GlyphManager=Du,e.ImagePosition=eu,e.LineAtlas=Fh,e.LngLat=Ch,e.LngLatBounds=kh,e.LocalGlyphMode=zu,e.MAX_SAFE_INTEGER=s,e.MercatorCoordinate=Bh,e.ONE_EM=xc,e.OverscaledTileID=qh,e.Properties=xa,e.RGBAImage=Gs,e.RequestManager=class{constructor(e,t,n){this._transformRequestFn=e,this._customAccessToken=t,this._silenceAuthErrors=!!n,this._createSkuToken()}_createSkuToken(){const e=function(){let e="";for(let t=0;t<10;t++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",J,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}}normalizeStyleURL(e,t){if(!Q(e))return e;const n=ne(e);return n.path=`/styles/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||t)}normalizeGlyphsURL(e,t){if(!Q(e))return e;const n=ne(e);return n.path=`/fonts/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||t)}normalizeSourceURL(e,t){if(!Q(e))return e;const n=ne(e);return n.path=`/v4/${n.authority}.json`,n.params.push("secure"),this._makeAPIURL(n,this._customAccessToken||t)}normalizeSpriteURL(e,t,n,i){const r=ne(e);return Q(e)?(r.path=`/styles/v1${r.path}/sprite${t}${n}`,this._makeAPIURL(r,this._customAccessToken||i)):(r.path+=`${t}${n}`,ie(r))}normalizeTileURL(e,t,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),e&&!Q(e))return e;const i=ne(e);i.path=i.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${t||n&&"raster"!==i.authority&&512===n?"@2x":""}${W.supported?".webp":"$1"}`),"raster"===i.authority?i.path=`/${H.RASTER_URL_PREFIX}${i.path}`:(i.path=i.path.replace(/^.+\/v4\//,"/"),i.path=`/${H.TILE_URL_VERSION}${i.path}`);const r=this._customAccessToken||function(e){for(const t of e){const e=t.match(/^access_token=(.*)$/);if(e)return e[1]}return null}(i.params)||H.ACCESS_TOKEN;return H.REQUIRE_ACCESS_TOKEN&&r&&this._skuToken&&i.params.push(`sku=${this._skuToken}`),this._makeAPIURL(i,r)}canonicalizeTileURL(e,t){const n=ne(e);if(!n.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!n.path.match(/\.[\w]+$/))return e;let i="mapbox://";n.path.match(/^\/raster\/v1\//)?i+=`raster/${n.path.replace(`/${H.RASTER_URL_PREFIX}/`,"")}`:i+=`tiles/${n.path.replace(`/${H.TILE_URL_VERSION}/`,"")}`;let r=n.params;return t&&(r=r.filter((e=>!e.match(/^access_token=/)))),r.length&&(i+=`?${r.join("&")}`),i}canonicalizeTileset(e,t){const n=!!t&&Q(t),i=[];for(const r of e.tiles||[])ee(r)?i.push(this.canonicalizeTileURL(r,n)):i.push(r);return i}_makeAPIURL(e,t){const n="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",i=ne(H.API_URL);if(e.protocol=i.protocol,e.authority=i.authority,"http"===e.protocol){const t=e.params.indexOf("secure");t>=0&&e.params.splice(t,1)}if("/"!==i.path&&(e.path=`${i.path}${e.path}`),!H.REQUIRE_ACCESS_TOKEN)return ie(e);if(t=t||H.ACCESS_TOKEN,!this._silenceAuthErrors){if(!t)throw new Error(`An API access token is required to use Mapbox GL. ${n}`);if("s"===t[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${n}`)}return e.params=e.params.filter((e=>-1===e.indexOf("access_token"))),e.params.push(`access_token=${t||""}`),ie(e)}},e.ResourceType=be,e.SegmentVector=Vo,e.SourceCache=vd,e.StencilMode=dd,e.StructArrayLayout1ui2=Za,e.StructArrayLayout2f1f2i16=Fa,e.StructArrayLayout2i4=ka,e.StructArrayLayout2ui4=qa,e.StructArrayLayout3f12=za,e.StructArrayLayout3ui6=Ua,e.StructArrayLayout4i8=Aa,e.Texture=Mh,e.Tile=Jh,e.Transitionable=ca,e.Uniform1f=_o,e.Uniform1i=class extends yo{constructor(e,t){super(e,t),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1i(this.location,e))}},e.Uniform2f=class extends yo{constructor(e,t){super(e,t),this.current=[0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]||(this.current=e,this.gl.uniform2f(this.location,e[0],e[1]))}},e.Uniform3f=class extends yo{constructor(e,t){super(e,t),this.current=[0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]||(this.current=e,this.gl.uniform3f(this.location,e[0],e[1],e[2]))}},e.Uniform4f=xo,e.UniformColor=bo,e.UniformMatrix3f=class extends yo{constructor(e,t){super(e,t),this.current=So}set(e){for(let t=0;t<9;t++)if(e[t]!==this.current[t]){this.current=e,this.gl.uniformMatrix3fv(this.location,!1,e);break}}},e.UniformMatrix4f=class extends yo{constructor(e,t){super(e,t),this.current=wo}set(e){if(e[12]!==this.current[12]||e[0]!==this.current[0])return this.current=e,void this.gl.uniformMatrix4fv(this.location,!1,e);for(let t=1;t<16;t++)if(e[t]!==this.current[t]){this.current=e,this.gl.uniformMatrix4fv(this.location,!1,e);break}}},e.UnwrappedTileID=Wh,e.ValidationError=Ne,e.VectorTileWorkerSource=class extends Be{constructor(e,t,n,i,r){super(),this.actor=e,this.layerIndex=t,this.availableImages=n,this.loadVectorData=r||Ad,this.loading={},this.loaded={},this.deduped=new kd(e.scheduler),this.isSpriteLoaded=i,this.scheduler=e.scheduler}loadTile(e,t){const n=e.uid,i=e&&e.request,r=i&&i.collectResourceTiming,a=this.loading[n]=new Ed(e);a.abort=this.loadVectorData(e,((o,s)=>{const l=!this.loading[n];if(delete this.loading[n],l||o||!s)return a.status="done",l||(this.loaded[n]=a),t(o);const c=s.rawData,u={};s.expires&&(u.expires=s.expires),s.cacheControl&&(u.cacheControl=s.cacheControl),a.vectorTile=s.vectorTile||new Wl.VectorTile(new Pc(c));const h=()=>{a.parse(a.vectorTile,this.layerIndex,this.availableImages,this.actor,((e,n)=>{if(e||!n)return t(e);const a={};if(r){const e=Vh(i);e.length>0&&(a.resourceTiming=JSON.parse(JSON.stringify(e)))}t(null,_({rawTileData:c.slice(0)},n,u,a))}))};this.isSpriteLoaded?h():this.once("isSpriteLoaded",(()=>{this.scheduler?this.scheduler.add(h,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom}):h()})),this.loaded=this.loaded||{},this.loaded[n]=a}))}reloadTile(e,t){const n=this.loaded,i=e.uid,r=this;if(n&&n[i]){const a=n[i];a.showCollisionBoxes=e.showCollisionBoxes,a.enableTerrain=!!e.enableTerrain;const o=(e,n)=>{const i=a.reloadCallback;i&&(delete a.reloadCallback,a.parse(a.vectorTile,r.layerIndex,this.availableImages,r.actor,i)),t(e,n)};"parsing"===a.status?a.reloadCallback=o:"done"===a.status&&(a.vectorTile?a.parse(a.vectorTile,this.layerIndex,this.availableImages,this.actor,o):o())}}abortTile(e,t){const n=e.uid,i=this.loading[n];i&&(i.abort&&i.abort(),delete this.loading[n]),t()}removeTile(e,t){const n=this.loaded,i=e.uid;n&&n[i]&&delete n[i],t()}},e.WritingMode=nu,e.ZoomHistory=dr,e.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e},e.addDynamicAttributes=oh,e.altitudeFromMercatorZ=Oh,e.asyncAll=v,e.bezier=p,e.bindAll=E,e.bufferConvexPolygon=function(e,t){const n=[];for(let i=0;i<e.length;i++){const r=g(i-1,-1,e.length-1),a=g(i+1,-1,e.length-1),o=e[i],s=e[a],l=e[r].sub(o).unit(),c=s.sub(o).unit(),u=c.angleWithSep(l.x,l.y),h=l.add(c).unit().mult(-1*t/Math.sin(u/2));n.push(o.add(h))}return n},e.cacheEntryPossiblyAdded=function(e){xe++,xe>ve&&(e.getActor().send("enforceCacheSizeLimit",ge),xe=0)},e.clamp=m,e.clearTileCache=function(e){const t=o.caches.delete(pe);e&&t.catch(e).then((()=>e()))},e.clipLine=ku,e.clone=function(e){var t=new ps(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},e.clone$1=function(e){var t=new ps(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},e.clone$2=C,e.collisionCircleLayout=_c,e.config=H,e.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},e.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},e.create=ys,e.create$1=function(){var e=new ps(16);return ps!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},e.create$2=fs,e.createExpression=ui,e.createFilter=Ti,e.createLayout=Ea,e.createStyleLayer=function(e){return"custom"===e.type?new vh(e):new xh[e.type](e)},e.cross=function(e,t,n){var i=t[0],r=t[1],a=t[2],o=n[0],s=n[1],l=n[2];return e[0]=r*l-a*s,e[1]=a*o-i*l,e[2]=i*s-r*o,e},e.degToRad=u,e.div=function(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e},e.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},e.dot$1=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},e.ease=f,e.easeCubicInOut=d,e.emitValidationErrors=tr,e.endsWith=M,e.enforceCacheSizeLimit=function(e){ye(),fe&&fe.then((t=>{t.keys().then((n=>{for(let i=0;i<n.length-e;i++)t.delete(n[i])}))}))},e.evaluateSizeForFeature=Sc,e.evaluateSizeForZoom=Tc,e.evaluateVariableOffset=Zu,e.evented=na,e.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},e.exactEquals$1=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},e.exported=j,e.exported$1=W,e.extend=_,e.filterObject=A,e.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},e.fromQuat=function(e,t){var n=t[0],i=t[1],r=t[2],a=t[3],o=n+n,s=i+i,l=r+r,c=n*o,u=i*o,h=i*s,d=r*o,p=r*s,f=r*l,m=a*o,g=a*s,v=a*l;return e[0]=1-h-f,e[1]=u+v,e[2]=d-g,e[3]=0,e[4]=u-v,e[5]=1-c-f,e[6]=p+m,e[7]=0,e[8]=d+g,e[9]=p-m,e[10]=1-c-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},e.fromRotation=function(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=n,e[2]=0,e[3]=-n,e[4]=i,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},e.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},e.furthestTileCorner=function(e){const t=Math.round((e+45+360)%360/90)%4;return h[t]},e.getAABBPointSquareDist=function(e,t,n){let i=0;for(let r=0;r<2;++r){const a=n?n[r]:0;e[r]>a&&(i+=(e[r]-a)*(e[r]-a)),t[r]<a&&(i+=(a-t[r])*(a-t[r]))}return i},e.getAnchorAlignment=mu,e.getAnchorJustification=Xu,e.getBounds=function(e){let t=1/0,n=1/0,i=-1/0,a=-1/0;for(const r of e)t=Math.min(t,r.x),n=Math.min(n,r.y),i=Math.max(i,r.x),a=Math.max(a,r.y);return{min:new r(t,n),max:new r(i,a)}},e.getImage=Ie,e.getJSON=function(e,t){return Te(_(e,{type:"json"}),t)},e.getMapSessionAPI=he,e.getPerformanceMeasurement=Vh,e.getRTLTextPluginStatus=ia,e.getReferrer=Se,e.getVideo=function(e,t){const n=o.document.createElement("video");n.muted=!0,n.onloadstart=function(){t(null,n)};for(let i=0;i<e.length;i++){const t=o.document.createElement("source");Ae(e[i])||(n.crossOrigin="Anonymous"),t.src=e[i],n.appendChild(t)}return{cancel:()=>{}}},e.identity=ms,e.identity$1=Is,e.invert=function(e,t){var n=t[0],i=t[1],r=t[2],a=t[3],o=t[4],s=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],v=t[15],y=n*s-i*o,_=n*l-r*o,x=n*c-a*o,b=i*l-r*s,w=i*c-a*s,S=r*c-a*l,T=u*m-h*f,E=u*g-d*f,M=u*v-p*f,k=h*g-d*m,A=h*v-p*m,C=d*v-p*g,P=y*C-_*A+x*k+b*M-w*E+S*T;return P?(e[0]=(s*C-l*A+c*k)*(P=1/P),e[1]=(r*A-i*C-a*k)*P,e[2]=(m*S-g*w+v*b)*P,e[3]=(d*w-h*S-p*b)*P,e[4]=(l*M-o*C-c*E)*P,e[5]=(n*C-r*M+a*E)*P,e[6]=(g*x-f*S-v*_)*P,e[7]=(u*S-d*x+p*_)*P,e[8]=(o*A-s*M+c*T)*P,e[9]=(i*M-n*A-a*T)*P,e[10]=(f*w-m*x+v*y)*P,e[11]=(h*x-u*w-p*y)*P,e[12]=(s*E-o*k-l*T)*P,e[13]=(n*k-i*E+r*T)*P,e[14]=(m*_-f*b-g*y)*P,e[15]=(u*b-h*_+d*y)*P,e):null},e.isMapAuthenticated=function(e){return de.has(e)},e.isMapboxURL=Q,e.latFromMercatorY=Dh,e.len=Cs,e.length=_s,e.length$1=function(e){return Math.hypot(e[0],e[1],e[2],e[3])},e.loadVectorTile=Ad,e.makeRequest=Te,e.mercatorXfromLng=Ih,e.mercatorYfromLat=Rh,e.mercatorZfromAltitude=zh,e.mul=function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e[3]=t[3]*n[3],e},e.mul$1=vs,e.mul$2=As,e.multiply=gs,e.multiply$1=ws,e.nextPowerOfTwo=S,e.normalize=Ts,e.normalize$1=function(e,t){var n=t[0],i=t[1],r=t[2],a=t[3],o=n*n+i*i+r*r+a*a;return o>0&&(o=1/Math.sqrt(o)),e[0]=n*o,e[1]=i*o,e[2]=r*o,e[3]=a*o,e},e.number=nn,e.ortho=function(e,t,n,i,r,a,o){var s=1/(t-n),l=1/(i-r),c=1/(a-o);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+n)*s,e[13]=(r+i)*l,e[14]=(o+a)*c,e[15]=1,e},e.pbf=Pc,e.perspective=function(e,t,n,i,r){var a,o=1/Math.tan(t/2);return e[0]=o/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=r&&r!==1/0?(e[10]=(r+i)*(a=1/(i-r)),e[14]=2*r*i*a):(e[10]=-1,e[14]=-2*i),e},e.pick=function(e,t){const n={};for(let i=0;i<t.length;i++){const r=t[i];r in e&&(n[r]=e[r])}return n},e.plugin=aa,e.pointGeometry=r,e.polygonIntersectsBox=as,e.polygonIntersectsPolygon=Xo,e.polygonizeBounds=function(e,t,n=0,i=!0){const a=new r(n,n),o=e.sub(a),s=t.add(a),l=[o,new r(s.x,o.y),s,new r(o.x,s.y)];return i&&l.push(o),l},e.posAttributes=Yh,e.postMapLoadEvent=ce,e.postTurnstileEvent=se,e.potpack=Qc,e.prevPowerOfTwo=function(e){return e<=1?1:Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},e.radToDeg=function(e){return e*c},e.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],e.registerForPluginStateChange=function(e){return e({pluginStatus:Kr,pluginURL:Qr}),na.on("pluginStateChange",e),e},e.removeAuthState=function(e){de.delete(e)},e.renderColorRamp=Ws,e.rotateX=function(e,t,n){var i=Math.sin(n),r=Math.cos(n),a=t[4],o=t[5],s=t[6],l=t[7],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*r+c*i,e[5]=o*r+u*i,e[6]=s*r+h*i,e[7]=l*r+d*i,e[8]=c*r-a*i,e[9]=u*r-o*i,e[10]=h*r-s*i,e[11]=d*r-l*i,e},e.rotateX$1=Rs,e.rotateY=function(e,t,n){var i=Math.sin(n),r=Math.cos(n),a=t[0],o=t[1],s=t[2],l=t[3],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*r-c*i,e[1]=o*r-u*i,e[2]=s*r-h*i,e[3]=l*r-d*i,e[8]=a*i+c*r,e[9]=o*i+u*r,e[10]=s*i+h*r,e[11]=l*i+d*r,e},e.rotateZ=function(e,t,n){var i=Math.sin(n),r=Math.cos(n),a=t[0],o=t[1],s=t[2],l=t[3],c=t[4],u=t[5],h=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*r+c*i,e[1]=o*r+u*i,e[2]=s*r+h*i,e[3]=l*r+d*i,e[4]=c*r-a*i,e[5]=u*r-o*i,e[6]=h*r-s*i,e[7]=d*r-l*i,e},e.rotateZ$1=function(e,t,n){n*=.5;var i=t[0],r=t[1],a=t[2],o=t[3],s=Math.sin(n),l=Math.cos(n);return e[0]=i*l+r*s,e[1]=r*l-i*s,e[2]=a*l+o*s,e[3]=o*l-a*s,e},e.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e},e.scale$1=function(e,t,n){var i=n[0],r=n[1],a=n[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},e.scale$2=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e},e.scaleAndAdd=Ss,e.setCacheLimits=function(e,t){ge=e,ve=t},e.setRTLTextPlugin=function(e,t,n=!1){if(Kr===$r||Kr===Xr||Kr===Yr)throw new Error("setRTLTextPlugin cannot be called multiple times.");Qr=j.resolveURL(e),Kr=$r,Jr=t,ta(),n||ra()},e.smoothstep=function(e,t,n){return(n=m((n-e)/(t-e),0,1))*n*(3-2*n)},e.spec=Fe,e.storeAuthState=function(e,t){t?de.add(e):de.delete(e)},e.sub=ks,e.subtract=bs,e.symbolSize=Ec,e.transformMat3=function(e,t,n){var i=t[0],r=t[1],a=t[2];return e[0]=i*n[0]+r*n[3]+a*n[6],e[1]=i*n[1]+r*n[4]+a*n[7],e[2]=i*n[2]+r*n[5]+a*n[8],e},e.transformMat4=Ps,e.transformMat4$1=function(e,t,n){var i=t[0],r=t[1],a=t[2],o=n[3]*i+n[7]*r+n[11]*a+n[15];return e[0]=(n[0]*i+n[4]*r+n[8]*a+n[12])/(o=o||1),e[1]=(n[1]*i+n[5]*r+n[9]*a+n[13])/o,e[2]=(n[2]*i+n[6]*r+n[10]*a+n[14])/o,e},e.transformQuat=Es,e.translate=function(e,t,n){var i,r,a,o,s,l,c,u,h,d,p,f,m=n[0],g=n[1],v=n[2];return t===e?(e[12]=t[0]*m+t[4]*g+t[8]*v+t[12],e[13]=t[1]*m+t[5]*g+t[9]*v+t[13],e[14]=t[2]*m+t[6]*g+t[10]*v+t[14],e[15]=t[3]*m+t[7]*g+t[11]*v+t[15]):(r=t[1],a=t[2],o=t[3],s=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],p=t[10],f=t[11],e[0]=i=t[0],e[1]=r,e[2]=a,e[3]=o,e[4]=s,e[5]=l,e[6]=c,e[7]=u,e[8]=h,e[9]=d,e[10]=p,e[11]=f,e[12]=i*m+s*g+h*v+t[12],e[13]=r*m+l*g+d*v+t[13],e[14]=a*m+c*g+p*v+t[14],e[15]=o*m+u*g+f*v+t[15]),e},e.triggerPluginCompletionEvent=ea,e.uniqueId=b,e.validateCustomStyleLayer=function(e){const t=[],n=e.id;return void 0===n&&t.push({message:`layers.${n}: missing required property "id"`}),void 0===e.render&&t.push({message:`layers.${n}: missing required method "render"`}),e.renderingMode&&"2d"!==e.renderingMode&&"3d"!==e.renderingMode&&t.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),t},e.validateFog=Ki,e.validateLight=Ji,e.validateStyle=Yi,e.values=y,e.vectorTile=Wl,e.version=t,e.warnOnce=L,e.window=o,e.wrap=g})),i(["./shared"],(function(e){function t(e){const n=typeof e;if("number"===n||"boolean"===n||"string"===n||null==e)return JSON.stringify(e);if(Array.isArray(e)){let n="[";for(const i of e)n+=`${t(i)},`;return`${n}]`}const i=Object.keys(e).sort();let r="{";for(let a=0;a<i.length;a++)r+=`${JSON.stringify(i[a])}:${t(e[i[a]])},`;return`${r}}`}function n(n){let i="";for(const r of e.refProperties)i+=`/${t(n[r])}`;return i}class i{constructor(e){this.keyCache={},e&&this.replace(e)}replace(e){this._layerConfigs={},this._layers={},this.update(e,[])}update(t,i){for(const n of t){this._layerConfigs[n.id]=n;const t=this._layers[n.id]=e.createStyleLayer(n);t._featureFilter=e.createFilter(t.filter),this.keyCache[n.id]&&delete this.keyCache[n.id]}for(const e of i)delete this.keyCache[e],delete this._layerConfigs[e],delete this._layers[e];this.familiesBySource={};const r=function(e,t){const i={};for(let a=0;a<e.length;a++){const r=t&&t[e[a].id]||n(e[a]);t&&(t[e[a].id]=r);let o=i[r];o||(o=i[r]=[]),o.push(e[a])}const r=[];for(const n in i)r.push(i[n]);return r}(e.values(this._layerConfigs),this.keyCache);for(const e of r){const t=e.map((e=>this._layers[e.id])),n=t[0];if("none"===n.visibility)continue;const i=n.source||"";let r=this.familiesBySource[i];r||(r=this.familiesBySource[i]={});const a=n.sourceLayer||"_geojsonTileLayer";let o=r[a];o||(o=r[a]=[]),o.push(t)}}}const{ImageBitmap:r}=e.window;class a{loadTile(t,n){const{uid:i,encoding:a,rawImageData:o,padding:s,buildQuadTree:l}=t,c=r&&o instanceof r?this.getImageData(o,s):o;n(null,new e.DEMData(i,c,a,s<1,l))}getImageData(t,n){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(t.width,t.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=t.width,this.offscreenCanvas.height=t.height,this.offscreenCanvasContext.drawImage(t,0,0,t.width,t.height);const i=this.offscreenCanvasContext.getImageData(-n,-n,t.width+2*n,t.height+2*n);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new e.RGBAImage({width:i.width,height:i.height},i.data)}}var o=function e(t,n){var i,r=t&&t.type;if("FeatureCollection"===r)for(i=0;i<t.features.length;i++)e(t.features[i],n);else if("GeometryCollection"===r)for(i=0;i<t.geometries.length;i++)e(t.geometries[i],n);else if("Feature"===r)e(t.geometry,n);else if("Polygon"===r)s(t.coordinates,n);else if("MultiPolygon"===r)for(i=0;i<t.coordinates.length;i++)s(t.coordinates[i],n);return t};function s(e,t){if(0!==e.length){l(e[0],t);for(var n=1;n<e.length;n++)l(e[n],!t)}}function l(e,t){for(var n=0,i=0,r=e.length,a=r-1;i<r;a=i++)n+=(e[i][0]-e[a][0])*(e[a][1]+e[i][1]);n>=0!=!!t&&e.reverse()}const c=e.vectorTile.VectorTileFeature.prototype.toGeoJSON;class u{constructor(t){this._feature=t,this.extent=e.EXTENT,this.type=t.type,this.properties=t.tags,"id"in t&&!isNaN(t.id)&&(this.id=parseInt(t.id,10))}loadGeometry(){if(1===this._feature.type){const t=[];for(const n of this._feature.geometry)t.push([new e.pointGeometry(n[0],n[1])]);return t}{const t=[];for(const n of this._feature.geometry){const i=[];for(const t of n)i.push(new e.pointGeometry(t[0],t[1]));t.push(i)}return t}}toGeoJSON(e,t,n){return c.call(this,e,t,n)}}class h{constructor(t){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=e.EXTENT,this.length=t.length,this._features=t}feature(e){return new u(this._features[e])}}var d=e.vectorTile.VectorTileFeature,p=f;function f(e,t){this.options=t||{},this.features=e,this.length=e.length}function m(e,t){this.id="number"==typeof e.id?e.id:void 0,this.type=e.type,this.rawGeometry=1===e.type?[e.geometry]:e.geometry,this.properties=e.tags,this.extent=t||4096}f.prototype.feature=function(e){return new m(this.features[e],this.options.extent)},m.prototype.loadGeometry=function(){var t=this.rawGeometry;this.geometry=[];for(var n=0;n<t.length;n++){for(var i=t[n],r=[],a=0;a<i.length;a++)r.push(new e.pointGeometry(i[a][0],i[a][1]));this.geometry.push(r)}return this.geometry},m.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var e=this.geometry,t=1/0,n=-1/0,i=1/0,r=-1/0,a=0;a<e.length;a++)for(var o=e[a],s=0;s<o.length;s++){var l=o[s];t=Math.min(t,l.x),n=Math.max(n,l.x),i=Math.min(i,l.y),r=Math.max(r,l.y)}return[t,i,n,r]},m.prototype.toGeoJSON=d.prototype.toGeoJSON;var g=y,v=p;function y(t){var n=new e.pbf;return function(e,t){for(var n in e.layers)t.writeMessage(3,_,e.layers[n])}(t,n),n.finish()}function _(e,t){var n;t.writeVarintField(15,e.version||1),t.writeStringField(1,e.name||""),t.writeVarintField(5,e.extent||4096);var i={keys:[],values:[],keycache:{},valuecache:{}};for(n=0;n<e.length;n++)i.feature=e.feature(n),t.writeMessage(2,x,i);var r=i.keys;for(n=0;n<r.length;n++)t.writeStringField(3,r[n]);var a=i.values;for(n=0;n<a.length;n++)t.writeMessage(4,E,a[n])}function x(e,t){var n=e.feature;void 0!==n.id&&t.writeVarintField(1,n.id),t.writeMessage(2,b,e),t.writeVarintField(3,n.type),t.writeMessage(4,T,n)}function b(e,t){var n=e.feature,i=e.keys,r=e.values,a=e.keycache,o=e.valuecache;for(var s in n.properties){var l=a[s];void 0===l&&(i.push(s),a[s]=l=i.length-1),t.writeVarint(l);var c=n.properties[s],u=typeof c;"string"!==u&&"boolean"!==u&&"number"!==u&&(c=JSON.stringify(c));var h=u+":"+c,d=o[h];void 0===d&&(r.push(c),o[h]=d=r.length-1),t.writeVarint(d)}}function w(e,t){return(t<<3)+(7&e)}function S(e){return e<<1^e>>31}function T(e,t){for(var n=e.loadGeometry(),i=e.type,r=0,a=0,o=n.length,s=0;s<o;s++){var l=n[s],c=1;1===i&&(c=l.length),t.writeVarint(w(1,c));for(var u=3===i?l.length-1:l.length,h=0;h<u;h++){1===h&&1!==i&&t.writeVarint(w(2,u-1));var d=l[h].x-r,p=l[h].y-a;t.writeVarint(S(d)),t.writeVarint(S(p)),r+=d,a+=p}3===i&&t.writeVarint(w(7,1))}}function E(e,t){var n=typeof e;"string"===n?t.writeStringField(1,e):"boolean"===n?t.writeBooleanField(7,e):"number"===n&&(e%1!=0?t.writeDoubleField(3,e):e<0?t.writeSVarintField(6,e):t.writeVarintField(5,e))}function M(e,t,n,i,r,a){if(r-i<=n)return;const o=i+r>>1;k(e,t,o,i,r,a%2),M(e,t,n,i,o-1,a+1),M(e,t,n,o+1,r,a+1)}function k(e,t,n,i,r,a){for(;r>i;){if(r-i>600){const o=r-i+1,s=n-i+1,l=Math.log(o),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(o-c)/o)*(s-o/2<0?-1:1);k(e,t,n,Math.max(i,Math.floor(n-s*c/o+u)),Math.min(r,Math.floor(n+(o-s)*c/o+u)),a)}const o=t[2*n+a];let s=i,l=r;for(A(e,t,i,n),t[2*r+a]>o&&A(e,t,i,r);s<l;){for(A(e,t,s,l),s++,l--;t[2*s+a]<o;)s++;for(;t[2*l+a]>o;)l--}t[2*i+a]===o?A(e,t,i,l):(l++,A(e,t,l,r)),l<=n&&(i=l+1),n<=l&&(r=l-1)}}function A(e,t,n,i){C(e,n,i),C(t,2*n,2*i),C(t,2*n+1,2*i+1)}function C(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}function P(e,t,n,i){const r=e-n,a=t-i;return r*r+a*a}g.fromVectorTileJs=y,g.fromGeojsonVt=function(e,t){t=t||{};var n={};for(var i in e)n[i]=new p(e[i].features,t),n[i].name=i,n[i].version=t.version,n[i].extent=t.extent;return y({layers:n})},g.GeoJSONWrapper=v;const L=e=>e[0],I=e=>e[1];class R{constructor(e,t=L,n=I,i=64,r=Float64Array){this.nodeSize=i,this.points=e;const a=e.length<65536?Uint16Array:Uint32Array,o=this.ids=new a(e.length),s=this.coords=new r(2*e.length);for(let l=0;l<e.length;l++)o[l]=l,s[2*l]=t(e[l]),s[2*l+1]=n(e[l]);M(o,s,i,0,o.length-1,0)}range(e,t,n,i){return function(e,t,n,i,r,a,o){const s=[0,e.length-1,0],l=[];let c,u;for(;s.length;){const h=s.pop(),d=s.pop(),p=s.pop();if(d-p<=o){for(let o=p;o<=d;o++)c=t[2*o],u=t[2*o+1],c>=n&&c<=r&&u>=i&&u<=a&&l.push(e[o]);continue}const f=Math.floor((p+d)/2);c=t[2*f],u=t[2*f+1],c>=n&&c<=r&&u>=i&&u<=a&&l.push(e[f]);const m=(h+1)%2;(0===h?n<=c:i<=u)&&(s.push(p),s.push(f-1),s.push(m)),(0===h?r>=c:a>=u)&&(s.push(f+1),s.push(d),s.push(m))}return l}(this.ids,this.coords,e,t,n,i,this.nodeSize)}within(e,t,n){return function(e,t,n,i,r,a){const o=[0,e.length-1,0],s=[],l=r*r;for(;o.length;){const c=o.pop(),u=o.pop(),h=o.pop();if(u-h<=a){for(let r=h;r<=u;r++)P(t[2*r],t[2*r+1],n,i)<=l&&s.push(e[r]);continue}const d=Math.floor((h+u)/2),p=t[2*d],f=t[2*d+1];P(p,f,n,i)<=l&&s.push(e[d]);const m=(c+1)%2;(0===c?n-r<=p:i-r<=f)&&(o.push(h),o.push(d-1),o.push(m)),(0===c?n+r>=p:i+r>=f)&&(o.push(d+1),o.push(u),o.push(m))}return s}(this.ids,this.coords,e,t,n,this.nodeSize)}}const z={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:e=>e},D=Math.fround||(O=new Float32Array(1),e=>(O[0]=+e,O[0]));var O;class B{constructor(e){this.options=W(Object.create(z),e),this.trees=new Array(this.options.maxZoom+1)}load(e){const{log:t,minZoom:n,maxZoom:i,nodeSize:r}=this.options;t&&console.time("total time");const a=`prepare ${e.length} points`;t&&console.time(a),this.points=e;let o=[];for(let s=0;s<e.length;s++)e[s].geometry&&o.push(N(e[s],s));this.trees[i+1]=new R(o,q,Z,r,Float32Array),t&&console.timeEnd(a);for(let s=i;s>=n;s--){const e=+Date.now();o=this._cluster(o,s),this.trees[s]=new R(o,q,Z,r,Float32Array),t&&console.log("z%d: %d clusters in %dms",s,o.length,+Date.now()-e)}return t&&console.timeEnd("total time"),this}getClusters(e,t){let n=((e[0]+180)%360+360)%360-180;const i=Math.max(-90,Math.min(90,e[1]));let r=180===e[2]?180:((e[2]+180)%360+360)%360-180;const a=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)n=-180,r=180;else if(n>r){const e=this.getClusters([n,i,180,a],t),o=this.getClusters([-180,i,r,a],t);return e.concat(o)}const o=this.trees[this._limitZoom(t)],s=o.range(j(n),G(a),j(r),G(i)),l=[];for(const c of s){const e=o.points[c];l.push(e.numPoints?U(e):this.points[e.index])}return l}getChildren(e){const t=this._getOriginId(e),n=this._getOriginZoom(e),i="No cluster with the specified id.",r=this.trees[n];if(!r)throw new Error(i);const a=r.points[t];if(!a)throw new Error(i);const o=this.options.radius/(this.options.extent*Math.pow(2,n-1)),s=r.within(a.x,a.y,o),l=[];for(const c of s){const t=r.points[c];t.parentId===e&&l.push(t.numPoints?U(t):this.points[t.index])}if(0===l.length)throw new Error(i);return l}getLeaves(e,t,n){const i=[];return this._appendLeaves(i,e,t=t||10,n=n||0,0),i}getTile(e,t,n){const i=this.trees[this._limitZoom(e)],r=Math.pow(2,e),{extent:a,radius:o}=this.options,s=o/a,l=(n-s)/r,c=(n+1+s)/r,u={features:[]};return this._addTileFeatures(i.range((t-s)/r,l,(t+1+s)/r,c),i.points,t,n,r,u),0===t&&this._addTileFeatures(i.range(1-s/r,l,1,c),i.points,r,n,r,u),t===r-1&&this._addTileFeatures(i.range(0,l,s/r,c),i.points,-1,n,r,u),u.features.length?u:null}getClusterExpansionZoom(e){let t=this._getOriginZoom(e)-1;for(;t<=this.options.maxZoom;){const n=this.getChildren(e);if(t++,1!==n.length)break;e=n[0].properties.cluster_id}return t}_appendLeaves(e,t,n,i,r){const a=this.getChildren(t);for(const o of a){const t=o.properties;if(t&&t.cluster?r+t.point_count<=i?r+=t.point_count:r=this._appendLeaves(e,t.cluster_id,n,i,r):r<i?r++:e.push(o),e.length===n)break}return r}_addTileFeatures(e,t,n,i,r,a){for(const o of e){const e=t[o],s=e.numPoints;let l,c,u;if(s)l=V(e),c=e.x,u=e.y;else{const t=this.points[e.index];l=t.properties,c=j(t.geometry.coordinates[0]),u=G(t.geometry.coordinates[1])}const h={type:1,geometry:[[Math.round(this.options.extent*(c*r-n)),Math.round(this.options.extent*(u*r-i))]],tags:l};let d;s?d=e.id:this.options.generateId?d=e.index:this.points[e.index].id&&(d=this.points[e.index].id),void 0!==d&&(h.id=d),a.features.push(h)}}_limitZoom(e){return Math.max(this.options.minZoom,Math.min(+e,this.options.maxZoom+1))}_cluster(e,t){const n=[],{radius:i,extent:r,reduce:a,minPoints:o}=this.options,s=i/(r*Math.pow(2,t));for(let l=0;l<e.length;l++){const i=e[l];if(i.zoom<=t)continue;i.zoom=t;const r=this.trees[t+1],c=r.within(i.x,i.y,s),u=i.numPoints||1;let h=u;for(const e of c){const n=r.points[e];n.zoom>t&&(h+=n.numPoints||1)}if(h>=o){let e=i.x*u,o=i.y*u,s=a&&u>1?this._map(i,!0):null;const d=(l<<5)+(t+1)+this.points.length;for(const n of c){const l=r.points[n];if(l.zoom<=t)continue;l.zoom=t;const c=l.numPoints||1;e+=l.x*c,o+=l.y*c,l.parentId=d,a&&(s||(s=this._map(i,!0)),a(s,this._map(l)))}i.parentId=d,n.push(F(e/h,o/h,d,h,s))}else if(n.push(i),h>1)for(const e of c){const i=r.points[e];i.zoom<=t||(i.zoom=t,n.push(i))}}return n}_getOriginId(e){return e-this.points.length>>5}_getOriginZoom(e){return(e-this.points.length)%32}_map(e,t){if(e.numPoints)return t?W({},e.properties):e.properties;const n=this.points[e.index].properties,i=this.options.map(n);return t&&i===n?W({},i):i}}function F(e,t,n,i,r){return{x:D(e),y:D(t),zoom:1/0,id:n,parentId:-1,numPoints:i,properties:r}}function N(e,t){const[n,i]=e.geometry.coordinates;return{x:D(j(n)),y:D(G(i)),zoom:1/0,index:t,parentId:-1}}function U(e){return{type:"Feature",id:e.id,properties:V(e),geometry:{type:"Point",coordinates:[(t=e.x,360*(t-.5)),H(e.y)]}};var t}function V(e){const t=e.numPoints,n=t>=1e4?`${Math.round(t/1e3)}k`:t>=1e3?Math.round(t/100)/10+"k":t;return W(W({},e.properties),{cluster:!0,cluster_id:e.id,point_count:t,point_count_abbreviated:n})}function j(e){return e/360+.5}function G(e){const t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function H(e){const t=(180-360*e)*Math.PI/180;return 360*Math.atan(Math.exp(t))/Math.PI-90}function W(e,t){for(const n in t)e[n]=t[n];return e}function q(e){return e.x}function Z(e){return e.y}function $(e,t,n,i){for(var r,a=i,o=n-t>>1,s=n-t,l=e[t],c=e[t+1],u=e[n],h=e[n+1],d=t+3;d<n;d+=3){var p=X(e[d],e[d+1],l,c,u,h);if(p>a)r=d,a=p;else if(p===a){var f=Math.abs(d-o);f<s&&(r=d,s=f)}}a>i&&(r-t>3&&$(e,t,r,i),e[r+2]=a,n-r>3&&$(e,r,n,i))}function X(e,t,n,i,r,a){var o=r-n,s=a-i;if(0!==o||0!==s){var l=((e-n)*o+(t-i)*s)/(o*o+s*s);l>1?(n=r,i=a):l>0&&(n+=o*l,i+=s*l)}return(o=e-n)*o+(s=t-i)*s}function Y(e,t,n,i){var r={id:void 0===e?null:e,type:t,geometry:n,tags:i,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(e){var t=e.geometry,n=e.type;if("Point"===n||"MultiPoint"===n||"LineString"===n)J(e,t);else if("Polygon"===n||"MultiLineString"===n)for(var i=0;i<t.length;i++)J(e,t[i]);else if("MultiPolygon"===n)for(i=0;i<t.length;i++)for(var r=0;r<t[i].length;r++)J(e,t[i][r])}(r),r}function J(e,t){for(var n=0;n<t.length;n+=3)e.minX=Math.min(e.minX,t[n]),e.minY=Math.min(e.minY,t[n+1]),e.maxX=Math.max(e.maxX,t[n]),e.maxY=Math.max(e.maxY,t[n+1])}function K(e,t,n,i){if(t.geometry){var r=t.geometry.coordinates,a=t.geometry.type,o=Math.pow(n.tolerance/((1<<n.maxZoom)*n.extent),2),s=[],l=t.id;if(n.promoteId?l=t.properties[n.promoteId]:n.generateId&&(l=i||0),"Point"===a)Q(r,s);else if("MultiPoint"===a)for(var c=0;c<r.length;c++)Q(r[c],s);else if("LineString"===a)ee(r,s,o,!1);else if("MultiLineString"===a){if(n.lineMetrics){for(c=0;c<r.length;c++)ee(r[c],s=[],o,!1),e.push(Y(l,"LineString",s,t.properties));return}te(r,s,o,!1)}else if("Polygon"===a)te(r,s,o,!0);else{if("MultiPolygon"!==a){if("GeometryCollection"===a){for(c=0;c<t.geometry.geometries.length;c++)K(e,{id:l,geometry:t.geometry.geometries[c],properties:t.properties},n,i);return}throw new Error("Input data is not a valid GeoJSON object.")}for(c=0;c<r.length;c++){var u=[];te(r[c],u,o,!0),s.push(u)}}e.push(Y(l,a,s,t.properties))}}function Q(e,t){t.push(ne(e[0])),t.push(ie(e[1])),t.push(0)}function ee(e,t,n,i){for(var r,a,o=0,s=0;s<e.length;s++){var l=ne(e[s][0]),c=ie(e[s][1]);t.push(l),t.push(c),t.push(0),s>0&&(o+=i?(r*c-l*a)/2:Math.sqrt(Math.pow(l-r,2)+Math.pow(c-a,2))),r=l,a=c}var u=t.length-3;t[2]=1,$(t,0,u,n),t[u+2]=1,t.size=Math.abs(o),t.start=0,t.end=t.size}function te(e,t,n,i){for(var r=0;r<e.length;r++){var a=[];ee(e[r],a,n,i),t.push(a)}}function ne(e){return e/360+.5}function ie(e){var t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function re(e,t,n,i,r,a,o,s){if(i/=t,a>=(n/=t)&&o<i)return e;if(o<n||a>=i)return null;for(var l=[],c=0;c<e.length;c++){var u=e[c],h=u.geometry,d=u.type,p=0===r?u.minX:u.minY,f=0===r?u.maxX:u.maxY;if(p>=n&&f<i)l.push(u);else if(!(f<n||p>=i)){var m=[];if("Point"===d||"MultiPoint"===d)ae(h,m,n,i,r);else if("LineString"===d)oe(h,m,n,i,r,!1,s.lineMetrics);else if("MultiLineString"===d)le(h,m,n,i,r,!1);else if("Polygon"===d)le(h,m,n,i,r,!0);else if("MultiPolygon"===d)for(var g=0;g<h.length;g++){var v=[];le(h[g],v,n,i,r,!0),v.length&&m.push(v)}if(m.length){if(s.lineMetrics&&"LineString"===d){for(g=0;g<m.length;g++)l.push(Y(u.id,d,m[g],u.tags));continue}"LineString"!==d&&"MultiLineString"!==d||(1===m.length?(d="LineString",m=m[0]):d="MultiLineString"),"Point"!==d&&"MultiPoint"!==d||(d=3===m.length?"Point":"MultiPoint"),l.push(Y(u.id,d,m,u.tags))}}}return l.length?l:null}function ae(e,t,n,i,r){for(var a=0;a<e.length;a+=3){var o=e[a+r];o>=n&&o<=i&&(t.push(e[a]),t.push(e[a+1]),t.push(e[a+2]))}}function oe(e,t,n,i,r,a,o){for(var s,l,c=se(e),u=0===r?ue:he,h=e.start,d=0;d<e.length-3;d+=3){var p=e[d],f=e[d+1],m=e[d+2],g=e[d+3],v=e[d+4],y=0===r?p:f,_=0===r?g:v,x=!1;o&&(s=Math.sqrt(Math.pow(p-g,2)+Math.pow(f-v,2))),y<n?_>n&&(l=u(c,p,f,g,v,n),o&&(c.start=h+s*l)):y>i?_<i&&(l=u(c,p,f,g,v,i),o&&(c.start=h+s*l)):ce(c,p,f,m),_<n&&y>=n&&(l=u(c,p,f,g,v,n),x=!0),_>i&&y<=i&&(l=u(c,p,f,g,v,i),x=!0),!a&&x&&(o&&(c.end=h+s*l),t.push(c),c=se(e)),o&&(h+=s)}var b=e.length-3;p=e[b],f=e[b+1],m=e[b+2],(y=0===r?p:f)>=n&&y<=i&&ce(c,p,f,m),b=c.length-3,a&&b>=3&&(c[b]!==c[0]||c[b+1]!==c[1])&&ce(c,c[0],c[1],c[2]),c.length&&t.push(c)}function se(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function le(e,t,n,i,r,a){for(var o=0;o<e.length;o++)oe(e[o],t,n,i,r,a,!1)}function ce(e,t,n,i){e.push(t),e.push(n),e.push(i)}function ue(e,t,n,i,r,a){var o=(a-t)/(i-t);return e.push(a),e.push(n+(r-n)*o),e.push(1),o}function he(e,t,n,i,r,a){var o=(a-n)/(r-n);return e.push(t+(i-t)*o),e.push(a),e.push(1),o}function de(e,t){for(var n=[],i=0;i<e.length;i++){var r,a=e[i],o=a.type;if("Point"===o||"MultiPoint"===o||"LineString"===o)r=pe(a.geometry,t);else if("MultiLineString"===o||"Polygon"===o){r=[];for(var s=0;s<a.geometry.length;s++)r.push(pe(a.geometry[s],t))}else if("MultiPolygon"===o)for(r=[],s=0;s<a.geometry.length;s++){for(var l=[],c=0;c<a.geometry[s].length;c++)l.push(pe(a.geometry[s][c],t));r.push(l)}n.push(Y(a.id,o,r,a.tags))}return n}function pe(e,t){var n=[];n.size=e.size,void 0!==e.start&&(n.start=e.start,n.end=e.end);for(var i=0;i<e.length;i+=3)n.push(e[i]+t,e[i+1],e[i+2]);return n}function fe(e,t){if(e.transformed)return e;var n,i,r,a=1<<e.z,o=e.x,s=e.y;for(n=0;n<e.features.length;n++){var l=e.features[n],c=l.geometry,u=l.type;if(l.geometry=[],1===u)for(i=0;i<c.length;i+=2)l.geometry.push(me(c[i],c[i+1],t,a,o,s));else for(i=0;i<c.length;i++){var h=[];for(r=0;r<c[i].length;r+=2)h.push(me(c[i][r],c[i][r+1],t,a,o,s));l.geometry.push(h)}}return e.transformed=!0,e}function me(e,t,n,i,r,a){return[Math.round(n*(e*i-r)),Math.round(n*(t*i-a))]}function ge(e,t,n,i,r){for(var a=t===r.maxZoom?0:r.tolerance/((1<<t)*r.extent),o={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:n,y:i,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<e.length;s++){o.numFeatures++,ve(o,e[s],a,r);var l=e[s].minX,c=e[s].minY,u=e[s].maxX,h=e[s].maxY;l<o.minX&&(o.minX=l),c<o.minY&&(o.minY=c),u>o.maxX&&(o.maxX=u),h>o.maxY&&(o.maxY=h)}return o}function ve(e,t,n,i){var r=t.geometry,a=t.type,o=[];if("Point"===a||"MultiPoint"===a)for(var s=0;s<r.length;s+=3)o.push(r[s]),o.push(r[s+1]),e.numPoints++,e.numSimplified++;else if("LineString"===a)ye(o,r,e,n,!1,!1);else if("MultiLineString"===a||"Polygon"===a)for(s=0;s<r.length;s++)ye(o,r[s],e,n,"Polygon"===a,0===s);else if("MultiPolygon"===a)for(var l=0;l<r.length;l++){var c=r[l];for(s=0;s<c.length;s++)ye(o,c[s],e,n,!0,0===s)}if(o.length){var u=t.tags||null;if("LineString"===a&&i.lineMetrics){for(var h in u={},t.tags)u[h]=t.tags[h];u.mapbox_clip_start=r.start/r.size,u.mapbox_clip_end=r.end/r.size}var d={geometry:o,type:"Polygon"===a||"MultiPolygon"===a?3:"LineString"===a||"MultiLineString"===a?2:1,tags:u};null!==t.id&&(d.id=t.id),e.features.push(d)}}function ye(e,t,n,i,r,a){var o=i*i;if(i>0&&t.size<(r?o:i))n.numPoints+=t.length/3;else{for(var s=[],l=0;l<t.length;l+=3)(0===i||t[l+2]>o)&&(n.numSimplified++,s.push(t[l]),s.push(t[l+1])),n.numPoints++;r&&function(e,t){for(var n=0,i=0,r=e.length,a=r-2;i<r;a=i,i+=2)n+=(e[i]-e[a])*(e[i+1]+e[a+1]);if(n>0===t)for(i=0,r=e.length;i<r/2;i+=2){var o=e[i],s=e[i+1];e[i]=e[r-2-i],e[i+1]=e[r-1-i],e[r-2-i]=o,e[r-1-i]=s}}(s,a),e.push(s)}}function _e(e,t){var n=(t=this.options=function(e,t){for(var n in t)e[n]=t[n];return e}(Object.create(this.options),t)).debug;if(n&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");var i=function(e,t){var n=[];if("FeatureCollection"===e.type)for(var i=0;i<e.features.length;i++)K(n,e.features[i],t,i);else K(n,"Feature"===e.type?e:{geometry:e},t);return n}(e,t);this.tiles={},this.tileCoords=[],n&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(i=function(e,t){var n=t.buffer/t.extent,i=e,r=re(e,1,-1-n,n,0,-1,2,t),a=re(e,1,1-n,2+n,0,-1,2,t);return(r||a)&&(i=re(e,1,-n,1+n,0,-1,2,t)||[],r&&(i=de(r,1).concat(i)),a&&(i=i.concat(de(a,-1)))),i}(i,t)).length&&this.splitTile(i,0,0,0),n&&(i.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function xe(e,t,n){return 32*((1<<e)*n+t)+e}function be(e,t){const n=e.tileID.canonical;if(!this._geoJSONIndex)return t(null,null);const i=this._geoJSONIndex.getTile(n.z,n.x,n.y);if(!i)return t(null,null);const r=new h(i.features);let a=g(r);0===a.byteOffset&&a.byteLength===a.buffer.byteLength||(a=new Uint8Array(a)),t(null,{vectorTile:r,rawData:a.buffer})}_e.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},_e.prototype.splitTile=function(e,t,n,i,r,a,o){for(var s=[e,t,n,i],l=this.options,c=l.debug;s.length;){i=s.pop(),n=s.pop(),t=s.pop(),e=s.pop();var u=1<<t,h=xe(t,n,i),d=this.tiles[h];if(!d&&(c>1&&console.time("creation"),d=this.tiles[h]=ge(e,t,n,i,l),this.tileCoords.push({z:t,x:n,y:i}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,n,i,d.numFeatures,d.numPoints,d.numSimplified),console.timeEnd("creation"));var p="z"+t;this.stats[p]=(this.stats[p]||0)+1,this.total++}if(d.source=e,r){if(t===l.maxZoom||t===r)continue;var f=1<<r-t;if(n!==Math.floor(a/f)||i!==Math.floor(o/f))continue}else if(t===l.indexMaxZoom||d.numPoints<=l.indexMaxPoints)continue;if(d.source=null,0!==e.length){c>1&&console.time("clipping");var m,g,v,y,_,x,b=.5*l.buffer/l.extent,w=.5-b,S=.5+b,T=1+b;m=g=v=y=null,_=re(e,u,n-b,n+S,0,d.minX,d.maxX,l),x=re(e,u,n+w,n+T,0,d.minX,d.maxX,l),e=null,_&&(m=re(_,u,i-b,i+S,1,d.minY,d.maxY,l),g=re(_,u,i+w,i+T,1,d.minY,d.maxY,l),_=null),x&&(v=re(x,u,i-b,i+S,1,d.minY,d.maxY,l),y=re(x,u,i+w,i+T,1,d.minY,d.maxY,l),x=null),c>1&&console.timeEnd("clipping"),s.push(m||[],t+1,2*n,2*i),s.push(g||[],t+1,2*n,2*i+1),s.push(v||[],t+1,2*n+1,2*i),s.push(y||[],t+1,2*n+1,2*i+1)}}},_e.prototype.getTile=function(e,t,n){var i=this.options,r=i.extent,a=i.debug;if(e<0||e>24)return null;var o=1<<e,s=xe(e,t=(t%o+o)%o,n);if(this.tiles[s])return fe(this.tiles[s],r);a>1&&console.log("drilling down to z%d-%d-%d",e,t,n);for(var l,c=e,u=t,h=n;!l&&c>0;)c--,u=Math.floor(u/2),h=Math.floor(h/2),l=this.tiles[xe(c,u,h)];return l&&l.source?(a>1&&console.log("found parent tile z%d-%d-%d",c,u,h),a>1&&console.time("drilling down"),this.splitTile(l.source,c,u,h,e,t,n),a>1&&console.timeEnd("drilling down"),this.tiles[s]?fe(this.tiles[s],r):null):null};class we extends e.VectorTileWorkerSource{constructor(e,t,n,i,r){super(e,t,n,i,be),r&&(this.loadGeoJSON=r)}loadData(t,n){const i=t&&t.request,r=i&&i.collectResourceTiming;this.loadGeoJSON(t,((a,s)=>{if(a||!s)return n(a);if("object"!=typeof s)return n(new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`));{o(s,!0);try{if(t.filter){const n=e.createExpression(t.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===n.result)throw new Error(n.value.map((e=>`${e.key}: ${e.message}`)).join(", "));const i=s.features.filter((e=>n.value.evaluate({zoom:0},e)));s={type:"FeatureCollection",features:i}}this._geoJSONIndex=t.cluster?new B(function({superclusterOptions:t,clusterProperties:n}){if(!n||!t)return t;const i={},r={},a={accumulated:null,zoom:0},o={properties:null},s=Object.keys(n);for(const l of s){const[t,a]=n[l],o=e.createExpression(a),s=e.createExpression("string"==typeof t?[t,["accumulated"],["get",l]]:t);i[l]=o.value,r[l]=s.value}return t.map=e=>{o.properties=e;const t={};for(const n of s)t[n]=i[n].evaluate(a,o);return t},t.reduce=(e,t)=>{o.properties=t;for(const n of s)a.accumulated=e[n],e[n]=r[n].evaluate(a,o)},t}(t)).load(s.features):function(e,t){return new _e(e,t)}(s,t.geojsonVtOptions)}catch(a){return n(a)}this.loaded={};const l={};if(r){const n=e.getPerformanceMeasurement(i);n&&(l.resourceTiming={},l.resourceTiming[t.source]=JSON.parse(JSON.stringify(n)))}n(null,l)}}))}reloadTile(e,t){const n=this.loaded;return n&&n[e.uid]?super.reloadTile(e,t):this.loadTile(e,t)}loadGeoJSON(t,n){if(t.request)e.getJSON(t.request,n);else{if("string"!=typeof t.data)return n(new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`));try{return n(null,JSON.parse(t.data))}catch(e){return n(new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(e,t){try{t(null,this._geoJSONIndex.getClusterExpansionZoom(e.clusterId))}catch(e){t(e)}}getClusterChildren(e,t){try{t(null,this._geoJSONIndex.getChildren(e.clusterId))}catch(e){t(e)}}getClusterLeaves(e,t){try{t(null,this._geoJSONIndex.getLeaves(e.clusterId,e.limit,e.offset))}catch(e){t(e)}}}class Se{constructor(t){this.self=t,this.actor=new e.Actor(t,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded=!1,this.workerSourceTypes={vector:e.VectorTileWorkerSource,geojson:we},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(e,t)=>{if(this.workerSourceTypes[e])throw new Error(`Worker source with name "${e}" already registered.`);this.workerSourceTypes[e]=t},this.self.registerRTLTextPlugin=t=>{if(e.plugin.isParsed())throw new Error("RTL text plugin already registered.");e.plugin.applyArabicShaping=t.applyArabicShaping,e.plugin.processBidirectionalText=t.processBidirectionalText,e.plugin.processStyledBidirectionalText=t.processStyledBidirectionalText}}checkIfReady(e,t,n){n()}setReferrer(e,t){this.referrer=t}spriteLoaded(t,n){this.isSpriteLoaded=n;for(const i in this.workerSources[t]){const r=this.workerSources[t][i];for(const t in r)r[t]instanceof e.VectorTileWorkerSource&&(r[t].isSpriteLoaded=n,r[t].fire(new e.Event("isSpriteLoaded")))}}setImages(e,t,n){this.availableImages[e]=t;for(const i in this.workerSources[e]){const n=this.workerSources[e][i];for(const e in n)n[e].availableImages=t}n()}enableTerrain(e,t,n){this.terrain=t,n()}setLayers(e,t,n){this.getLayerIndex(e).replace(t),n()}updateLayers(e,t,n){this.getLayerIndex(e).update(t.layers,t.removedIds),n()}loadTile(t,n,i){const r=this.enableTerrain?e.extend({enableTerrain:this.terrain},n):n;this.getWorkerSource(t,n.type,n.source).loadTile(r,i)}loadDEMTile(t,n,i){const r=this.enableTerrain?e.extend({buildQuadTree:this.terrain},n):n;this.getDEMWorkerSource(t,n.source).loadTile(r,i)}reloadTile(t,n,i){const r=this.enableTerrain?e.extend({enableTerrain:this.terrain},n):n;this.getWorkerSource(t,n.type,n.source).reloadTile(r,i)}abortTile(e,t,n){this.getWorkerSource(e,t.type,t.source).abortTile(t,n)}removeTile(e,t,n){this.getWorkerSource(e,t.type,t.source).removeTile(t,n)}removeSource(e,t,n){if(!this.workerSources[e]||!this.workerSources[e][t.type]||!this.workerSources[e][t.type][t.source])return;const i=this.workerSources[e][t.type][t.source];delete this.workerSources[e][t.type][t.source],void 0!==i.removeSource?i.removeSource(t,n):n()}loadWorkerSource(e,t,n){try{this.self.importScripts(t.url),n()}catch(e){n(e.toString())}}syncRTLPluginState(t,n,i){try{e.plugin.setState(n);const t=e.plugin.getPluginURL();if(e.plugin.isLoaded()&&!e.plugin.isParsed()&&null!=t){this.self.importScripts(t);const n=e.plugin.isParsed();i(n?void 0:new Error(`RTL Text Plugin failed to import scripts from ${t}`),n)}}catch(e){i(e.toString())}}getAvailableImages(e){let t=this.availableImages[e];return t||(t=[]),t}getLayerIndex(e){let t=this.layerIndexes[e];return t||(t=this.layerIndexes[e]=new i),t}getWorkerSource(e,t,n){return this.workerSources[e]||(this.workerSources[e]={}),this.workerSources[e][t]||(this.workerSources[e][t]={}),this.workerSources[e][t][n]||(this.workerSources[e][t][n]=new this.workerSourceTypes[t]({send:(t,n,i,r,a,o)=>{this.actor.send(t,n,i,e,a,o)},scheduler:this.actor.scheduler},this.getLayerIndex(e),this.getAvailableImages(e),this.isSpriteLoaded)),this.workerSources[e][t][n]}getDEMWorkerSource(e,t){return this.demWorkerSources[e]||(this.demWorkerSources[e]={}),this.demWorkerSources[e][t]||(this.demWorkerSources[e][t]=new a),this.demWorkerSources[e][t]}enforceCacheSizeLimit(t,n){e.enforceCacheSizeLimit(n)}getWorkerPerformanceMetrics(e,t,n){n(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new Se(self)),Se})),i(["./shared"],(function(e){var t=n;function n(e){return!function(e){return"undefined"==typeof window||"undefined"==typeof document?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var e,t,n=new Blob([""],{type:"text/javascript"}),i=URL.createObjectURL(n);try{t=new Worker(i),e=!0}catch(t){e=!1}return t&&t.terminate(),URL.revokeObjectURL(i),e}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var e=document.createElement("canvas");e.width=e.height=1;var t=e.getContext("2d");if(!t)return!1;var n=t.getImageData(0,0,1,1);return n&&n.width===e.width}()?(void 0===i[t=e&&e.failIfMajorPerformanceCaveat]&&(i[t]=function(e){var t,i=function(e){var t=document.createElement("canvas"),i=Object.create(n.webGLContextAttributes);return i.failIfMajorPerformanceCaveat=e,t.getContext("webgl",i)||t.getContext("experimental-webgl",i)}(e);if(!i)return!1;try{t=i.createShader(i.VERTEX_SHADER)}catch(e){return!1}return!(!t||i.isContextLost())&&(i.shaderSource(t,"void main() {}"),i.compileShader(t),!0===i.getShaderParameter(t,i.COMPILE_STATUS))}(t)),i[t]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var t}(e)}var i={};function r(e,t){if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!r(e[n],t[n]))return!1;return!0}if("object"==typeof e&&null!==e&&null!==t){if("object"!=typeof t)return!1;if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(!r(e[n],t[n]))return!1;return!0}return e===t}n.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const a={create:function(t,n,i){const r=e.window.document.createElement(t);return void 0!==n&&(r.className=n),i&&i.appendChild(r),r},createNS:function(t,n){return e.window.document.createElementNS(t,n)}},o=e.window.document&&e.window.document.documentElement.style,s=o&&void 0!==o.userSelect?"userSelect":"WebkitUserSelect";let l;a.disableDrag=function(){o&&s&&(l=o[s],o[s]="none")},a.enableDrag=function(){o&&s&&(o[s]=l)},a.setTransform=function(e,t){e.style.transform=t};let c=!1;try{const t=Object.defineProperty({},"passive",{get(){c=!0}});e.window.addEventListener("test",t,t),e.window.removeEventListener("test",t,t)}catch(e){c=!1}a.addEventListener=function(e,t,n,i={}){e.addEventListener(t,n,"passive"in i&&c?i:i.capture)},a.removeEventListener=function(e,t,n,i={}){e.removeEventListener(t,n,"passive"in i&&c?i:i.capture)};const u=function(t){t.preventDefault(),t.stopPropagation(),e.window.removeEventListener("click",u,!0)};function h(t,n,i){const r=t.offsetWidth===n.width?1:t.offsetWidth/n.width;return new e.pointGeometry((i.clientX-n.left)*r,(i.clientY-n.top)*r)}a.suppressClick=function(){e.window.addEventListener("click",u,!0),e.window.setTimeout((()=>{e.window.removeEventListener("click",u,!0)}),0)},a.mousePos=function(e,t){const n=e.getBoundingClientRect();return h(e,n,t)},a.touchPos=function(e,t){const n=e.getBoundingClientRect(),i=[];for(let r=0;r<t.length;r++)i.push(h(e,n,t[r]));return i},a.mouseButton=function(t){return void 0!==e.window.InstallTrigger&&2===t.button&&t.ctrlKey&&e.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:t.button},a.remove=function(e){e.parentNode&&e.parentNode.removeChild(e)};class d{constructor(e,t){this.pos=e,this.dir=t}intersectsPlane(t,n,i){const r=e.dot(n,this.dir);if(Math.abs(r)<1e-6)return!1;const a=e.dot(e.sub(e.create(),t,this.pos),n)/r,o=e.scaleAndAdd(e.create(),this.pos,this.dir,a);return e.copy(i,o),!0}}class p{constructor(e,t){this.points=e,this.planes=t}static fromInvProjectionMatrix(t,n,i){const r=Math.pow(2,i),a=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((i=>{const a=e.transformMat4([],i,t),o=1/a[3]/n*r;return e.mul(a,a,[o,o,1/a[3],o])})),o=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((t=>{const n=e.sub([],a[t[0]],a[t[1]]),i=e.sub([],a[t[2]],a[t[1]]),r=e.normalize([],e.cross([],n,i)),o=-e.dot(r,a[t[1]]);return r.concat(o)}));return new p(a,o)}}class f{constructor(t,n){this.min=t,this.max=n,this.center=e.scale([],e.add([],this.min,this.max),.5)}quadrant(t){const n=[t%2==0,t<2],i=e.clone(this.min),r=e.clone(this.max);for(let e=0;e<n.length;e++)i[e]=n[e]?this.min[e]:this.center[e],r[e]=n[e]?this.center[e]:this.max[e];return r[2]=this.max[2],new f(i,r)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}intersects(t){const n=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let i=!0;for(let r=0;r<t.planes.length;r++){const a=t.planes[r];let o=0;for(let t=0;t<n.length;t++)o+=e.dot$1(a,n[t])>=0;if(0===o)return 0;o!==n.length&&(i=!1)}if(i)return 2;for(let e=0;e<3;e++){let n=Number.MAX_VALUE,i=-Number.MAX_VALUE;for(let r=0;r<t.points.length;r++){const a=t.points[r][e]-this.min[e];n=Math.min(n,a),i=Math.max(i,a)}if(i<0||n>this.max[e]-this.min[e])return 0}return 1}}function m(e){const{userImage:t}=e;return!!(t&&t.render&&t.render())&&(e.data.replace(new Uint8Array(t.data.buffer)),!0)}class g extends e.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new e.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:e,callback:t}of this.requestors)this._notify(e,t);this.requestors=[]}}getImage(e){return this.images[e]}addImage(e,t){this._validate(e,t)&&(this.images[e]=t)}_validate(t,n){let i=!0;return this._validateStretch(n.stretchX,n.data&&n.data.width)||(this.fire(new e.ErrorEvent(new Error(`Image "${t}" has invalid "stretchX" value`))),i=!1),this._validateStretch(n.stretchY,n.data&&n.data.height)||(this.fire(new e.ErrorEvent(new Error(`Image "${t}" has invalid "stretchY" value`))),i=!1),this._validateContent(n.content,n)||(this.fire(new e.ErrorEvent(new Error(`Image "${t}" has invalid "content" value`))),i=!1),i}_validateStretch(e,t){if(!e)return!0;let n=0;for(const i of e){if(i[0]<n||i[1]<i[0]||t<i[1])return!1;n=i[1]}return!0}_validateContent(e,t){return!(e&&(4!==e.length||e[0]<0||t.data.width<e[0]||e[1]<0||t.data.height<e[1]||e[2]<0||t.data.width<e[2]||e[3]<0||t.data.height<e[3]||e[2]<e[0]||e[3]<e[1]))}updateImage(e,t){t.version=this.images[e].version+1,this.images[e]=t,this.updatedImages[e]=!0}removeImage(e){const t=this.images[e];delete this.images[e],delete this.patterns[e],t.userImage&&t.userImage.onRemove&&t.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e,t){let n=!0;if(!this.isLoaded())for(const i of e)this.images[i]||(n=!1);this.isLoaded()||n?this._notify(e,t):this.requestors.push({ids:e,callback:t})}_notify(t,n){const i={};for(const r of t){this.images[r]||this.fire(new e.Event("styleimagemissing",{id:r}));const t=this.images[r];t?i[r]={data:t.data.clone(),pixelRatio:t.pixelRatio,sdf:t.sdf,version:t.version,stretchX:t.stretchX,stretchY:t.stretchY,content:t.content,hasRenderCallback:Boolean(t.userImage&&t.userImage.render)}:e.warnOnce(`Image "${r}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}n(null,i)}getPixelSize(){const{width:e,height:t}=this.atlasImage;return{width:e,height:t}}getPattern(t){const n=this.patterns[t],i=this.getImage(t);if(!i)return null;if(n&&n.position.version===i.version)return n.position;if(n)n.position.version=i.version;else{const n={w:i.data.width+2,h:i.data.height+2,x:0,y:0},r=new e.ImagePosition(n,i);this.patterns[t]={bin:n,position:r}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const n=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new e.Texture(t,this.atlasImage,n.RGBA),this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const e in this.patterns)t.push(this.patterns[e].bin);const{w:n,h:i}=e.potpack(t),r=this.atlasImage;r.resize({width:n||1,height:i||1});for(const a in this.patterns){const{bin:t}=this.patterns[a],n=t.x+1,i=t.y+1,o=this.images[a].data,s=o.width,l=o.height;e.RGBAImage.copy(o,r,{x:0,y:0},{x:n,y:i},{width:s,height:l}),e.RGBAImage.copy(o,r,{x:0,y:l-1},{x:n,y:i-1},{width:s,height:1}),e.RGBAImage.copy(o,r,{x:0,y:0},{x:n,y:i+l},{width:s,height:1}),e.RGBAImage.copy(o,r,{x:s-1,y:0},{x:n-1,y:i},{width:1,height:l}),e.RGBAImage.copy(o,r,{x:0,y:0},{x:n+s,y:i},{width:1,height:l})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const t of e){if(this.callbackDispatchedThisFrame[t])continue;this.callbackDispatchedThisFrame[t]=!0;const e=this.images[t];m(e)&&this.updateImage(t,e)}}}const v=new e.Properties({anchor:new e.DataConstantProperty(e.spec.light.anchor),position:new class{constructor(){this.specification=e.spec.light.position}possiblyEvaluate(t,n){return function([t,n,i]){const r=e.degToRad(n+90),a=e.degToRad(i);return{x:t*Math.cos(r)*Math.sin(a),y:t*Math.sin(r)*Math.sin(a),z:t*Math.cos(a),azimuthal:n,polar:i}}(t.expression.evaluate(n))}interpolate(t,n,i){return{x:e.number(t.x,n.x,i),y:e.number(t.y,n.y,i),z:e.number(t.z,n.z,i),azimuthal:e.number(t.azimuthal,n.azimuthal,i),polar:e.number(t.polar,n.polar,i)}}},color:new e.DataConstantProperty(e.spec.light.color),intensity:new e.DataConstantProperty(e.spec.light.intensity)}),y="-transition";class _ extends e.Evented{constructor(t){super(),this._transitionable=new e.Transitionable(v),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,n={}){if(!this._validate(e.validateLight,t,n))for(const i in t){const n=t[i];e.endsWith(i,y)?this._transitionable.setTransition(i.slice(0,-y.length),n):this._transitionable.setValue(i,n)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(t,n,i){return(!i||!1!==i.validate)&&e.emitValidationErrors(this,t.call(e.validateStyle,e.extend({value:n,style:{glyphs:!0,sprite:!0},styleSpec:e.spec})))}}const x=new e.Properties({source:new e.DataConstantProperty(e.spec.terrain.source),exaggeration:new e.DataConstantProperty(e.spec.terrain.exaggeration)}),b="-transition";class w extends e.Evented{constructor(t){super(),this._transitionable=new e.Transitionable(x),this.set(t),this._transitioning=this._transitionable.untransitioned()}get(){return this._transitionable.serialize()}set(t){for(const n in t){const i=t[n];e.endsWith(n,b)?this._transitionable.setTransition(n.slice(0,-b.length),i):this._transitionable.setValue(n,i)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}}function S(t,n,i,r){const a=e.smoothstep(45,65,i),[o,s]=T(t,r),l=e.length(n);let c=1-Math.min(1,Math.exp((l-o)/(s-o)*-6));return c*=c*c,c=Math.min(1,1.00747*c),c*a*t.alpha}function T(e,t){const n=.5/Math.tan(.5*t);return[e.range[0]+n,e.range[1]+n]}const E=new e.Properties({range:new e.DataConstantProperty(e.spec.fog.range),color:new e.DataConstantProperty(e.spec.fog.color),"horizon-blend":new e.DataConstantProperty(e.spec.fog["horizon-blend"])}),M="-transition";class k extends e.Evented{constructor(t){super(),this._transitionable=new e.Transitionable(E),this.set(t),this._transitioning=this._transitionable.untransitioned()}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t){if(!this._validate(e.validateFog,t))for(const n in t){const i=t[n];e.endsWith(n,M)?this._transitionable.setTransition(n.slice(0,-M.length),i):this._transitionable.setValue(n,i)}}getOpacity(t){const n=this.properties&&this.properties.get("color")||1;return e.smoothstep(45,65,t)*n.a}getOpacityAtLatLng(t,n){return function(t,n,i){const r=e.MercatorCoordinate.fromLngLat(n),a=i.elevation?i.elevation.getAtPointOrZero(r):0,o=[r.x,r.y,a];return e.transformMat4$1(o,o,i.mercatorFogMatrix),S(t,o,i.pitch,i._fov)}(this.state,t,n)}getFovAdjustedRange(e){return T(this.state,e)}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(t,n,i){return(!i||!1!==i.validate)&&e.emitValidationErrors(this,t.call(e.validateStyle,e.extend({value:n,style:{glyphs:!0,sprite:!0},styleSpec:e.spec})))}}class A{constructor(t,n){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=e.uniqueId();const i=this.workerPool.acquire(this.id);for(let e=0;e<i.length;e++){const t=new A.Actor(i[e],n,this.id);t.name=`Worker ${e}`,this.actors.push(t)}this.ready=!1,this.broadcast("checkIfReady",null,(()=>{this.ready=!0}))}broadcast(t,n,i){e.asyncAll(this.actors,((e,i)=>{e.send(t,n,i)}),i=i||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach((e=>{e.remove()})),this.actors=[],this.workerPool.release(this.id)}}function C(t,n,i){return n*(e.EXTENT/(t.tileSize*Math.pow(2,i-t.tileID.overscaledZ)))}A.Actor=e.Actor;class P{constructor(e,t,n,i){this.screenBounds=e,this.cameraPoint=t,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=n,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map((e=>i.pointCoordinate3D(e))),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(t,n){let i,r;if(t instanceof e.pointGeometry||"number"==typeof t[0]){const a=e.pointGeometry.convert(t);i=[e.pointGeometry.convert(t)],r=n.isPointAboveHorizon(a)}else{const a=e.pointGeometry.convert(t[0]),o=e.pointGeometry.convert(t[1]);i=[a,o],r=e.polygonizeBounds(a,o).every((e=>n.isPointAboveHorizon(e)))}return new P(i,n.getCameraPoint(),r,n)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(t){return e.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const n=this.screenBounds[0],i=1===this.screenBounds.length?this.screenBounds[0].add(new e.pointGeometry(1,1)):this.screenBounds[1],r=e.polygonizeBounds(n,i,0,!1);return this.cameraPoint.y>i.y&&(this.cameraPoint.x>n.x&&this.cameraPoint.x<i.x?r.splice(3,0,this.cameraPoint):this.cameraPoint.x>=i.x?r[2]=this.cameraPoint:this.cameraPoint.x<=n.x&&(r[3]=this.cameraPoint)),e.bufferConvexPolygon(r,t)}containsTile(t,n,i){const r=t.queryPadding+1,a=i?this._bufferedCameraMercator(r,n).map((e=>t.tileID.getTilePoint(e))):this._bufferedScreenMercator(r,n).map((e=>t.tileID.getTilePoint(e))),o=this.screenGeometryMercator.map((e=>t.tileID.getTileVec3(e))),s=o.map((t=>new e.pointGeometry(t[0],t[1]))),l=n.getFreeCameraOptions().position||new e.MercatorCoordinate(0,0,0),c=t.tileID.getTileVec3(l),u=o.map((t=>{const n=e.sub(t,t,c);return e.normalize(n,n),new d(c,n)})),h=C(t,1,n.zoom);if(e.polygonIntersectsBox(a,0,0,e.EXTENT,e.EXTENT))return{queryGeometry:this,tilespaceGeometry:s,tilespaceRays:u,bufferedTilespaceGeometry:a,bufferedTilespaceBounds:(p=e.getBounds(a),p.min.x=e.clamp(p.min.x,0,e.EXTENT),p.min.y=e.clamp(p.min.y,0,e.EXTENT),p.max.x=e.clamp(p.max.x,0,e.EXTENT),p.max.y=e.clamp(p.max.y,0,e.EXTENT),p),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:h};var p}_bufferedScreenMercator(e,t){const n=L(e);if(this._screenRaycastCache[n])return this._screenRaycastCache[n];{const i=this.bufferedScreenGeometry(e).map((e=>t.pointCoordinate3D(e)));return this._screenRaycastCache[n]=i,i}}_bufferedCameraMercator(e,t){const n=L(e);if(this._cameraRaycastCache[n])return this._cameraRaycastCache[n];{const i=this.bufferedCameraGeometry(e).map((e=>t.pointCoordinate3D(e)));return this._cameraRaycastCache[n]=i,i}}}function L(e){return 100*e|0}function I(t,n,i){const r=function(r,a){if(r)return i(r);if(a){const r=e.pick(e.extend(a,t),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);a.vector_layers&&(r.vectorLayers=a.vector_layers,r.vectorLayerIds=r.vectorLayers.map((e=>e.id))),r.tiles=n.canonicalizeTileset(r,t.url),i(null,r)}};return t.url?e.getJSON(n.transformRequest(n.normalizeSourceURL(t.url),e.ResourceType.Source),r):e.exported.frame((()=>r(null,t)))}class R{constructor(t,n,i){this.bounds=e.LngLatBounds.convert(this.validateBounds(t)),this.minzoom=n||0,this.maxzoom=i||24}validateBounds(e){return Array.isArray(e)&&4===e.length?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(t){const n=Math.pow(2,t.z),i=Math.floor(e.mercatorXfromLng(this.bounds.getWest())*n),r=Math.floor(e.mercatorYfromLat(this.bounds.getNorth())*n),a=Math.ceil(e.mercatorXfromLng(this.bounds.getEast())*n),o=Math.ceil(e.mercatorYfromLat(this.bounds.getSouth())*n);return t.x>=i&&t.x<a&&t.y>=r&&t.y<o}}class z{constructor(e,t,n){this.context=e;const i=e.gl;this.buffer=i.createBuffer(),this.dynamicDraw=Boolean(n),this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),i.bufferData(i.ELEMENT_ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?i.DYNAMIC_DRAW:i.STATIC_DRAW),this.dynamicDraw||delete t.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const t=this.context.gl;this.context.unbindVAO(),this.bind(),t.bufferSubData(t.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const D={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class O{constructor(e,t,n,i){this.length=t.length,this.attributes=n,this.itemSize=t.bytesPerElement,this.dynamicDraw=i,this.context=e;const r=e.gl;this.buffer=r.createBuffer(),e.bindVertexBuffer.set(this.buffer),r.bufferData(r.ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?r.DYNAMIC_DRAW:r.STATIC_DRAW),this.dynamicDraw||delete t.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){const t=this.context.gl;this.bind(),t.bufferSubData(t.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,t){for(let n=0;n<this.attributes.length;n++){const i=t.attributes[this.attributes[n].name];void 0!==i&&e.enableVertexAttribArray(i)}}setVertexAttribPointers(e,t,n){for(let i=0;i<this.attributes.length;i++){const r=this.attributes[i],a=t.attributes[r.name];void 0!==a&&e.vertexAttribPointer(a,r.components,e[D[r.type]],!1,this.itemSize,r.offset+this.itemSize*(n||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class B{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class F extends B{getDefault(){return e.Color.transparent}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class N extends B{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class U extends B{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class V extends B{getDefault(){return[!0,!0,!0,!0]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class j extends B{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class G extends B{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class H extends B{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const t=this.current;(e.func!==t.func||e.ref!==t.ref||e.mask!==t.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class W extends B{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class q extends B{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),this.current=e,this.dirty=!1}}class Z extends B{getDefault(){return[0,1]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class $ extends B{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),this.current=e,this.dirty=!1}}class X extends B{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class Y extends B{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.BLEND):t.disable(t.BLEND),this.current=e,this.dirty=!1}}class J extends B{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class K extends B{getDefault(){return e.Color.transparent}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Q extends B{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class ee extends B{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),this.current=e,this.dirty=!1}}class te extends B{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class ne extends B{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class ie extends B{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class re extends B{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class ae extends B{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class oe extends B{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class se extends B{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindRenderbuffer(t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class le extends B{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindTexture(t.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class ce extends B{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindBuffer(t.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class ue extends B{getDefault(){return null}set(e){const t=this.gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class he extends B{constructor(e){super(e),this.vao=e.extVertexArrayObject}getDefault(){return null}set(e){this.vao&&(e!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(e),this.current=e,this.dirty=!1)}}class de extends B{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class pe extends B{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class fe extends B{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class me extends B{constructor(e,t){super(e),this.context=e,this.parent=t}getDefault(){return null}}class ge extends me{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class ve extends me{attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferRenderbuffer(t.FRAMEBUFFER,this.attachment(),t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class ye extends ve{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class _e{constructor(e,t,n,i){this.context=e,this.width=t,this.height=n;const r=this.framebuffer=e.gl.createFramebuffer();this.colorAttachment=new ge(e,r),i&&(this.depthAttachment=new ve(e,r))}destroy(){const e=this.context.gl,t=this.colorAttachment.get();if(t&&e.deleteTexture(t),this.depthAttachment){const t=this.depthAttachment.get();t&&e.deleteRenderbuffer(t)}e.deleteFramebuffer(this.framebuffer)}}class xe{constructor(e){this.gl=e,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new F(this),this.clearDepth=new N(this),this.clearStencil=new U(this),this.colorMask=new V(this),this.depthMask=new j(this),this.stencilMask=new G(this),this.stencilFunc=new H(this),this.stencilOp=new W(this),this.stencilTest=new q(this),this.depthRange=new Z(this),this.depthTest=new $(this),this.depthFunc=new X(this),this.blend=new Y(this),this.blendFunc=new J(this),this.blendColor=new K(this),this.blendEquation=new Q(this),this.cullFace=new ee(this),this.cullFaceSide=new te(this),this.frontFace=new ne(this),this.program=new ie(this),this.activeTexture=new re(this),this.viewport=new ae(this),this.bindFramebuffer=new oe(this),this.bindRenderbuffer=new se(this),this.bindTexture=new le(this),this.bindVertexBuffer=new ce(this),this.bindElementBuffer=new ue(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new he(this),this.pixelStoreUnpack=new de(this),this.pixelStoreUnpackPremultiplyAlpha=new pe(this),this.pixelStoreUnpackFlipY=new fe(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=e.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(e.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=e.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=e.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,t){return new z(this,e,t)}createVertexBuffer(e,t,n){return new O(this,e,t,n)}createRenderbuffer(e,t,n){const i=this.gl,r=i.createRenderbuffer();return this.bindRenderbuffer.set(r),i.renderbufferStorage(i.RENDERBUFFER,e,t,n),this.bindRenderbuffer.set(null),r}createFramebuffer(e,t,n){return new _e(this,e,t,n)}clear({color:e,depth:t,stencil:n}){const i=this.gl;let r=0;e&&(r|=i.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),void 0!==t&&(r|=i.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(t),this.depthMask.set(!0)),void 0!==n&&(r|=i.STENCIL_BUFFER_BIT,this.clearStencil.set(n),this.stencilMask.set(255)),i.clear(r)}setCullFace(e){!1===e.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(t){r(t.blendFunction,e.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class be extends e.Evented{constructor(t,n,i,r){super(),this.id=t,this.dispatcher=i,this.setEventedParent(r),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=e.extend({type:"raster"},n),e.extend(this,e.pick(n,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new e.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=I(this._options,this.map._requestManager,((t,n)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new e.ErrorEvent(t)):n&&(e.extend(this,n),n.bounds&&(this.tileBounds=new R(n.bounds,this.minzoom,this.maxzoom)),e.postTurnstileEvent(n.tiles),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"})))}))}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return e.extend({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(t,n){const i=e.exported.devicePixelRatio>=2,r=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),i,this.tileSize);t.request=e.getImage(this.map._requestManager.transformRequest(r,e.ResourceType.Tile),((i,r,a,o)=>{if(delete t.request,t.aborted)t.state="unloaded",n(null);else if(i)t.state="errored",n(i);else if(r){this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:a,expires:o});const i=this.map.painter.context,s=i.gl;t.texture=this.map.painter.getTileTexture(r.width),t.texture?t.texture.update(r,{useMipmap:!0}):(t.texture=new e.Texture(i,r,s.RGBA,{useMipmap:!0}),t.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE,s.LINEAR_MIPMAP_NEAREST),i.extTextureFilterAnisotropic&&s.texParameterf(s.TEXTURE_2D,i.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,i.extTextureFilterAnisotropicMax)),t.state="loaded",e.cacheEntryPossiblyAdded(this.dispatcher),n(null)}}))}abortTile(e,t){e.request&&(e.request.cancel(),delete e.request),t()}unloadTile(e,t){e.texture&&this.map.painter.saveTileTexture(e.texture),t()}hasTransition(){return!1}}let we;var Se=e.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Te extends e.Evented{constructor(e,t,n,i){super(),this.id=e,this.dispatcher=n,this.coordinates=t.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(i),this.options=t}load(t,n){this._loaded=!1,this.fire(new e.Event("dataloading",{dataType:"source"})),this.url=this.options.url,e.getImage(this.map._requestManager.transformRequest(this.url,e.ResourceType.Image),((i,r)=>{this._loaded=!0,i?this.fire(new e.ErrorEvent(i)):r&&(this.image=r,t&&(this.coordinates=t),n&&n(),this._finishLoading())}))}loaded(){return this._loaded}updateImage(e){return this.image&&e.url?(this.options.url=e.url,this.load(e.coordinates,(()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}setCoordinates(t){this.coordinates=t;const n=t.map(e.MercatorCoordinate.fromLngLat);this.tileID=function(t){let n=1/0,i=1/0,r=-1/0,a=-1/0;for(const e of t)n=Math.min(n,e.x),i=Math.min(i,e.y),r=Math.max(r,e.x),a=Math.max(a,e.y);const o=Math.max(r-n,a-i),s=Math.max(0,Math.floor(-Math.log(o)/Math.LN2)),l=Math.pow(2,s);return new e.CanonicalTileID(s,Math.floor((n+r)/2*l),Math.floor((i+a)/2*l))}(n),this.minzoom=this.maxzoom=this.tileID.z;const i=n.map((e=>this.tileID.getTilePoint(e)._round()));return this._boundsArray=new e.StructArrayLayout4i8,this._boundsArray.emplaceBack(i[0].x,i[0].y,0,0),this._boundsArray.emplaceBack(i[1].x,i[1].y,e.EXTENT,0),this._boundsArray.emplaceBack(i[3].x,i[3].y,0,e.EXTENT),this._boundsArray.emplaceBack(i[2].x,i[2].y,e.EXTENT,e.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const t=this.map.painter.context,n=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,Se.members)),this.boundsSegments||(this.boundsSegments=e.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new e.Texture(t,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));for(const e in this.tiles){const t=this.tiles[e];"loaded"!==t.state&&(t.state="loaded",t.texture=this.texture)}}loadTile(e,t){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},t(null)):(e.state="errored",t(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Ee={vector:class extends e.Evented{constructor(t,n,i,r){if(super(),this.id=t,this.dispatcher=i,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,e.extend(this,e.pick(n,["url","scheme","tileSize","promoteId"])),this._options=e.extend({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(r),this._tileWorkers={},this._deduped=new e.DedupedRequest}load(){this._loaded=!1,this.fire(new e.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=I(this._options,this.map._requestManager,((t,n)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new e.ErrorEvent(t)):n&&(e.extend(this,n),n.bounds&&(this.tileBounds=new R(n.bounds,this.minzoom,this.maxzoom)),e.postTurnstileEvent(n.tiles,this.map._requestManager._customAccessToken),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"})))}))}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.cancel(),e();const t=this.map.style._getSourceCaches(this.id);for(const n of t)n.clearTiles();this.load()}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return e.extend({},this._options)}loadTile(t,n){const i=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme)),r={request:this.map._requestManager.transformRequest(i,e.ResourceType.Tile),data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:e.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile};if(r.request.collectResourceTiming=this._collectResourceTiming,t.actor&&"expired"!==t.state)"loading"===t.state?t.reloadCallback=n:t.request=t.actor.send("reloadTile",r,a.bind(this));else if(t.actor=this._tileWorkers[i]=this._tileWorkers[i]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",r,a.bind(this),void 0,!0);else{const n=e.loadVectorTile.call({deduped:this._deduped},r,((e,n)=>{e||!n?a.call(this,e):(r.data={cacheControl:n.cacheControl,expires:n.expires,rawData:n.rawData.slice(0)},t.actor&&t.actor.send("loadTile",r,a.bind(this),void 0,!0))}),!0);t.request={cancel:n}}function a(i,r){return delete t.request,t.aborted?n(null):i&&404!==i.status?n(i):(r&&r.resourceTiming&&(t.resourceTiming=r.resourceTiming),this.map._refreshExpiredTiles&&r&&t.setExpiryData(r),t.loadVectorData(r,this.map.painter),e.cacheEntryPossiblyAdded(this.dispatcher),n(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.actor&&e.actor.send("abortTile",{uid:e.uid,type:this.type,source:this.id})}unloadTile(e){e.unloadVectorData(),e.actor&&e.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:be,"raster-dem":class extends be{constructor(t,n,i,r){super(t,n,i,r),this.type="raster-dem",this.maxzoom=22,this._options=e.extend({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(t,n){const i=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function r(e,i){e&&(t.state="errored",n(e)),i&&(t.dem=i,t.dem.onDeserialize(),t.needsHillshadePrepare=!0,t.needsDEMTextureUpload=!0,t.state="loaded",n(null))}t.request=e.getImage(this.map._requestManager.transformRequest(i,e.ResourceType.Tile),function(i,a,o,s){if(delete t.request,t.aborted)t.state="unloaded",n(null);else if(i)t.state="errored",n(i);else if(a){this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:o,expires:s});const n=e.window.ImageBitmap&&a instanceof e.window.ImageBitmap&&(null==we&&(we=e.window.OffscreenCanvas&&new e.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof e.window.createImageBitmap),we),i=1-(a.width-e.prevPowerOfTwo(a.width))/2;i<1||t.neighboringTiles||(t.neighboringTiles=this._getNeighboringTiles(t.tileID));const l=n?a:e.exported.getImageData(a,i),c={uid:t.uid,coord:t.tileID,source:this.id,rawImageData:l,encoding:this.encoding,padding:i};t.actor&&"expired"!==t.state||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",c,r.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(t){const n=t.canonical,i=Math.pow(2,n.z),r=(n.x-1+i)%i,a=0===n.x?t.wrap-1:t.wrap,o=(n.x+1+i)%i,s=n.x+1===i?t.wrap+1:t.wrap,l={};return l[new e.OverscaledTileID(t.overscaledZ,a,n.z,r,n.y).key]={backfilled:!1},l[new e.OverscaledTileID(t.overscaledZ,s,n.z,o,n.y).key]={backfilled:!1},n.y>0&&(l[new e.OverscaledTileID(t.overscaledZ,a,n.z,r,n.y-1).key]={backfilled:!1},l[new e.OverscaledTileID(t.overscaledZ,t.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},l[new e.OverscaledTileID(t.overscaledZ,s,n.z,o,n.y-1).key]={backfilled:!1}),n.y+1<i&&(l[new e.OverscaledTileID(t.overscaledZ,a,n.z,r,n.y+1).key]={backfilled:!1},l[new e.OverscaledTileID(t.overscaledZ,t.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},l[new e.OverscaledTileID(t.overscaledZ,s,n.z,o,n.y+1).key]={backfilled:!1}),l}unloadTile(e){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded"}},geojson:class extends e.Evented{constructor(t,n,i,r){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=i.getActor(),this.setEventedParent(r),this._data=n.data,this._options=e.extend({},n),this._collectResourceTiming=n.collectResourceTiming,void 0!==n.maxzoom&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const a=e.EXTENT/this.tileSize;this.workerOptions=e.extend({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(void 0!==n.buffer?n.buffer:128)*a,tolerance:(void 0!==n.tolerance?n.tolerance:.375)*a,extent:e.EXTENT,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:void 0!==n.clusterMaxZoom?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:e.EXTENT,radius:(void 0!==n.clusterRadius?n.clusterRadius:50)*a,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions)}onAdd(e){this.map=e,this.setData(this._data)}setData(e){return this._data=e,this._updateWorkerData(),this}getClusterExpansionZoom(e,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:e,source:this.id},t),this}getClusterChildren(e,t){return this.actor.send("geojson.getClusterChildren",{clusterId:e,source:this.id},t),this}getClusterLeaves(e,t,n,i){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:e,limit:t,offset:n},i),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new e.Event("dataloading",{dataType:"source"})),this._loaded=!1;const t=e.extend({},this.workerOptions),n=this._data;"string"==typeof n?(t.request=this.map._requestManager.transformRequest(e.exported.resolveURL(n),e.ResourceType.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(n),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,((t,n)=>{if(this._loaded=!0,this._pendingLoad=null,t)this.fire(new e.ErrorEvent(t));else{const t={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&n&&n.resourceTiming&&n.resourceTiming[this.id]&&(t.resourceTiming=n.resourceTiming[this.id]),this.fire(new e.Event("data",t)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)}))}loaded(){return this._loaded}loadTile(t,n){const i=t.actor?"reloadTile":"loadTile";t.actor=this.actor,t.request=this.actor.send(i,{type:this.type,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:e.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},((e,r)=>(delete t.request,t.unloadVectorData(),t.aborted?n(null):e?n(e):(t.loadVectorData(r,this.map.painter,"reloadTile"===i),n(null)))),void 0,"loadTile"===i)}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.aborted=!0}unloadTile(e){e.unloadVectorData(),this.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return e.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Te{constructor(e,t,n,i){super(e,t,n,i),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const t=this.options;this.urls=[];for(const n of t.urls)this.urls.push(this.map._requestManager.transformRequest(n,e.ResourceType.Source).url);e.getVideo(this.urls,((t,n)=>{this._loaded=!0,t?this.fire(new e.ErrorEvent(t)):n&&(this.video=n,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading())}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const n=this.video.seekable;t<n.start(0)||t>n.end(0)?this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const t=this.map.painter.context,n=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,Se.members)),this.boundsSegments||(this.boundsSegments=e.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new e.Texture(t,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));for(const e in this.tiles){const t=this.tiles[e];"loaded"!==t.state&&(t.state="loaded",t.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Te,canvas:class extends Te{constructor(t,n,i,r){super(t,n,i,r),n.coordinates?Array.isArray(n.coordinates)&&4===n.coordinates.length&&!n.coordinates.some((e=>!Array.isArray(e)||2!==e.length||e.some((e=>"number"!=typeof e))))||this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${t}`,null,'missing required property "coordinates"'))),n.animate&&"boolean"!=typeof n.animate&&this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),n.canvas?"string"==typeof n.canvas||n.canvas instanceof e.window.HTMLCanvasElement||this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${t}`,null,'missing required property "canvas"'))),this.options=n,this.animate=void 0===n.animate||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof e.window.HTMLCanvasElement?this.options.canvas:e.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new e.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions())return;if(0===Object.keys(this.tiles).length)return;const n=this.map.painter.context,i=n.gl;this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,Se.members)),this.boundsSegments||(this.boundsSegments=e.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new e.Texture(n,this.canvas,i.RGBA,{premultiply:!0});for(const e in this.tiles){const t=this.tiles[e];"loaded"!==t.state&&(t.state="loaded",t.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}},Me=function(t,n,i,r){const a=new Ee[n.type](t,n,i,r);if(a.id!==t)throw new Error(`Expected Source id to be ${t} instead of ${a.id}`);return e.bindAll(["load","abort","unload","serialize","prepare"],a),a};function ke(t,n){const i=e.identity([]);return e.scale$1(i,i,[.5*t.width,.5*-t.height,1]),e.translate(i,i,[1,-1,0]),e.multiply(i,i,t.calculateProjMatrix(n.toUnwrapped()))}function Ae(e,t,n,i,r,a,o,s=!1){const l=e.tilesIn(i,o,s);l.sort(Pe);const c=[];for(const h of l)c.push({wrappedTileID:h.tile.tileID.wrapped().key,queryResults:h.tile.queryRenderedFeatures(t,n,e._state,h,r,a,ke(e.transform,h.tile.tileID),s)});const u=function(e){const t={},n={};for(const i of e){const e=i.queryResults,r=i.wrappedTileID,a=n[r]=n[r]||{};for(const n in e){const i=e[n],r=a[n]=a[n]||{},o=t[n]=t[n]||[];for(const e of i)r[e.featureIndex]||(r[e.featureIndex]=!0,o.push(e))}}return t}(c);for(const h in u)u[h].forEach((t=>{const n=t.feature,i=e.getFeatureState(n.layer["source-layer"],n.id);n.source=n.layer.source,n.layer["source-layer"]&&(n.sourceLayer=n.layer["source-layer"]),n.state=i}));return u}function Ce(e,t){const n=e.getRenderableIds().map((t=>e.getTileByID(t))),i=[],r={};for(let a=0;a<n.length;a++){const e=n[a],o=e.tileID.canonical.key;r[o]||(r[o]=!0,e.querySourceFeatures(i,t))}return i}function Pe(e,t){const n=e.tileID,i=t.tileID;return n.overscaledZ-i.overscaledZ||n.canonical.y-i.canonical.y||n.wrap-i.wrap||n.canonical.x-i.canonical.x}function Le(){return null!=qr.workerClass?new qr.workerClass:new e.window.Worker(qr.workerUrl)}const Ie="mapboxgl_preloaded_worker_pool";class Re{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Re.workerCount;)this.workers.push(new Le);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],0===this.numActive()&&(this.workers.forEach((e=>{e.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Ie]}numActive(){return Object.keys(this.active).length}}let ze;function De(){return ze||(ze=new Re),ze}function Oe(t,n){const i={};for(const e in t)"ref"!==e&&(i[e]=t[e]);return e.refProperties.forEach((e=>{e in n&&(i[e]=n[e])})),i}function Be(e){e=e.slice();const t=Object.create(null);for(let n=0;n<e.length;n++)t[e[n].id]=e[n];for(let n=0;n<e.length;n++)"ref"in e[n]&&(e[n]=Oe(e[n],t[e[n].ref]));return e}Re.workerCount=2;const Fe={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog"};function Ne(e,t,n){n.push({command:Fe.addSource,args:[e,t[e]]})}function Ue(e,t,n){t.push({command:Fe.removeSource,args:[e]}),n[e]=!0}function Ve(e,t,n,i){Ue(e,n,i),Ne(e,t,n)}function je(e,t,n){let i;for(i in e[n])if(e[n].hasOwnProperty(i)&&"data"!==i&&!r(e[n][i],t[n][i]))return!1;for(i in t[n])if(t[n].hasOwnProperty(i)&&"data"!==i&&!r(e[n][i],t[n][i]))return!1;return!0}function Ge(e,t,n,i,a,o){let s;for(s in t=t||{},e=e||{})e.hasOwnProperty(s)&&(r(e[s],t[s])||n.push({command:o,args:[i,s,t[s],a]}));for(s in t)t.hasOwnProperty(s)&&!e.hasOwnProperty(s)&&(r(e[s],t[s])||n.push({command:o,args:[i,s,t[s],a]}))}function He(e){return e.id}function We(e,t){return e[t.id]=t,e}class qe{constructor(e,t){this.reset(e,t)}reset(e,t){this.points=e||[],this._distances=[0];for(let n=1;n<this.points.length;n++)this._distances[n]=this._distances[n-1]+this.points[n].dist(this.points[n-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(t||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(1===this.points.length)return this.points[0];t=e.clamp(t,0,1);let n=1,i=this._distances[n];const r=t*this.paddedLength+this.padding;for(;i<r&&n<this._distances.length;)i=this._distances[++n];const a=n-1,o=this._distances[a],s=i-o,l=s>0?(r-o)/s:0;return this.points[a].mult(1-l).add(this.points[n].mult(l))}}class Ze{constructor(e,t,n){const i=this.boxCells=[],r=this.circleCells=[];this.xCellCount=Math.ceil(e/n),this.yCellCount=Math.ceil(t/n);for(let a=0;a<this.xCellCount*this.yCellCount;a++)i.push([]),r.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=t,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/t,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,t,n,i,r){this._forEachCell(t,n,i,r,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(r)}insertCircle(e,t,n,i){this._forEachCell(t-i,n-i,t+i,n+i,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(t),this.circles.push(n),this.circles.push(i)}_insertBoxCell(e,t,n,i,r,a){this.boxCells[r].push(a)}_insertCircleCell(e,t,n,i,r,a){this.circleCells[r].push(a)}_query(e,t,n,i,r,a){if(n<0||e>this.width||i<0||t>this.height)return!r&&[];const o=[];if(e<=0&&t<=0&&this.width<=n&&this.height<=i){if(r)return!0;for(let e=0;e<this.boxKeys.length;e++)o.push({key:this.boxKeys[e],x1:this.bboxes[4*e],y1:this.bboxes[4*e+1],x2:this.bboxes[4*e+2],y2:this.bboxes[4*e+3]});for(let e=0;e<this.circleKeys.length;e++){const t=this.circles[3*e],n=this.circles[3*e+1],i=this.circles[3*e+2];o.push({key:this.circleKeys[e],x1:t-i,y1:n-i,x2:t+i,y2:n+i})}return a?o.filter(a):o}return this._forEachCell(e,t,n,i,this._queryCell,o,{hitTest:r,seenUids:{box:{},circle:{}}},a),r?o.length>0:o}_queryCircle(e,t,n,i,r){const a=e-n,o=e+n,s=t-n,l=t+n;if(o<0||a>this.width||l<0||s>this.height)return!i&&[];const c=[];return this._forEachCell(a,s,o,l,this._queryCellCircle,c,{hitTest:i,circle:{x:e,y:t,radius:n},seenUids:{box:{},circle:{}}},r),i?c.length>0:c}query(e,t,n,i,r){return this._query(e,t,n,i,!1,r)}hitTest(e,t,n,i,r){return this._query(e,t,n,i,!0,r)}hitTestCircle(e,t,n,i){return this._queryCircle(e,t,n,!0,i)}_queryCell(e,t,n,i,r,a,o,s){const l=o.seenUids,c=this.boxCells[r];if(null!==c){const r=this.bboxes;for(const u of c)if(!l.box[u]){l.box[u]=!0;const c=4*u;if(e<=r[c+2]&&t<=r[c+3]&&n>=r[c+0]&&i>=r[c+1]&&(!s||s(this.boxKeys[u]))){if(o.hitTest)return a.push(!0),!0;a.push({key:this.boxKeys[u],x1:r[c],y1:r[c+1],x2:r[c+2],y2:r[c+3]})}}}const u=this.circleCells[r];if(null!==u){const r=this.circles;for(const c of u)if(!l.circle[c]){l.circle[c]=!0;const u=3*c;if(this._circleAndRectCollide(r[u],r[u+1],r[u+2],e,t,n,i)&&(!s||s(this.circleKeys[c]))){if(o.hitTest)return a.push(!0),!0;{const e=r[u],t=r[u+1],n=r[u+2];a.push({key:this.circleKeys[c],x1:e-n,y1:t-n,x2:e+n,y2:t+n})}}}}}_queryCellCircle(e,t,n,i,r,a,o,s){const l=o.circle,c=o.seenUids,u=this.boxCells[r];if(null!==u){const e=this.bboxes;for(const t of u)if(!c.box[t]){c.box[t]=!0;const n=4*t;if(this._circleAndRectCollide(l.x,l.y,l.radius,e[n+0],e[n+1],e[n+2],e[n+3])&&(!s||s(this.boxKeys[t])))return a.push(!0),!0}}const h=this.circleCells[r];if(null!==h){const e=this.circles;for(const t of h)if(!c.circle[t]){c.circle[t]=!0;const n=3*t;if(this._circlesCollide(e[n],e[n+1],e[n+2],l.x,l.y,l.radius)&&(!s||s(this.circleKeys[t])))return a.push(!0),!0}}}_forEachCell(e,t,n,i,r,a,o,s){const l=this._convertToXCellCoord(e),c=this._convertToYCellCoord(t),u=this._convertToXCellCoord(n),h=this._convertToYCellCoord(i);for(let d=l;d<=u;d++)for(let l=c;l<=h;l++)if(r.call(this,e,t,n,i,this.xCellCount*l+d,a,o,s))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,t,n,i,r,a){const o=i-e,s=r-t,l=n+a;return l*l>o*o+s*s}_circleAndRectCollide(e,t,n,i,r,a,o){const s=(a-i)/2,l=Math.abs(e-(i+s));if(l>s+n)return!1;const c=(o-r)/2,u=Math.abs(t-(r+c));if(u>c+n)return!1;if(l<=s||u<=c)return!0;const h=l-s,d=u-c;return h*h+d*d<=n*n}}function $e(t,n,i,r,a){const o=e.create$1();return n?(e.scale$1(o,o,[1/a,1/a,1]),i||e.rotateZ(o,o,r.angle)):e.multiply(o,r.labelPlaneMatrix,t),o}function Xe(t,n,i,r,a){if(n){const n=e.clone$1(t);return e.scale$1(n,n,[a,a,1]),i||e.rotateZ(n,n,-r.angle),n}return r.glCoordMatrix}function Ye(t,n,i=0){const r=[t.x,t.y,i,1];i?e.transformMat4(r,r,n):st(r,r,n);const a=r[3];return{point:new e.pointGeometry(r[0]/a,r[1]/a),signedDistanceFromCamera:a}}function Je(e,t){return Math.min(.5+e/t*.5,1.5)}function Ke(e,t){const n=e[0]/e[3],i=e[1]/e[3];return n>=-t[0]&&n<=t[0]&&i>=-t[1]&&i<=t[1]}function Qe(t,n,i,r,a,o,s,l,c){const u=r?t.textSizeData:t.iconSizeData,h=e.evaluateSizeForZoom(u,i.transform.zoom),d=[256/i.width*2+1,256/i.height*2+1],p=r?t.text.dynamicLayoutVertexArray:t.icon.dynamicLayoutVertexArray;p.clear();const f=t.lineVertexArray,m=r?t.text.placedSymbolArray:t.icon.placedSymbolArray,g=i.transform.width/i.transform.height;let v=!1;for(let y=0;y<m.length;y++){const r=m.get(y);if(r.hidden||r.writingMode===e.WritingMode.vertical&&!v){ot(r.numGlyphs,p);continue}v=!1;const _=c?c({x:r.anchorX,y:r.anchorY}):0,x=[r.anchorX,r.anchorY,_,1];if(e.transformMat4(x,x,n),!Ke(x,d)){ot(r.numGlyphs,p);continue}const b=Je(i.transform.cameraToCenterDistance,x[3]),w=e.evaluateSizeForFeature(u,h,r),S=s?w/b:w*b,T=new e.pointGeometry(r.anchorX,r.anchorY),E=Ye(T,a,_);if(E.signedDistanceFromCamera<=0){ot(r.numGlyphs,p);continue}const M=E.point;let k={};const A=s?null:c,C=nt(r,S,!1,l,n,a,o,t.glyphOffsetArray,f,p,M,T,k,g,A);v=C.useVertical,A&&C.needsFlipping&&(k={}),(C.notEnoughRoom||v||C.needsFlipping&&nt(r,S,!0,l,n,a,o,t.glyphOffsetArray,f,p,M,T,k,g,A).notEnoughRoom)&&ot(r.numGlyphs,p)}r?t.text.dynamicLayoutVertexBuffer.updateData(p):t.icon.dynamicLayoutVertexBuffer.updateData(p)}function et(e,t,n,i,r,a,o,s,l,c,u,h,d){const p=s.glyphStartIndex+s.numGlyphs,f=s.lineStartIndex,m=s.lineStartIndex+s.lineLength,g=t.getoffsetX(s.glyphStartIndex),v=t.getoffsetX(p-1),y=rt(e*g,n,i,r,a,o,s.segment,f,m,l,c,u,h,d,!0);if(!y)return null;const _=rt(e*v,n,i,r,a,o,s.segment,f,m,l,c,u,h,d,!0);return _?{first:y,last:_}:null}function tt(t,n,i,r){return t===e.WritingMode.horizontal&&Math.abs(i.y-n.y)>Math.abs(i.x-n.x)*r?{useVertical:!0}:(t===e.WritingMode.vertical?n.y<i.y:n.x>i.x)?{needsFlipping:!0}:null}function nt(t,n,i,r,a,o,s,l,c,u,h,d,p,f,m){const g=n/24,v=t.lineOffsetX*g,y=t.lineOffsetY*g;let _;if(t.numGlyphs>1){const e=t.glyphStartIndex+t.numGlyphs,n=t.lineStartIndex,a=t.lineStartIndex+t.lineLength,u=et(g,l,v,y,i,h,d,t,c,o,p,m);if(!u)return{notEnoughRoom:!0};const x=Ye(u.first.point,s).point,b=Ye(u.last.point,s).point;if(r&&!i){const e=tt(t.writingMode,x,b,f);if(e)return e}_=[u.first];for(let r=t.glyphStartIndex+1;r<e-1;r++)_.push(rt(g*l.getoffsetX(r),v,y,i,h,d,t.segment,n,a,c,o,p,m));_.push(u.last)}else{if(r&&!i){const n=Ye(d,a).point,i=t.lineStartIndex+t.segment+1,r=new e.pointGeometry(c.getx(i),c.gety(i)),o=Ye(r,a),s=o.signedDistanceFromCamera>0?o.point:it(d,r,n,1,a),l=tt(t.writingMode,n,s,f);if(l)return l}const n=rt(g*l.getoffsetX(t.glyphStartIndex),v,y,i,h,d,t.segment,t.lineStartIndex,t.lineStartIndex+t.lineLength,c,o,p,m);if(!n)return{notEnoughRoom:!0};_=[n]}for(const x of _)e.addDynamicAttributes(u,x.point,x.angle);return{}}function it(e,t,n,i,r,a){const o=e.add(e.sub(t)._unit()),s=Ye(o,r,a?a(o):0).point,l=n.sub(s);return n.add(l._mult(i/l.mag()))}function rt(t,n,i,r,a,o,s,l,c,u,h,d,p,f,m){const g=r?t-n:t+n;let v=g>0?1:-1,y=0;r&&(v*=-1,y=Math.PI),v<0&&(y+=Math.PI);let _=v>0?l+s:l+s+1,x=a,b=a,w=0,S=0;const T=Math.abs(g),E=[],M=[];let k=o;const A=()=>{const t=_-v;return 0===w?o:new e.pointGeometry(u.getx(t),u.gety(t))},C=()=>it(A(),k,b,T-w+1,h,p);for(;w+S<=T;){if(_+=v,_<l||_>=c)return null;if(b=x,E.push(x),f&&M.push(k||A()),x=d[_],void 0===x){k=new e.pointGeometry(u.getx(_),u.gety(_));const t=Ye(k,h,p?p(k):0);x=t.signedDistanceFromCamera>0?d[_]=t.point:C()}else k=null;w+=S,S=b.dist(x)}m&&p&&(k=k||new e.pointGeometry(u.getx(_),u.gety(_)),d[_]=x=void 0===d[_]?x:C(),S=b.dist(x));const P=(T-w)/S,L=x.sub(b),I=L.mult(P)._add(b);i&&I._add(L._unit()._perp()._mult(i*v));const R=y+Math.atan2(x.y-b.y,x.x-b.x);return E.push(I),f&&(k=k||new e.pointGeometry(u.getx(_),u.gety(_)),M.push(function(t,n,i){const r=1-i;return new e.pointGeometry(t.x*r+n.x*i,t.y*r+n.y*i)}(M.length>0?M[M.length-1]:k,k,P))),{point:I,angle:R,path:E,tilePath:M}}const at=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ot(e,t){for(let n=0;n<e;n++){const e=t.length;t.resize(e+4),t.float32.set(at,3*e)}}function st(e,t,n){const i=t[0],r=t[1];return e[0]=n[0]*i+n[4]*r+n[12],e[1]=n[1]*i+n[5]*r+n[13],e[3]=n[3]*i+n[7]*r+n[15],e}const lt=100;class ct{constructor(e,t,n=new Ze(e.width+200,e.height+200,25),i=new Ze(e.width+200,e.height+200,25)){this.transform=e,this.grid=n,this.ignoredGrid=i,this.pitchfactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+lt,this.screenBottomBoundary=e.height+lt,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.fogState=t}placeCollisionBox(e,t,n,i,r,a,o){const s=this.projectAndGetPerspectiveRatio(a,t.anchorPointX,t.anchorPointY,t.elevation,t.tileID),l=r*s.perspectiveRatio,c=(t.x1*e+n.x-t.padding)*l+s.point.x,u=(t.y1*e+n.y-t.padding)*l+s.point.y,h=(t.x2*e+n.x+t.padding)*l+s.point.x,d=(t.y2*e+n.y+t.padding)*l+s.point.y,p=s.perspectiveRatio<=.55||s.aboveHorizon;return!this.isInsideGrid(c,u,h,d)||!i&&this.grid.hitTest(c,u,h,d,o)||p?{box:[],offscreen:!1}:{box:[c,u,h,d],offscreen:this.isOffscreen(c,u,h,d)}}placeCollisionCircles(t,n,i,r,a,o,s,l,c,u,h,d,p,f){const m=[],g=this.transform.elevation,v=g?e=>g.getAtTileOffset(f,e.x,e.y):e=>0,y=new e.pointGeometry(n.anchorX,n.anchorY),_=v(y),x=this.projectAndGetPerspectiveRatio(o,y.x,y.y,_,f),{perspectiveRatio:b}=x,w=(u?a/b:a*b)/e.ONE_EM,S=Ye(y,s,_).point,T=x.signedDistanceFromCamera>0?et(w,r,n.lineOffsetX*w,n.lineOffsetY*w,!1,S,y,n,i,s,{},g&&!u?v:null,u&&!!g):null;let E=!1,M=!1,k=!0;if(T&&!x.aboveHorizon){const n=.5*d*b+p,i=new e.pointGeometry(-100,-100),r=new e.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),a=new qe,o=T.first,s=T.last;let u=[];for(let e=o.path.length-1;e>=1;e--)u.push(o.path[e]);for(let e=1;e<s.path.length;e++)u.push(s.path[e]);const f=2.5*n;if(l){const e=u.map(g?(e,t)=>{const n=v(t<o.path.length-1?o.tilePath[o.path.length-1-t]:s.tilePath[t-o.path.length+2]);return Ye(e,l,n)}:e=>Ye(e,l));u=e.some((e=>e.signedDistanceFromCamera<=0))?[]:e.map((e=>e.point))}let y=[];if(u.length>0){const t=u[0].clone(),n=u[0].clone();for(let e=1;e<u.length;e++)t.x=Math.min(t.x,u[e].x),t.y=Math.min(t.y,u[e].y),n.x=Math.max(n.x,u[e].x),n.y=Math.max(n.y,u[e].y);y=t.x>=i.x&&n.x<=r.x&&t.y>=i.y&&n.y<=r.y?[u]:n.x<i.x||t.x>r.x||n.y<i.y||t.y>r.y?[]:e.clipLine([u],i.x,i.y,r.x,r.y)}for(const e of y){a.reset(e,.25*n);let i=0;i=a.length<=.5*n?1:Math.ceil(a.paddedLength/f)+1;for(let e=0;e<i;e++){const r=e/Math.max(i-1,1),o=a.lerp(r),s=o.x+lt,l=o.y+lt;m.push(s,l,n,0);const u=s-n,d=l-n,p=s+n,f=l+n;if(k=k&&this.isOffscreen(u,d,p,f),M=M||this.isInsideGrid(u,d,p,f),!t&&this.grid.hitTestCircle(s,l,n,h)&&(E=!0,!c))return{circles:[],offscreen:!1,collisionDetected:E}}}}return{circles:!c&&E||!M?[]:m,offscreen:k,collisionDetected:E}}queryRenderedSymbols(t){if(0===t.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const n=[];let i=1/0,r=1/0,a=-1/0,o=-1/0;for(const u of t){const t=new e.pointGeometry(u.x+lt,u.y+lt);i=Math.min(i,t.x),r=Math.min(r,t.y),a=Math.max(a,t.x),o=Math.max(o,t.y),n.push(t)}const s=this.grid.query(i,r,a,o).concat(this.ignoredGrid.query(i,r,a,o)),l={},c={};for(const u of s){const t=u.key;if(void 0===l[t.bucketInstanceId]&&(l[t.bucketInstanceId]={}),l[t.bucketInstanceId][t.featureIndex])continue;const i=[new e.pointGeometry(u.x1,u.y1),new e.pointGeometry(u.x2,u.y1),new e.pointGeometry(u.x2,u.y2),new e.pointGeometry(u.x1,u.y2)];e.polygonIntersectsPolygon(n,i)&&(l[t.bucketInstanceId][t.featureIndex]=!0,void 0===c[t.bucketInstanceId]&&(c[t.bucketInstanceId]=[]),c[t.bucketInstanceId].push(t.featureIndex))}return c}insertCollisionBox(e,t,n,i,r){(t?this.ignoredGrid:this.grid).insert({bucketInstanceId:n,featureIndex:i,collisionGroupID:r},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,t,n,i,r){const a=t?this.ignoredGrid:this.grid,o={bucketInstanceId:n,featureIndex:i,collisionGroupID:r};for(let s=0;s<e.length;s+=4)a.insertCircle(o,e[s],e[s+1],e[s+2])}projectAndGetPerspectiveRatio(t,n,i,r,a){const o=[n,i,r||0,1];let s=!1;if(r||this.transform.pitch>0){e.transformMat4(o,o,t);let l=!1;this.fogState&&a&&(l=function(t,n,i,r,a,o){const s=o.calculateFogTileMatrix(a),l=[n,i,r];return e.transformMat4$1(l,l,s),S(t,l,o.pitch,o._fov)}(this.fogState,n,i,r||0,a.toUnwrapped(),this.transform)>.9),s=o[2]>o[3]||l}else st(o,o,t);return{point:new e.pointGeometry((o[0]/o[3]+1)/2*this.transform.width+lt,(-o[1]/o[3]+1)/2*this.transform.height+lt),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/o[3]*.5,1.5),signedDistanceFromCamera:o[3],aboveHorizon:s}}isOffscreen(e,t,n,i){return n<lt||e>=this.screenRightBoundary||i<lt||t>this.screenBottomBoundary}isInsideGrid(e,t,n,i){return n>=0&&e<this.gridRightBoundary&&i>=0&&t<this.gridBottomBoundary}getViewportMatrix(){const t=e.identity([]);return e.translate(t,t,[-100,-100,0]),t}}class ut{constructor(e,t,n,i){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?t:-t))):i&&n?1:0,this.placed=n}isHidden(){return 0===this.opacity&&!this.placed}}class ht{constructor(e,t,n,i,r){this.text=new ut(e?e.text:null,t,n,r),this.icon=new ut(e?e.icon:null,t,i,r)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class dt{constructor(e,t,n){this.text=e,this.icon=t,this.skipFade=n}}class pt{constructor(){this.invProjMatrix=e.create$1(),this.viewportMatrix=e.create$1(),this.circles=[]}}class ft{constructor(e,t,n,i,r){this.bucketInstanceId=e,this.featureIndex=t,this.sourceLayerIndex=n,this.bucketIndex=i,this.tileID=r}}class mt{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const t=++this.maxGroupID;this.collisionGroups[e]={ID:t,predicate:e=>e.collisionGroupID===t}}return this.collisionGroups[e]}}function gt(t,n,i,r,a){const{horizontalAlign:o,verticalAlign:s}=e.getAnchorAlignment(t),l=-(o-.5)*n,c=-(s-.5)*i,u=e.evaluateVariableOffset(t,r);return new e.pointGeometry(l+u[0]*a,c+u[1]*a)}function vt(t,n,i,r,a){const o=new e.pointGeometry(t,n);return i&&o._rotate(r?a:-a),o}class yt{constructor(e,t,n,i,r){this.transform=e.clone(),this.collisionIndex=new ct(this.transform,r),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=t,this.retainedQueryData={},this.collisionGroups=new mt(n),this.collisionCircleArrays={},this.prevPlacement=i,i&&(i.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,n,i,r){const a=i.getBucket(n),o=i.latestFeatureIndex;if(!a||!o||n.id!==a.layerIds[0])return;const s=i.collisionBoxArray,l=a.layers[0].layout,c=Math.pow(2,this.transform.zoom-i.tileID.overscaledZ),u=i.tileSize/e.EXTENT,h=this.transform.calculateProjMatrix(i.tileID.toUnwrapped()),d="map"===l.get("text-pitch-alignment"),p="map"===l.get("text-rotation-alignment"),f=C(i,1,this.transform.zoom),m=$e(h,d,p,this.transform,f);let g=null;if(d){const t=Xe(h,d,p,this.transform,f);g=e.multiply([],this.transform.labelPlaneMatrix,t)}this.retainedQueryData[a.bucketInstanceId]=new ft(a.bucketInstanceId,o,a.sourceLayerIndex,a.index,i.tileID);const v={bucket:a,layout:l,posMatrix:h,textLabelPlaneMatrix:m,labelToScreenMatrix:g,scale:c,textPixelRatio:u,holdingForFade:i.holdingForFade(),collisionBoxArray:s,partiallyEvaluatedTextSize:e.evaluateSizeForZoom(a.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:e.evaluateSizeForZoom(a.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(a.sourceID)};if(r)for(const e of a.sortKeyRanges){const{sortKey:n,symbolInstanceStart:i,symbolInstanceEnd:r}=e;t.push({sortKey:n,symbolInstanceStart:i,symbolInstanceEnd:r,parameters:v})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:a.symbolInstances.length,parameters:v})}attemptAnchorPlacement(e,t,n,i,r,a,o,s,l,c,u,h,d,p,f,m,g,v){const y=[h.textOffset0,h.textOffset1],_=p.getSymbolInstanceTextSize(g,h,this.transform.zoom,d),x=gt(e,n,i,y,r),b=this.collisionIndex.placeCollisionBox(_,t,vt(x.x,x.y,a,o,this.transform.angle),u,s,l,c.predicate);if((!m||0!==this.collisionIndex.placeCollisionBox(p.getSymbolInstanceIconSize(v,this.transform.zoom,d),m,vt(x.x,x.y,a,o,this.transform.angle),u,s,l,c.predicate).box.length)&&b.box.length>0){let t;return this.prevPlacement&&this.prevPlacement.variableOffsets[h.crossTileID]&&this.prevPlacement.placements[h.crossTileID]&&this.prevPlacement.placements[h.crossTileID].text&&(t=this.prevPlacement.variableOffsets[h.crossTileID].anchor),this.variableOffsets[h.crossTileID]={textOffset:y,width:n,height:i,anchor:e,textBoxScale:r,prevAnchor:t},this.markUsedJustification(p,e,h,f),p.allowVerticalPlacement&&(this.markUsedOrientation(p,f,h),this.placedOrientations[h.crossTileID]=f),{shift:x,placedGlyphBoxes:b}}}placeLayerBucketPart(t,n,i){const{bucket:r,layout:a,posMatrix:o,textLabelPlaneMatrix:s,labelToScreenMatrix:l,textPixelRatio:c,holdingForFade:u,collisionBoxArray:h,partiallyEvaluatedTextSize:d,partiallyEvaluatedIconSize:p,collisionGroup:f}=t.parameters,m=a.get("text-optional"),g=a.get("icon-optional"),v=a.get("text-allow-overlap"),y=a.get("icon-allow-overlap"),_="map"===a.get("text-rotation-alignment"),x="map"===a.get("text-pitch-alignment"),b="none"!==a.get("icon-text-fit"),w="viewport-y"===a.get("symbol-z-order"),S=v&&(y||!r.hasIconData()||g),T=y&&(v||!r.hasTextData()||m);!r.collisionArrays&&h&&r.deserializeCollisionBoxes(h),i&&r.updateCollisionDebugBuffers(this.transform.zoom,h);const E=(t,h,w)=>{if(n[t.crossTileID])return;if(u)return void(this.placements[t.crossTileID]=new dt(!1,!1,!1));let E=!1,M=!1,k=!0,A=null,C={box:null,offscreen:null},P={box:null,offscreen:null},L=null,I=null,R=null,z=0,D=0,O=0;w.textFeatureIndex?z=w.textFeatureIndex:t.useRuntimeCollisionCircles&&(z=t.featureIndex),w.verticalTextFeatureIndex&&(D=w.verticalTextFeatureIndex);const B=e=>{e.tileID=this.retainedQueryData[r.bucketInstanceId].tileID,(this.transform.elevation||e.elevation)&&(e.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[r.bucketInstanceId].tileID,e.anchorPointX,e.anchorPointY):0)},F=w.textBox;if(F){B(F);const n=n=>{let i=e.WritingMode.horizontal;if(r.allowVerticalPlacement&&!n&&this.prevPlacement){const e=this.prevPlacement.placedOrientations[t.crossTileID];e&&(this.placedOrientations[t.crossTileID]=e,i=e,this.markUsedOrientation(r,i,t))}return i},i=(n,i)=>{if(r.allowVerticalPlacement&&t.numVerticalGlyphVertices>0&&w.verticalTextBox){for(const t of r.writingModes)if(t===e.WritingMode.vertical?(C=i(),P=C):C=n(),C&&C.box&&C.box.length)break}else C=n()};if(a.get("text-variable-anchor")){let s=a.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[t.crossTileID]){const e=this.prevPlacement.variableOffsets[t.crossTileID];s.indexOf(e.anchor)>0&&(s=s.filter((t=>t!==e.anchor)),s.unshift(e.anchor))}const l=(e,n,i)=>{const a=t.textBoxScale,l=(e.x2-e.x1)*a+2*e.padding,u=(e.y2-e.y1)*a+2*e.padding,m=b&&!y?n:null;m&&B(m);let g={box:[],offscreen:!1};const w=v?2*s.length:s.length;for(let v=0;v<w;++v){const n=this.attemptAnchorPlacement(s[v%s.length],e,l,u,a,_,x,c,o,f,v>=s.length,t,h,r,i,m,d,p);if(n&&(g=n.placedGlyphBoxes,g&&g.box&&g.box.length)){E=!0,A=n.shift;break}}return g};i((()=>l(F,w.iconBox,e.WritingMode.horizontal)),(()=>{const n=w.verticalTextBox;return n&&B(n),r.allowVerticalPlacement&&!(C&&C.box&&C.box.length)&&t.numVerticalGlyphVertices>0&&n?l(n,w.verticalIconBox,e.WritingMode.vertical):{box:null,offscreen:null}})),C&&(E=C.box,k=C.offscreen);const u=n(C&&C.box);if(!E&&this.prevPlacement){const e=this.prevPlacement.variableOffsets[t.crossTileID];e&&(this.variableOffsets[t.crossTileID]=e,this.markUsedJustification(r,e.anchor,t,u))}}else{const a=(n,i)=>{const a=r.getSymbolInstanceTextSize(d,t,this.transform.zoom,h),s=this.collisionIndex.placeCollisionBox(a,n,new e.pointGeometry(0,0),v,c,o,f.predicate);return s&&s.box&&s.box.length&&(this.markUsedOrientation(r,i,t),this.placedOrientations[t.crossTileID]=i),s};i((()=>a(F,e.WritingMode.horizontal)),(()=>{const n=w.verticalTextBox;return r.allowVerticalPlacement&&t.numVerticalGlyphVertices>0&&n?(B(n),a(n,e.WritingMode.vertical)):{box:null,offscreen:null}})),n(C&&C.box&&C.box.length)}}if(L=C,E=L&&L.box&&L.box.length>0,k=L&&L.offscreen,t.useRuntimeCollisionCircles){const n=r.text.placedSymbolArray.get(t.centerJustifiedTextSymbolIndex),c=e.evaluateSizeForFeature(r.textSizeData,d,n),u=a.get("text-padding");I=this.collisionIndex.placeCollisionCircles(v,n,r.lineVertexArray,r.glyphOffsetArray,c,o,s,l,i,x,f.predicate,t.collisionCircleDiameter,u,this.retainedQueryData[r.bucketInstanceId].tileID),E=v||I.circles.length>0&&!I.collisionDetected,k=k&&I.offscreen}if(w.iconFeatureIndex&&(O=w.iconFeatureIndex),w.iconBox){const t=t=>{B(t);const n=b&&A?vt(A.x,A.y,_,x,this.transform.angle):new e.pointGeometry(0,0),i=r.getSymbolInstanceIconSize(p,this.transform.zoom,h);return this.collisionIndex.placeCollisionBox(i,t,n,y,c,o,f.predicate)};P&&P.box&&P.box.length&&w.verticalIconBox?(R=t(w.verticalIconBox),M=R.box.length>0):(R=t(w.iconBox),M=R.box.length>0),k=k&&R.offscreen}const N=m||0===t.numHorizontalGlyphVertices&&0===t.numVerticalGlyphVertices,U=g||0===t.numIconVertices;if(N||U?U?N||(M=M&&E):E=M&&E:M=E=M&&E,E&&L&&L.box&&this.collisionIndex.insertCollisionBox(L.box,a.get("text-ignore-placement"),r.bucketInstanceId,P&&P.box&&D?D:z,f.ID),M&&R&&this.collisionIndex.insertCollisionBox(R.box,a.get("icon-ignore-placement"),r.bucketInstanceId,O,f.ID),I&&(E&&this.collisionIndex.insertCollisionCircles(I.circles,a.get("text-ignore-placement"),r.bucketInstanceId,z,f.ID),i)){const e=r.bucketInstanceId;let t=this.collisionCircleArrays[e];void 0===t&&(t=this.collisionCircleArrays[e]=new pt);for(let n=0;n<I.circles.length;n+=4)t.circles.push(I.circles[n+0]),t.circles.push(I.circles[n+1]),t.circles.push(I.circles[n+2]),t.circles.push(I.collisionDetected?1:0)}this.placements[t.crossTileID]=new dt(E||S,M||T,k||r.justReloaded),n[t.crossTileID]=!0};if(w){const e=r.getSortedSymbolIndexes(this.transform.angle);for(let t=e.length-1;t>=0;--t){const n=e[t];E(r.symbolInstances.get(n),n,r.collisionArrays[n])}}else for(let e=t.symbolInstanceStart;e<t.symbolInstanceEnd;e++)E(r.symbolInstances.get(e),e,r.collisionArrays[e]);if(i&&r.bucketInstanceId in this.collisionCircleArrays){const t=this.collisionCircleArrays[r.bucketInstanceId];e.invert(t.invProjMatrix,o),t.viewportMatrix=this.collisionIndex.getViewportMatrix()}r.justReloaded=!1}markUsedJustification(t,n,i,r){let a;a=r===e.WritingMode.vertical?i.verticalPlacedTextSymbolIndex:{left:i.leftJustifiedTextSymbolIndex,center:i.centerJustifiedTextSymbolIndex,right:i.rightJustifiedTextSymbolIndex}[e.getAnchorJustification(n)];const o=[i.leftJustifiedTextSymbolIndex,i.centerJustifiedTextSymbolIndex,i.rightJustifiedTextSymbolIndex,i.verticalPlacedTextSymbolIndex];for(const e of o)e>=0&&(t.text.placedSymbolArray.get(e).crossTileID=a>=0&&e!==a?0:i.crossTileID)}markUsedOrientation(t,n,i){const r=n===e.WritingMode.horizontal||n===e.WritingMode.horizontalOnly?n:0,a=n===e.WritingMode.vertical?n:0,o=[i.leftJustifiedTextSymbolIndex,i.centerJustifiedTextSymbolIndex,i.rightJustifiedTextSymbolIndex];for(const e of o)t.text.placedSymbolArray.get(e).placedOrientation=r;i.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(i.verticalPlacedTextSymbolIndex).placedOrientation=a)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const t=this.prevPlacement;let n=!1;this.prevZoomAdjustment=t?t.zoomAdjustment(this.transform.zoom):0;const i=t?t.symbolFadeChange(e):1,r=t?t.opacities:{},a=t?t.variableOffsets:{},o=t?t.placedOrientations:{};for(const s in this.placements){const e=this.placements[s],t=r[s];t?(this.opacities[s]=new ht(t,i,e.text,e.icon),n=n||e.text!==t.text.placed||e.icon!==t.icon.placed):(this.opacities[s]=new ht(null,i,e.text,e.icon,e.skipFade),n=n||e.text||e.icon)}for(const s in r){const e=r[s];if(!this.opacities[s]){const t=new ht(e,i,!1,!1);t.isHidden()||(this.opacities[s]=t,n=n||e.text.placed||e.icon.placed)}}for(const s in a)this.variableOffsets[s]||!this.opacities[s]||this.opacities[s].isHidden()||(this.variableOffsets[s]=a[s]);for(const s in o)this.placedOrientations[s]||!this.opacities[s]||this.opacities[s].isHidden()||(this.placedOrientations[s]=o[s]);n?this.lastPlacementChangeTime=e:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=t?t.lastPlacementChangeTime:e)}updateLayerOpacities(e,t){const n={};for(const i of t){const t=i.getBucket(e);t&&i.latestFeatureIndex&&e.id===t.layerIds[0]&&this.updateBucketOpacities(t,n,i.collisionBoxArray)}}updateBucketOpacities(t,n,i){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const r=t.layers[0].layout,a=new ht(null,0,!1,!1,!0),o=r.get("text-allow-overlap"),s=r.get("icon-allow-overlap"),l=r.get("text-variable-anchor"),c="map"===r.get("text-rotation-alignment"),u="map"===r.get("text-pitch-alignment"),h="none"!==r.get("icon-text-fit"),d=new ht(null,0,o&&(s||!t.hasIconData()||r.get("icon-optional")),s&&(o||!t.hasTextData()||r.get("text-optional")),!0);!t.collisionArrays&&i&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(i);const p=(e,t,n)=>{for(let i=0;i<t/4;i++)e.opacityVertexArray.emplaceBack(n)};for(let f=0;f<t.symbolInstances.length;f++){const i=t.symbolInstances.get(f),{numHorizontalGlyphVertices:r,numVerticalGlyphVertices:o,crossTileID:s}=i;let m=this.opacities[s];n[s]?m=a:m||(m=d,this.opacities[s]=m),n[s]=!0;const g=i.numIconVertices>0,v=this.placedOrientations[i.crossTileID],y=v===e.WritingMode.vertical,_=v===e.WritingMode.horizontal||v===e.WritingMode.horizontalOnly;if(r>0||o>0){const e=kt(m.text);p(t.text,r,y?At:e),p(t.text,o,_?At:e);const n=m.text.isHidden();[i.rightJustifiedTextSymbolIndex,i.centerJustifiedTextSymbolIndex,i.leftJustifiedTextSymbolIndex].forEach((e=>{e>=0&&(t.text.placedSymbolArray.get(e).hidden=n||y?1:0)})),i.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(i.verticalPlacedTextSymbolIndex).hidden=n||_?1:0);const a=this.variableOffsets[i.crossTileID];a&&this.markUsedJustification(t,a.anchor,i,v);const s=this.placedOrientations[i.crossTileID];s&&(this.markUsedJustification(t,"left",i,s),this.markUsedOrientation(t,s,i))}if(g){const e=kt(m.icon),n=!(h&&i.verticalPlacedIconSymbolIndex&&y);i.placedIconSymbolIndex>=0&&(p(t.icon,i.numIconVertices,n?e:At),t.icon.placedSymbolArray.get(i.placedIconSymbolIndex).hidden=m.icon.isHidden()),i.verticalPlacedIconSymbolIndex>=0&&(p(t.icon,i.numVerticalIconVertices,n?At:e),t.icon.placedSymbolArray.get(i.verticalPlacedIconSymbolIndex).hidden=m.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const n=t.collisionArrays[f];if(n){let i=new e.pointGeometry(0,0);if(n.textBox||n.verticalTextBox){let e=!0;if(l){const t=this.variableOffsets[s];t?(i=gt(t.anchor,t.width,t.height,t.textOffset,t.textBoxScale),c&&i._rotate(u?this.transform.angle:-this.transform.angle)):e=!1}n.textBox&&_t(t.textCollisionBox.collisionVertexArray,m.text.placed,!e||y,i.x,i.y),n.verticalTextBox&&_t(t.textCollisionBox.collisionVertexArray,m.text.placed,!e||_,i.x,i.y)}const r=Boolean(!_&&n.verticalIconBox);n.iconBox&&_t(t.iconCollisionBox.collisionVertexArray,m.icon.placed,r,h?i.x:0,h?i.y:0),n.verticalIconBox&&_t(t.iconCollisionBox.collisionVertexArray,m.icon.placed,!r,h?i.x:0,h?i.y:0)}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const e=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=e.invProjMatrix,t.placementViewportMatrix=e.viewportMatrix,t.collisionCircleArray=e.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(e){return 0===this.fadeDuration?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,t){const n=this.zoomAtLastRecencyCheck===t?1-this.zoomAdjustment(t):1;return this.zoomAtLastRecencyCheck=t,this.commitTime+this.fadeDuration*n>e}setStale(){this.stale=!0}}function _t(e,t,n,i,r){e.emplaceBack(t?1:0,n?1:0,i||0,r||0),e.emplaceBack(t?1:0,n?1:0,i||0,r||0),e.emplaceBack(t?1:0,n?1:0,i||0,r||0),e.emplaceBack(t?1:0,n?1:0,i||0,r||0)}const xt=Math.pow(2,25),bt=Math.pow(2,24),wt=Math.pow(2,17),St=Math.pow(2,16),Tt=Math.pow(2,9),Et=Math.pow(2,8),Mt=Math.pow(2,1);function kt(e){if(0===e.opacity&&!e.placed)return 0;if(1===e.opacity&&e.placed)return 4294967295;const t=e.placed?1:0,n=Math.floor(127*e.opacity);return n*xt+t*bt+n*wt+t*St+n*Tt+t*Et+n*Mt+t}const At=0;class Ct{constructor(e){this._sortAcrossTiles="viewport-y"!==e.layout.get("symbol-z-order")&&void 0!==e.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,t,n,i,r){const a=this._bucketParts;for(;this._currentTileIndex<e.length;)if(t.getBucketParts(a,i,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,r())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,a.sort(((e,t)=>e.sortKey-t.sortKey)));this._currentPartIndex<a.length;)if(t.placeLayerBucketPart(a[this._currentPartIndex],this._seenCrossTileIDs,n),this._currentPartIndex++,r())return!0;return!1}}class Pt{constructor(e,t,n,i,r,a,o,s){this.placement=new yt(e,r,a,o,s),this._currentPlacementIndex=t.length-1,this._forceFullPlacement=n,this._showCollisionBoxes=i,this._done=!1}isDone(){return this._done}continuePlacement(t,n,i){const r=e.exported.now(),a=()=>{const t=e.exported.now()-r;return!this._forceFullPlacement&&t>2};for(;this._currentPlacementIndex>=0;){const e=n[t[this._currentPlacementIndex]],r=this.placement.collisionIndex.transform.zoom;if("symbol"===e.type&&(!e.minzoom||e.minzoom<=r)&&(!e.maxzoom||e.maxzoom>r)){if(this._inProgressLayer||(this._inProgressLayer=new Ct(e)),this._inProgressLayer.continuePlacement(i[e.source],this.placement,this._showCollisionBoxes,e,a))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const Lt=512/e.EXTENT/2;class It{constructor(e,t,n){this.tileID=e,this.indexedSymbolInstances={},this.bucketInstanceId=n;for(let i=0;i<t.length;i++){const n=t.get(i),r=n.key;this.indexedSymbolInstances[r]||(this.indexedSymbolInstances[r]=[]),this.indexedSymbolInstances[r].push({crossTileID:n.crossTileID,coord:this.getScaledCoordinates(n,e)})}}getScaledCoordinates(t,n){const i=Lt/Math.pow(2,n.canonical.z-this.tileID.canonical.z);return{x:Math.floor((n.canonical.x*e.EXTENT+t.anchorX)*i),y:Math.floor((n.canonical.y*e.EXTENT+t.anchorY)*i)}}findMatches(e,t,n){const i=this.tileID.canonical.z<t.canonical.z?1:Math.pow(2,this.tileID.canonical.z-t.canonical.z);for(let r=0;r<e.length;r++){const a=e.get(r);if(a.crossTileID)continue;const o=this.indexedSymbolInstances[a.key];if(!o)continue;const s=this.getScaledCoordinates(a,t);for(const e of o)if(Math.abs(e.coord.x-s.x)<=i&&Math.abs(e.coord.y-s.y)<=i&&!n[e.crossTileID]){n[e.crossTileID]=!0,a.crossTileID=e.crossTileID;break}}}}class Rt{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class zt{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const t=Math.round((e-this.lng)/360);if(0!==t)for(const n in this.indexes){const e=this.indexes[n],i={};for(const n in e){const r=e[n];r.tileID=r.tileID.unwrapTo(r.tileID.wrap+t),i[r.tileID.key]=r}this.indexes[n]=i}this.lng=e}addBucket(e,t,n){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===t.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let r=0;r<t.symbolInstances.length;r++)t.symbolInstances.get(r).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const i=this.usedCrossTileIDs[e.overscaledZ];for(const r in this.indexes){const n=this.indexes[r];if(Number(r)>e.overscaledZ)for(const r in n){const a=n[r];a.tileID.isChildOf(e)&&a.findMatches(t.symbolInstances,e,i)}else{const a=n[e.scaledTo(Number(r)).key];a&&a.findMatches(t.symbolInstances,e,i)}}for(let r=0;r<t.symbolInstances.length;r++){const e=t.symbolInstances.get(r);e.crossTileID||(e.crossTileID=n.generate(),i[e.crossTileID]=!0)}return void 0===this.indexes[e.overscaledZ]&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new It(e,t.symbolInstances,t.bucketInstanceId),!0}removeBucketCrossTileIDs(e,t){for(const n in t.indexedSymbolInstances)for(const i of t.indexedSymbolInstances[n])delete this.usedCrossTileIDs[e][i.crossTileID]}removeStaleBuckets(e){let t=!1;for(const n in this.indexes){const i=this.indexes[n];for(const r in i)e[i[r].bucketInstanceId]||(this.removeBucketCrossTileIDs(n,i[r]),delete i[r],t=!0)}return t}}class Dt{constructor(){this.layerIndexes={},this.crossTileIDs=new Rt,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,t,n){let i=this.layerIndexes[e.id];void 0===i&&(i=this.layerIndexes[e.id]=new zt);let r=!1;const a={};i.handleWrapJump(n);for(const o of t){const t=o.getBucket(e);t&&e.id===t.layerIds[0]&&(t.bucketInstanceId||(t.bucketInstanceId=++this.maxBucketInstanceId),i.addBucket(o.tileID,t,this.crossTileIDs)&&(r=!0),a[t.bucketInstanceId]=!0)}return i.removeStaleBuckets(a)&&(r=!0),r}pruneUnusedLayers(e){const t={};e.forEach((e=>{t[e]=!0}));for(const n in this.layerIndexes)t[n]||delete this.layerIndexes[n]}}const Ot=(t,n)=>e.emitValidationErrors(t,n&&n.filter((e=>"source.canvas"!==e.identifier))),Bt=e.pick(Fe,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog"]),Ft=e.pick(Fe,["setCenter","setZoom","setBearing","setPitch"]),Nt=function(){const t={},n=e.spec.$version;for(const i in e.spec.$root){const r=e.spec.$root[i];if(r.required){let e=null;e="version"===i?n:"array"===r.type?[]:{},null!=e&&(t[i]=e)}}return t}(),Ut={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Vt extends e.Evented{constructor(t,n={}){super(),this.map=t,this.dispatcher=new A(De(),this),this.imageManager=new g,this.imageManager.setEventedParent(this),this.glyphManager=new e.GlyphManager(t._requestManager,n.localFontFamily?e.LocalGlyphMode.all:n.localIdeographFontFamily?e.LocalGlyphMode.ideographs:e.LocalGlyphMode.none,n.localFontFamily||n.localIdeographFontFamily),this.lineAtlas=new e.LineAtlas(256,512),this.crossTileSymbolIndex=new Dt,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new e.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",e.getReferrer());const i=this;this._rtlTextPluginCallback=Vt.registerForPluginStateChange((t=>{i.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:t.pluginStatus,pluginURL:t.pluginURL},((t,n)=>{if(e.triggerPluginCompletionEvent(t),n&&n.every((e=>e)))for(const e in i._sourceCaches){const t=i._sourceCaches[e],n=t.getSource().type;"vector"!==n&&"geojson"!==n||t.reload()}}))})),this.on("data",(e=>{if("source"!==e.dataType||"metadata"!==e.sourceDataType)return;const t=this.getSource(e.sourceId);if(t&&t.vectorLayerIds)for(const n in this._layers){const e=this._layers[n];e.source===t.id&&this._validateLayer(e)}}))}loadURL(t,n={}){this.fire(new e.Event("dataloading",{dataType:"style"}));const i="boolean"==typeof n.validate?n.validate:!e.isMapboxURL(t);t=this.map._requestManager.normalizeStyleURL(t,n.accessToken);const r=this.map._requestManager.transformRequest(t,e.ResourceType.Style);this._request=e.getJSON(r,((t,n)=>{this._request=null,t?this.fire(new e.ErrorEvent(t)):n&&this._load(n,i)}))}loadJSON(t,n={}){this.fire(new e.Event("dataloading",{dataType:"style"})),this._request=e.exported.frame((()=>{this._request=null,this._load(t,!1!==n.validate)}))}loadEmpty(){this.fire(new e.Event("dataloading",{dataType:"style"})),this._load(Nt,!1)}_updateLayerCount(e,t){const n=t?1:-1;e.is3D()&&(this._num3DLayers+=n),"circle"===e.type&&(this._numCircleLayers+=n),"symbol"===e.type&&(this._numSymbolLayers+=n)}_load(t,n){if(n&&Ot(this,e.validateStyle(t)))return;this._loaded=!0,this.stylesheet=t;for(const e in t.sources)this.addSource(e,t.sources[e],{validate:!1});this._changed=!1,t.sprite?this._loadSprite(t.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(t.glyphs);const i=Be(this.stylesheet.layers);this._order=i.map((e=>e.id)),this._layers={},this._serializedLayers={};for(let r of i)r=e.createStyleLayer(r),r.setEventedParent(this,{layer:{id:r.id}}),this._layers[r.id]=r,this._serializedLayers[r.id]=r.serialize(),this._updateLayerCount(r,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new _(this.stylesheet.light),this.stylesheet.terrain&&this._createTerrain(this.stylesheet.terrain),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new e.Event("data",{dataType:"style"})),this.fire(new e.Event("style.load"))}_loadSprite(t){this._spriteRequest=function(t,n,i){let r,a,o;const s=e.exported.devicePixelRatio>1?"@2x":"";let l=e.getJSON(n.transformRequest(n.normalizeSpriteURL(t,s,".json"),e.ResourceType.SpriteJSON),((e,t)=>{l=null,o||(o=e,r=t,u())})),c=e.getImage(n.transformRequest(n.normalizeSpriteURL(t,s,".png"),e.ResourceType.SpriteImage),((e,t)=>{c=null,o||(o=e,a=t,u())}));function u(){if(o)i(o);else if(r&&a){const t=e.exported.getImageData(a),n={};for(const i in r){const{width:a,height:o,x:s,y:l,sdf:c,pixelRatio:u,stretchX:h,stretchY:d,content:p}=r[i],f=new e.RGBAImage({width:a,height:o});e.RGBAImage.copy(t,f,{x:s,y:l},{x:0,y:0},{width:a,height:o}),n[i]={data:f,pixelRatio:u,sdf:c,stretchX:h,stretchY:d,content:p}}i(null,n)}}return{cancel(){l&&(l.cancel(),l=null),c&&(c.cancel(),c=null)}}}(t,this.map._requestManager,((t,n)=>{if(this._spriteRequest=null,t)this.fire(new e.ErrorEvent(t));else if(n)for(const e in n)this.imageManager.addImage(e,n[e]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new e.Event("data",{dataType:"style"}))}))}_validateLayer(t){const n=this.getSource(t.source);if(!n)return;const i=t.sourceLayer;i&&("geojson"===n.type||n.vectorLayerIds&&-1===n.vectorLayerIds.indexOf(i))&&this.fire(new e.ErrorEvent(new Error(`Source layer "${i}" does not exist on source "${n.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(const e in this._sourceCaches)if(!this._sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(e){const t=[];for(const n of e){const e=this._layers[n];"custom"!==e.type&&t.push(e.serialize())}return t}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;if(this.fog&&this.fog.hasTransition())return!0;for(const e in this._sourceCaches)if(this._sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(e){return!!this.terrain&&Ut[e.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(t){if(!this._loaded)return;const n=this._changed;if(this._changed){const e=Object.keys(this._updatedLayers),n=Object.keys(this._removedLayers);(e.length||n.length)&&this._updateWorkerLayers(e,n);for(const t in this._updatedSources){const e=this._updatedSources[t];"reload"===e?this._reloadSource(t):"clear"===e&&this._clearSource(t)}this._updateTilesForChangedImages();for(const i in this._updatedPaintProps)this._layers[i].updateTransitions(t);this.light.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this._resetUpdates()}const i={};for(const e in this._sourceCaches){const t=this._sourceCaches[e];i[e]=t.used,t.used=!1}for(const e of this._order){const n=this._layers[e];if(n.recalculate(t,this._availableImages),!n.isHidden(t.zoom)){const e=this._getLayerSourceCache(n);e&&(e.used=!0)}const i=this.map.painter;if(i){const e=n.getProgramIds();if(!e)continue;const r=n.getProgramConfiguration(t.zoom);for(const t of e)i.useProgram(t,r)}}for(const r in i){const t=this._sourceCaches[r];i[r]!==t.used&&t.getSource().fire(new e.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:t.getSource().id}))}this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),n&&this.fire(new e.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const t in this._sourceCaches)this._sourceCaches[t].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateWorkerLayers(e,t){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(e),removedIds:t})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(t){if(this._checkLoaded(),Ot(this,e.validateStyle(t)))return!1;(t=e.clone$2(t)).layers=Be(t.layers);const n=function(e,t){if(!e)return[{command:Fe.setStyle,args:[t]}];let n=[];try{if(!r(e.version,t.version))return[{command:Fe.setStyle,args:[t]}];r(e.center,t.center)||n.push({command:Fe.setCenter,args:[t.center]}),r(e.zoom,t.zoom)||n.push({command:Fe.setZoom,args:[t.zoom]}),r(e.bearing,t.bearing)||n.push({command:Fe.setBearing,args:[t.bearing]}),r(e.pitch,t.pitch)||n.push({command:Fe.setPitch,args:[t.pitch]}),r(e.sprite,t.sprite)||n.push({command:Fe.setSprite,args:[t.sprite]}),r(e.glyphs,t.glyphs)||n.push({command:Fe.setGlyphs,args:[t.glyphs]}),r(e.transition,t.transition)||n.push({command:Fe.setTransition,args:[t.transition]}),r(e.light,t.light)||n.push({command:Fe.setLight,args:[t.light]}),r(e.fog,t.fog)||n.push({command:Fe.setFog,args:[t.fog]});const i={},a=[];!function(e,t,n,i){let a;for(a in t=t||{},e=e||{})e.hasOwnProperty(a)&&(t.hasOwnProperty(a)||Ue(a,n,i));for(a in t)t.hasOwnProperty(a)&&(e.hasOwnProperty(a)?r(e[a],t[a])||("geojson"===e[a].type&&"geojson"===t[a].type&&je(e,t,a)?n.push({command:Fe.setGeoJSONSourceData,args:[a,t[a].data]}):Ve(a,t,n,i)):Ne(a,t,n))}(e.sources,t.sources,a,i);const o=[];e.layers&&e.layers.forEach((e=>{i[e.source]?n.push({command:Fe.removeLayer,args:[e.id]}):o.push(e)}));let s=e.terrain;s&&i[s.source]&&(n.push({command:Fe.setTerrain,args:[void 0]}),s=void 0),n=n.concat(a),r(s,t.terrain)||n.push({command:Fe.setTerrain,args:[t.terrain]}),function(e,t,n){t=t||[];const i=(e=e||[]).map(He),a=t.map(He),o=e.reduce(We,{}),s=t.reduce(We,{}),l=i.slice(),c=Object.create(null);let u,h,d,p,f,m,g;for(u=0,h=0;u<i.length;u++)d=i[u],s.hasOwnProperty(d)?h++:(n.push({command:Fe.removeLayer,args:[d]}),l.splice(l.indexOf(d,h),1));for(u=0,h=0;u<a.length;u++)d=a[a.length-1-u],l[l.length-1-u]!==d&&(o.hasOwnProperty(d)?(n.push({command:Fe.removeLayer,args:[d]}),l.splice(l.lastIndexOf(d,l.length-h),1)):h++,m=l[l.length-u],n.push({command:Fe.addLayer,args:[s[d],m]}),l.splice(l.length-u,0,d),c[d]=!0);for(u=0;u<a.length;u++)if(d=a[u],p=o[d],f=s[d],!c[d]&&!r(p,f))if(r(p.source,f.source)&&r(p["source-layer"],f["source-layer"])&&r(p.type,f.type)){for(g in Ge(p.layout,f.layout,n,d,null,Fe.setLayoutProperty),Ge(p.paint,f.paint,n,d,null,Fe.setPaintProperty),r(p.filter,f.filter)||n.push({command:Fe.setFilter,args:[d,f.filter]}),r(p.minzoom,f.minzoom)&&r(p.maxzoom,f.maxzoom)||n.push({command:Fe.setLayerZoomRange,args:[d,f.minzoom,f.maxzoom]}),p)p.hasOwnProperty(g)&&"layout"!==g&&"paint"!==g&&"filter"!==g&&"metadata"!==g&&"minzoom"!==g&&"maxzoom"!==g&&(0===g.indexOf("paint.")?Ge(p[g],f[g],n,d,g.slice(6),Fe.setPaintProperty):r(p[g],f[g])||n.push({command:Fe.setLayerProperty,args:[d,g,f[g]]}));for(g in f)f.hasOwnProperty(g)&&!p.hasOwnProperty(g)&&"layout"!==g&&"paint"!==g&&"filter"!==g&&"metadata"!==g&&"minzoom"!==g&&"maxzoom"!==g&&(0===g.indexOf("paint.")?Ge(p[g],f[g],n,d,g.slice(6),Fe.setPaintProperty):r(p[g],f[g])||n.push({command:Fe.setLayerProperty,args:[d,g,f[g]]}))}else n.push({command:Fe.removeLayer,args:[d]}),m=l[l.lastIndexOf(d)+1],n.push({command:Fe.addLayer,args:[f,m]})}(o,t.layers,n)}catch(e){console.warn("Unable to compute style diff:",e),n=[{command:Fe.setStyle,args:[t]}]}return n}(this.serialize(),t).filter((e=>!(e.command in Ft)));if(0===n.length)return!1;const i=n.filter((e=>!(e.command in Bt)));if(i.length>0)throw new Error(`Unimplemented: ${i.map((e=>e.command)).join(", ")}.`);return n.forEach((e=>{"setTransition"!==e.command&&this[e.command].apply(this,e.args)})),this.stylesheet=t,!0}addImage(t,n){if(this.getImage(t))return this.fire(new e.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(t,n),this._afterImageUpdated(t)}updateImage(e,t){this.imageManager.updateImage(e,t)}getImage(e){return this.imageManager.getImage(e)}removeImage(t){if(!this.getImage(t))return this.fire(new e.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new e.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,n,i={}){if(this._checkLoaded(),void 0!==this.getSource(t))throw new Error("There is already a source with this ID");if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(e.validateStyle.source,`sources.${t}`,n,null,i))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const r=Me(t,n,this.dispatcher,this);r.setEventedParent(this,(()=>({isSourceLoaded:this.loaded(),source:r.serialize(),sourceId:t})));const a=n=>{const i=(n?"symbol:":"other:")+t,a=this._sourceCaches[i]=new e.SourceCache(i,r,n);(n?this._symbolSourceCaches:this._otherSourceCaches)[t]=a,a.style=this,a.onAdd(this.map)};a(!1),"vector"!==n.type&&"geojson"!==n.type||a(!0),r.onAdd&&r.onAdd(this.map),this._changed=!0}removeSource(t){this._checkLoaded();const n=this.getSource(t);if(void 0===n)throw new Error("There is no source with this ID");for(const r in this._layers)if(this._layers[r].source===t)return this.fire(new e.ErrorEvent(new Error(`Source "${t}" cannot be removed while layer "${r}" is using it.`)));if(this.terrain&&this.terrain.get().source===t)return this.fire(new e.ErrorEvent(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));const i=this._getSourceCaches(t);for(const r of i)delete this._sourceCaches[r.id],delete this._updatedSources[r.id],r.fire(new e.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:r.getSource().id})),r.setEventedParent(null),r.clearTiles();delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],n.setEventedParent(null),n.onRemove&&n.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,t){this._checkLoaded(),this.getSource(e).setData(t),this._changed=!0}getSource(e){const t=this._getSourceCache(e);return t&&t.getSource()}addLayer(t,n,i={}){this._checkLoaded();const r=t.id;if(this.getLayer(r))return void this.fire(new e.ErrorEvent(new Error(`Layer with id "${r}" already exists on this map`)));let a;if("custom"===t.type){if(Ot(this,e.validateCustomStyleLayer(t)))return;a=e.createStyleLayer(t)}else{if("object"==typeof t.source&&(this.addSource(r,t.source),t=e.clone$2(t),t=e.extend(t,{source:r})),this._validate(e.validateStyle.layer,`layers.${r}`,t,{arrayIndex:-1},i))return;a=e.createStyleLayer(t),this._validateLayer(a),a.setEventedParent(this,{layer:{id:r}}),this._serializedLayers[a.id]=a.serialize(),this._updateLayerCount(a,!0)}const o=n?this._order.indexOf(n):this._order.length;if(n&&-1===o)return void this.fire(new e.ErrorEvent(new Error(`Layer with id "${n}" does not exist on this map.`)));this._order.splice(o,0,r),this._layerOrderChanged=!0,this._layers[r]=a;const s=this._getLayerSourceCache(a);if(this._removedLayers[r]&&a.source&&s&&"custom"!==a.type){const e=this._removedLayers[r];delete this._removedLayers[r],e.type!==a.type?this._updatedSources[a.source]="clear":(this._updatedSources[a.source]="reload",s.pause())}this._updateLayer(a),a.onAdd&&a.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(t,n){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===n)return;const i=this._order.indexOf(t);this._order.splice(i,1);const r=n?this._order.indexOf(n):this._order.length;n&&-1===r?this.fire(new e.ErrorEvent(new Error(`Layer with id "${n}" does not exist on this map.`))):(this._order.splice(r,0,t),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(t){this._checkLoaded();const n=this._layers[t];if(!n)return void this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be removed.`)));n.setEventedParent(null),this._updateLayerCount(n,!1);const i=this._order.indexOf(t);this._order.splice(i,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=n,delete this._layers[t],delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],n.onRemove&&n.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(e){return this._layers[e]}hasLayer(e){return e in this._layers}hasLayerType(e){for(const t in this._layers)if(this._layers[t].type===e)return!0;return!1}setLayerZoomRange(t,n,i){this._checkLoaded();const r=this.getLayer(t);r?r.minzoom===n&&r.maxzoom===i||(null!=n&&(r.minzoom=n),null!=i&&(r.maxzoom=i),this._updateLayer(r)):this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(t,n,i={}){this._checkLoaded();const a=this.getLayer(t);if(a){if(!r(a.filter,n))return null==n?(a.filter=void 0,void this._updateLayer(a)):void(this._validate(e.validateStyle.filter,`layers.${a.id}.filter`,n,null,i)||(a.filter=e.clone$2(n),this._updateLayer(a)))}else this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be filtered.`)))}getFilter(t){return e.clone$2(this.getLayer(t).filter)}setLayoutProperty(t,n,i,a={}){this._checkLoaded();const o=this.getLayer(t);o?r(o.getLayoutProperty(n),i)||(o.setLayoutProperty(n,i,a),this._updateLayer(o)):this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(t,n){const i=this.getLayer(t);if(i)return i.getLayoutProperty(n);this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style.`)))}setPaintProperty(t,n,i,a={}){this._checkLoaded();const o=this.getLayer(t);o?r(o.getPaintProperty(n),i)||(o.setPaintProperty(n,i,a)&&this._updateLayer(o),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(e,t){return this.getLayer(e).getPaintProperty(t)}setFeatureState(t,n){this._checkLoaded();const i=t.source,r=t.sourceLayer,a=this.getSource(i);if(void 0===a)return void this.fire(new e.ErrorEvent(new Error(`The source '${i}' does not exist in the map's style.`)));const o=a.type;if("geojson"===o&&r)return void this.fire(new e.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===o&&!r)return void this.fire(new e.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===t.id&&this.fire(new e.ErrorEvent(new Error("The feature id parameter must be provided.")));const s=this._getSourceCaches(i);for(const e of s)e.setFeatureState(r,t.id,n)}removeFeatureState(t,n){this._checkLoaded();const i=t.source,r=this.getSource(i);if(void 0===r)return void this.fire(new e.ErrorEvent(new Error(`The source '${i}' does not exist in the map's style.`)));const a=r.type,o="vector"===a?t.sourceLayer:void 0;if("vector"===a&&!o)return void this.fire(new e.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(n&&"string"!=typeof t.id&&"number"!=typeof t.id)return void this.fire(new e.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const s=this._getSourceCaches(i);for(const e of s)e.removeFeatureState(o,t.id,n)}getFeatureState(t){this._checkLoaded();const n=t.source,i=t.sourceLayer,r=this.getSource(n);if(void 0!==r){if("vector"!==r.type||i)return void 0===t.id&&this.fire(new e.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(n)[0].getFeatureState(i,t.id);this.fire(new e.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new e.ErrorEvent(new Error(`The source '${n}' does not exist in the map's style.`)))}getTransition(){return e.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const t={};for(const e in this._sourceCaches){const n=this._sourceCaches[e].getSource();t[n.id]||(t[n.id]=n.serialize())}return e.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:t,layers:this._serializeLayers(this._order)},(e=>void 0!==e))}_updateLayer(e){this._updatedLayers[e.id]=!0;const t=this._getLayerSourceCache(e);e.source&&!this._updatedSources[e.source]&&t&&"raster"!==t.getSource().type&&(this._updatedSources[e.source]="reload",t.pause()),this._changed=!0}_flattenAndSortRenderedFeatures(e){const t=e=>"fill-extrusion"===this._layers[e].type,n={},i=[];for(let a=this._order.length-1;a>=0;a--){const r=this._order[a];if(t(r)){n[r]=a;for(const t of e){const e=t[r];if(e)for(const t of e)i.push(t)}}}i.sort(((e,t)=>t.intersectionZ-e.intersectionZ));const r=[];for(let a=this._order.length-1;a>=0;a--){const o=this._order[a];if(t(o))for(let e=i.length-1;e>=0;e--){const t=i[e].feature;if(n[t.layer.id]<a)break;r.push(t),i.pop()}else for(const t of e){const e=t[o];if(e)for(const t of e)r.push(t.feature)}}return r}queryRenderedFeatures(t,n,i){n&&n.filter&&this._validate(e.validateStyle.filter,"queryRenderedFeatures.filter",n.filter,null,n);const r={};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new e.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const t of n.layers){const n=this._layers[t];if(!n)return this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be queried for features.`))),[];r[n.source]=!0}}const a=[];n.availableImages=this._availableImages;const o=n&&n.layers?n.layers.some((e=>{const t=this.getLayer(e);return t&&t.is3D()})):this.has3DLayers(),s=P.createFromScreenPoints(t,i);for(const e in this._sourceCaches){const t=this._sourceCaches[e].getSource().id;n.layers&&!r[t]||a.push(Ae(this._sourceCaches[e],this._layers,this._serializedLayers,s,n,i,o,!!this.map._showQueryGeometry))}return this.placement&&a.push(function(e,t,n,i,r,a,o){const s={},l=a.queryRenderedSymbols(i),c=[];for(const u of Object.keys(l).map(Number))c.push(o[u]);c.sort(Pe);for(const u of c){const n=u.featureIndex.lookupSymbolFeatures(l[u.bucketInstanceId],t,u.bucketIndex,u.sourceLayerIndex,r.filter,r.layers,r.availableImages,e);for(const e in n){const t=s[e]=s[e]||[],i=n[e];i.sort(((e,t)=>{const n=u.featureSortOrder;if(n){const i=n.indexOf(e.featureIndex);return n.indexOf(t.featureIndex)-i}return t.featureIndex-e.featureIndex}));for(const e of i)t.push(e)}}for(const u in s)s[u].forEach((t=>{const i=t.feature,r=n(e[u]).getFeatureState(i.layer["source-layer"],i.id);i.source=i.layer.source,i.layer["source-layer"]&&(i.sourceLayer=i.layer["source-layer"]),i.state=r}));return s}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),s.screenGeometry,n,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(a)}querySourceFeatures(t,n){n&&n.filter&&this._validate(e.validateStyle.filter,"querySourceFeatures.filter",n.filter,null,n);const i=this._getSourceCaches(t);let r=[];for(const e of i)r=r.concat(Ce(e,n));return r}addSourceType(e,t,n){return Vt.getSourceType(e)?n(new Error(`A source type called "${e}" already exists.`)):(Vt.setSourceType(e,t),t.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:e,url:t.workerSourceURL},n):n(null,null))}getLight(){return this.light.getLight()}setLight(t,n={}){this._checkLoaded();const i=this.light.getLight();let a=!1;for(const e in t)if(!r(t[e],i[e])){a=!0;break}if(!a)return;const o={now:e.exported.now(),transition:e.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,n),this.light.updateTransitions(o)}getTerrain(){return this.terrain?this.terrain.get():null}setTerrain(t){if(this._checkLoaded(),!t)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if("object"==typeof t.source){const n="terrain-dem-src";this.addSource(n,t.source),t=e.clone$2(t),t=e.extend(t,{source:n})}if(!this._validate(e.validateStyle.terrain,"terrain",t)){if(this.terrain){const n=this.terrain,i=n.get();for(const a in t)if(!r(t[a],i[a])){n.set(t),this.stylesheet.terrain=t;const i={now:e.exported.now(),transition:e.extend({duration:0},this.stylesheet.transition)};n.updateTransitions(i);break}}else this._createTerrain(t);this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}}_createFog(t){const n=this.fog=new k(t);this.stylesheet.fog=t;const i={now:e.exported.now(),transition:e.extend({duration:0},this.stylesheet.transition)};n.updateTransitions(i)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask((()=>{for(const e of this.map._markers)e._evaluateOpacity()}))}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const n=this.fog,i=n.get();for(const a in t)if(!r(t[a],i[a])){n.set(t),this.stylesheet.fog=t;const i={now:e.exported.now(),transition:e.extend({duration:0},this.stylesheet.transition)};n.updateTransitions(i);break}}else this._createFog(t);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const e=this._order.filter((e=>this.isLayerDraped(this._layers[e]))),t=this._order.filter((e=>!this.isLayerDraped(this._layers[e])));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...e),this._drapedFirstOrder.push(...t)}_createTerrain(t){const n=this.terrain=new w(t);this.stylesheet.terrain=t,this.dispatcher.broadcast("enableTerrain",!0),this._force3DLayerUpdate();const i={now:e.exported.now(),transition:e.extend({duration:0},this.stylesheet.transition)};n.updateTransitions(i)}_force3DLayerUpdate(){for(const e in this._layers){const t=this._layers[e];"fill-extrusion"===t.type&&this._updateLayer(t)}}_validate(t,n,i,r,a={}){return(!a||!1!==a.validate)&&Ot(this,t.call(e.validateStyle,e.extend({key:n,style:this.serialize(),value:i,styleSpec:e.spec},r)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),e.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const e in this._layers)this._layers[e].setEventedParent(null);for(const e in this._sourceCaches)this._sourceCaches[e].clearTiles(),this._sourceCaches[e].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(e){const t=this._getSourceCaches(e);for(const n of t)n.clearTiles()}_reloadSource(e){const t=this._getSourceCaches(e);for(const n of t)n.resume(),n.reload()}_updateSources(e){for(const t in this._sourceCaches)this._sourceCaches[t].update(e)}_generateCollisionBoxes(){for(const e in this._sourceCaches){const t=this._sourceCaches[e];t.resume(),t.reload()}}_updatePlacement(t,n,i,r,a=!1){let o=!1,s=!1;const l={};for(const e of this._order){const n=this._layers[e];if("symbol"!==n.type)continue;if(!l[n.source]){const e=this._getLayerSourceCache(n);if(!e)continue;l[n.source]=e.getRenderableIds(!0).map((t=>e.getTileByID(t))).sort(((e,t)=>t.tileID.overscaledZ-e.tileID.overscaledZ||(e.tileID.isLessThan(t.tileID)?-1:1)))}const i=this.crossTileSymbolIndex.addLayer(n,l[n.source],t.center.lng);o=o||i}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),a=a||this._layerOrderChanged||0===i,this._layerOrderChanged&&this.fire(new e.Event("neworder")),(a||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(e.exported.now(),t.zoom))&&(this.pauseablePlacement=new Pt(t,this._order,a,n,i,r,this.placement,this.fog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,l),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(e.exported.now()),s=!0),o&&this.pauseablePlacement.placement.setStale()),s||o)for(const e of this._order){const t=this._layers[e];"symbol"===t.type&&this.placement.updateLayerOpacities(t,l[t.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(e.exported.now())}_releaseSymbolFadeTiles(){for(const e in this._sourceCaches)this._sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,t,n){this.imageManager.getImages(t.icons,n),this._updateTilesForChangedImages();const i=e=>{e&&e.setDependencies(t.tileID.key,t.type,t.icons)};i(this._otherSourceCaches[t.source]),i(this._symbolSourceCaches[t.source])}getGlyphs(e,t,n){this.glyphManager.getGlyphs(t.stacks,n)}getResource(t,n,i){return e.makeRequest(n,i)}_getSourceCache(e){return this._otherSourceCaches[e]}_getLayerSourceCache(e){return"symbol"===e.type?this._symbolSourceCaches[e.source]:this._otherSourceCaches[e.source]}_getSourceCaches(e){const t=[];return this._otherSourceCaches[e]&&t.push(this._otherSourceCaches[e]),this._symbolSourceCaches[e]&&t.push(this._symbolSourceCaches[e]),t}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}}Vt.getSourceType=function(e){return Ee[e]},Vt.setSourceType=function(e,t){Ee[e]=t},Vt.registerForPluginStateChange=e.registerForPluginStateChange;var jt="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}\n#endif",Gt="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let Ht={},Wt={};Ht=Xt("","\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef TERRAIN\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);}float prevElevation(vec2 apos) {float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nfloat unpack_depth(vec4 rgba_depth)\n{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",!0),Wt=Xt("#ifdef FOG\nuniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec3 fog_apply_from_vert(vec3 color,float fog_opac) {return mix(color,u_fog_color.rgb,fog_opac);}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb/=alpha;color.rgb=fog_apply(color.rgb,pos);color.rgb*=alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif","#ifdef FOG\nuniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",!0);const qt=Xt("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),Zt=jt;var $t={background:Xt("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:Xt("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:Xt("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);vec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nvec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:Xt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Xt("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\ngl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec3 pos=vec3(floor(a_pos*0.5)+extrude,elevation(floor(a_pos*0.5)));gl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:Xt("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Xt("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=u_matrix*vec4(a_pos,elevation(a_pos),1.0);gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Xt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Xt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);}"),fill:Xt("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:Xt("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:Xt("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:Xt("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:Xt("varying vec4 v_color;void main() {vec4 color=v_color;\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;varying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;\n#ifdef TERRAIN\nvec2 centroid_pos=a_centroid_pos;bool flat_roof=centroid_pos.x !=0.0;float ele=elevation(pos_nx.xy);float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#else\nvec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);gl_Position=u_matrix*vec4(pos,1);\n#endif\nfloat colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:Xt("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;\n#ifdef TERRAIN\nvec2 centroid_pos=a_centroid_pos;bool flat_roof=centroid_pos.x !=0.0;float ele=elevation(pos_nx.xy);float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);\n#else\nvec3 p=vec3(pos_nx.xy,z);gl_Position=u_matrix*vec4(p,1);\n#endif\nvec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:Xt("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Xt("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:Xt("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),lineGradient:Xt("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:Xt("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),lineSDF:Xt("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 dash_from\n#pragma mapbox: initialize mediump vec4 dash_to\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);vec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 dash_from\n#pragma mapbox: initialize mediump vec4 dash_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float widthA=dash_from.z*fromScale;float widthB=dash_to.z*toScale;float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*(tileZoomRatio/widthA)/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*(tileZoomRatio/widthB)/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);v_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:Xt("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:Xt("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float h=elevation(a_pos);vec4 projectedPoint=u_matrix*vec4(a_pos,h,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),h,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h,1.0);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));}"),symbolSDF:Xt("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float h=elevation(a_pos);vec4 projectedPoint=u_matrix*vec4(a_pos,h,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),h,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h,1.0);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),symbolTextAndIcon:Xt("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float h=elevation(a_pos);vec4 projectedPoint=u_matrix*vec4(a_pos,h,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),h,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h,1.0);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}"),terrainRaster:Xt("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef FOG\ncolor.rgb=fog_dither(fog_apply_from_vert(color.rgb,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n}"),terrainDepth:Xt("#ifdef GL_ES\nprecision highp float;\n#endif\nvec4 pack_depth(float ndc_z) {float depth=ndc_z*0.5+0.5;const vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Xt("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Gt),skyboxGradient:Xt("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform lowp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Gt),skyboxCapture:Xt("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}")};function Xt(e,t,n){const i=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,r=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,a=t.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),o=e.match(r),s=t.match(r),l=jt.match(r);let c=s?s.concat(o):o;n||(Ht.staticUniforms&&(c=Ht.staticUniforms.concat(c)),Wt.staticUniforms&&(c=Wt.staticUniforms.concat(c))),c&&(c=c.concat(l));const u={};return{fragmentSource:e=e.replace(i,((e,t,n,i,r)=>(u[r]=!0,"define"===t?`\n#ifndef HAS_UNIFORM_u_${r}\nvarying ${n} ${i} ${r};\n#else\nuniform ${n} ${i} u_${r};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${r}\n    ${n} ${i} ${r} = u_${r};\n#endif\n`))),vertexSource:t=t.replace(i,((e,t,n,i,r)=>{const a="float"===i?"vec2":"vec4",o=r.match(/color/)?"color":a;return u[r]?"define"===t?`\n#ifndef HAS_UNIFORM_u_${r}\nuniform lowp float u_${r}_t;\nattribute ${n} ${a} a_${r};\nvarying ${n} ${i} ${r};\n#else\nuniform ${n} ${i} u_${r};\n#endif\n`:"vec4"===o?`\n#ifndef HAS_UNIFORM_u_${r}\n    ${r} = a_${r};\n#else\n    ${n} ${i} ${r} = u_${r};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${r}\n    ${r} = unpack_mix_${o}(a_${r}, u_${r}_t);\n#else\n    ${n} ${i} ${r} = u_${r};\n#endif\n`:"define"===t?`\n#ifndef HAS_UNIFORM_u_${r}\nuniform lowp float u_${r}_t;\nattribute ${n} ${a} a_${r};\n#else\nuniform ${n} ${i} u_${r};\n#endif\n`:"vec4"===o?`\n#ifndef HAS_UNIFORM_u_${r}\n    ${n} ${i} ${r} = a_${r};\n#else\n    ${n} ${i} ${r} = u_${r};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${r}\n    ${n} ${i} ${r} = unpack_mix_${o}(a_${r}, u_${r}_t);\n#else\n    ${n} ${i} ${r} = u_${r};\n#endif\n`})),staticAttributes:a,staticUniforms:c}}class Yt{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,t,n,i,r,a,o,s){this.context=e;let l=this.boundPaintVertexBuffers.length!==i.length;for(let c=0;!l&&c<i.length;c++)this.boundPaintVertexBuffers[c]!==i[c]&&(l=!0);e.extVertexArrayObject&&this.vao&&this.boundProgram===t&&this.boundLayoutVertexBuffer===n&&!l&&this.boundIndexBuffer===r&&this.boundVertexOffset===a&&this.boundDynamicVertexBuffer===o&&this.boundDynamicVertexBuffer2===s?(e.bindVertexArrayOES.set(this.vao),o&&o.bind(),r&&r.dynamicDraw&&r.bind(),s&&s.bind()):this.freshBind(t,n,i,r,a,o,s)}freshBind(e,t,n,i,r,a,o){let s;const l=e.numAttributes,c=this.context,u=c.gl;if(c.extVertexArrayObject)this.vao&&this.destroy(),this.vao=c.extVertexArrayObject.createVertexArrayOES(),c.bindVertexArrayOES.set(this.vao),s=0,this.boundProgram=e,this.boundLayoutVertexBuffer=t,this.boundPaintVertexBuffers=n,this.boundIndexBuffer=i,this.boundVertexOffset=r,this.boundDynamicVertexBuffer=a,this.boundDynamicVertexBuffer2=o;else{s=c.currentNumAttributes||0;for(let e=l;e<s;e++)u.disableVertexAttribArray(e)}t.enableAttributes(u,e);for(const h of n)h.enableAttributes(u,e);a&&a.enableAttributes(u,e),o&&o.enableAttributes(u,e),t.bind(),t.setVertexAttribPointers(u,e,r);for(const h of n)h.bind(),h.setVertexAttribPointers(u,e,r);a&&(a.bind(),a.setVertexAttribPointers(u,e,r)),i&&i.bind(),o&&(o.bind(),o.setVertexAttribPointers(u,e,r)),c.currentNumAttributes=l}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Jt(t,n){const i=Math.pow(2,n.canonical.z),r=n.canonical.y;return[new e.MercatorCoordinate(0,r/i).toLngLat().lat,new e.MercatorCoordinate(0,(r+1)/i).toLngLat().lat]}function Kt(t,n,i,r,a,o,s){const l=t.context,c=l.gl,u=i.fbo;if(!u)return;t.prepareDrawTile(n);const h=t.useProgram("hillshade");l.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,u.colorAttachment.get());const d=((e,t,n,i)=>{const r=n.paint.get("hillshade-shadow-color"),a=n.paint.get("hillshade-highlight-color"),o=n.paint.get("hillshade-accent-color");let s=n.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===n.paint.get("hillshade-illumination-anchor")&&(s-=e.transform.angle);const l=!e.options.moving;return{u_matrix:i||e.transform.calculateProjMatrix(t.tileID.toUnwrapped(),l),u_image:0,u_latrange:Jt(0,t.tileID),u_light:[n.paint.get("hillshade-exaggeration"),s],u_shadow:r,u_highlight:a,u_accent:o}})(t,i,r,t.terrain?n.projMatrix:null);t.prepareDrawProgram(l,h,n.toUnwrapped()),h.draw(l,c.TRIANGLES,a,o,s,e.CullFaceMode.disabled,d,r.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments)}function Qt(t,n,i){if(!n.needsDEMTextureUpload)return;const r=t.context,a=r.gl;r.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||t.getTileTexture(i.stride);const o=i.getPixels();n.demTexture?n.demTexture.update(o,{premultiply:!1}):n.demTexture=new e.Texture(r,o,a.RGBA,{premultiply:!1}),n.needsDEMTextureUpload=!1}function en(t,n,i,r,a,o){const s=t.context,l=s.gl;if(!n.dem)return;const c=n.dem;if(s.activeTexture.set(l.TEXTURE1),Qt(t,n,c),!n.demTexture)return;n.demTexture.bind(l.NEAREST,l.CLAMP_TO_EDGE);const u=c.dim;s.activeTexture.set(l.TEXTURE0);let h=n.fbo;if(!h){const t=new e.Texture(s,{width:u,height:u,data:null},l.RGBA);t.bind(l.LINEAR,l.CLAMP_TO_EDGE),h=n.fbo=s.createFramebuffer(u,u,!0),h.colorAttachment.set(t.texture)}s.bindFramebuffer.set(h.framebuffer),s.viewport.set([0,0,u,u]),t.useProgram("hillshadePrepare").draw(s,l.TRIANGLES,r,a,o,e.CullFaceMode.disabled,((t,n)=>{const i=n.stride,r=e.create$1();return e.ortho(r,0,e.EXTENT,-e.EXTENT,0,0,1),e.translate(r,r,[0,-e.EXTENT,0]),{u_matrix:r,u_image:1,u_dimension:[i,i],u_zoom:t.overscaledZ,u_unpack:n.unpackVector}})(n.tileID,c),i.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments),n.needsHillshadePrepare=!1}const tn=(t,n)=>({u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_image0:new e.Uniform1i(t,n.u_image0),u_skirt_height:new e.Uniform1f(t,n.u_skirt_height)}),nn=(e,t)=>({u_matrix:e,u_image0:0,u_skirt_height:t}),rn=new class{constructor(){this.operations={}}newMorphing(e,t,n,i,r){if(e in this.operations){const t=this.operations[e];t.to.tileID.key!==n.tileID.key&&(t.queued=n)}else this.operations[e]={startTime:i,phase:0,duration:r,from:t,to:n,queued:null}}getMorphValuesForProxy(e){if(!(e in this.operations))return null;const t=this.operations[e];return{from:t.from,to:t.to,phase:t.phase}}update(e){for(const t in this.operations){const n=this.operations[t];for(n.phase=(e-n.startTime)/n.duration;n.phase>=1||!this._validOp(n);)if(!this._nextOp(n,e)){delete this.operations[t];break}}}_nextOp(e,t){return!!e.queued&&(e.from=e.to,e.to=e.queued,e.queued=null,e.phase=0,e.startTime=t,!0)}_validOp(e){return e.from.hasData()&&e.to.hasData()}},an={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function on(t,n,i,r,a){const o=t.context,s=o.gl;let l,c;const u=t.options.showTerrainWireframe?2:0,h=(e,n)=>{if(c===e)return;const i=[an[e]];n&&i.push(an[u]),l=t.useProgram("terrainRaster",null,i),c=e},d=t.colorModeForRenderPass(),p=new e.DepthMode(s.LEQUAL,e.DepthMode.ReadWrite,t.depthRangeFor3D);rn.update(a);const f=t.transform,m=6*Math.pow(1.5,22-f.zoom)*n.exaggeration();(u?[!1,!0]:[!1]).forEach((u=>{c=-1;const g=u?s.LINES:s.TRIANGLES,[v,y]=u?n.getWirefameBuffer():[n.gridIndexBuffer,n.gridSegments];for(const c of r){const r=i.getTile(c),b=e.StencilMode.disabled,w=n.prevTerrainTileForTile[c.key],S=n.terrainTileForTile[c.key];x=S,null!=(_=w)&&null!=x&&_.hasData()&&x.hasData()&&null!=_.demTexture&&null!=x.demTexture&&_.tileID.key!==x.tileID.key&&rn.newMorphing(c.key,w,S,a,250),o.activeTexture.set(s.TEXTURE0),r.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE,s.LINEAR_MIPMAP_NEAREST);const T=rn.getMorphValuesForProxy(c.key),E=T?1:0;let M;T&&(M={morphing:{srcDemTile:T.from,dstDemTile:T.to,phase:e.easeCubicInOut(T.phase)}});const k=nn(c.projMatrix,sn(c.canonical,f.renderWorldCopies)?m/10:m);h(E,u),n.setupElevationDraw(r,l,M),t.prepareDrawProgram(o,l,c.toUnwrapped()),l.draw(o,g,p,b,d,e.CullFaceMode.backCCW,k,"terrain_raster",n.gridBuffer,v,y)}var _,x}))}function sn(e,t){const n=1<<e.z;return!t&&(0===e.x||e.x===n-1)||0===e.y||e.y===n-1}const ln=e=>({u_matrix:e});function cn(t,n,i,r,a){if(a>0){const o=e.exported.now(),s=(o-t.timeAdded)/a,l=n?(o-n.timeAdded)/a:-1,c=i.getSource(),u=r.coveringZoomLevel({tileSize:c.tileSize,roundZoom:c.roundZoom}),h=!n||Math.abs(n.tileID.overscaledZ-u)>Math.abs(t.tileID.overscaledZ-u),d=h&&t.refreshedUponExpiration?1:e.clamp(h?s:1-l,0,1);return t.refreshedUponExpiration&&s>=1&&(t.refreshedUponExpiration=!1),n?{opacity:1,mix:1-d}:{opacity:d,mix:0}}return{opacity:1,mix:0}}class un extends e.SourceCache{constructor(e){const t=Me("proxy",{type:"geojson",maxzoom:e.transform.maxZoom},new A(De(),null),e.style);super("proxy",t,!1),t.setEventedParent(this),this.map=this.getSource().map=e,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,n,i){if(t.freezeTileCoverage)return;this.transform=t;const r=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce(((n,i)=>{if(n[i.key]="",!this._tiles[i.key]){const n=new e.Tile(i,this._source.tileSize*i.overscaleFactor(),t.tileZoom);n.state="loaded",this._tiles[i.key]=n}return n}),{});for(const e in this._tiles)e in r||(this.freeFBO(e),this._tiles[e].state="unloaded",delete this._tiles[e])}freeFBO(e){const t=this.proxyCachedFBO[e];if(void 0!==t){const n=Object.values(t);this.renderCachePool.push(...n),delete this.proxyCachedFBO[e]}}deallocRenderCache(){this.renderCache.forEach((e=>e.fb.destroy())),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class hn extends e.OverscaledTileID{constructor(e,t,n){super(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y),this.proxyTileKey=t,this.projMatrix=n}}class dn extends e.Elevation{constructor(t,n){super(),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[i,r,a]=function(t){const n=new e.StructArrayLayout4i8,i=new e.StructArrayLayout3ui6,r=131;n.reserve(17161),i.reserve(33800);const a=e.EXTENT/128,o=e.EXTENT+a/2,s=o+a;for(let c=-a;c<s;c+=a)for(let t=-a;t<s;t+=a){const i=t<0||t>o||c<0||c>o?24575:0,r=e.clamp(Math.round(t),0,e.EXTENT),a=e.clamp(Math.round(c),0,e.EXTENT);n.emplaceBack(r+i,a,r,a)}const l=(e,t)=>{const n=t*r+e;i.emplaceBack(n+1,n,n+r),i.emplaceBack(n+r,n+r+1,n+1)};for(let e=1;e<129;e++)for(let t=1;t<129;t++)l(t,e);return[0,129].forEach((e=>{for(let t=0;t<130;t++)l(t,e),l(e,t)})),[n,i,32768]}(),o=t.context;this.gridBuffer=o.createVertexBuffer(i,Se.members),this.gridIndexBuffer=o.createIndexBuffer(r),this.gridSegments=e.SegmentVector.simpleSegment(0,0,i.length,r.length),this.gridNoSkirtSegments=e.SegmentVector.simpleSegment(0,0,i.length,a),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new un(n.map),this.orthoMatrix=e.create$1(),e.ortho(this.orthoMatrix,0,e.EXTENT,0,e.EXTENT,0,1);const s=o.gl;this._overlapStencilMode=new e.StencilMode({func:s.GEQUAL,mask:255},0,255,s.KEEP,s.KEEP,s.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=n,this._useVertexMorphing=!0,this._exaggeration=1}set style(e){e.on("data",this._onStyleDataEvent.bind(this)),e.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=e,this._checkRenderCacheEfficiency()}update(t,n,i){if(t&&t.terrain){this._style!==t&&(this.style=t),this.enabled=!0;const r=t.terrain.properties;this.sourceCache=t._getSourceCache(r.get("source")),this._exaggeration=r.get("exaggeration");const a=()=>{this.sourceCache.used&&e.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const t=this.sourceCache.getSource().tileSize/128,i=this.proxySourceCache.getSource().tileSize;this.sourceCache.update(n,t*i,!0),this._findCoveringTileCache[this.sourceCache.id]={}};this.sourceCache.usedForTerrain||(this._findCoveringTileCache[this.sourceCache.id]={},this.sourceCache.usedForTerrain=!0,a(),this._initializing=!0),a(),n.updateElevation(!i),this._findCoveringTileCache[this.proxySourceCache.id]={},this.proxySourceCache.update(n),this._emptyDEMTextureDirty=!0}else this._disable()}_checkRenderCacheEfficiency(){const t=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==t.efficiency&&e.warnOnce(`Terrain render cache efficiency is not optimal (${t.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${t.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(e){e.coord&&"source"===e.dataType?this._clearRenderCacheForTile(e.sourceCacheId,e.coord):"style"===e.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const e in this._style._sourceCaches)this._style._sourceCaches[e].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach((e=>e.fb.destroy())),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const e=2*this.proxySourceCache.getSource().tileSize;return[e,e]}set useVertexMorphing(e){this._useVertexMorphing=e}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const n=this.proxySourceCache,i=this.painter.transform;this._initializing&&(this._initializing=0===i._centerAltitude&&-1===this.getAtPointOrZero(e.MercatorCoordinate.fromLngLat(i.center),-1),this._emptyDEMTextureDirty=!this._initializing);const r=this.painter.options;this.renderCached=(r.zooming||r.moving||r.rotating||!!this.forceRenderCached)&&!this._invalidateRenderCache,this._invalidateRenderCache=!1;const a=this.proxyCoords=n.getIds().map((e=>{const t=n.getTileByID(e).tileID;return t.projMatrix=i.calculateProjMatrix(t.toUnwrapped()),t}));!function(t,n){const i=n.transform.pointCoordinate(n.transform.getCameraPoint()),r=new e.pointGeometry(i.x,i.y);t.sort(((t,n)=>{if(n.overscaledZ-t.overscaledZ)return n.overscaledZ-t.overscaledZ;const i=new e.pointGeometry(t.canonical.x+(1<<t.canonical.z)*t.wrap,t.canonical.y),a=new e.pointGeometry(n.canonical.x+(1<<n.canonical.z)*n.wrap,n.canonical.y),o=r.mult(1<<t.canonical.z);return o.x-=.5,o.y-=.5,o.distSqr(i)-o.distSqr(a)}))}(a,this.painter),this._previousZoom=i.zoom;const o=this.proxyToSource||{};this.proxyToSource={},a.forEach((e=>{this.proxyToSource[e.key]={}})),this.terrainTileForTile={};const s=this._style._sourceCaches;for(const e in s){const n=s[e];if(!n.used)continue;if(n!==this.sourceCache&&(this._findCoveringTileCache[n.id]={}),this._setupProxiedCoordsForOrtho(n,t[e],o),n.usedForTerrain)continue;const i=t[e];n.getSource().reparseOverscaled&&this._assignTerrainTiles(i)}this.proxiedCoords[n.id]=a.map((e=>new hn(e,e.key,this.orthoMatrix))),this._assignTerrainTiles(a),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(o),this.renderingToTexture=!1,this._updateTimestamp=e.exported.now();const l={};this._visibleDemTiles=[];for(const e of this.proxyCoords){const t=this.terrainTileForTile[e.key];if(!t)continue;const n=t.tileID.key;n in l||(this._visibleDemTiles.push(t),l[n]=n)}}_assignTerrainTiles(e){this._initializing||e.forEach((e=>{if(this.terrainTileForTile[e.key])return;const t=this._findTileCoveringTileID(e,this.sourceCache);t&&(this.terrainTileForTile[e.key]=t)}))}_prepareDEMTextures(){const e=this.painter.context,t=e.gl;for(const n in this.terrainTileForTile){const i=this.terrainTileForTile[n],r=i.dem;!r||i.demTexture&&!i.needsDEMTextureUpload||(e.activeTexture.set(t.TEXTURE1),Qt(this.painter,i,r))}}_prepareDemTileUniforms(e,t,n,i){if(!t||null==t.demTexture)return!1;const r=e.tileID.canonical,a=Math.pow(2,t.tileID.canonical.z-r.z),o=i||"";return n[`u_dem_tl${o}`]=[r.x*a%1,r.y*a%1],n[`u_dem_scale${o}`]=a,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){let e=0;const t=this._visibleDemTiles.reduce(((t,n)=>{if(!n.dem)return t;const i=n.dem.tree.minimums[0];return i>0&&e++,t+i}),0);return e?t/e:0}_updateEmptyDEMTexture(){const t=this.painter.context,n=t.gl;t.activeTexture.set(n.TEXTURE2);const i=this._getLoadedAreaMinimum(),r={width:1,height:1,data:new Uint8Array(e.DEMData.pack(i,this.sourceCache.getSource().encoding))};this._emptyDEMTextureDirty=!1;let a=this._emptyDEMTexture;return a?a.update(r,{premultiply:!1}):a=this._emptyDEMTexture=new e.Texture(t,r,n.RGBA,{premultiply:!1}),a}setupElevationDraw(t,n,i){const r=this.painter.context,a=r.gl,o=(s=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:e.DEMData.getUnpackVector(s),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var s;o.u_dem_size=this.sourceCache.getSource().tileSize,o.u_exaggeration=this.exaggeration();let l=null,c=null,u=1;if(i&&i.morphing&&this._useVertexMorphing){const e=i.morphing.srcDemTile,n=i.morphing.dstDemTile;u=i.morphing.phase,e&&n&&(this._prepareDemTileUniforms(t,e,o,"_prev")&&(c=e),this._prepareDemTileUniforms(t,n,o)&&(l=n))}if(c&&l?(r.activeTexture.set(a.TEXTURE2),l.demTexture.bind(a.NEAREST,a.CLAMP_TO_EDGE,a.NEAREST),r.activeTexture.set(a.TEXTURE4),c.demTexture.bind(a.NEAREST,a.CLAMP_TO_EDGE,a.NEAREST),o.u_dem_lerp=u):(l=this.terrainTileForTile[t.tileID.key],r.activeTexture.set(a.TEXTURE2),(this._prepareDemTileUniforms(t,l,o)?l.demTexture:this.emptyDEMTexture).bind(a.NEAREST,a.CLAMP_TO_EDGE,a.NEAREST)),i&&i.useDepthForOcclusion&&(r.activeTexture.set(a.TEXTURE3),this._depthTexture.bind(a.NEAREST,a.CLAMP_TO_EDGE,a.NEAREST),o.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height]),i&&i.useMeterToDem&&l){const t=(1<<l.tileID.canonical.z)*e.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;o.u_meter_to_dem=t}i&&i.labelPlaneMatrixInv&&(o.u_label_plane_matrix_inv=i.labelPlaneMatrixInv),n.setTerrainUniformValues(r,o)}renderBatch(t){if(0===this._drapedRenderBatches.length)return t+1;this.renderingToTexture=!0;const n=this.painter,i=this.painter.context,r=this.proxySourceCache,a=this.proxiedCoords[r.id],o=()=>{i.bindFramebuffer.set(null),i.viewport.set([0,0,n.width,n.height]),this.renderingToTexture=!1},s=this._drapedRenderBatches.shift();let l=[];const c=n.style.order;let u=0;for(let h=0;h<a.length;h++){const d=a[h],p=r.getTileByID(d.proxyTileKey),f=r.proxyCachedFBO[d.key]?r.proxyCachedFBO[d.key][t]:void 0;let m,g;if(m=this.currentFBO=void 0!==f?r.renderCache[f]:this.pool[u++],p.texture=m.tex,void 0===f||m.dirty){i.bindFramebuffer.set(m.fb.framebuffer),this.renderedToTile=!1,m.dirty&&(i.clear({color:e.Color.transparent}),m.dirty=!1);for(let e=s.start;e<=s.end;++e){const t=n.style._layers[c[e]];if(t.isHidden(n.transform.zoom))continue;const r=n.style._getLayerSourceCache(t),a=r?this.proxyToSource[d.key][r.id]:[d];if(!a)continue;const o=a;i.viewport.set([0,0,m.fb.width,m.fb.height]),g!==(r?r.id:null)&&(this._setupStencil(a,t,r),g=r?r.id:null),n.renderLayer(n,r,t,o)}m.dirty=this.renderedToTile,this.renderedToTile&&l.push(p.tileID),5===u&&(u=0,l.length>0&&(o(),on(n,this,r,l,this._updateTimestamp),this.renderingToTexture=!0,l=[]))}else l.push(p.tileID)}return o(),l.length>0&&on(n,this,r,l,this._updateTimestamp),s.end+1}postRender(){}renderCacheEfficiency(e){const t=e.order.length;if(0===t)return{efficiency:100};let n,i=0,r=0,a=!1;for(let o=0;o<t;++o){const t=e._layers[e.order[o]];this._style.isLayerDraped(t)?(a&&++i,++r):a||(a=!0,n=t.id)}return 0===r?{efficiency:100}:{efficiency:100*(1-i/r),firstUndrapedLayer:n}}getMinElevationBelowMSL(){let e=0;return this._visibleDemTiles.filter((e=>e.dem)).forEach((t=>{e=Math.min(e,t.dem.tree.minimums[0])})),0===e?e:(e-30)*this._exaggeration}raycast(e,t,n){if(!this._visibleDemTiles)return null;const i=this._visibleDemTiles.filter((e=>e.dem)).map((i=>{const r=i.tileID,a=Math.pow(2,r.overscaledZ),{x:o,y:s}=r.canonical,l=o/a,c=(o+1)/a,u=s/a,h=(s+1)/a;return{minx:l,miny:u,maxx:c,maxy:h,t:i.dem.tree.raycastRoot(l,u,c,h,e,t,n),tile:i}}));i.sort(((e,t)=>(null!==e.t?e.t:Number.MAX_VALUE)-(null!==t.t?t.t:Number.MAX_VALUE)));for(const r of i){if(null==r.t)return null;const i=r.tile.dem.tree.raycast(r.minx,r.miny,r.maxx,r.maxy,e,t,n);if(null!=i)return i}return null}_createFBO(){const t=this.painter.context,n=t.gl,i=this.drapeBufferSize;t.activeTexture.set(n.TEXTURE0);const r=new e.Texture(t,{width:i[0],height:i[1],data:null},n.RGBA);r.bind(n.LINEAR,n.CLAMP_TO_EDGE);const a=t.createFramebuffer(i[0],i[1],!1);return a.colorAttachment.set(r.texture),a.depthAttachment=new ye(t,a.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,i[0],i[1]),this._stencilRef=0,a.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):a.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&!t.extTextureFilterAnisotropicForceOff&&n.texParameterf(n.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:a,tex:r,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(!this.renderCached)return!0;if(this._style.light&&this._style.light.hasTransition())return!0;for(const e in this._style._sourceCaches)if(this._style._sourceCaches[e].hasTransition())return!0;return this._style.order.some((e=>{const t=this._style._layers[e],n=t.isHidden(this.painter.transform.zoom),i=t.getCrossfadeParameters(),r=!!i&&1!==i.t,a=t.hasTransition();return"custom"!==t.type&&!n&&(r||a)}))}_clearRasterFadeFromRenderCache(){let e=!1;for(const t in this._style._sourceCaches)if(this._style._sourceCaches[t]._source instanceof be){e=!0;break}if(e)for(let t=0;t<this._style.order.length;++t){const e=this._style._layers[this._style.order[t]],n=e.isHidden(this.painter.transform.zoom),i=this._style._getLayerSourceCache(e);if("raster"!==e.type||n||!i)continue;const r=e.paint.get("raster-fade-duration");for(const t of this.proxyCoords){const e=this.proxyToSource[t.key][i.id];if(e)for(const t of e){const e=cn(i.getTile(t),i.findLoadedParent(t,0),i,this.painter.transform,r);(1!==e.opacity||0!==e.mix)&&this._clearRenderCacheForTile(i.id,t)}}}}_setupDrapedRenderBatches(){const e=this._style.order,t=e.length;if(0===t)return;const n=[];let i,r=0,a=this._style._layers[e[r]];for(;!this._style.isLayerDraped(a)&&a.isHidden(this.painter.transform.zoom)&&++r<t;)a=this._style._layers[e[r]];for(;r<t;++r){const t=this._style._layers[e[r]];t.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(t)?void 0===i&&(i=r):void 0!==i&&(n.push({start:i,end:r-1}),i=void 0))}void 0!==i&&n.push({start:i,end:r-1}),this._drapedRenderBatches=n}_setupRenderCache(e){const t=this.proxySourceCache;if(this._shouldDisableRenderCache()){if(t.renderCache.length>t.renderCachePool.length){const e=Object.values(t.proxyCachedFBO);t.proxyCachedFBO={};for(let n=0;n<e.length;++n){const i=Object.values(e[n]);t.renderCachePool.push(...i)}}return}this._clearRasterFadeFromRenderCache();const n=this.proxyCoords,i=this._tilesDirty;for(let r=n.length-1;r>=0;r--){const a=n[r];if(t.getTileByID(a.key),void 0!==t.proxyCachedFBO[a.key]){const n=e[a.key],r=this.proxyToSource[a.key];let o=0;for(const e in r){const t=r[e],a=n[e];if(!a||a.length!==t.length||t.some(((t,n)=>t!==a[n]||i[e]&&i[e].hasOwnProperty(t.key)))){o=-1;break}++o}for(const e in t.proxyCachedFBO[a.key])t.renderCache[t.proxyCachedFBO[a.key][e]].dirty=o<0||o!==Object.values(n).length}else for(let e=0;e<this._drapedRenderBatches.length;++e){const n=this._drapedRenderBatches[e];let i=t.renderCachePool.pop();void 0===i&&t.renderCache.length<50&&(i=t.renderCache.length,t.renderCache.push(this._createFBO())),void 0!==i&&(void 0===t.proxyCachedFBO[a.key]&&(t.proxyCachedFBO[a.key]={}),t.proxyCachedFBO[a.key][n.start]=i,t.renderCache[i].dirty=!0)}}this._tilesDirty={}}_setupStencil(e,t,n){if(!n||!this._sourceTilesOverlap[n.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const i=this.painter.context,r=i.gl;if(e.length<=1)return void(this._overlapStencilType=!1);let a;if(t.isTileClipped())a=e.length,this._overlapStencilMode.test={func:r.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(e[0].overscaledZ>e[e.length-1].overscaledZ))return void(this._overlapStencilType=!1);a=1,this._overlapStencilMode.test={func:r.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+a>255&&(i.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=a,this._overlapStencilMode.ref=this._stencilRef,t.isTileClipped()&&this._renderTileClippingMasks(e,this._overlapStencilMode.ref)}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):e.StencilMode.disabled}_renderTileClippingMasks(t,n){const i=this.painter,r=this.painter.context,a=r.gl;i._tileClippingMaskIDs={},r.setColorMode(e.ColorMode.disabled),r.setDepthMode(e.DepthMode.disabled);const o=i.useProgram("clippingMask");for(const s of t){const t=i._tileClippingMaskIDs[s.key]=--n;o.draw(r,a.TRIANGLES,e.DepthMode.disabled,new e.StencilMode({func:a.ALWAYS,mask:0},t,255,a.KEEP,a.KEEP,a.REPLACE),e.ColorMode.disabled,e.CullFaceMode.disabled,ln(s.projMatrix),"$clipping",i.tileExtentBuffer,i.quadTriangleIndexBuffer,i.tileExtentSegments)}}pointCoordinate(t){const n=this.painter.transform;if(t.x<0||t.x>n.width||t.y<0||t.y>n.height)return null;const i=[t.x,t.y,1,1];e.transformMat4(i,i,n.pixelMatrixInverse),e.scale$2(i,i,1/i[3]),i[0]/=n.worldSize,i[1]/=n.worldSize;const r=n._camera.position,a=e.mercatorZfromAltitude(1,n.center.lat),o=[r[0],r[1],r[2]/a,0],s=e.subtract([],i.slice(0,3),o);e.normalize(s,s);const l=this.raycast(o,s,this._exaggeration);return null!==l&&l?(e.scaleAndAdd(o,o,s,l),o[3]=o[2],o[2]*=a,o):null}drawDepth(){const t=this.painter,n=t.context,i=this.proxySourceCache,r=Math.ceil(t.width),a=Math.ceil(t.height);if(!this._depthFBO||this._depthFBO.width===r&&this._depthFBO.height===a||(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture),!this._depthFBO){const t=n.gl,i=n.createFramebuffer(r,a,!0);n.activeTexture.set(t.TEXTURE0);const o=new e.Texture(n,{width:r,height:a,data:null},t.RGBA);o.bind(t.NEAREST,t.CLAMP_TO_EDGE),i.colorAttachment.set(o.texture);const s=n.createRenderbuffer(n.gl.DEPTH_COMPONENT16,r,a);i.depthAttachment.set(s),this._depthFBO=i,this._depthTexture=o}n.bindFramebuffer.set(this._depthFBO.framebuffer),n.viewport.set([0,0,r,a]),function(t,n,i,r){const a=t.context,o=a.gl;a.clear({depth:1});const s=t.useProgram("terrainDepth"),l=new e.DepthMode(o.LESS,e.DepthMode.ReadWrite,t.depthRangeFor3D);for(const c of r){const t=i.getTile(c),r=nn(c.projMatrix,0);n.setupElevationDraw(t,s),s.draw(a,o.TRIANGLES,l,e.StencilMode.disabled,e.ColorMode.unblended,e.CullFaceMode.backCCW,r,"terrain_depth",n.gridBuffer,n.gridIndexBuffer,n.gridNoSkirtSegments)}}(t,this,i,this.proxyCoords)}_setupProxiedCoordsForOrtho(e,t,n){if(e.getSource()instanceof Te)return this._setupProxiedCoordsForImageSource(e,t,n);this._findCoveringTileCache[e.id]=this._findCoveringTileCache[e.id]||{};const i=this.proxiedCoords[e.id]=[],r=this.proxyCoords;for(let o=0;o<r.length;o++){const t=r[o],a=this._findTileCoveringTileID(t,e);if(a){const r=this._createProxiedId(t,a,n[t.key]&&n[t.key][e.id]);i.push(r),this.proxyToSource[t.key][e.id]=[r]}}let a=!1;for(let o=0;o<t.length;o++){const r=e.getTile(t[o]);if(!r||!r.hasData())continue;const s=this._findTileCoveringTileID(r.tileID,this.proxySourceCache);if(s&&s.tileID.canonical.z!==r.tileID.canonical.z){const t=this.proxyToSource[s.tileID.key][e.id],o=this._createProxiedId(s.tileID,r,n[s.tileID.key]&&n[s.tileID.key][e.id]);t?t.splice(t.length-1,0,o):this.proxyToSource[s.tileID.key][e.id]=[o],i.push(o),a=!0}}this._sourceTilesOverlap[e.id]=a}_setupProxiedCoordsForImageSource(t,n,i){if(!t.getSource().loaded())return;const r=this.proxiedCoords[t.id]=[],a=this.proxyCoords,o=t.getSource(),s=new e.pointGeometry(o.tileID.x,o.tileID.y)._div(1<<o.tileID.z),l=o.coordinates.map(e.MercatorCoordinate.fromLngLat).reduce(((e,t)=>(e.min.x=Math.min(e.min.x,t.x-s.x),e.min.y=Math.min(e.min.y,t.y-s.y),e.max.x=Math.max(e.max.x,t.x-s.x),e.max.y=Math.max(e.max.y,t.y-s.y),e)),{min:new e.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new e.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),c=(t,n)=>{const i=t.wrap+t.canonical.x/(1<<t.canonical.z),r=t.canonical.y/(1<<t.canonical.z),a=e.EXTENT/(1<<t.canonical.z),o=n.wrap+n.canonical.x/(1<<n.canonical.z),s=n.canonical.y/(1<<n.canonical.z);return i+a<o+l.min.x||i>o+l.max.x||r+a<s+l.min.y||r>s+l.max.y};for(let e=0;e<a.length;e++){const o=a[e];for(let e=0;e<n.length;e++){const a=t.getTile(n[e]);if(!a||!a.hasData())continue;if(c(o,a.tileID))continue;const s=this._createProxiedId(o,a,i[o.key]&&i[o.key][t.id]),l=this.proxyToSource[o.key][t.id];l?l.push(s):this.proxyToSource[o.key][t.id]=[s],r.push(s)}}}_createProxiedId(t,n,i){let r=this.orthoMatrix;if(i){const e=i.find((e=>e.key===n.tileID.key));if(e)return e}if(n.tileID.key!==t.key){const i=t.canonical.z-n.tileID.canonical.z;let a,o,s;r=e.create$1();const l=n.tileID.wrap-t.wrap<<t.overscaledZ;i>0?(a=e.EXTENT>>i,o=a*((n.tileID.canonical.x<<i)-t.canonical.x+l),s=a*((n.tileID.canonical.y<<i)-t.canonical.y)):(a=e.EXTENT<<-i,o=e.EXTENT*(n.tileID.canonical.x-(t.canonical.x+l<<-i)),s=e.EXTENT*(n.tileID.canonical.y-(t.canonical.y<<-i))),e.ortho(r,0,a,0,a,0,1),e.translate(r,r,[o,s,0])}return new hn(n.tileID,t.key,r)}_findTileCoveringTileID(t,n){let i=n.getTile(t);if(i&&i.hasData())return i;const r=this._findCoveringTileCache[n.id],a=r[t.key];if(i=a?n.getTileByID(a):null,i&&i.hasData()||null===a)return i;let o=i?i.tileID:t,s=o.overscaledZ;const l=n.getSource().minzoom,c=[];if(!a){const r=n.getSource().maxzoom;if(t.canonical.z>=r){const i=t.canonical.z-r;n.getSource().reparseOverscaled?(s=Math.max(t.canonical.z+2,n.transform.tileZoom),o=new e.OverscaledTileID(s,t.wrap,r,t.canonical.x>>i,t.canonical.y>>i)):0!==i&&(s=r,o=new e.OverscaledTileID(s,t.wrap,r,t.canonical.x>>i,t.canonical.y>>i))}o.key!==t.key&&(c.push(o.key),i=n.getTile(o))}const u=e=>{c.forEach((t=>{r[t]=e})),c.length=0};for(s-=1;s>=l&&(!i||!i.hasData());s--){i&&u(i.tileID.key);const e=o.calculateScaledKey(s);if(i=n.getTileByID(e),i&&i.hasData())break;const t=r[e];if(null===t)break;void 0===t?c.push(e):i=n.getTileByID(t)}return u(i?i.tileID.key:null),i&&i.hasData()?i:null}findDEMTileFor(e){return this.enabled?this._findTileCoveringTileID(e,this.sourceCache):null}prepareDrawTile(e){this.renderedToTile||(this.renderedToTile=!0)}_clearRenderCacheForTile(e,t){let n=this._tilesDirty[e];n||(n=this._tilesDirty[e]={}),n[t.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const t=function(t){let n,i,r;const a=new e.StructArrayLayout2ui4,o=131;for(i=1;i<129;i++){for(n=1;n<129;n++)r=i*o+n,a.emplaceBack(r,r+1),a.emplaceBack(r,r+o),a.emplaceBack(r+1,r+o),128===i&&a.emplaceBack(r+o,r+o+1);a.emplaceBack(r+1,r+1+o)}return a}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(t),this.wireframeSegments=e.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,t.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function pn(e){const t=[];for(let n=0;n<e.length;n++){if(null===e[n])continue;const i=e[n].split(" ");t.push(i.pop())}return t}class fn{static cacheKey(e,t,n){let i=`${e}${n?n.cacheKey:""}`;for(const r of t)i+=`/${r}`;return i}constructor(t,n,i,r,a,o){const s=t.gl;this.program=s.createProgram();const l=pn(i.staticAttributes),c=r?r.getBinderAttributes():[],u=l.concat(c),h=i.staticUniforms?pn(i.staticUniforms):[],d=r?r.getBinderUniforms():[],p=h.concat(d),f=[];for(const e of p)f.indexOf(e)<0&&f.push(e);let m=r?r.defines():[];m=m.concat(o.map((e=>`#define ${e}`)));const g=m.concat(qt.fragmentSource,Zt,Wt.fragmentSource,i.fragmentSource).join("\n"),v=m.concat(qt.vertexSource,Zt,Wt.vertexSource,Ht.vertexSource,i.vertexSource).join("\n"),y=s.createShader(s.FRAGMENT_SHADER);if(s.isContextLost())return void(this.failedToCreate=!0);s.shaderSource(y,g),s.compileShader(y),s.attachShader(this.program,y);const _=s.createShader(s.VERTEX_SHADER);if(s.isContextLost())return void(this.failedToCreate=!0);s.shaderSource(_,v),s.compileShader(_),s.attachShader(this.program,_),this.attributes={};const x={};this.numAttributes=u.length;for(let e=0;e<this.numAttributes;e++)u[e]&&(s.bindAttribLocation(this.program,e,u[e]),this.attributes[u[e]]=e);s.linkProgram(this.program),s.deleteShader(_),s.deleteShader(y);for(let e=0;e<f.length;e++){const t=f[e];if(t&&!x[t]){const e=s.getUniformLocation(this.program,t);e&&(x[t]=e)}}this.fixedUniforms=a(t,x),this.binderUniforms=r?r.getUniforms(t,x):[],-1!==o.indexOf("TERRAIN")&&(this.terrainUniforms=((t,n)=>({u_dem:new e.Uniform1i(t,n.u_dem),u_dem_prev:new e.Uniform1i(t,n.u_dem_prev),u_dem_unpack:new e.Uniform4f(t,n.u_dem_unpack),u_dem_tl:new e.Uniform2f(t,n.u_dem_tl),u_dem_scale:new e.Uniform1f(t,n.u_dem_scale),u_dem_tl_prev:new e.Uniform2f(t,n.u_dem_tl_prev),u_dem_scale_prev:new e.Uniform1f(t,n.u_dem_scale_prev),u_dem_size:new e.Uniform1f(t,n.u_dem_size),u_dem_lerp:new e.Uniform1f(t,n.u_dem_lerp),u_exaggeration:new e.Uniform1f(t,n.u_exaggeration),u_depth:new e.Uniform1i(t,n.u_depth),u_depth_size_inv:new e.Uniform2f(t,n.u_depth_size_inv),u_meter_to_dem:new e.Uniform1f(t,n.u_meter_to_dem),u_label_plane_matrix_inv:new e.UniformMatrix4f(t,n.u_label_plane_matrix_inv)}))(t,x)),-1!==o.indexOf("FOG")&&(this.fogUniforms=((t,n)=>({u_fog_matrix:new e.UniformMatrix4f(t,n.u_fog_matrix),u_fog_range:new e.Uniform2f(t,n.u_fog_range),u_fog_color:new e.Uniform4f(t,n.u_fog_color),u_fog_horizon_blend:new e.Uniform1f(t,n.u_fog_horizon_blend),u_fog_temporal_offset:new e.Uniform1f(t,n.u_fog_temporal_offset)}))(t,x))}setTerrainUniformValues(e,t){if(!this.terrainUniforms)return;const n=this.terrainUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)n[e].set(t[e])}}setFogUniformValues(e,t){if(!this.fogUniforms)return;const n=this.fogUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)n[e].location&&n[e].set(t[e])}}draw(e,t,n,i,r,a,o,s,l,c,u,h,d,p,f,m){const g=e.gl;if(this.failedToCreate)return;e.program.set(this.program),e.setDepthMode(n),e.setStencilMode(i),e.setColorMode(r),e.setCullFace(a);for(const y in this.fixedUniforms)this.fixedUniforms[y].set(o[y]);p&&p.setUniforms(e,this.binderUniforms,h,{zoom:d});const v={[g.LINES]:2,[g.TRIANGLES]:3,[g.LINE_STRIP]:1}[t];for(const y of u.get()){const n=y.vaos||(y.vaos={});(n[s]||(n[s]=new Yt)).bind(e,this,l,p?p.getPaintVertexBuffers():[],c,y.vertexOffset,f,m),g.drawElements(t,y.primitiveLength*v,g.UNSIGNED_SHORT,y.primitiveOffset*v*2)}}}function mn(e,t,n){const i=1/C(n,1,t.transform.tileZoom),r=Math.pow(2,n.tileID.overscaledZ),a=n.tileSize*Math.pow(2,t.transform.tileZoom)/r,o=a*(n.tileID.canonical.x+n.tileID.wrap*r),s=a*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_scale:[i,e.fromScale,e.toScale],u_fade:e.t,u_pixel_coord_upper:[o>>16,s>>16],u_pixel_coord_lower:[65535&o,65535&s]}}const gn=(t,n,i,r)=>{const a=n.style.light,o=a.properties.get("position"),s=[o.x,o.y,o.z],l=e.create$2();"viewport"===a.properties.get("anchor")&&(e.fromRotation(l,-n.transform.angle),e.transformMat3(s,s,l));const c=a.properties.get("color");return{u_matrix:t,u_lightpos:s,u_lightintensity:a.properties.get("intensity"),u_lightcolor:[c.r,c.g,c.b],u_vertical_gradient:+i,u_opacity:r}},vn=(t,n,i,r,a,o,s)=>e.extend(gn(t,n,i,r),mn(o,n,s),{u_height_factor:-Math.pow(2,a.overscaledZ)/s.tileSize/8}),yn=e=>({u_matrix:e}),_n=(t,n,i,r)=>e.extend(yn(t),mn(i,n,r)),xn=(e,t)=>({u_matrix:e,u_world:t}),bn=(t,n,i,r,a)=>e.extend(_n(t,n,i,r),{u_world:a}),wn=(t,n,i,r)=>{const a=t.transform;let o;if("map"===r.paint.get("circle-pitch-alignment")){const e=C(i,1,a.zoom);o=[e,e]}else o=a.pixelsToGLUnits;return{u_camera_to_center_distance:a.cameraToCenterDistance,u_matrix:t.translatePosMatrix(n.projMatrix,i,r.paint.get("circle-translate"),r.paint.get("circle-translate-anchor")),u_device_pixel_ratio:e.exported.devicePixelRatio,u_extrude_scale:o}},Sn=e=>{const t=[];return"map"===e.paint.get("circle-pitch-alignment")&&t.push("PITCH_WITH_MAP"),"map"===e.paint.get("circle-pitch-scale")&&t.push("SCALE_WITH_MAP"),t},Tn=(t,n,i)=>{const r=e.EXTENT/i.tileSize;return{u_matrix:t,u_camera_to_center_distance:n.cameraToCenterDistance,u_extrude_scale:[n.pixelsToGLUnits[0]/r,n.pixelsToGLUnits[1]/r]}},En=(e,t,n=1)=>({u_matrix:e,u_color:t,u_overlay:0,u_overlay_scale:n}),Mn=(e,t,n,i)=>({u_matrix:e,u_extrude_scale:C(t,1,n),u_intensity:i}),kn=(t,n,i,r)=>{const a=t.transform;return{u_matrix:In(t,n,i,r),u_ratio:1/C(n,1,a.zoom),u_device_pixel_ratio:e.exported.devicePixelRatio,u_units_to_pixels:[1/a.pixelsToGLUnits[0],1/a.pixelsToGLUnits[1]]}},An=(t,n,i,r,a)=>e.extend(kn(t,n,i,r),{u_image:0,u_image_height:a}),Cn=(t,n,i,r,a)=>{const o=t.transform,s=Ln(n,o);return{u_matrix:In(t,n,i,a),u_texsize:n.imageAtlasTexture.size,u_ratio:1/C(n,1,o.zoom),u_device_pixel_ratio:e.exported.devicePixelRatio,u_image:0,u_scale:[s,r.fromScale,r.toScale],u_fade:r.t,u_units_to_pixels:[1/o.pixelsToGLUnits[0],1/o.pixelsToGLUnits[1]]}},Pn=(t,n,i,r,a)=>{const o=Ln(n,t.transform);return e.extend(kn(t,n,i,a),{u_texsize:n.lineAtlasTexture.size,u_scale:[o,r.fromScale,r.toScale],u_image:0,u_mix:r.t})};function Ln(e,t){return 1/C(e,1,t.tileZoom)}function In(e,t,n,i){return e.translatePosMatrix(i||t.tileID.projMatrix,t,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const Rn=(e,t,n,i,r)=>{return{u_matrix:e,u_tl_parent:t,u_scale_parent:n,u_buffer_scale:1,u_fade_t:i.mix,u_opacity:i.opacity*r.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:r.paint.get("raster-brightness-min"),u_brightness_high:r.paint.get("raster-brightness-max"),u_saturation_factor:(o=r.paint.get("raster-saturation"),o>0?1-1/(1.001-o):-o),u_contrast_factor:(a=r.paint.get("raster-contrast"),a>0?1/(1-a):1+a),u_spin_weights:zn(r.paint.get("raster-hue-rotate"))};var a,o};function zn(e){e*=Math.PI/180;const t=Math.sin(e),n=Math.cos(e);return[(2*n+1)/3,(-Math.sqrt(3)*t-n+1)/3,(Math.sqrt(3)*t-n+1)/3]}const Dn=(e,t,n,i,r,a,o,s,l,c)=>{const u=r.transform;return{u_is_size_zoom_constant:+("constant"===e||"source"===e),u_is_size_feature_constant:+("constant"===e||"camera"===e),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:u.cameraToCenterDistance,u_pitch:u.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:u.width/u.height,u_fade_change:r.options.fadeDuration?r.symbolFadeChange:1,u_matrix:a,u_label_plane_matrix:o,u_coord_matrix:s,u_is_text:+l,u_pitch_with_map:+i,u_texsize:c,u_texture:0}},On=(t,n,i,r,a,o,s,l,c,u,h)=>{const{cameraToCenterDistance:d,_pitch:p}=a.transform;return e.extend(Dn(t,n,i,r,a,o,s,l,c,u),{u_gamma_scale:r?d*Math.cos(a.terrain?0:p):1,u_device_pixel_ratio:e.exported.devicePixelRatio,u_is_halo:+h})},Bn=(t,n,i,r,a,o,s,l,c,u)=>e.extend(On(t,n,i,r,a,o,s,l,!0,c,!0),{u_texsize_icon:u,u_texture_icon:1}),Fn=(e,t,n)=>({u_matrix:e,u_opacity:t,u_color:n}),Nn=(t,n,i,r,a,o)=>e.extend(function(e,t,n,i){const r=n.imageManager.getPattern(e.from.toString()),a=n.imageManager.getPattern(e.to.toString()),{width:o,height:s}=n.imageManager.getPixelSize(),l=Math.pow(2,i.tileID.overscaledZ),c=i.tileSize*Math.pow(2,n.transform.tileZoom)/l,u=c*(i.tileID.canonical.x+i.tileID.wrap*l),h=c*i.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:r.tl,u_pattern_br_a:r.br,u_pattern_tl_b:a.tl,u_pattern_br_b:a.br,u_texsize:[o,s],u_mix:t.t,u_pattern_size_a:r.displaySize,u_pattern_size_b:a.displaySize,u_scale_a:t.fromScale,u_scale_b:t.toScale,u_tile_units_to_pixels:1/C(i,1,n.transform.tileZoom),u_pixel_coord_upper:[u>>16,h>>16],u_pixel_coord_lower:[65535&u,65535&h]}}(r,o,i,a),{u_matrix:t,u_opacity:n}),Un={fillExtrusion:(t,n)=>({u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_lightpos:new e.Uniform3f(t,n.u_lightpos),u_lightintensity:new e.Uniform1f(t,n.u_lightintensity),u_lightcolor:new e.Uniform3f(t,n.u_lightcolor),u_vertical_gradient:new e.Uniform1f(t,n.u_vertical_gradient),u_opacity:new e.Uniform1f(t,n.u_opacity)}),fillExtrusionPattern:(t,n)=>({u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_lightpos:new e.Uniform3f(t,n.u_lightpos),u_lightintensity:new e.Uniform1f(t,n.u_lightintensity),u_lightcolor:new e.Uniform3f(t,n.u_lightcolor),u_vertical_gradient:new e.Uniform1f(t,n.u_vertical_gradient),u_height_factor:new e.Uniform1f(t,n.u_height_factor),u_image:new e.Uniform1i(t,n.u_image),u_texsize:new e.Uniform2f(t,n.u_texsize),u_pixel_coord_upper:new e.Uniform2f(t,n.u_pixel_coord_upper),u_pixel_coord_lower:new e.Uniform2f(t,n.u_pixel_coord_lower),u_scale:new e.Uniform3f(t,n.u_scale),u_fade:new e.Uniform1f(t,n.u_fade),u_opacity:new e.Uniform1f(t,n.u_opacity)}),fill:(t,n)=>({u_matrix:new e.UniformMatrix4f(t,n.u_matrix)}),fillPattern:(t,n)=>({u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_image:new e.Uniform1i(t,n.u_image),u_texsize:new e.Uniform2f(t,n.u_texsize),u_pixel_coord_upper:new e.Uniform2f(t,n.u_pixel_coord_upper),u_pixel_coord_lower:new e.Uniform2f(t,n.u_pixel_coord_lower),u_scale:new e.Uniform3f(t,n.u_scale),u_fade:new e.Uniform1f(t,n.u_fade)}),fillOutline:(t,n)=>({u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_world:new e.Uniform2f(t,n.u_world)}),fillOutlinePattern:(t,n)=>({u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_world:new e.Uniform2f(t,n.u_world),u_image:new e.Uniform1i(t,n.u_image),u_texsize:new e.Uniform2f(t,n.u_texsize),u_pixel_coord_upper:new e.Uniform2f(t,n.u_pixel_coord_upper),u_pixel_coord_lower:new e.Uniform2f(t,n.u_pixel_coord_lower),u_scale:new e.Uniform3f(t,n.u_scale),u_fade:new e.Uniform1f(t,n.u_fade)}),circle:(t,n)=>({u_camera_to_center_distance:new e.Uniform1f(t,n.u_camera_to_center_distance),u_extrude_scale:new e.Uniform2f(t,n.u_extrude_scale),u_device_pixel_ratio:new e.Uniform1f(t,n.u_device_pixel_ratio),u_matrix:new e.UniformMatrix4f(t,n.u_matrix)}),collisionBox:(t,n)=>({u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_camera_to_center_distance:new e.Uniform1f(t,n.u_camera_to_center_distance),u_extrude_scale:new e.Uniform2f(t,n.u_extrude_scale)}),collisionCircle:(t,n)=>({u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_inv_matrix:new e.UniformMatrix4f(t,n.u_inv_matrix),u_camera_to_center_distance:new e.Uniform1f(t,n.u_camera_to_center_distance),u_viewport_size:new e.Uniform2f(t,n.u_viewport_size)}),debug:(t,n)=>({u_color:new e.UniformColor(t,n.u_color),u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_overlay:new e.Uniform1i(t,n.u_overlay),u_overlay_scale:new e.Uniform1f(t,n.u_overlay_scale)}),clippingMask:(t,n)=>({u_matrix:new e.UniformMatrix4f(t,n.u_matrix)}),heatmap:(t,n)=>({u_extrude_scale:new e.Uniform1f(t,n.u_extrude_scale),u_intensity:new e.Uniform1f(t,n.u_intensity),u_matrix:new e.UniformMatrix4f(t,n.u_matrix)}),heatmapTexture:(t,n)=>({u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_world:new e.Uniform2f(t,n.u_world),u_image:new e.Uniform1i(t,n.u_image),u_color_ramp:new e.Uniform1i(t,n.u_color_ramp),u_opacity:new e.Uniform1f(t,n.u_opacity)}),hillshade:(t,n)=>({u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_image:new e.Uniform1i(t,n.u_image),u_latrange:new e.Uniform2f(t,n.u_latrange),u_light:new e.Uniform2f(t,n.u_light),u_shadow:new e.UniformColor(t,n.u_shadow),u_highlight:new e.UniformColor(t,n.u_highlight),u_accent:new e.UniformColor(t,n.u_accent)}),hillshadePrepare:(t,n)=>({u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_image:new e.Uniform1i(t,n.u_image),u_dimension:new e.Uniform2f(t,n.u_dimension),u_zoom:new e.Uniform1f(t,n.u_zoom),u_unpack:new e.Uniform4f(t,n.u_unpack)}),line:(t,n)=>({u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_ratio:new e.Uniform1f(t,n.u_ratio),u_device_pixel_ratio:new e.Uniform1f(t,n.u_device_pixel_ratio),u_units_to_pixels:new e.Uniform2f(t,n.u_units_to_pixels)}),lineGradient:(t,n)=>({u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_ratio:new e.Uniform1f(t,n.u_ratio),u_device_pixel_ratio:new e.Uniform1f(t,n.u_device_pixel_ratio),u_units_to_pixels:new e.Uniform2f(t,n.u_units_to_pixels),u_image:new e.Uniform1i(t,n.u_image),u_image_height:new e.Uniform1f(t,n.u_image_height)}),linePattern:(t,n)=>({u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_texsize:new e.Uniform2f(t,n.u_texsize),u_ratio:new e.Uniform1f(t,n.u_ratio),u_device_pixel_ratio:new e.Uniform1f(t,n.u_device_pixel_ratio),u_image:new e.Uniform1i(t,n.u_image),u_units_to_pixels:new e.Uniform2f(t,n.u_units_to_pixels),u_scale:new e.Uniform3f(t,n.u_scale),u_fade:new e.Uniform1f(t,n.u_fade)}),lineSDF:(t,n)=>({u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_texsize:new e.Uniform2f(t,n.u_texsize),u_ratio:new e.Uniform1f(t,n.u_ratio),u_device_pixel_ratio:new e.Uniform1f(t,n.u_device_pixel_ratio),u_units_to_pixels:new e.Uniform2f(t,n.u_units_to_pixels),u_image:new e.Uniform1i(t,n.u_image),u_scale:new e.Uniform3f(t,n.u_scale),u_mix:new e.Uniform1f(t,n.u_mix)}),raster:(t,n)=>({u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_tl_parent:new e.Uniform2f(t,n.u_tl_parent),u_scale_parent:new e.Uniform1f(t,n.u_scale_parent),u_buffer_scale:new e.Uniform1f(t,n.u_buffer_scale),u_fade_t:new e.Uniform1f(t,n.u_fade_t),u_opacity:new e.Uniform1f(t,n.u_opacity),u_image0:new e.Uniform1i(t,n.u_image0),u_image1:new e.Uniform1i(t,n.u_image1),u_brightness_low:new e.Uniform1f(t,n.u_brightness_low),u_brightness_high:new e.Uniform1f(t,n.u_brightness_high),u_saturation_factor:new e.Uniform1f(t,n.u_saturation_factor),u_contrast_factor:new e.Uniform1f(t,n.u_contrast_factor),u_spin_weights:new e.Uniform3f(t,n.u_spin_weights)}),symbolIcon:(t,n)=>({u_is_size_zoom_constant:new e.Uniform1i(t,n.u_is_size_zoom_constant),u_is_size_feature_constant:new e.Uniform1i(t,n.u_is_size_feature_constant),u_size_t:new e.Uniform1f(t,n.u_size_t),u_size:new e.Uniform1f(t,n.u_size),u_camera_to_center_distance:new e.Uniform1f(t,n.u_camera_to_center_distance),u_pitch:new e.Uniform1f(t,n.u_pitch),u_rotate_symbol:new e.Uniform1i(t,n.u_rotate_symbol),u_aspect_ratio:new e.Uniform1f(t,n.u_aspect_ratio),u_fade_change:new e.Uniform1f(t,n.u_fade_change),u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_label_plane_matrix:new e.UniformMatrix4f(t,n.u_label_plane_matrix),u_coord_matrix:new e.UniformMatrix4f(t,n.u_coord_matrix),u_is_text:new e.Uniform1i(t,n.u_is_text),u_pitch_with_map:new e.Uniform1i(t,n.u_pitch_with_map),u_texsize:new e.Uniform2f(t,n.u_texsize),u_texture:new e.Uniform1i(t,n.u_texture)}),symbolSDF:(t,n)=>({u_is_size_zoom_constant:new e.Uniform1i(t,n.u_is_size_zoom_constant),u_is_size_feature_constant:new e.Uniform1i(t,n.u_is_size_feature_constant),u_size_t:new e.Uniform1f(t,n.u_size_t),u_size:new e.Uniform1f(t,n.u_size),u_camera_to_center_distance:new e.Uniform1f(t,n.u_camera_to_center_distance),u_pitch:new e.Uniform1f(t,n.u_pitch),u_rotate_symbol:new e.Uniform1i(t,n.u_rotate_symbol),u_aspect_ratio:new e.Uniform1f(t,n.u_aspect_ratio),u_fade_change:new e.Uniform1f(t,n.u_fade_change),u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_label_plane_matrix:new e.UniformMatrix4f(t,n.u_label_plane_matrix),u_coord_matrix:new e.UniformMatrix4f(t,n.u_coord_matrix),u_is_text:new e.Uniform1i(t,n.u_is_text),u_pitch_with_map:new e.Uniform1i(t,n.u_pitch_with_map),u_texsize:new e.Uniform2f(t,n.u_texsize),u_texture:new e.Uniform1i(t,n.u_texture),u_gamma_scale:new e.Uniform1f(t,n.u_gamma_scale),u_device_pixel_ratio:new e.Uniform1f(t,n.u_device_pixel_ratio),u_is_halo:new e.Uniform1i(t,n.u_is_halo)}),symbolTextAndIcon:(t,n)=>({u_is_size_zoom_constant:new e.Uniform1i(t,n.u_is_size_zoom_constant),u_is_size_feature_constant:new e.Uniform1i(t,n.u_is_size_feature_constant),u_size_t:new e.Uniform1f(t,n.u_size_t),u_size:new e.Uniform1f(t,n.u_size),u_camera_to_center_distance:new e.Uniform1f(t,n.u_camera_to_center_distance),u_pitch:new e.Uniform1f(t,n.u_pitch),u_rotate_symbol:new e.Uniform1i(t,n.u_rotate_symbol),u_aspect_ratio:new e.Uniform1f(t,n.u_aspect_ratio),u_fade_change:new e.Uniform1f(t,n.u_fade_change),u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_label_plane_matrix:new e.UniformMatrix4f(t,n.u_label_plane_matrix),u_coord_matrix:new e.UniformMatrix4f(t,n.u_coord_matrix),u_is_text:new e.Uniform1i(t,n.u_is_text),u_pitch_with_map:new e.Uniform1i(t,n.u_pitch_with_map),u_texsize:new e.Uniform2f(t,n.u_texsize),u_texsize_icon:new e.Uniform2f(t,n.u_texsize_icon),u_texture:new e.Uniform1i(t,n.u_texture),u_texture_icon:new e.Uniform1i(t,n.u_texture_icon),u_gamma_scale:new e.Uniform1f(t,n.u_gamma_scale),u_device_pixel_ratio:new e.Uniform1f(t,n.u_device_pixel_ratio),u_is_halo:new e.Uniform1i(t,n.u_is_halo)}),background:(t,n)=>({u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_opacity:new e.Uniform1f(t,n.u_opacity),u_color:new e.UniformColor(t,n.u_color)}),backgroundPattern:(t,n)=>({u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_opacity:new e.Uniform1f(t,n.u_opacity),u_image:new e.Uniform1i(t,n.u_image),u_pattern_tl_a:new e.Uniform2f(t,n.u_pattern_tl_a),u_pattern_br_a:new e.Uniform2f(t,n.u_pattern_br_a),u_pattern_tl_b:new e.Uniform2f(t,n.u_pattern_tl_b),u_pattern_br_b:new e.Uniform2f(t,n.u_pattern_br_b),u_texsize:new e.Uniform2f(t,n.u_texsize),u_mix:new e.Uniform1f(t,n.u_mix),u_pattern_size_a:new e.Uniform2f(t,n.u_pattern_size_a),u_pattern_size_b:new e.Uniform2f(t,n.u_pattern_size_b),u_scale_a:new e.Uniform1f(t,n.u_scale_a),u_scale_b:new e.Uniform1f(t,n.u_scale_b),u_pixel_coord_upper:new e.Uniform2f(t,n.u_pixel_coord_upper),u_pixel_coord_lower:new e.Uniform2f(t,n.u_pixel_coord_lower),u_tile_units_to_pixels:new e.Uniform1f(t,n.u_tile_units_to_pixels)}),terrainRaster:tn,terrainDepth:tn,skybox:(t,n)=>({u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_sun_direction:new e.Uniform3f(t,n.u_sun_direction),u_cubemap:new e.Uniform1i(t,n.u_cubemap),u_opacity:new e.Uniform1f(t,n.u_opacity),u_temporal_offset:new e.Uniform1f(t,n.u_temporal_offset)}),skyboxGradient:(t,n)=>({u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_color_ramp:new e.Uniform1i(t,n.u_color_ramp),u_center_direction:new e.Uniform3f(t,n.u_center_direction),u_radius:new e.Uniform1f(t,n.u_radius),u_opacity:new e.Uniform1f(t,n.u_opacity),u_temporal_offset:new e.Uniform1f(t,n.u_temporal_offset)}),skyboxCapture:(t,n)=>({u_matrix_3f:new e.UniformMatrix3f(t,n.u_matrix_3f),u_sun_direction:new e.Uniform3f(t,n.u_sun_direction),u_sun_intensity:new e.Uniform1f(t,n.u_sun_intensity),u_color_tint_r:new e.Uniform4f(t,n.u_color_tint_r),u_color_tint_m:new e.Uniform4f(t,n.u_color_tint_m),u_luminance:new e.Uniform1f(t,n.u_luminance)})};let Vn;function jn(t,n,i,r,a,o,s){const l=t.context,c=l.gl,u=t.useProgram("collisionBox"),h=[];let d=0,p=0;for(let x=0;x<r.length;x++){const f=r[x],m=n.getTile(f),g=m.getBucket(i);if(!g)continue;let v=f.projMatrix;0===a[0]&&0===a[1]||(v=t.translatePosMatrix(f.projMatrix,m,a,o));const y=s?g.textCollisionBox:g.iconCollisionBox,_=g.collisionCircleArray;if(_.length>0){const n=e.create$1(),i=v;e.mul$1(n,g.placementInvProjMatrix,t.transform.glCoordMatrix),e.mul$1(n,n,g.placementViewportMatrix),h.push({circleArray:_,circleOffset:p,transform:i,invTransform:n}),d+=_.length/4,p=d}y&&(t.terrain&&t.terrain.setupElevationDraw(m,u),u.draw(l,c.LINES,e.DepthMode.disabled,e.StencilMode.disabled,t.colorModeForRenderPass(),e.CullFaceMode.disabled,Tn(v,t.transform,m),i.id,y.layoutVertexBuffer,y.indexBuffer,y.segments,null,t.transform.zoom,null,y.collisionVertexBuffer,y.collisionVertexBufferExt))}if(!s||!h.length)return;const f=t.useProgram("collisionCircle"),m=new e.StructArrayLayout2f1f2i16;m.resize(4*d),m._trim();let g=0;for(const e of h)for(let t=0;t<e.circleArray.length/4;t++){const n=4*t,i=e.circleArray[n+0],r=e.circleArray[n+1],a=e.circleArray[n+2],o=e.circleArray[n+3];m.emplace(g++,i,r,a,o,0),m.emplace(g++,i,r,a,o,1),m.emplace(g++,i,r,a,o,2),m.emplace(g++,i,r,a,o,3)}(!Vn||Vn.length<2*d)&&(Vn=function(t){const n=2*t,i=new e.StructArrayLayout3ui6;i.resize(n),i._trim();for(let e=0;e<n;e++){const t=6*e;i.uint16[t+0]=4*e+0,i.uint16[t+1]=4*e+1,i.uint16[t+2]=4*e+2,i.uint16[t+3]=4*e+2,i.uint16[t+4]=4*e+3,i.uint16[t+5]=4*e+0}return i}(d));const v=l.createIndexBuffer(Vn,!0),y=l.createVertexBuffer(m,e.collisionCircleLayout.members,!0);for(const x of h){const n={u_matrix:x.transform,u_inv_matrix:x.invTransform,u_camera_to_center_distance:(_=t.transform).cameraToCenterDistance,u_viewport_size:[_.width,_.height]};f.draw(l,c.TRIANGLES,e.DepthMode.disabled,e.StencilMode.disabled,t.colorModeForRenderPass(),e.CullFaceMode.disabled,n,i.id,y,v,e.SegmentVector.simpleSegment(0,2*x.circleOffset,x.circleArray.length,x.circleArray.length/2),null,t.transform.zoom,null,null,null)}var _;y.destroy(),v.destroy()}const Gn=e.identity(new Float32Array(16));function Hn(t,n,i,r,a,o){const{horizontalAlign:s,verticalAlign:l}=e.getAnchorAlignment(t),c=-(s-.5)*n,u=-(l-.5)*i,h=e.evaluateVariableOffset(t,r);return new e.pointGeometry((c/a+h[0])*o,(u/a+h[1])*o)}function Wn(t,n,i,r,a,o,s,l,c,u,h,d){const p=t.text.placedSymbolArray,f=t.text.dynamicLayoutVertexArray,m=t.icon.dynamicLayoutVertexArray,g={};f.clear();for(let v=0;v<p.length;v++){const m=p.get(v),y=t.allowVerticalPlacement&&!m.placedOrientation,_=m.hidden||!m.crossTileID||y?null:r[m.crossTileID];if(_){const r=new e.pointGeometry(m.anchorX,m.anchorY),p=d(r),v=Ye(r,i?l:s,p),y=Je(o.cameraToCenterDistance,v.signedDistanceFromCamera);let x=a.evaluateSizeForFeature(t.textSizeData,u,m)*y/e.ONE_EM;i&&(x*=t.tilePixelRatio/c);const{width:b,height:w,anchor:S,textOffset:T,textBoxScale:E}=_,M=Hn(S,b,w,T,E,x),k=i?Ye(r.add(M),s,p).point:v.point.add(n?M.rotate(-o.angle):M),A=t.allowVerticalPlacement&&m.placedOrientation===e.WritingMode.vertical?Math.PI/2:0;for(let t=0;t<m.numGlyphs;t++)e.addDynamicAttributes(f,k,A);h&&m.associatedIconIndex>=0&&(g[m.associatedIconIndex]={shiftedAnchor:k,angle:A})}else ot(m.numGlyphs,f)}if(h){m.clear();const n=t.icon.placedSymbolArray;for(let t=0;t<n.length;t++){const i=n.get(t);if(i.hidden)ot(i.numGlyphs,m);else{const n=g[t];if(n)for(let t=0;t<i.numGlyphs;t++)e.addDynamicAttributes(m,n.shiftedAnchor,n.angle);else ot(i.numGlyphs,m)}}t.icon.dynamicLayoutVertexBuffer.updateData(m)}t.text.dynamicLayoutVertexBuffer.updateData(f)}function qn(e,t,n){return n.iconsInText&&t?"symbolTextAndIcon":e?"symbolSDF":"symbolIcon"}function Zn(t,n,i,r,a,o,s,l,c,u,h,d){const p=t.context,f=p.gl,m=t.transform,g="map"===l,v="map"===c,y=g&&"point"!==i.layout.get("symbol-placement"),_=g&&!v&&!y,x=void 0!==i.layout.get("symbol-sort-key").constantOr(1);let b=!1;const w=t.depthModeForSublayer(0,e.DepthMode.ReadOnly),S=i.layout.get("text-variable-anchor"),T=[],E=t.terrain&&v?["PITCH_WITH_MAP_TERRAIN"]:null;for(const M of r){const r=n.getTile(M),l=r.getBucket(i);if(!l)continue;const c=a?l.text:l.icon;if(!c||!c.segments.get().length)continue;const h=c.programConfigurations.get(i.id),d=a||l.sdfIcons,p=a?l.textSizeData:l.iconSizeData,w=v||0!==m.pitch,k=t.useProgram(qn(d,a,l),h,E),A=e.evaluateSizeForZoom(p,m.zoom);let P,L,I,R,z=[0,0],D=null;if(a){if(L=r.glyphAtlasTexture,I=f.LINEAR,P=r.glyphAtlasTexture.size,l.iconsInText){z=r.imageAtlasTexture.size,D=r.imageAtlasTexture;const e="composite"===p.kind||"camera"===p.kind;R=w||t.options.rotating||t.options.zooming||e?f.LINEAR:f.NEAREST}}else{const e=1!==i.layout.get("icon-size").constantOr(0)||l.iconsNeedLinear;L=r.imageAtlasTexture,I=d||t.options.rotating||t.options.zooming||e||w?f.LINEAR:f.NEAREST,P=r.imageAtlasTexture.size}const O=C(r,1,t.transform.zoom),B=$e(M.projMatrix,v,g,t.transform,O),F=t.terrain&&v&&y?e.invert(new Float32Array(16),B):Gn,N=Xe(M.projMatrix,v,g,t.transform,O),U=S&&l.hasTextData(),V="none"!==i.layout.get("icon-text-fit")&&U&&l.hasIconData();if(y){const e=m.elevation;Qe(l,M.projMatrix,t,a,B,N,v,u,e?t=>e.getAtTileOffset(M,t.x,t.y):null)}const j=t.translatePosMatrix(M.projMatrix,r,o,s),G=y||a&&S||V?Gn:B,H=t.translatePosMatrix(N,r,o,s,!0),W=d&&0!==i.paint.get(a?"text-halo-width":"icon-halo-width").constantOr(1);let q;q=d?l.iconsInText?Bn(p.kind,A,_,v,t,j,G,H,P,z):On(p.kind,A,_,v,t,j,G,H,a,P,!0):Dn(p.kind,A,_,v,t,j,G,H,a,P);const Z={program:k,buffers:c,uniformValues:q,atlasTexture:L,atlasTextureIcon:D,atlasInterpolation:I,atlasInterpolationIcon:R,isSDF:d,hasHalo:W,tile:r,labelPlaneMatrixInv:F};if(x&&l.canOverlap){b=!0;const t=c.segments.get();for(const n of t)T.push({segments:new e.SegmentVector([n]),sortKey:n.sortKey,state:Z})}else T.push({segments:c.segments,sortKey:0,state:Z})}b&&T.sort(((e,t)=>e.sortKey-t.sortKey));for(const e of T){const n=e.state;if(t.terrain&&t.terrain.setupElevationDraw(n.tile,n.program,{useDepthForOcclusion:!0,labelPlaneMatrixInv:n.labelPlaneMatrixInv}),p.activeTexture.set(f.TEXTURE0),n.atlasTexture.bind(n.atlasInterpolation,f.CLAMP_TO_EDGE),n.atlasTextureIcon&&(p.activeTexture.set(f.TEXTURE1),n.atlasTextureIcon&&n.atlasTextureIcon.bind(n.atlasInterpolationIcon,f.CLAMP_TO_EDGE)),n.isSDF){const r=n.uniformValues;n.hasHalo&&(r.u_is_halo=1,$n(n.buffers,e.segments,i,t,n.program,w,h,d,r)),r.u_is_halo=0}$n(n.buffers,e.segments,i,t,n.program,w,h,d,n.uniformValues)}}function $n(t,n,i,r,a,o,s,l,c){const u=r.context;a.draw(u,u.gl.TRIANGLES,o,s,l,e.CullFaceMode.disabled,c,i.id,t.layoutVertexBuffer,t.indexBuffer,n,i.paint,r.transform.zoom,t.programConfigurations.get(i.id),t.dynamicLayoutVertexBuffer,t.opacityVertexBuffer)}function Xn(t,n,i,r,a,o,s){const l=t.context.gl,c=i.paint.get("fill-pattern"),u=c&&c.constantOr(1),h=i.getCrossfadeParameters();let d,p,f,m,g;s?(p=u&&!i.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",d=l.LINES):(p=u?"fillPattern":"fill",d=l.TRIANGLES);for(const v of r){const r=n.getTile(v);if(u&&!r.patternsLoaded())continue;const y=r.getBucket(i);if(!y)continue;t.prepareDrawTile(v);const _=y.programConfigurations.get(i.id),x=t.useProgram(p,_);u&&(t.context.activeTexture.set(l.TEXTURE0),r.imageAtlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE),_.updatePaintBuffers(h));const b=c.constantOr(null);if(b&&r.imageAtlas){const e=r.imageAtlas,t=e.patternPositions[b.to.toString()],n=e.patternPositions[b.from.toString()];t&&n&&_.setConstantPatternPositions(t,n)}const w=t.translatePosMatrix(v.projMatrix,r,i.paint.get("fill-translate"),i.paint.get("fill-translate-anchor"));if(s){m=y.indexBuffer2,g=y.segments2;const e=t.terrain&&t.terrain.renderingToTexture?t.terrain.drapeBufferSize:[l.drawingBufferWidth,l.drawingBufferHeight];f="fillOutlinePattern"===p&&u?bn(w,t,h,r,e):xn(w,e)}else m=y.indexBuffer,g=y.segments,f=u?_n(w,t,h,r):yn(w);t.prepareDrawProgram(t.context,x,v.toUnwrapped()),x.draw(t.context,d,a,t.stencilModeForClipping(v),o,e.CullFaceMode.disabled,f,i.id,y.layoutVertexBuffer,m,g,i.paint,t.transform.zoom,_)}}function Yn(t,n,i,r,a,o,s){const l=t.context,c=l.gl,u=i.paint.get("fill-extrusion-pattern"),h=u.constantOr(1),d=i.getCrossfadeParameters(),p=i.paint.get("fill-extrusion-opacity");for(const f of r){const r=n.getTile(f),m=r.getBucket(i);if(!m)continue;const g=m.programConfigurations.get(i.id),v=t.useProgram(h?"fillExtrusionPattern":"fillExtrusion",g);if(t.terrain){const e=t.terrain;if(!m.enableTerrain)continue;if(e.setupElevationDraw(r,v,{useMeterToDem:!0}),Jn(l,n,f,m,i,e),!m.centroidVertexBuffer){const e=v.attributes.a_centroid_pos;void 0!==e&&c.vertexAttrib2f(e,0,0)}}h&&(t.context.activeTexture.set(c.TEXTURE0),r.imageAtlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE),g.updatePaintBuffers(d));const y=u.constantOr(null);if(y&&r.imageAtlas){const e=r.imageAtlas,t=e.patternPositions[y.to.toString()],n=e.patternPositions[y.from.toString()];t&&n&&g.setConstantPatternPositions(t,n)}const _=t.translatePosMatrix(f.projMatrix,r,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),x=i.paint.get("fill-extrusion-vertical-gradient"),b=h?vn(_,t,x,p,f,d,r):gn(_,t,x,p);t.prepareDrawProgram(l,v,f.toUnwrapped()),v.draw(l,l.gl.TRIANGLES,a,o,s,e.CullFaceMode.backCCW,b,i.id,m.layoutVertexBuffer,m.indexBuffer,m.segments,i.paint,t.transform.zoom,g,t.terrain?m.centroidVertexBuffer:null)}}function Jn(t,n,i,r,a,o){const s=[t=>{let n=t.canonical.x-1,i=t.wrap;return n<0&&(n=(1<<t.canonical.z)-1,i--),new e.OverscaledTileID(t.overscaledZ,i,t.canonical.z,n,t.canonical.y)},t=>{let n=t.canonical.x+1,i=t.wrap;return n===1<<t.canonical.z&&(n=0,i++),new e.OverscaledTileID(t.overscaledZ,i,t.canonical.z,n,t.canonical.y)},t=>new e.OverscaledTileID(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,(0===t.canonical.y?1<<t.canonical.z:t.canonical.y)-1),t=>new e.OverscaledTileID(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y===(1<<t.canonical.z)-1?0:t.canonical.y+1)],l=e=>{const t=n.getSource().maxzoom,i=e=>{const t=n.getTileByID(e);if(t&&t.hasData())return t.getBucket(a)};let r,o,s;return(e.overscaledZ===e.canonical.z||e.overscaledZ>=t)&&(r=i(e.key)),e.overscaledZ>=t&&(o=i(e.calculateScaledKey(e.overscaledZ+1))),e.overscaledZ>t&&(s=i(e.calculateScaledKey(e.overscaledZ-1))),r||o||s},c=[0,0,0],u=(t,n)=>(c[0]=Math.min(t.min.y,n.min.y),c[1]=Math.max(t.max.y,n.max.y),c[2]=e.EXTENT-n.min.x>t.max.x?n.min.x-e.EXTENT:t.max.x,c),h=(t,n)=>(c[0]=Math.min(t.min.x,n.min.x),c[1]=Math.max(t.max.x,n.max.x),c[2]=e.EXTENT-n.min.y>t.max.y?n.min.y-e.EXTENT:t.max.y,c),d=[(e,t)=>u(e,t),(e,t)=>u(t,e),(e,t)=>h(e,t),(e,t)=>h(t,e)],p=new e.pointGeometry(0,0);let f,m,g;const v=(t,n,r,a,s)=>{const l=[[a?r:t,a?t:r,0],[a?r:n,a?n:r,0]],c=s<0?e.EXTENT+s:s,u=[a?c:(t+n)/2,a?(t+n)/2:c,0];return 0===r&&s<0||0!==r&&s>0?o.getForTilePoints(g,[u],!0,m):l.push(u),o.getForTilePoints(i,l,!0,f),Math.max(l[0][2],l[1][2],u[2])/o.exaggeration()};for(let y=0;y<4;y++){const t=r.borders[y];if(0===t.length&&(r.borderDone[y]=!0),r.borderDone[y])continue;const n=g=s[y](i),a=l(n);if(!a||!a.enableTerrain)continue;if(m=o.findDEMTileFor(n),!m||!m.dem)continue;if(!f){const e=o.findDEMTileFor(i);if(!e||!e.dem)return;f=e}const c=(y<2?1:5)-y,u=a.borders[c];let h=0;for(let i=0;i<t.length;i++){const n=r.featuresOnBorder[t[i]],o=n.borders[y];let s;for(;h<u.length&&(s=a.featuresOnBorder[u[h]],!(s.borders[c][1]>o[0]+3));)a.borderDone[c]||a.encodeCentroid(void 0,s,!1),h++;if(s&&h<u.length){const t=h;let i=0;for(;!(s.borders[c][0]>o[1]-3)&&(i++,++h!==u.length);)s=a.featuresOnBorder[u[h]];if(s=a.featuresOnBorder[u[t]],n.intersectsCount()>1||s.intersectsCount()>1||1!==i){1!==i&&(h=t),r.encodeCentroid(void 0,n,!1),a.borderDone[c]||a.encodeCentroid(void 0,s,!1);continue}const l=d[y](n,s),f=y%2?e.EXTENT-1:0;p.x=v(l[0],Math.min(e.EXTENT-1,l[1]),f,y<2,l[2]),p.y=0,r.encodeCentroid(p,n,!1),a.borderDone[c]||a.encodeCentroid(p,s,!1)}else r.encodeCentroid(void 0,n,!1)}r.borderDone[y]=r.needsCentroidUpdate=!0,a.borderDone[c]||(a.borderDone[c]=a.needsCentroidUpdate=!0)}(r.needsCentroidUpdate||!r.centroidVertexBuffer&&0!==r.centroidVertexArray.length)&&r.uploadCentroid(t)}const Kn=new e.Color(1,0,0,1),Qn=new e.Color(0,1,0,1),ei=new e.Color(0,0,1,1),ti=new e.Color(1,0,1,1),ni=new e.Color(0,1,1,1);function ii(e,t,n,i){ai(e,0,t+n/2,e.transform.width,n,i)}function ri(e,t,n,i){ai(e,t-n/2,0,n,e.transform.height,i)}function ai(t,n,i,r,a,o){const s=t.context,l=s.gl;l.enable(l.SCISSOR_TEST),l.scissor(n*e.exported.devicePixelRatio,i*e.exported.devicePixelRatio,r*e.exported.devicePixelRatio,a*e.exported.devicePixelRatio),s.clear({color:o}),l.disable(l.SCISSOR_TEST)}function oi(t,n,i){const r=t.context,a=r.gl,o=i.projMatrix,s=t.useProgram("debug"),l=n.getTileByID(i.key);t.terrain&&t.terrain.setupElevationDraw(l,s);const c=e.DepthMode.disabled,u=e.StencilMode.disabled,h=t.colorModeForRenderPass(),d="$debug";r.activeTexture.set(a.TEXTURE0),t.emptyTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE),s.draw(r,a.LINE_STRIP,c,u,h,e.CullFaceMode.disabled,En(o,e.Color.red),d,t.debugBuffer,t.tileBorderIndexBuffer,t.debugSegments);const p=l.latestRawTileData,f=Math.floor((p&&p.byteLength||0)/1024),m=n.getTile(i).tileSize,g=512/Math.min(m,512)*(i.overscaledZ/t.transform.zoom)*.5;let v=i.canonical.toString();i.overscaledZ!==i.canonical.z&&(v+=` => ${i.overscaledZ}`),function(e,t){e.initDebugOverlayCanvas();const n=e.debugOverlayCanvas,i=e.context.gl,r=e.debugOverlayCanvas.getContext("2d");r.clearRect(0,0,n.width,n.height),r.shadowColor="white",r.shadowBlur=2,r.lineWidth=1.5,r.strokeStyle="white",r.textBaseline="top",r.font="bold 36px Open Sans, sans-serif",r.fillText(t,5,5),r.strokeText(t,5,5),e.debugOverlayTexture.update(n),e.debugOverlayTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE)}(t,`${v} ${f}kb`),s.draw(r,a.TRIANGLES,c,u,e.ColorMode.alphaBlended,e.CullFaceMode.disabled,En(o,e.Color.transparent,g),d,t.debugBuffer,t.quadTriangleIndexBuffer,t.debugSegments)}const si=e.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:li}=si;function ci(e,t,n,i){e.emplaceBack(t,n,i)}class ui{constructor(t){this.vertexArray=new e.StructArrayLayout3f12,this.indices=new e.StructArrayLayout3ui6,ci(this.vertexArray,-1,-1,1),ci(this.vertexArray,1,-1,1),ci(this.vertexArray,-1,1,1),ci(this.vertexArray,1,1,1),ci(this.vertexArray,-1,-1,-1),ci(this.vertexArray,1,-1,-1),ci(this.vertexArray,-1,1,-1),ci(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,li),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=e.SegmentVector.simpleSegment(0,0,36,12)}}function hi(t,n,i,r,a,o){const s=t.gl,l=n.paint.get("sky-atmosphere-color"),c=n.paint.get("sky-atmosphere-halo-color"),u=n.paint.get("sky-atmosphere-sun-intensity"),h=((e,t,n,i,r)=>({u_matrix_3f:e,u_sun_direction:t,u_sun_intensity:n,u_color_tint_r:[i.r,i.g,i.b,i.a],u_color_tint_m:[r.r,r.g,r.b,r.a],u_luminance:5e-5}))(e.fromMat4([],r),a,u,l,c);s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_CUBE_MAP_POSITIVE_X+o,n.skyboxTexture,0),i.draw(t,s.TRIANGLES,e.DepthMode.disabled,e.StencilMode.disabled,e.ColorMode.unblended,e.CullFaceMode.frontCW,h,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const di={symbol:function(t,n,i,r,a){if("translucent"!==t.renderPass)return;const o=e.StencilMode.disabled,s=t.colorModeForRenderPass();i.layout.get("text-variable-anchor")&&function(t,n,i,r,a,o,s){const l=n.transform,c="map"===a,u="map"===o;for(const h of t){const t=r.getTile(h),a=t.getBucket(i);if(!a||!a.text||!a.text.segments.get().length)continue;const o=e.evaluateSizeForZoom(a.textSizeData,l.zoom),d=C(t,1,n.transform.zoom),p=$e(h.projMatrix,u,c,n.transform,d),f="none"!==i.layout.get("icon-text-fit")&&a.hasIconData();if(o){const n=Math.pow(2,l.zoom-t.tileID.overscaledZ),i=l.elevation;Wn(a,c,u,s,e.symbolSize,l,p,h.projMatrix,n,o,f,i?e=>i.getAtTileOffset(h,e.x,e.y):e=>0)}}}(r,t,i,n,i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),a),0!==i.paint.get("icon-opacity").constantOr(1)&&Zn(t,n,i,r,!1,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),i.layout.get("icon-rotation-alignment"),i.layout.get("icon-pitch-alignment"),i.layout.get("icon-keep-upright"),o,s),0!==i.paint.get("text-opacity").constantOr(1)&&Zn(t,n,i,r,!0,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),i.layout.get("text-keep-upright"),o,s),n.map.showCollisionBoxes&&(jn(t,n,i,r,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),!0),jn(t,n,i,r,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),!1))},circle:function(t,n,i,r){if("translucent"!==t.renderPass)return;const a=i.paint.get("circle-opacity"),o=i.paint.get("circle-stroke-width"),s=i.paint.get("circle-stroke-opacity"),l=void 0!==i.layout.get("circle-sort-key").constantOr(1);if(0===a.constantOr(1)&&(0===o.constantOr(1)||0===s.constantOr(1)))return;const c=t.context,u=c.gl,h=t.depthModeForSublayer(0,e.DepthMode.ReadOnly),d=e.StencilMode.disabled,p=t.colorModeForRenderPass(),f=[];for(let m=0;m<r.length;m++){const a=r[m],o=n.getTile(a),s=o.getBucket(i);if(!s)continue;const c=s.programConfigurations.get(i.id),u=Sn(i),h={programConfiguration:c,program:t.useProgram("circle",c,u),layoutVertexBuffer:s.layoutVertexBuffer,indexBuffer:s.indexBuffer,uniformValues:wn(t,a,o,i),tile:o};if(l){const t=s.segments.get();for(const n of t)f.push({segments:new e.SegmentVector([n]),sortKey:n.sortKey,state:h})}else f.push({segments:s.segments,sortKey:0,state:h})}l&&f.sort(((e,t)=>e.sortKey-t.sortKey));for(const m of f){const{programConfiguration:n,program:r,layoutVertexBuffer:a,indexBuffer:o,uniformValues:s,tile:l}=m.state,f=m.segments;t.terrain&&t.terrain.setupElevationDraw(l,r,{useDepthForOcclusion:!0}),t.prepareDrawProgram(c,r,l.tileID.toUnwrapped()),r.draw(c,u.TRIANGLES,h,d,p,e.CullFaceMode.disabled,s,i.id,a,o,f,i.paint,t.transform.zoom,n)}},heatmap:function(t,n,i,r){if(0!==i.paint.get("heatmap-opacity"))if("offscreen"===t.renderPass){const a=t.context,o=a.gl,s=e.StencilMode.disabled,l=new e.ColorMode([o.ONE,o.ONE],e.Color.transparent,[!0,!0,!0,!0]);!function(e,t,n){const i=e.gl;e.activeTexture.set(i.TEXTURE1),e.viewport.set([0,0,t.width/4,t.height/4]);let r=n.heatmapFbo;if(r)i.bindTexture(i.TEXTURE_2D,r.colorAttachment.get()),e.bindFramebuffer.set(r.framebuffer);else{const a=i.createTexture();i.bindTexture(i.TEXTURE_2D,a),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),r=n.heatmapFbo=e.createFramebuffer(t.width/4,t.height/4,!1),function(e,t,n,i){const r=e.gl;r.texImage2D(r.TEXTURE_2D,0,r.RGBA,t.width/4,t.height/4,0,r.RGBA,e.extRenderToTextureHalfFloat?e.extTextureHalfFloat.HALF_FLOAT_OES:r.UNSIGNED_BYTE,null),i.colorAttachment.set(n)}(e,t,a,r)}}(a,t,i),a.clear({color:e.Color.transparent});for(let c=0;c<r.length;c++){const u=r[c];if(n.hasRenderableParent(u))continue;const h=n.getTile(u),d=h.getBucket(i);if(!d)continue;const p=d.programConfigurations.get(i.id),f=t.useProgram("heatmap",p),{zoom:m}=t.transform;t.terrain&&t.terrain.setupElevationDraw(h,f),t.prepareDrawProgram(a,f,u.toUnwrapped()),f.draw(a,o.TRIANGLES,e.DepthMode.disabled,s,l,e.CullFaceMode.disabled,Mn(u.projMatrix,h,m,i.paint.get("heatmap-intensity")),i.id,d.layoutVertexBuffer,d.indexBuffer,d.segments,i.paint,t.transform.zoom,p)}a.viewport.set([0,0,t.width,t.height])}else"translucent"===t.renderPass&&(t.context.setColorMode(t.colorModeForRenderPass()),function(t,n){const i=t.context,r=i.gl,a=n.heatmapFbo;if(!a)return;i.activeTexture.set(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,a.colorAttachment.get()),i.activeTexture.set(r.TEXTURE1);let o=n.colorRampTexture;o||(o=n.colorRampTexture=new e.Texture(i,n.colorRamp,r.RGBA)),o.bind(r.LINEAR,r.CLAMP_TO_EDGE),t.useProgram("heatmapTexture").draw(i,r.TRIANGLES,e.DepthMode.disabled,e.StencilMode.disabled,t.colorModeForRenderPass(),e.CullFaceMode.disabled,((t,n,i,r)=>{const a=e.create$1();e.ortho(a,0,t.width,t.height,0,0,1);const o=t.context.gl;return{u_matrix:a,u_world:[o.drawingBufferWidth,o.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:n.paint.get("heatmap-opacity")}})(t,n),n.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments,n.paint,t.transform.zoom)}(t,i))},line:function(t,n,i,r){if("translucent"!==t.renderPass)return;const a=i.paint.get("line-opacity"),o=i.paint.get("line-width");if(0===a.constantOr(1)||0===o.constantOr(1))return;const s=t.depthModeForSublayer(0,e.DepthMode.ReadOnly),l=t.colorModeForRenderPass(),c=i.paint.get("line-dasharray"),u=c.constantOr(1),h=i.layout.get("line-cap"),d=i.paint.get("line-pattern"),p=d.constantOr(1),f=i.paint.get("line-gradient"),m=i.getCrossfadeParameters(),g=p?"linePattern":u?"lineSDF":f?"lineGradient":"line",v=t.context,y=v.gl;for(const _ of r){const r=n.getTile(_);if(p&&!r.patternsLoaded())continue;const a=r.getBucket(i);if(!a)continue;t.prepareDrawTile(_);const o=a.programConfigurations.get(i.id),x=t.useProgram(g,o),b=d.constantOr(null);if(b&&r.imageAtlas){const e=r.imageAtlas,t=e.patternPositions[b.to.toString()],n=e.patternPositions[b.from.toString()];t&&n&&o.setConstantPatternPositions(t,n)}const w=c.constantOr(null),S=h.constantOr(null);if(!p&&w&&S&&r.lineAtlas){const e=r.lineAtlas,t=e.getDash(w.to,S),n=e.getDash(w.from,S);t&&n&&o.setConstantPatternPositions(t,n)}const T=t.terrain?_.projMatrix:null,E=p?Cn(t,r,i,m,T):u?Pn(t,r,i,m,T):f?An(t,r,i,T,a.lineClipsArray.length):kn(t,r,i,T);if(p)v.activeTexture.set(y.TEXTURE0),r.imageAtlasTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE),o.updatePaintBuffers(m);else if(u)v.activeTexture.set(y.TEXTURE0),r.lineAtlasTexture.bind(y.LINEAR,y.REPEAT),o.updatePaintBuffers(m);else if(f){const r=a.gradients[i.id];let o=r.texture;if(i.gradientVersion!==r.version){let s=256;if(i.stepInterpolant){const i=n.getSource().maxzoom,r=_.canonical.z===i?Math.ceil(1<<t.transform.maxZoom-_.canonical.z):1;s=e.clamp(e.nextPowerOfTwo(a.maxLineLength/e.EXTENT*1024*r),256,v.maxTextureSize)}r.gradient=e.renderColorRamp({expression:i.gradientExpression(),evaluationKey:"lineProgress",resolution:s,image:r.gradient||void 0,clips:a.lineClipsArray}),r.texture?r.texture.update(r.gradient):r.texture=new e.Texture(v,r.gradient,y.RGBA),r.version=i.gradientVersion,o=r.texture}v.activeTexture.set(y.TEXTURE0),o.bind(i.stepInterpolant?y.NEAREST:y.LINEAR,y.CLAMP_TO_EDGE)}t.prepareDrawProgram(v,x,_.toUnwrapped()),x.draw(v,y.TRIANGLES,s,t.stencilModeForClipping(_),l,e.CullFaceMode.disabled,E,i.id,a.layoutVertexBuffer,a.indexBuffer,a.segments,i.paint,t.transform.zoom,o,a.layoutVertexBuffer2)}},fill:function(t,n,i,r){const a=i.paint.get("fill-color"),o=i.paint.get("fill-opacity");if(0===o.constantOr(1))return;const s=t.colorModeForRenderPass(),l=i.paint.get("fill-pattern"),c=t.opaquePassEnabledForLayer()&&!l.constantOr(1)&&1===a.constantOr(e.Color.transparent).a&&1===o.constantOr(0)?"opaque":"translucent";if(t.renderPass===c){const a=t.depthModeForSublayer(1,"opaque"===t.renderPass?e.DepthMode.ReadWrite:e.DepthMode.ReadOnly);Xn(t,n,i,r,a,s,!1)}if("translucent"===t.renderPass&&i.paint.get("fill-antialias")){const a=t.depthModeForSublayer(i.getPaintProperty("fill-outline-color")?2:0,e.DepthMode.ReadOnly);Xn(t,n,i,r,a,s,!0)}},"fill-extrusion":function(t,n,i,r){const a=i.paint.get("fill-extrusion-opacity");if(0!==a&&"translucent"===t.renderPass){const o=new e.DepthMode(t.context.gl.LEQUAL,e.DepthMode.ReadWrite,t.depthRangeFor3D);if(1!==a||i.paint.get("fill-extrusion-pattern").constantOr(1))Yn(t,n,i,r,o,e.StencilMode.disabled,e.ColorMode.disabled),Yn(t,n,i,r,o,t.stencilModeFor3D(),t.colorModeForRenderPass());else{const a=t.colorModeForRenderPass();Yn(t,n,i,r,o,e.StencilMode.disabled,a)}}},hillshade:function(t,n,i,r){if("offscreen"!==t.renderPass&&"translucent"!==t.renderPass)return;const a=t.context,o=t.depthModeForSublayer(0,e.DepthMode.ReadOnly),s=t.colorModeForRenderPass(),l=t.terrain&&t.terrain.renderingToTexture,[c,u]="translucent"!==t.renderPass||l?[{},r]:t.stencilConfigForOverlap(r);for(const h of u){const r=n.getTile(h);if(r.needsHillshadePrepare&&"offscreen"===t.renderPass)en(t,r,i,o,e.StencilMode.disabled,s);else if("translucent"===t.renderPass){const e=l&&t.terrain?t.terrain.stencilModeForRTTOverlap(h):c[h.overscaledZ];Kt(t,h,r,i,o,e,s)}}a.viewport.set([0,0,t.width,t.height])},raster:function(t,n,i,r,a,o){if("translucent"!==t.renderPass)return;if(0===i.paint.get("raster-opacity"))return;if(!r.length)return;const s=t.context,l=s.gl,c=n.getSource(),u=t.useProgram("raster"),h=t.colorModeForRenderPass(),d=t.terrain&&t.terrain.renderingToTexture,[p,f]=c instanceof Te||d?[{},r]:t.stencilConfigForOverlap(r),m=f[f.length-1].overscaledZ,g=!t.options.moving;for(const v of f){const r=d?e.DepthMode.disabled:t.depthModeForSublayer(v.overscaledZ-m,1===i.paint.get("raster-opacity")?e.DepthMode.ReadWrite:e.DepthMode.ReadOnly,l.LESS),a=v.toUnwrapped(),f=n.getTile(v);if(d&&(!f||!f.hasData()))continue;const y=d?v.projMatrix:t.transform.calculateProjMatrix(a,g),_=t.terrain&&d?t.terrain.stencilModeForRTTOverlap(v):p[v.overscaledZ],x=o?0:i.paint.get("raster-fade-duration");f.registerFadeDuration(x);const b=n.findLoadedParent(v,0),w=cn(f,b,n,t.transform,x);let S,T;t.terrain&&t.terrain.prepareDrawTile(v);const E="nearest"===i.paint.get("raster-resampling")?l.NEAREST:l.LINEAR;s.activeTexture.set(l.TEXTURE0),f.texture.bind(E,l.CLAMP_TO_EDGE,l.LINEAR_MIPMAP_NEAREST),s.activeTexture.set(l.TEXTURE1),b?(b.texture.bind(E,l.CLAMP_TO_EDGE,l.LINEAR_MIPMAP_NEAREST),S=Math.pow(2,b.tileID.overscaledZ-f.tileID.overscaledZ),T=[f.tileID.canonical.x*S%1,f.tileID.canonical.y*S%1]):f.texture.bind(E,l.CLAMP_TO_EDGE,l.LINEAR_MIPMAP_NEAREST);const M=Rn(y,T||[0,0],S||1,w,i);t.prepareDrawProgram(s,u,a),c instanceof Te?u.draw(s,l.TRIANGLES,r,e.StencilMode.disabled,h,e.CullFaceMode.disabled,M,i.id,c.boundsBuffer,t.quadTriangleIndexBuffer,c.boundsSegments):u.draw(s,l.TRIANGLES,r,_,h,e.CullFaceMode.disabled,M,i.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments)}},background:function(t,n,i,r){const a=i.paint.get("background-color"),o=i.paint.get("background-opacity");if(0===o)return;const s=t.context,l=s.gl,c=t.transform,u=c.tileSize,h=i.paint.get("background-pattern");if(t.isPatternMissing(h))return;const d=!h&&1===a.a&&1===o&&t.opaquePassEnabledForLayer()?"opaque":"translucent";if(t.renderPass!==d)return;const p=e.StencilMode.disabled,f=t.depthModeForSublayer(0,"opaque"===d?e.DepthMode.ReadWrite:e.DepthMode.ReadOnly),m=t.colorModeForRenderPass(),g=t.useProgram(h?"backgroundPattern":"background"),v=r||c.coveringTiles({tileSize:u});h&&(s.activeTexture.set(l.TEXTURE0),t.imageManager.bind(t.context));const y=i.getCrossfadeParameters();for(const _ of v){const n=_.toUnwrapped(),c=r?_.projMatrix:t.transform.calculateProjMatrix(n);t.prepareDrawTile(_);const d=h?Nn(c,o,t,h,{tileID:_,tileSize:u},y):Fn(c,o,a);t.prepareDrawProgram(s,g,n),g.draw(s,l.TRIANGLES,f,p,m,e.CullFaceMode.disabled,d,i.id,t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments)}},sky:function(t,n,i){const r=i.paint.get("sky-opacity");if(0===r)return;const a=t.context,o=i.paint.get("sky-type"),s=new e.DepthMode(a.gl.LEQUAL,e.DepthMode.ReadOnly,[0,1]),l=t.frameCounter/1e3%1;"atmosphere"===o?"offscreen"===t.renderPass?i.needsSkyboxCapture(t)&&(function(t,n,i,r){const a=t.context,o=a.gl;let s=n.skyboxFbo;if(!s){s=n.skyboxFbo=a.createFramebuffer(32,32,!1),n.skyboxGeometry=new ui(a),n.skyboxTexture=a.gl.createTexture(),o.bindTexture(o.TEXTURE_CUBE_MAP,n.skyboxTexture),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MAG_FILTER,o.LINEAR);for(let e=0;e<6;++e)o.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,o.RGBA,32,32,0,o.RGBA,o.UNSIGNED_BYTE,null)}a.bindFramebuffer.set(s.framebuffer),a.viewport.set([0,0,32,32]);const l=n.getCenter(t,!0),c=t.useProgram("skyboxCapture"),u=new Float64Array(16);e.identity(u),e.rotateY(u,u,.5*-Math.PI),hi(a,n,c,u,l,0),e.identity(u),e.rotateY(u,u,.5*Math.PI),hi(a,n,c,u,l,1),e.identity(u),e.rotateX(u,u,.5*-Math.PI),hi(a,n,c,u,l,2),e.identity(u),e.rotateX(u,u,.5*Math.PI),hi(a,n,c,u,l,3),e.identity(u),hi(a,n,c,u,l,4),e.identity(u),e.rotateY(u,u,Math.PI),hi(a,n,c,u,l,5),a.viewport.set([0,0,t.width,t.height])}(t,i),i.markSkyboxValid(t)):"sky"===t.renderPass&&function(t,n,i,r,a){const o=t.context,s=o.gl,l=t.transform,c=t.useProgram("skybox");o.activeTexture.set(s.TEXTURE0),s.bindTexture(s.TEXTURE_CUBE_MAP,n.skyboxTexture);const u=((e,t,n,i,r)=>({u_matrix:e,u_sun_direction:t,u_cubemap:0,u_opacity:i,u_temporal_offset:r}))(l.skyboxMatrix,n.getCenter(t,!1),0,r,a);t.prepareDrawProgram(o,c),c.draw(o,s.TRIANGLES,i,e.StencilMode.disabled,t.colorModeForRenderPass(),e.CullFaceMode.backCW,u,"skybox",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}(t,i,s,r,l):"gradient"===o&&"sky"===t.renderPass&&function(t,n,i,r,a){const o=t.context,s=o.gl,l=t.transform,c=t.useProgram("skyboxGradient");n.skyboxGeometry||(n.skyboxGeometry=new ui(o)),o.activeTexture.set(s.TEXTURE0);let u=n.colorRampTexture;u||(u=n.colorRampTexture=new e.Texture(o,n.colorRamp,s.RGBA)),u.bind(s.LINEAR,s.CLAMP_TO_EDGE);const h=((t,n,i,r,a)=>({u_matrix:t,u_color_ramp:0,u_center_direction:n,u_radius:e.degToRad(i),u_opacity:r,u_temporal_offset:a}))(l.skyboxMatrix,n.getCenter(t,!1),n.paint.get("sky-gradient-radius"),r,a);t.prepareDrawProgram(o,c),c.draw(o,s.TRIANGLES,i,e.StencilMode.disabled,t.colorModeForRenderPass(),e.CullFaceMode.backCW,h,"skyboxGradient",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}(t,i,s,r,l)},debug:function(e,t,n){for(let i=0;i<n.length;i++)oi(e,t,n[i])},custom:function(t,n,i){const r=t.context,a=i.implementation;if("offscreen"===t.renderPass){const e=a.prerender;e&&(t.setCustomLayerDefaults(),r.setColorMode(t.colorModeForRenderPass()),e.call(a,r.gl,t.transform.customLayerMatrix()),r.setDirty(),t.setBaseState())}else if("translucent"===t.renderPass){t.setCustomLayerDefaults(),r.setColorMode(t.colorModeForRenderPass()),r.setStencilMode(e.StencilMode.disabled);const n="3d"===a.renderingMode?new e.DepthMode(t.context.gl.LEQUAL,e.DepthMode.ReadWrite,t.depthRangeFor3D):t.depthModeForSublayer(0,e.DepthMode.ReadOnly);r.setDepthMode(n),a.render(r.gl,t.transform.customLayerMatrix()),r.setDirty(),t.setBaseState(),r.bindFramebuffer.set(null)}}};class pi{constructor(t,n){this.context=new xe(t),this.transform=n,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=e.SourceCache.maxUnderzooming+e.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Dt,this.gpuTimers={},this.frameCounter=0}updateTerrain(e,t){const n=!!e&&!!e.terrain;if(!(n||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new dn(this,e));const i=this._terrain;this.transform.elevation=n?i:null,i.update(e,this.transform,t)}_updateFog(e){const t=e.fog;if(!t||t.getOpacity(this.transform.pitch)<1||t.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[n,i]=t.getFovAdjustedRange(this.transform._fov),r=n+.78*(i-n);this.transform.fogCullDistSq=r*r}get terrain(){return this._terrain&&this._terrain.enabled?this._terrain:null}resize(t,n){if(this.width=t*e.exported.devicePixelRatio,this.height=n*e.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const e of this.style.order)this.style._layers[e].resize()}setup(){const t=this.context,n=new e.StructArrayLayout2i4;n.emplaceBack(0,0),n.emplaceBack(e.EXTENT,0),n.emplaceBack(0,e.EXTENT),n.emplaceBack(e.EXTENT,e.EXTENT),this.tileExtentBuffer=t.createVertexBuffer(n,e.posAttributes.members),this.tileExtentSegments=e.SegmentVector.simpleSegment(0,0,4,2);const i=new e.StructArrayLayout2i4;i.emplaceBack(0,0),i.emplaceBack(e.EXTENT,0),i.emplaceBack(0,e.EXTENT),i.emplaceBack(e.EXTENT,e.EXTENT),this.debugBuffer=t.createVertexBuffer(i,e.posAttributes.members),this.debugSegments=e.SegmentVector.simpleSegment(0,0,4,5);const r=new e.StructArrayLayout4i8;r.emplaceBack(0,0,0,0),r.emplaceBack(e.EXTENT,0,e.EXTENT,0),r.emplaceBack(0,e.EXTENT,0,e.EXTENT),r.emplaceBack(e.EXTENT,e.EXTENT,e.EXTENT,e.EXTENT),this.rasterBoundsBuffer=t.createVertexBuffer(r,Se.members),this.rasterBoundsSegments=e.SegmentVector.simpleSegment(0,0,4,2);const a=new e.StructArrayLayout2i4;a.emplaceBack(0,0),a.emplaceBack(1,0),a.emplaceBack(0,1),a.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(a,e.posAttributes.members),this.viewportSegments=e.SegmentVector.simpleSegment(0,0,4,2);const o=new e.StructArrayLayout1ui2;o.emplaceBack(0),o.emplaceBack(1),o.emplaceBack(3),o.emplaceBack(2),o.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(o);const s=new e.StructArrayLayout3ui6;s.emplaceBack(0,1,2),s.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(s),this.emptyTexture=new e.Texture(t,{width:1,height:1,data:new Uint8Array([0,0,0,0])},t.gl.RGBA),this.identityMat=e.create$1();const l=this.context.gl;this.stencilClearMode=new e.StencilMode({func:l.ALWAYS,mask:0},0,255,l.ZERO,l.ZERO,l.ZERO),this.loadTimeStamps.push(e.window.performance.now())}clearStencil(){const t=this.context,n=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const i=e.create$1();e.ortho(i,0,this.width,this.height,0,0,1),e.scale$1(i,i,[n.drawingBufferWidth,n.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,n.TRIANGLES,e.DepthMode.disabled,this.stencilClearMode,e.ColorMode.disabled,e.CullFaceMode.disabled,ln(i),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,n,i){if(!(n&&this.currentStencilSource!==n.id&&t.isTileClipped()&&i&&i.length))return;this.currentStencilSource=n.id;const r=this.context,a=r.gl;this.nextStencilID+i.length>256&&this.clearStencil(),r.setColorMode(e.ColorMode.disabled),r.setDepthMode(e.DepthMode.disabled);const o=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const s of i){const t=this._tileClippingMaskIDs[s.key]=this.nextStencilID++;o.draw(r,a.TRIANGLES,e.DepthMode.disabled,new e.StencilMode({func:a.ALWAYS,mask:0},t,255,a.KEEP,a.KEEP,a.REPLACE),e.ColorMode.disabled,e.CullFaceMode.disabled,ln(s.projMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,n=this.context.gl;return new e.StencilMode({func:n.NOTEQUAL,mask:255},t,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const n=this.context.gl;return new e.StencilMode({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,n.KEEP,n.KEEP,n.REPLACE)}stencilConfigForOverlap(t){const n=this.context.gl,i=t.sort(((e,t)=>t.overscaledZ-e.overscaledZ)),r=i[i.length-1].overscaledZ,a=i[0].overscaledZ-r+1;if(a>1){this.currentStencilSource=void 0,this.nextStencilID+a>256&&this.clearStencil();const t={};for(let i=0;i<a;i++)t[i+r]=new e.StencilMode({func:n.GEQUAL,mask:255},i+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=a,[t,i]}return[{[r]:e.StencilMode.disabled},i]}colorModeForRenderPass(){const t=this.context.gl;if(this._showOverdrawInspector){const n=1/8;return new e.ColorMode([t.CONSTANT_COLOR,t.ONE],new e.Color(n,n,n,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?e.ColorMode.unblended:e.ColorMode.alphaBlended}depthModeForSublayer(t,n,i){if(!this.opaquePassEnabledForLayer())return e.DepthMode.disabled;const r=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new e.DepthMode(i||this.context.gl.LEQUAL,n,[r,r])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,n){this.style=t,this.options=n,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(e.exported.now()),this.imageManager.beginFrame();const i=this.style.order,r=this.style._sourceCaches;for(const e in r){const t=r[e];t.used&&t.prepare(this.context)}const a={},o={},s={};for(const e in r){const t=r[e];a[e]=t.getVisibleCoordinates(),o[e]=a[e].slice().reverse(),s[e]=t.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let e=0;e<i.length;e++)if(this.style._layers[i[e]].is3D()){this.opaquePassCutoff=e;break}if(this.terrain&&(this.terrain.updateTileBinding(s),this.opaquePassCutoff=0),!e.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const e of i){const n=this.style._layers[e],i=t._getLayerSourceCache(n);if(!n.hasOffscreenPass()||n.isHidden(this.transform.zoom))continue;const r=i?o[i.id]:void 0;("custom"===n.type||n.isSky()||r&&r.length)&&this.renderLayer(this,i,n,r)}this.depthRangeFor3D=[0,1-(t.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let l=e.Color.transparent;if(this.style.fog&&(l=this.style.fog.properties.get("color")),this.context.clear({color:n.showOverdrawInspector?e.Color.black:l,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=i.length-1;this.currentLayer>=0;this.currentLayer--){const e=this.style._layers[i[this.currentLayer]],n=t._getLayerSourceCache(e);if(e.isSky())continue;const r=n?o[n.id]:void 0;this._renderTileClippingMasks(e,n,r),this.renderLayer(this,n,e,r)}if(this.renderPass="sky",this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<i.length;this.currentLayer++){const e=this.style._layers[i[this.currentLayer]],n=t._getLayerSourceCache(e);e.isSky()&&this.renderLayer(this,n,e,n?o[n.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<i.length;){const e=this.style._layers[i[this.currentLayer]],n=t._getLayerSourceCache(e);if(e.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(e)){if(e.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const r=n?("symbol"===e.type?s:o)[n.id]:void 0;this._renderTileClippingMasks(e,n,n?a[n.id]:void 0),this.renderLayer(this,n,e,r),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let n=null;e.values(this.style._layers).forEach((e=>{const i=t._getLayerSourceCache(e);i&&!e.isHidden(this.transform.zoom)&&(!n||n.getSource().maxzoom<i.getSource().maxzoom)&&(n=i)})),n&&this.options.showTileBoundaries&&di.debug(this,n,n.getVisibleCoordinates())}this.options.showPadding&&function(e){const t=e.transform.padding;ii(e,e.transform.height-(t.top||0),3,Kn),ii(e,t.bottom||0,3,Qn),ri(e,t.left||0,3,ei),ri(e,e.transform.width-(t.right||0),3,ti);const n=e.transform.centerPoint;!function(e,t,n,i){ai(e,t-1,n-10,2,20,i),ai(e,t-10,n-1,20,2,i)}(e,n.x,e.transform.height-n.y,ni)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%e.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(e.window.performance.now()),this.saveCanvasCopy())}renderLayer(e,t,n,i){n.isHidden(this.transform.zoom)||("background"===n.type||"sky"===n.type||"custom"===n.type||i&&i.length)&&(this.id=n.id,this.gpuTimingStart(n),di[n.type](e,t,n,i,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(e){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery;let n=this.gpuTimers[e.id];n||(n=this.gpuTimers[e.id]={calls:0,cpuTime:0,query:t.createQueryEXT()}),n.calls++,t.beginQueryEXT(t.TIME_ELAPSED_EXT,n.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const e=this.context.extTimerQuery;e.endQueryEXT(e.TIME_ELAPSED_EXT)}collectGpuTimers(){const e=this.gpuTimers;return this.gpuTimers={},e}queryGpuTimers(e){const t={};for(const n in e){const i=e[n],r=this.context.extTimerQuery,a=r.getQueryObjectEXT(i.query,r.QUERY_RESULT_EXT)/1e6;r.deleteQueryEXT(i.query),t[n]=a}return t}translatePosMatrix(t,n,i,r,a){if(!i[0]&&!i[1])return t;const o=a?"map"===r?this.transform.angle:0:"viewport"===r?-this.transform.angle:0;if(o){const e=Math.sin(o),t=Math.cos(o);i=[i[0]*t-i[1]*e,i[0]*e+i[1]*t]}const s=[a?i[0]:C(n,i[0],this.transform.zoom),a?i[1]:C(n,i[1],this.transform.zoom),0],l=new Float32Array(16);return e.translate(l,t,s),l}saveTileTexture(e){const t=this._tileTextures[e.size[0]];t?t.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const t=this._tileTextures[e];return t&&t.length>0?t.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const t=this.imageManager.getPattern(e.from.toString()),n=this.imageManager.getPattern(e.to.toString());return!t||!n}currentGlobalDefines(){const e=this.terrain&&this.terrain.renderingToTexture,t=this.style&&this.style.fog,n=[];return this.terrain&&!this.terrain.renderingToTexture&&n.push("TERRAIN"),t&&!e&&0!==t.getOpacity(this.transform.pitch)&&n.push("FOG"),e&&n.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&n.push("OVERDRAW_INSPECTOR"),n}useProgram(e,t,n){this.cache=this.cache||{};const i=n||[],r=this.currentGlobalDefines().concat(i),a=fn.cacheKey(e,r,t);return this.cache[a]||(this.cache[a]=new fn(this.context,e,$t[e],t,Un[e],r)),this.cache[a]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=e.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new e.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(e){this.terrain&&this.terrain.prepareDrawTile(e)}prepareDrawProgram(e,t,n){if(this.terrain&&this.terrain.renderingToTexture)return;const i=this.style.fog;if(i){const r=i.getOpacity(this.transform.pitch);0!==r&&t.setFogUniformValues(e,((e,t,n,i)=>{const r=t.properties.get("color"),a=e.frameCounter/1e3%1,o=[r.r/r.a,r.g/r.a,r.b/r.a,i];return{u_fog_matrix:n?e.transform.calculateFogTileMatrix(n):e.identityMat,u_fog_range:t.getFovAdjustedRange(e.transform._fov),u_fog_color:o,u_fog_horizon_blend:t.properties.get("horizon-blend"),u_fog_temporal_offset:a}})(this,i,n,r))}}setTileLoadedFlag(e){this.tileLoaded=e}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const e=this.context.gl,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.copyTexImage2D(e.TEXTURE_2D,0,e.RGBA,0,0,e.drawingBufferWidth,e.drawingBufferHeight,0),t}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const e=this.style&&this.style.fog;return!!e&&0!==e.getOpacity(this.transform.pitch)}}class fi{constructor(e=0,t=0,n=0,i=0){if(isNaN(e)||e<0||isNaN(t)||t<0||isNaN(n)||n<0||isNaN(i)||i<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=t,this.left=n,this.right=i}interpolate(t,n,i){return null!=n.top&&null!=t.top&&(this.top=e.number(t.top,n.top,i)),null!=n.bottom&&null!=t.bottom&&(this.bottom=e.number(t.bottom,n.bottom,i)),null!=n.left&&null!=t.left&&(this.left=e.number(t.left,n.left,i)),null!=n.right&&null!=t.right&&(this.right=e.number(t.right,n.right,i)),this}getCenter(t,n){const i=e.clamp((this.left+t-this.right)/2,0,t),r=e.clamp((this.top+n-this.bottom)/2,0,n);return new e.pointGeometry(i,r)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new fi(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function mi(e,t){return[e[4*t],e[4*t+1],e[4*t+2],e[4*t+3]]}function gi(e,t,n){e[4*t+0]=n[0],e[4*t+1]=n[1],e[4*t+2]=n[2],e[4*t+3]=n[3]}function vi(t,n){const i=mi(t,3);e.fromQuat(t,n),gi(t,3,i)}function yi(e,t){gi(e,3,[t[0],t[1],t[2],1])}function _i(t,n){const i=e.identity$1([]);return e.rotateZ$1(i,i,-n),e.rotateX$1(i,i,-t),i}function xi(t,n){const i=[t[0],t[1],0],r=[n[0],n[1],0];if(e.length(i)>=1e-15){const t=e.normalize([],i);e.scale(r,t,e.dot(r,t)),n[0]=r[0],n[1]=r[1]}const a=e.cross([],n,t);if(e.len(a)<1e-15)return null;const o=Math.atan2(-a[1],a[0]);return _i(Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2]),o)}class bi{constructor(e,t){this.position=e,this.orientation=t}get position(){return this._position}set position(t){this._position=this._renderWorldCopies?function(t){if(!t)return;const n=Array.isArray(t)?new e.MercatorCoordinate(t[0],t[1],t[2]):t;return n.x=e.wrap(n.x,0,1),n}(t):t}lookAtPoint(t,n){if(this.orientation=null,!this.position)return;const i=this._elevation?this._elevation.getAtPointOrZero(e.MercatorCoordinate.fromLngLat(t)):0,r=this.position,a=e.MercatorCoordinate.fromLngLat(t,i),o=[a.x-r.x,a.y-r.y,a.z-r.z];n||(n=[0,0,1]),n[2]=Math.abs(n[2]),this.orientation=xi(o,n)}setPitchBearing(t,n){this.orientation=_i(e.degToRad(t),e.degToRad(-n))}}class wi{constructor(t,n){this._transform=e.identity([]),this._orientation=e.identity$1([]),n&&(this._orientation=n,vi(this._transform,this._orientation)),t&&yi(this._transform,t)}get mercatorPosition(){const t=this.position;return new e.MercatorCoordinate(t[0],t[1],t[2])}get position(){const e=mi(this._transform,3);return[e[0],e[1],e[2]]}set position(e){yi(this._transform,e)}get orientation(){return this._orientation}set orientation(e){this._orientation=e,vi(this._transform,this._orientation)}getPitchBearing(){const e=this.forward(),t=this.right();return{bearing:Math.atan2(-t[1],t[0]),pitch:Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2])}}setPitchBearing(e,t){this._orientation=_i(e,t),vi(this._transform,this._orientation)}forward(){const e=mi(this._transform,2);return[-e[0],-e[1],-e[2]]}up(){const e=mi(this._transform,1);return[-e[0],-e[1],-e[2]]}right(){const e=mi(this._transform,0);return[e[0],e[1],e[2]]}getCameraToWorld(t,n){const i=new Float64Array(16);return e.invert(i,this.getWorldToCamera(t,n)),i}getWorldToCameraPosition(t,n,i){const r=this.position;e.scale(r,r,-t);const a=new Float64Array(16);return e.fromScaling(a,[i,i,i]),e.translate(a,a,r),a[10]*=n,a}getWorldToCamera(t,n){const i=new Float64Array(16),r=new Float64Array(4),a=this.position;return e.conjugate(r,this._orientation),e.scale(a,a,-t),e.fromQuat(i,r),e.translate(i,i,a),i[1]*=-1,i[5]*=-1,i[9]*=-1,i[13]*=-1,i[8]*=n,i[9]*=n,i[10]*=n,i[11]*=n,i}getCameraToClipPerspective(t,n,i,r){const a=new Float64Array(16);return e.perspective(a,t,n,i,r),a}getDistanceToElevation(t){const n=0===t?0:e.mercatorZfromAltitude(t,this.position[1]),i=this.forward();return(n-this.position[2])/i[2]}clone(){return new wi([...this.position],[...this.orientation])}}class Si{constructor(t,n,i,r,a){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===a||a,this._minZoom=t||0,this._maxZoom=n||22,this._minPitch=null==i?0:i,this._maxPitch=null==r?60:r,this.setMaxBounds(),this.width=0,this.height=0,this._center=new e.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new fi,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._camera=new wi,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._horizonShift=.1}clone(){const e=new Si(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return e._elevation=this._elevation,e._centerAltitude=this._centerAltitude,e.tileSize=this.tileSize,e.latRange=this.latRange,e.width=this.width,e.height=this.height,e.cameraElevationReference=this.cameraElevationReference,e._center=this._center,e._setZoom(this.zoom),e._cameraZoom=this._cameraZoom,e.angle=this.angle,e._fov=this._fov,e._pitch=this._pitch,e._averageElevation=this._averageElevation,e._unmodified=this._unmodified,e._edgeInsets=this._edgeInsets.clone(),e._camera=this._camera.clone(),e._calcMatrices(),e.freezeTileCoverage=this.freezeTileCoverage,e}get elevation(){return this._elevation}set elevation(e){this._elevation!==e&&(this._elevation=e,e?this._updateCenterElevation()&&this._updateCameraOnTerrain():(this._cameraZoom=null,this._centerAltitude=0),this._calcMatrices())}updateElevation(e){this._terrainEnabled()&&null==this._cameraZoom&&this._updateCenterElevation()&&this._updateCameraOnTerrain(),e&&this._constrainCameraAltitude(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(e){void 0===e?e=!0:null===e&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const e=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get pixelsPerMeter(){return e.mercatorZfromAltitude(1,this.center.lat)*this.worldSize}get cameraPixelsPerMeter(){return e.mercatorZfromAltitude(1,this.center.lat)*this.cameraWorldSize}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new e.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const n=-e.wrap(t,-180,180)*Math.PI/180;var i;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=(i=new e.ARRAY_TYPE(4),e.ARRAY_TYPE!=Float32Array&&(i[1]=0,i[2]=0),i[0]=1,i[3]=1,i),function(e,t,n){var i=t[0],r=t[1],a=t[2],o=t[3],s=Math.sin(n),l=Math.cos(n);e[0]=i*l+a*s,e[1]=r*l+o*s,e[2]=i*-s+a*l,e[3]=r*-s+o*l}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const n=e.clamp(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(e){this._averageElevation=e,this._calcFogMatrices()}get zoom(){return this._zoom}set zoom(e){const t=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==t&&(this._unmodified=!1,this._setZoom(t),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._constrain(),this._calcMatrices())}_setZoom(e){this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom}_updateCenterElevation(){if(!this._elevation)return!1;const t=this._elevation.getAtPointOrZero(e.MercatorCoordinate.fromLngLat(this.center),-1);return-1===t?(this._cameraZoom=null,!1):(this._centerAltitude=t,!0)}_updateCameraOnTerrain(){const t=this.cameraToCenterDistance/this.worldSize,n=e.mercatorZfromAltitude(this._centerAltitude,this.center.lat);this._cameraZoom=this._zoomFromMercatorZ(n+t)}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,n=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],i=this.horizonLineFromTop();let r=0,a=0;for(let o=0;o<n.length;o++){const s=new e.pointGeometry(n[o][0]*this.width,i+n[o][1]*(this.height-i)),l=t.pointCoordinate(s);if(!l)continue;const c=1/Math.hypot(l[0]-this._camera.position[0],l[1]-this._camera.position[1]);r+=l[3]*c,a+=c}return 0===a?NaN:r/a}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCenterElevation()?this._updateCameraOnTerrain():this._cameraZoom=null:this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._cameraZoom||!this._elevation)return;const t=this._cameraZoom,n=this._elevation.getAtPointOrZero(e.MercatorCoordinate.fromLngLat(this.center)),i=e.mercatorZfromAltitude(n,this.center.lat),r=this._mercatorZfromZoom(t),a=this._mercatorZfromZoom(this._maxZoom),o=Math.max(r-i,a);this._setZoom(this._zoomFromMercatorZ(o))}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}computeZoomRelativeTo(t){const n=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let i;i=t.z<this._camera.position[2]?[n.x,n.y,n.z]:[t.x,t.y,t.z];const r=e.length(e.sub([],this._camera.position,i));return e.clamp(this._zoomFromMercatorZ(r),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height)return;if(!t.position&&!t.orientation)return;this._updateCameraState();let n=!1;if(t.orientation&&!e.exactEquals(t.orientation,this._camera.orientation)&&(n=this._setCameraOrientation(t.orientation)),t.position){const i=[t.position.x,t.position.y,t.position.z];e.exactEquals$1(i,this._camera.position)||(this._setCameraPosition(i),n=!0)}n&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,n=new bi;return n.position=new e.MercatorCoordinate(t[0],t[1],t[2]),n.orientation=this._camera.orientation,n._elevation=this.elevation,n._renderWorldCopies=this._renderWorldCopies,n}_setCameraOrientation(t){if(!e.length$1(t))return!1;e.normalize$1(t,t);const n=e.transformQuat([],[0,0,-1],t),i=e.transformQuat([],[0,-1,0],t);if(i[2]<0)return!1;const r=xi(n,i);return!!r&&(this._camera.orientation=r,!0)}_setCameraPosition(t){const n=this.zoomScale(this.minZoom)*this.tileSize,i=this.zoomScale(this.maxZoom)*this.tileSize,r=this.cameraToCenterDistance;t[2]=e.clamp(t[2],r/i,r/n),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,t,n){this._unmodified=!1,this._edgeInsets.interpolate(e,t,n),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const t=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,t)}getVisibleUnwrappedCoordinates(t){const n=[new e.UnwrappedTileID(0,t)];if(this._renderWorldCopies){const i=this.pointCoordinate(new e.pointGeometry(0,0)),r=this.pointCoordinate(new e.pointGeometry(this.width,0)),a=this.pointCoordinate(new e.pointGeometry(this.width,this.height)),o=this.pointCoordinate(new e.pointGeometry(0,this.height)),s=Math.floor(Math.min(i.x,r.x,a.x,o.x)),l=Math.floor(Math.max(i.x,r.x,a.x,o.x)),c=1;for(let u=s-c;u<=l+c;u++)0!==u&&n.push(new e.UnwrappedTileID(u,t))}return n}coveringTiles(t){let n=this.coveringZoomLevel(t);const i=n,r=this.elevation&&!t.isTerrainDEM;if(void 0!==t.minzoom&&n<t.minzoom)return[];void 0!==t.maxzoom&&n>t.maxzoom&&(n=t.maxzoom);const a=e.MercatorCoordinate.fromLngLat(this.center),o=1<<n,s=[o*a.x,o*a.y,0],l=p.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n),c=this.pointCoordinate(this.getCameraPoint()),u=o*e.mercatorZfromAltitude(1,this.center.lat),h=this._camera.position[2]/e.mercatorZfromAltitude(1,this.center.lat),d=[o*c.x,o*c.y,h],m=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),g=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation?n:0,v=t.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,y=t.isTerrainDEM?-v:this._elevation?this._elevation.getMinElevationBelowMSL():0,_=e=>({aabb:new f([e*o,0,y],[(e+1)*o,o,v]),zoom:0,x:0,y:0,wrap:e,fullyVisible:!1}),x=[],b=[],w=n,S=t.reparseOverscaled?i:n,T=e=>{if(!this._elevation||!e.tileID)return;const t=this._elevation.getMinMaxForTile(e.tileID),n=e.aabb;t?(n.min[2]=t.min,n.max[2]=t.max,n.center[2]=(n.min[2]+n.max[2])/2):(e.shouldSplit=k(e),e.shouldSplit||(n.min[2]=n.max[2]=n.center[2]=this._centerAltitude))},E=e=>e*e,M=E((h-this._centerAltitude)*u),k=e=>{if(e.zoom<g)return!0;if(e.zoom===w)return!1;if(null!=e.shouldSplit)return e.shouldSplit;const t=e.aabb.distanceX(d),n=e.aabb.distanceY(d);let i=M;r&&(i=E(e.aabb.distanceZ(d)*u));const a=t*t+n*n+i;return a<E((1<<w-e.zoom)*m*((e,t)=>{if(t*E(.707)<e)return 1;const n=Math.sqrt(t/e);return n/(1.4144271570014144+(Math.pow(1.1,n-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(i,M),a))};if(this._renderWorldCopies)for(let e=1;e<=3;e++)x.push(_(-e)),x.push(_(e));for(x.push(_(0));x.length>0;){const i=x.pop(),a=i.x,o=i.y;let c=i.fullyVisible;if(!c){const e=i.aabb.intersects(l);if(0===e)continue;c=2===e}if(i.zoom!==w&&k(i))for(let t=0;t<4;t++){const n=(a<<1)+t%2,s=(o<<1)+(t>>1),l={aabb:i.aabb.quadrant(t),zoom:i.zoom+1,x:n,y:s,wrap:i.wrap,fullyVisible:c,tileID:void 0,shouldSplit:void 0};r&&(l.tileID=new e.OverscaledTileID(i.zoom+1===w?S:i.zoom+1,i.wrap,i.zoom+1,n,s),T(l)),x.push(l)}else{const r=i.zoom===w?S:i.zoom;if(t.minzoom&&t.minzoom>r)continue;const l=s[0]-(.5+a+(i.wrap<<i.zoom))*(1<<n-i.zoom),c=s[1]-.5-o,u=i.tileID?i.tileID:new e.OverscaledTileID(r,i.wrap,i.zoom,a,o);b.push({tileID:u,distanceSq:l*l+c*c})}}if(this.fogCullDistSq){const t=this.fogCullDistSq;b.splice(0,b.length,...b.filter((n=>{const i=[0,0,0,1],a=[e.EXTENT,e.EXTENT,0,1],o=this.calculateFogTileMatrix(n.tileID.toUnwrapped());e.transformMat4(i,i,o),e.transformMat4(a,a,o);const s=e.getAABBPointSquareDist(i,a);if(0===s)return!0;let l=!1;const c=this.horizonLineFromTop();if(s>t&&0!==c){const t=this.calculateProjMatrix(n.tileID.toUnwrapped());let i;r&&this._elevation&&(i=this._elevation.getMinMaxForTile(n.tileID)),i||(i={min:y,max:v});const a=e.furthestTileCorner(this.bearing),o=[a[0]*e.EXTENT,a[1]*e.EXTENT,i.max];e.transformMat4$1(o,o,t),l=(1-o[1])*this.height*.5<c}return s<t||l})))}return b.sort(((e,t)=>e.distanceSq-t.distanceSq)).map((e=>e.tileID))}resize(e,t){this.width=e,this.height=t,this.pixelsToGLUnits=[2/e,-2/t],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(t){const n=e.clamp(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new e.pointGeometry(e.mercatorXfromLng(t.lng)*this.worldSize,e.mercatorYfromLat(n)*this.worldSize)}unproject(t){return new e.MercatorCoordinate(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}setLocationAtPoint(t,n){const i=this.pointCoordinate(n),r=this.pointCoordinate(this.centerPoint),a=this.locationCoordinate(t),o=new e.MercatorCoordinate(a.x-(i.x-r.x),a.y-(i.y-r.y));this.center=this.coordinateLocation(o),this._renderWorldCopies&&(this.center=this.center.wrap())}setLocation(e){this.center=this.coordinateLocation(e),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(e){return this._coordinatePoint(this.locationCoordinate(e),!1)}locationPoint3D(e){return this._coordinatePoint(this.locationCoordinate(e),!0)}pointLocation(e){return this.coordinateLocation(this.pointCoordinate(e))}pointLocation3D(e){return this.coordinateLocation(this.pointCoordinate3D(e))}locationCoordinate(t){return e.MercatorCoordinate.fromLngLat(t)}coordinateLocation(e){return e.toLngLat()}pointRayIntersection(t,n){const i=null!=n?n:this._centerAltitude,r=[t.x,t.y,0,1],a=[t.x,t.y,1,1];e.transformMat4(r,r,this.pixelMatrixInverse),e.transformMat4(a,a,this.pixelMatrixInverse);const o=a[3];e.scale$2(r,r,1/r[3]),e.scale$2(a,a,1/o);const s=r[2],l=a[2];return{p0:r,p1:a,t:s===l?0:(i-s)/(l-s)}}screenPointToMercatorRay(t){const n=[t.x,t.y,0,1],i=[t.x,t.y,1,1];return e.transformMat4(n,n,this.pixelMatrixInverse),e.transformMat4(i,i,this.pixelMatrixInverse),e.scale$2(n,n,1/n[3]),e.scale$2(i,i,1/i[3]),n[2]=e.mercatorZfromAltitude(n[2],this._center.lat)*this.worldSize,i[2]=e.mercatorZfromAltitude(i[2],this._center.lat)*this.worldSize,e.scale$2(n,n,1/this.worldSize),e.scale$2(i,i,1/this.worldSize),new d([n[0],n[1],n[2]],e.normalize([],e.sub([],i,n)))}rayIntersectionCoordinate(t){const{p0:n,p1:i,t:r}=t,a=e.mercatorZfromAltitude(n[2],this._center.lat),o=e.mercatorZfromAltitude(i[2],this._center.lat);return new e.MercatorCoordinate(e.number(n[0],i[0],r)/this.worldSize,e.number(n[1],i[1],r)/this.worldSize,e.number(a,o,r))}pointCoordinate(t){const n=this.horizonLineFromTop(!1),i=new e.pointGeometry(t.x,Math.max(n,t.y));return this.rayIntersectionCoordinate(this.pointRayIntersection(i))}pointCoordinate3D(t){if(!this.elevation)return this.pointCoordinate(t);const n=this.elevation;let i=this.elevation.pointCoordinate(t);if(i)return new e.MercatorCoordinate(i[0],i[1],i[2]);let r=0,a=this.horizonLineFromTop();if(t.y>a)return this.pointCoordinate(t);const o=.02*a,s=t.clone();for(let l=0;l<10&&a-r>o;l++){s.y=e.number(r,a,.66);const t=n.pointCoordinate(s);t?(a=s.y,i=t):r=s.y}return i?new e.MercatorCoordinate(i[0],i[1],i[2]):this.pointCoordinate(t)}isPointAboveHorizon(e){if(this.elevation)return!this.elevation.pointCoordinate(e);{const t=this.horizonLineFromTop();return e.y<t}}_coordinatePoint(t,n){const i=n&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,r=[t.x*this.worldSize,t.y*this.worldSize,i+t.toAltitude(),1];return e.transformMat4(r,r,this.pixelMatrix),r[3]>0?new e.pointGeometry(r[0]/r[3],r[1]/r[3]):new e.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}getBounds(){return this._terrainEnabled()?this._getBounds3D():(new e.LngLatBounds).extend(this.pointLocation(new e.pointGeometry(this._edgeInsets.left,this._edgeInsets.top))).extend(this.pointLocation(new e.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top))).extend(this.pointLocation(new e.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom))).extend(this.pointLocation(new e.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom)))}_getBounds3D(){const t=this.elevation,n=t.visibleDemTiles.reduce(((e,t)=>{if(t.dem){const n=t.dem.tree;e.min=Math.min(e.min,n.minimums[0]),e.max=Math.max(e.max,n.maximums[0])}return e}),{min:Number.MAX_VALUE,max:0});n.min*=t.exaggeration(),n.max*=t.exaggeration();const i=this.horizonLineFromTop();return[new e.pointGeometry(0,i),new e.pointGeometry(this.width,i),new e.pointGeometry(this.width,this.height),new e.pointGeometry(0,this.height)].reduce(((e,t)=>e.extend(this.coordinateLocation(this.rayIntersectionCoordinate(this.pointRayIntersection(t,n.min)))).extend(this.coordinateLocation(this.rayIntersectionCoordinate(this.pointRayIntersection(t,n.max))))),new e.LngLatBounds)}horizonLineFromTop(e=!0){const t=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,n=this.height/2-.97*t;return e?Math.max(0,n):n}getMaxBounds(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new e.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}setMaxBounds(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(t,n){const i=t.canonical,r=n/this.zoomScale(i.z),a=i.x+Math.pow(2,i.z)*t.wrap,o=e.identity(new Float64Array(16));return e.translate(o,o,[a*r,i.y*r,0]),e.scale$1(o,o,[r/e.EXTENT,r/e.EXTENT,1]),o}calculateFogTileMatrix(t){const n=t.key,i=this._fogTileMatrixCache;if(i[n])return i[n];const r=this.calculatePosMatrix(t,this.cameraWorldSize);return e.multiply(r,this.worldToFogMatrix,r),i[n]=new Float32Array(r),i[n]}calculateProjMatrix(t,n=!1){const i=t.key,r=n?this._alignedProjMatrixCache:this._projMatrixCache;if(r[i])return r[i];const a=this.calculatePosMatrix(t,this.worldSize);return e.multiply(a,n?this.alignedProjMatrix:this.projMatrix,a),r[i]=new Float32Array(a),r[i]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const t=this._elevation;this._updateCameraState();const n=this._camera.position,i=this._camera.forward();if(n[2]<=0||i[2]>=0)return;const r=e.mercatorZfromAltitude(1,this._center.lat);n[2]/=r,i[2]/=r,e.normalize(i,i);const a=t.raycast(n,i,t.exaggeration());if(a){const t=e.scaleAndAdd([],n,i,a),r=new e.MercatorCoordinate(t[0],t[1],e.mercatorZfromAltitude(t[2],e.latFromMercatorY(t[1]))),o=this._camera.position,s=r.z+e.length([r.x-o[0],r.y-o[1],r.z-o[2]]);this._cameraZoom=this._zoomFromMercatorZ(s),this._centerAltitude=r.toAltitude(),this._center=r.toLngLat(),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const t=this._elevation;this._updateCameraState();const n=t.getAtPointOrZero(this._camera.mercatorPosition),i=this._minimumHeightOverTerrain()*Math.cos(e.degToRad(this._maxPitch)),r=e.mercatorZfromAltitude(n,this._center.lat),a=this._camera.position[2]-r;if(a<i){const t=e.MercatorCoordinate.fromLngLat(this._center,this._centerAltitude),n=this._camera.mercatorPosition,r=[t.x-n.x,t.y-n.y,t.z-n.z],o=e.length(r);r[2]-=i-a;const s=e.length(r);if(0===s)return;e.scale(r,r,o/s),this._camera.position=[t.x-r[0],t.y-r[1],t.z-r[2]],this._camera.orientation=xi(r,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let t,n,i,r,a=-90,o=90,s=-180,l=180;const c=this.size,u=this._unmodified;if(this.latRange){const n=this.latRange;a=e.mercatorYfromLat(n[1])*this.worldSize,o=e.mercatorYfromLat(n[0])*this.worldSize,t=o-a<c.y?c.y/(o-a):0}if(this.lngRange){const t=this.lngRange;s=e.mercatorXfromLng(t[0])*this.worldSize,l=e.mercatorXfromLng(t[1])*this.worldSize,n=l-s<c.x?c.x/(l-s):0}const h=this.point,d=Math.max(n||0,t||0);if(d)return this.center=this.unproject(new e.pointGeometry(n?(l+s)/2:h.x,t?(o+a)/2:h.y)),this.zoom+=this.scaleZoom(d),this._unmodified=u,void(this._constraining=!1);if(this.latRange){const e=h.y,t=c.y/2;e-t<a&&(r=a+t),e+t>o&&(r=o-t)}if(this.lngRange){const e=h.x,t=c.x/2;e-t<s&&(i=s+t),e+t>l&&(i=l-t)}void 0===i&&void 0===r||(this.center=this.unproject(new e.pointGeometry(void 0!==i?i:h.x,void 0!==r?r:h.y))),this._constrainCameraAltitude(),this._unmodified=u,this._constraining=!1}_minZoomForBounds(){const t=(e,t)=>Math.log2(e/(this.tileSize*Math.abs(t[1]-t[0])));let n=0;if(this.latRange){const i=this.latRange;n=t(this.height,[e.mercatorYfromLat(i[0]),e.mercatorYfromLat(i[1])])}let i=0;if(this.lngRange){const n=this.lngRange;i=t(this.width,[e.mercatorXfromLng(n[0]),e.mercatorXfromLng(n[1])])}return Math.max(n,i)}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;const n=this.pixelsPerMeter;this._updateCameraState();const i=Math.PI/2+this._pitch,r=this.fovAboveCenter,a=this.elevation?this.elevation.getMinElevationBelowMSL()*n:0,o=(this._camera.position[2]*this.worldSize-a)/Math.cos(this._pitch),s=Math.sin(r)*o/Math.sin(e.clamp(Math.PI-i-r,.01,Math.PI-.01)),l=this.point,c=l.x,u=l.y,h=Math.cos(Math.PI/2-this._pitch)*s+o,d=Math.min(1.01*h,o*(1/this._horizonShift)),p=this.height/50,f=this._camera.getWorldToCamera(this.worldSize,n),m=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,p,d);m[8]=2*-t.x/this.width,m[9]=2*t.y/this.height;let g=e.mul$1([],m,f);this.mercatorMatrix=e.scale$1([],g,[this.worldSize,this.worldSize,this.worldSize/n]),this.projMatrix=g,this.invProjMatrix=e.invert(new Float64Array(16),this.projMatrix);const v=new Float32Array(16);e.identity(v),e.scale$1(v,v,[1,-1,1]),e.rotateX(v,v,this._pitch),e.rotateZ(v,v,this.angle);const y=e.perspective(new Float32Array(16),this._fov,this.width/this.height,p,d),_=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;y[8]=2*-t.x/this.width,y[9]=2*(t.y+_)/this.height,this.skyboxMatrix=e.multiply(v,y,v);const x=this.width%2/2,b=this.height%2/2,w=Math.cos(this.angle),S=Math.sin(this.angle),T=c-Math.round(c)+w*x+S*b,E=u-Math.round(u)+w*b+S*x,M=new Float64Array(g);if(e.translate(M,M,[T>.5?T-1:T,E>.5?E-1:E,0]),this.alignedProjMatrix=M,g=e.create$1(),e.scale$1(g,g,[this.width/2,-this.height/2,1]),e.translate(g,g,[1,-1,0]),this.labelPlaneMatrix=g,g=e.create$1(),e.scale$1(g,g,[1,-1,1]),e.translate(g,g,[-1,-1,0]),e.scale$1(g,g,[2/this.width,2/this.height,1]),this.glCoordMatrix=g,this.pixelMatrix=e.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),g=e.invert(new Float64Array(16),this.pixelMatrix),!g)throw new Error("failed to invert matrix");this.pixelMatrixInverse=g,this._projMatrixCache={},this._alignedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSize,n=this.cameraPixelsPerMeter,i=this._camera.position,r=1/this.height,a=[t,t,n];e.scale(a,a,r),e.scale(i,i,-1),e.multiply$1(i,i,a);const o=e.create$1();e.translate(o,o,i),e.scale$1(o,o,a),this.mercatorFogMatrix=o,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,n,r)}_updateCameraState(){if(!this.height)return;this._camera.setPitchBearing(this._pitch,this.angle);const t=this._camera.forward(),n=this.cameraToCenterDistance,i=this.point,r=this._mercatorZfromZoom(this._cameraZoom?this._cameraZoom:this._zoom)-e.mercatorZfromAltitude(this._centerAltitude,this.center.lat),a=this.cameraToCenterDistance/r;this._camera.position=[i.x/this.worldSize-t[0]*n/a,i.y/this.worldSize-t[1]*n/a,e.mercatorZfromAltitude(this._centerAltitude,this._center.lat)+-t[2]*n/a]}_translateCameraConstrained(t){const n=this._maxCameraBoundsDistance()*Math.cos(this._pitch),i=t[2];let r=1;i>0&&(r=Math.min((n-this._camera.position[2])/i,1)),this._camera.position=e.scaleAndAdd([],this._camera.position,t,r),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,n=this._camera.forward(),{pitch:i,bearing:r}=this._camera.getPitchBearing(),a=e.mercatorZfromAltitude(this._centerAltitude,this.center.lat),o=this._mercatorZfromZoom(this._maxZoom)*Math.cos(e.degToRad(this._maxPitch)),s=Math.max((t[2]-a)/Math.cos(i),o),l=this._zoomFromMercatorZ(s);e.scaleAndAdd(t,t,n,s),this._pitch=e.clamp(i,e.degToRad(this.minPitch),e.degToRad(this.maxPitch)),this.angle=e.wrap(r,-Math.PI,Math.PI),this._setZoom(e.clamp(l,this._minZoom,this._maxZoom)),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._center=new e.MercatorCoordinate(t[0],t[1],t[2]).toLngLat(),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(e){return Math.pow(2,e)*this.tileSize}_mercatorZfromZoom(e){return this.cameraToCenterDistance/this._worldSizeFromZoom(e)}_minimumHeightOverTerrain(){const e=Math.min((null!=this._cameraZoom?this._cameraZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(e)}_zoomFromMercatorZ(e){return this.scaleZoom(this.cameraToCenterDistance/(e*this.tileSize))}_terrainEnabled(){return!!this._elevation}isHorizonVisibleForPoints(t,n){const i=Math.min(t.x,n.x),r=Math.max(t.x,n.x),a=Math.min(t.y,n.y),o=Math.max(t.y,n.y),s=[new e.pointGeometry(i,a),new e.pointGeometry(r,o),new e.pointGeometry(i,o),new e.pointGeometry(r,a)],l=this._renderWorldCopies?-3:0,c=this._renderWorldCopies?4:1;for(const e of s){const t=this.pointRayIntersection(e);if(t.t<0)return!0;const n=this.rayIntersectionCoordinate(t);if(n.x<l||n.y<0||n.x>c||n.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+e.radToDeg(this.fovAboveCenter)>88||this.isHorizonVisibleForPoints(new e.pointGeometry(0,0),new e.pointGeometry(this.width,this.height))}zoomDeltaToMovement(t,n){const i=e.length(e.sub([],this._camera.position,t)),r=this._zoomFromMercatorZ(i)+n;return i-this._mercatorZfromZoom(r)}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new e.pointGeometry(0,t))}}class Ti{constructor(t){this._hashName=t&&encodeURIComponent(t),e.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(e,t){let n=!1,i=null;const r=()=>{i=null,n&&(e(),i=setTimeout(r,300),n=!1)};return()=>(n=!0,i||r(),i)}(this._updateHashUnthrottled.bind(this))}addTo(t){return this._map=t,e.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return e.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const n=this._map.getCenter(),i=Math.round(100*this._map.getZoom())/100,r=Math.ceil((i*Math.LN2+Math.log(512/360/.5))/Math.LN10),a=Math.pow(10,r),o=Math.round(n.lng*a)/a,s=Math.round(n.lat*a)/a,l=this._map.getBearing(),c=this._map.getPitch();let u="";if(u+=t?`/${o}/${s}/${i}`:`${i}/${s}/${o}`,(l||c)&&(u+="/"+Math.round(10*l)/10),c&&(u+=`/${Math.round(c)}`),this._hashName){const t=this._hashName;let n=!1;const i=e.window.location.hash.slice(1).split("&").map((e=>{const i=e.split("=")[0];return i===t?(n=!0,`${i}=${u}`):e})).filter((e=>e));return n||i.push(`${t}=${u}`),`#${i.join("&")}`}return`#${u}`}_getCurrentHash(){const t=e.window.location.hash.replace("#","");if(this._hashName){let e;return t.split("&").map((e=>e.split("="))).forEach((t=>{t[0]===this._hashName&&(e=t)})),(e&&e[1]||"").split("/")}return t.split("/")}_onHashChange(){const e=this._getCurrentHash();if(e.length>=3&&!e.some((e=>isNaN(e)))){const t=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(e[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+e[2],+e[1]],zoom:+e[0],bearing:t,pitch:+(e[4]||0)}),!0}return!1}_updateHashUnthrottled(){const t=e.window.location.href.replace(/(#.+)?$/,this.getHashString());e.window.history.replaceState(e.window.history.state,null,t)}}const Ei={linearity:.3,easing:e.bezier(0,0,.3,1)},Mi=e.extend({deceleration:2500,maxSpeed:1400},Ei),ki=e.extend({deceleration:20,maxSpeed:1400},Ei),Ai=e.extend({deceleration:1e3,maxSpeed:360},Ei),Ci=e.extend({deceleration:1e3,maxSpeed:90},Ei);class Pi{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:e.exported.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,n=e.exported.now();for(;t.length>0&&n-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const n={zoom:0,bearing:0,pitch:0,pan:new e.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:e}of this._inertiaBuffer)n.zoom+=e.zoomDelta||0,n.bearing+=e.bearingDelta||0,n.pitch+=e.pitchDelta||0,e.panDelta&&n.pan._add(e.panDelta),e.around&&(n.around=e.around),e.pinchAround&&(n.pinchAround=e.pinchAround);const i=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,r={};if(n.pan.mag()){const a=Ii(n.pan.mag(),i,e.extend({},Mi,t||{}));r.offset=n.pan.mult(a.amount/n.pan.mag()),r.center=this._map.transform.center,Li(r,a)}if(n.zoom){const e=Ii(n.zoom,i,ki);r.zoom=this._map.transform.zoom+e.amount,Li(r,e)}if(n.bearing){const t=Ii(n.bearing,i,Ai);r.bearing=this._map.transform.bearing+e.clamp(t.amount,-179,179),Li(r,t)}if(n.pitch){const e=Ii(n.pitch,i,Ci);r.pitch=this._map.transform.pitch+e.amount,Li(r,e)}if(r.zoom||r.bearing){const e=void 0===n.pinchAround?n.around:n.pinchAround;r.around=e?this._map.unproject(e):this._map.getCenter()}return this.clear(),e.extend(r,{noMoveStart:!0})}}function Li(e,t){(!e.duration||e.duration<t.duration)&&(e.duration=t.duration,e.easing=t.easing)}function Ii(t,n,i){const{maxSpeed:r,linearity:a,deceleration:o}=i,s=e.clamp(t*a/(n/1e3),-r,r),l=Math.abs(s)/(o*a);return{easing:i.easing,duration:1e3*l,amount:s*(l/2)}}class Ri extends e.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,i,r={}){const o=a.mousePos(n.getCanvasContainer(),i),s=n.unproject(o);super(t,e.extend({point:o,lngLat:s,originalEvent:i},r)),this._defaultPrevented=!1,this.target=n}}class zi extends e.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,i){const r="touchend"===t?i.changedTouches:i.touches,o=a.touchPos(n.getCanvasContainer(),r),s=o.map((e=>n.unproject(e))),l=o.reduce(((e,t,n,i)=>e.add(t.div(i.length))),new e.pointGeometry(0,0));super(t,{points:o,point:l,lngLats:s,lngLat:n.unproject(l),originalEvent:i}),this._defaultPrevented=!1}}class Di extends e.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,t,n){super(e,{originalEvent:n}),this._defaultPrevented=!1}}class Oi{constructor(e,t){this._map=e,this._clickTolerance=t.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new Di(e.type,this._map,e))}mousedown(e,t){return this._mousedownPos=t,this._firePreventable(new Ri(e.type,this._map,e))}mouseup(e){this._map.fire(new Ri(e.type,this._map,e))}click(e,t){this._mousedownPos&&this._mousedownPos.dist(t)>=this._clickTolerance||this._map.fire(new Ri(e.type,this._map,e))}dblclick(e){return this._firePreventable(new Ri(e.type,this._map,e))}mouseover(e){this._map.fire(new Ri(e.type,this._map,e))}mouseout(e){this._map.fire(new Ri(e.type,this._map,e))}touchstart(e){return this._firePreventable(new zi(e.type,this._map,e))}touchmove(e){this._map.fire(new zi(e.type,this._map,e))}touchend(e){this._map.fire(new zi(e.type,this._map,e))}touchcancel(e){this._map.fire(new zi(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Bi{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(e){this._map.fire(new Ri(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ri("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._map.fire(new Ri(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Fi{constructor(e,t){this._map=e,this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=t.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,t){this.isEnabled()&&e.shiftKey&&0===e.button&&(a.disableDrag(),this._startPos=this._lastPos=t,this._active=!0)}mousemoveWindow(e,t){if(!this._active)return;const n=t;if(this._lastPos.equals(n)||!this._box&&n.dist(this._startPos)<this._clickTolerance)return;const i=this._startPos;this._lastPos=n,this._box||(this._box=a.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",e));const r=Math.min(i.x,n.x),o=Math.max(i.x,n.x),s=Math.min(i.y,n.y),l=Math.max(i.y,n.y);this._map._requestDomTask((()=>{this._box&&(a.setTransform(this._box,`translate(${r}px,${s}px)`),this._box.style.width=o-r+"px",this._box.style.height=l-s+"px")}))}mouseupWindow(t,n){if(!this._active)return;if(0!==t.button)return;const i=this._startPos,r=n;if(this.reset(),a.suppressClick(),i.x!==r.x||i.y!==r.y)return this._map.fire(new e.Event("boxzoomend",{originalEvent:t})),{cameraAnimation:e=>e.fitScreenCoordinates(i,r,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}keydown(e){this._active&&27===e.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(a.remove(this._box),this._box=null),a.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,n){return this._map.fire(new e.Event(t,{originalEvent:n}))}}function Ni(e,t){const n={};for(let i=0;i<e.length;i++)n[e[i].identifier]=t[i];return n}class Ui{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,n,i){(this.centroid||i.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=t.timeStamp),i.length===this.numTouches&&(this.centroid=function(t){const n=new e.pointGeometry(0,0);for(const e of t)n._add(e);return n.div(t.length)}(n),this.touches=Ni(i,n)))}touchmove(e,t,n){if(this.aborted||!this.centroid)return;const i=Ni(n,t);for(const r in this.touches){const e=this.touches[r],t=i[r];(!t||t.dist(e)>30)&&(this.aborted=!0)}}touchend(e,t,n){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),0===n.length){const e=!this.aborted&&this.centroid;if(this.reset(),e)return e}}}class Vi{constructor(e){this.singleTap=new Ui(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,t,n){this.singleTap.touchstart(e,t,n)}touchmove(e,t,n){this.singleTap.touchmove(e,t,n)}touchend(e,t,n){const i=this.singleTap.touchend(e,t,n);if(i){const t=e.timeStamp-this.lastTime<500,n=!this.lastTap||this.lastTap.dist(i)<30;if(t&&n||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=i,this.count===this.numTaps)return this.reset(),i}}}class ji{constructor(){this._zoomIn=new Vi({numTouches:1,numTaps:2}),this._zoomOut=new Vi({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,t,n){this._zoomIn.touchstart(e,t,n),this._zoomOut.touchstart(e,t,n)}touchmove(e,t,n){this._zoomIn.touchmove(e,t,n),this._zoomOut.touchmove(e,t,n)}touchend(e,t,n){const i=this._zoomIn.touchend(e,t,n),r=this._zoomOut.touchend(e,t,n);return i?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:t.getZoom()+1,around:t.unproject(i)},{originalEvent:e})}):r?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:t.getZoom()-1,around:t.unproject(r)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Gi={0:1,2:2};class Hi{constructor(e){this.reset(),this._clickTolerance=e.clickTolerance||1}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(e,t){return!1}_move(e,t){return{}}mousedown(e,t){if(this._lastPoint)return;const n=a.mouseButton(e);this._correctButton(e,n)&&(this._lastPoint=t,this._eventButton=n)}mousemoveWindow(e,t){const n=this._lastPoint;if(n)if(e.preventDefault(),function(e,t){const n=Gi[t];return void 0===e.buttons||(e.buttons&n)!==n}(e,this._eventButton))this.reset();else if(this._moved||!(t.dist(n)<this._clickTolerance))return this._moved=!0,this._lastPoint=t,this._move(n,t)}mouseupWindow(e){this._lastPoint&&a.mouseButton(e)===this._eventButton&&(this._moved&&a.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Wi extends Hi{mousedown(e,t){super.mousedown(e,t),this._lastPoint&&(this._active=!0)}_correctButton(e,t){return 0===t&&!e.ctrlKey}_move(e,t){return{around:t,panDelta:t.sub(e)}}}class qi extends Hi{_correctButton(e,t){return 0===t&&e.ctrlKey||2===t}_move(e,t){const n=.8*(t.x-e.x);if(n)return this._active=!0,{bearingDelta:n}}contextmenu(e){e.preventDefault()}}class Zi extends Hi{_correctButton(e,t){return 0===t&&e.ctrlKey||2===t}_move(e,t){const n=-.5*(t.y-e.y);if(n)return this._active=!0,{pitchDelta:n}}contextmenu(e){e.preventDefault()}}class $i{constructor(e){this._minTouches=1,this._clickTolerance=e.clickTolerance||1,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new e.pointGeometry(0,0)}touchstart(e,t,n){return this._calculateTransform(e,t,n)}touchmove(e,t,n){if(this._active&&!(n.length<this._minTouches))return e.preventDefault(),this._calculateTransform(e,t,n)}touchend(e,t,n){this._calculateTransform(e,t,n),this._active&&n.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,n,i){i.length>0&&(this._active=!0);const r=Ni(i,n),a=new e.pointGeometry(0,0),o=new e.pointGeometry(0,0);let s=0;for(const e in r){const t=r[e],n=this._touches[e];n&&(a._add(t),o._add(t.sub(n)),s++,r[e]=t)}if(this._touches=r,s<this._minTouches||!o.mag())return;const l=o.div(s);return this._sum._add(l),this._sum.mag()<this._clickTolerance?void 0:{around:a.div(s),panDelta:l}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Xi{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(e){}_move(e,t,n){return{}}touchstart(e,t,n){this._firstTwoTouches||n.length<2||(this._firstTwoTouches=[n[0].identifier,n[1].identifier],this._start([t[0],t[1]]))}touchmove(e,t,n){if(!this._firstTwoTouches)return;e.preventDefault();const[i,r]=this._firstTwoTouches,a=Yi(n,t,i),o=Yi(n,t,r);if(!a||!o)return;const s=this._aroundCenter?null:a.add(o).div(2);return this._move([a,o],s,e)}touchend(e,t,n){if(!this._firstTwoTouches)return;const[i,r]=this._firstTwoTouches,o=Yi(n,t,i),s=Yi(n,t,r);o&&s||(this._active&&a.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Yi(e,t,n){for(let i=0;i<e.length;i++)if(e[i].identifier===n)return t[i]}function Ji(e,t){return Math.log(e/t)/Math.LN2}class Ki extends Xi{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,t){const n=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(Ji(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ji(this._distance,n),pinchAround:t}}}function Qi(e,t){return 180*e.angleWith(t)/Math.PI}class er extends Xi{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,t){const n=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Qi(this._vector,n),pinchAround:t}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const t=25/(Math.PI*this._minDiameter)*360,n=Qi(e,this._startVector);return Math.abs(n)<t}}function tr(e){return Math.abs(e.y)>Math.abs(e.x)}class nr extends Xi{reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(e){this._lastPoints=e,tr(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,t,n){const i=e[0].sub(this._lastPoints[0]),r=e[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(i,r,n.timeStamp),this._valid)return this._lastPoints=e,this._active=!0,{pitchDelta:(i.y+r.y)/2*-.5}}gestureBeginsVertically(e,t,n){if(void 0!==this._valid)return this._valid;const i=e.mag()>=2,r=t.mag()>=2;if(!i&&!r)return;if(!i||!r)return void 0===this._firstMove&&(this._firstMove=n),n-this._firstMove<100&&void 0;const a=e.y>0==t.y>0;return tr(e)&&tr(t)&&a}}const ir={panStep:100,bearingStep:15,pitchStep:10};class rr{constructor(){const e=ir;this._panStep=e.panStep,this._bearingStep=e.bearingStep,this._pitchStep=e.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let t=0,n=0,i=0,r=0,a=0;switch(e.keyCode){case 61:case 107:case 171:case 187:t=1;break;case 189:case 109:case 173:t=-1;break;case 37:e.shiftKey?n=-1:(e.preventDefault(),r=-1);break;case 39:e.shiftKey?n=1:(e.preventDefault(),r=1);break;case 38:e.shiftKey?i=1:(e.preventDefault(),a=-1);break;case 40:e.shiftKey?i=-1:(e.preventDefault(),a=1);break;default:return}return this._rotationDisabled&&(n=0,i=0),{cameraAnimation:o=>{const s=o.getZoom();o.easeTo({duration:300,easeId:"keyboardHandler",easing:ar,zoom:t?Math.round(s)+t*(e.shiftKey?2:1):s,bearing:o.getBearing()+n*this._bearingStep,pitch:o.getPitch()+i*this._pitchStep,offset:[-r*this._panStep,-a*this._panStep],center:o.getCenter()},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function ar(e){return e*(2-e)}const or=4.000244140625;class sr{constructor(t,n){this._map=t,this._el=t.getCanvasContainer(),this._handler=n,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,e.bindAll(["_onTimeout"],this)}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=e&&"center"===e.around)}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled())return;let n=t.deltaMode===e.window.WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const i=e.exported.now(),r=i-(this._lastWheelEventTime||0);this._lastWheelEventTime=i,0!==n&&n%or==0?this._type="wheel":0!==n&&Math.abs(n)<4?this._type="trackpad":r>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(r*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),t.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=t,this._delta-=n,this._active||this._start(t)),t.preventDefault()}_onTimeout(e){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(e)}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const t=a.mousePos(this._el,e);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:t,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId)return;if(this._frameId=null,!this.isActive())return;const t=this._map.transform,n=()=>t._terrainEnabled()?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(0!==this._delta){const e="wheel"===this._type&&Math.abs(this._delta)>or?this._wheelZoomRate:this._defaultZoomRate;let i=2/(1+Math.exp(-Math.abs(this._delta*e)));this._delta<0&&0!==i&&(i=1/i);const r=n(),a=Math.pow(2,r),o="number"==typeof this._targetZoom?t.zoomScale(this._targetZoom):a;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(o*i))),"wheel"===this._type&&(this._startZoom=n(),this._easing=this._smoothOutEasing(200)),this._delta=0}const i="number"==typeof this._targetZoom?this._targetZoom:n(),r=this._startZoom,a=this._easing;let o,s=!1;if("wheel"===this._type&&r&&a){const t=Math.min((e.exported.now()-this._lastWheelEventTime)/200,1),n=a(t);o=e.number(r,i,n),t<1?this._frameId||(this._frameId=!0):s=!0}else o=i,s=!0;return this._active=!0,s&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!s,zoomDelta:o-n(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let n=e.ease;if(this._prevEase){const t=this._prevEase,i=(e.exported.now()-t.start)/t.duration,r=t.easing(i+.01)-t.easing(i),a=.27/Math.sqrt(r*r+1e-4)*.01,o=Math.sqrt(.0729-a*a);n=e.bezier(a,o,.25,1)}return this._prevEase={start:e.exported.now(),duration:t,easing:n},n}reset(){this._active=!1}}class lr{constructor(e,t){this._clickZoom=e,this._tapZoom=t}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class cr{constructor(){this.reset()}reset(){this._active=!1}dblclick(e,t){return e.preventDefault(),{cameraAnimation:n=>{n.easeTo({duration:300,zoom:n.getZoom()+(e.shiftKey?-1:1),around:n.unproject(t)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ur{constructor(){this._tap=new Vi({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(e,t,n){this._swipePoint||(this._tapTime&&e.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?n.length>0&&(this._swipePoint=t[0],this._swipeTouch=n[0].identifier):this._tap.touchstart(e,t,n))}touchmove(e,t,n){if(this._tapTime){if(this._swipePoint){if(n[0].identifier!==this._swipeTouch)return;const i=t[0],r=i.y-this._swipePoint.y;return this._swipePoint=i,e.preventDefault(),this._active=!0,{zoomDelta:r/128}}}else this._tap.touchmove(e,t,n)}touchend(e,t,n){this._tapTime?this._swipePoint&&0===n.length&&this.reset():this._tap.touchend(e,t,n)&&(this._tapTime=e.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class hr{constructor(e,t,n){this._el=e,this._mousePan=t,this._touchPan=n}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class dr{constructor(e,t,n){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=t,this._mousePitch=n}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class pr{constructor(e,t,n,i){this._el=e,this._touchZoom=t,this._touchRotate=n,this._tapDragZoom=i,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const fr=e=>e.zoom||e.drag||e.pitch||e.rotate;class mr extends e.Event{}class gr{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,n){const i=e.sub([],n,t);this.radius=e.length(i[2]<0?e.div([],i,this.constants):[i[0],i[1],0])}projectRay(t){e.div(t,t,this.constants),e.normalize(t,t),e.mul$2(t,t,this.constants);const n=e.scale([],t,this.radius);if(n[2]>0){const t=e.scale([],[0,0,1],e.dot(n,[0,0,1])),i=e.scale([],e.normalize([],[n[0],n[1],0]),this.radius),r=e.add([],n,e.scale([],e.sub([],e.add([],i,t),n),2));n[0]=r[0],n[1]=r[1]}return n}}function vr(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta}class yr{constructor(t,n){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Pi(t),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new gr,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(n),e.bindAll(["handleEvent","handleWindowEvent"],this);const i=this._el;this._listeners=[[i,"touchstart",{passive:!0}],[i,"touchmove",{passive:!1}],[i,"touchend",void 0],[i,"touchcancel",void 0],[i,"mousedown",void 0],[i,"mousemove",void 0],[i,"mouseup",void 0],[e.window.document,"mousemove",{capture:!0}],[e.window.document,"mouseup",void 0],[i,"mouseover",void 0],[i,"mouseout",void 0],[i,"dblclick",void 0],[i,"click",void 0],[i,"keydown",{capture:!1}],[i,"keyup",void 0],[i,"wheel",{passive:!1}],[i,"contextmenu",void 0],[e.window,"blur",void 0]];for(const[r,o,s]of this._listeners)a.addEventListener(r,o,r===e.window.document?this.handleWindowEvent:this.handleEvent,s)}destroy(){for(const[t,n,i]of this._listeners)a.removeEventListener(t,n,t===e.window.document?this.handleWindowEvent:this.handleEvent,i)}_addDefaultHandlers(e){const t=this._map,n=t.getCanvasContainer();this._add("mapEvent",new Oi(t,e));const i=t.boxZoom=new Fi(t,e);this._add("boxZoom",i);const r=new ji,a=new cr;t.doubleClickZoom=new lr(a,r),this._add("tapZoom",r),this._add("clickZoom",a);const o=new ur;this._add("tapDragZoom",o);const s=t.touchPitch=new nr;this._add("touchPitch",s);const l=new qi(e),c=new Zi(e);t.dragRotate=new dr(e,l,c),this._add("mouseRotate",l,["mousePitch"]),this._add("mousePitch",c,["mouseRotate"]);const u=new Wi(e),h=new $i(e);t.dragPan=new hr(n,u,h),this._add("mousePan",u),this._add("touchPan",h,["touchZoom","touchRotate"]);const d=new er,p=new Ki;t.touchZoomRotate=new pr(n,p,d,o),this._add("touchRotate",d,["touchPan","touchZoom"]),this._add("touchZoom",p,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Bi(t));const f=t.scrollZoom=new sr(t,this);this._add("scrollZoom",f,["mousePan"]);const m=t.keyboard=new rr;this._add("keyboard",m);for(const g of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])e.interactive&&e[g]&&t[g].enable(e[g])}_add(e,t,n){this._handlers.push({handlerName:e,handler:t,allowed:n}),this._handlersById[e]=t}stop(e){if(!this._updatingCamera){for(const{handler:e}of this._handlers)e.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(fr(this._eventsInProgress))||this.isZooming()}_blockedByActive(e,t,n){for(const i in e)if(i!==n&&(!t||t.indexOf(i)<0))return!0;return!1}handleWindowEvent(e){this.handleEvent(e,`${e.type}Window`)}_getMapTouches(e){const t=[];for(const n of e)this._el.contains(n.target)&&t.push(n);return t}handleEvent(e,t){if("blur"===e.type)return void this.stop(!0);this._updatingCamera=!0;const n="renderFrame"===e.type,i=n?void 0:e,r={needsRenderFrame:!1},o={},s={},l=e.touches?this._getMapTouches(e.touches):void 0,c=l?a.touchPos(this._el,l):n?void 0:a.mousePos(this._el,e);for(const{handlerName:a,handler:d,allowed:p}of this._handlers){if(!d.isEnabled())continue;let n;this._blockedByActive(s,p,a)?d.reset():d[t||e.type]&&(n=d[t||e.type](e,c,l),this.mergeHandlerResult(r,o,n,a,i),n&&n.needsRenderFrame&&this._triggerRenderFrame()),(n||d.isActive())&&(s[a]=d)}const u={};for(const a in this._previousActiveHandlers)s[a]||(u[a]=i);this._previousActiveHandlers=s,(Object.keys(u).length||vr(r))&&(this._changes.push([r,o,u]),this._triggerRenderFrame()),(Object.keys(s).length||vr(r))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:h}=r;h&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],h(this._map))}mergeHandlerResult(t,n,i,r,a){if(!i)return;e.extend(t,i);const o={handlerName:r,originalEvent:i.originalEvent||a};void 0!==i.zoomDelta&&(n.zoom=o),void 0!==i.panDelta&&(n.drag=o),void 0!==i.pitchDelta&&(n.pitch=o),void 0!==i.bearingDelta&&(n.rotate=o)}_applyChanges(){const t={},n={},i={};for(const[r,a,o]of this._changes)r.panDelta&&(t.panDelta=(t.panDelta||new e.pointGeometry(0,0))._add(r.panDelta)),r.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+r.zoomDelta),r.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+r.bearingDelta),r.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+r.pitchDelta),void 0!==r.around&&(t.around=r.around),void 0!==r.aroundCoord&&(t.aroundCoord=r.aroundCoord),void 0!==r.pinchAround&&(t.pinchAround=r.pinchAround),r.noInertia&&(t.noInertia=r.noInertia),e.extend(n,a),e.extend(i,o);this._updateMapTransform(t,n,i),this._changes=[]}_updateMapTransform(t,n,i){const r=this._map,a=r.transform,o=e=>[e.x,e.y,e.z];if((e=>{const t=this._eventsInProgress.drag;return t&&!this._handlersById[t.handlerName].isActive()})()&&!vr(t)){const e=a.zoom;a.cameraElevationReference="sea",a.recenterOnTerrain(),a.cameraElevationReference="ground",e!==a.zoom&&this._map._update(!0)}if(!vr(t))return this._fireEvents(n,i,!0);let{panDelta:s,zoomDelta:l,bearingDelta:c,pitchDelta:u,around:h,aroundCoord:d,pinchAround:p}=t;void 0!==p&&(h=p),(e=>n.drag&&!this._eventsInProgress.drag)()&&h&&(this._dragOrigin=o(a.pointCoordinate3D(h)),this._trackingEllipsoid.setup(a._camera.position,this._dragOrigin)),a.cameraElevationReference="sea",r._stop(!0),h=h||r.transform.centerPoint,c&&(a.bearing+=c),u&&(a.pitch+=u),a._updateCameraState();const f=[0,0,0];if(s){const e=a.screenPointToMercatorRay(h),t=a.screenPointToMercatorRay(h.sub(s)),n=this._trackingEllipsoid.projectRay(e.dir),i=this._trackingEllipsoid.projectRay(t.dir);f[0]=i[0]-n[0],f[1]=i[1]-n[1]}const m=a.zoom,g=[0,0,0];if(l){const t=o(d||a.pointCoordinate3D(h)),n={dir:e.normalize([],e.sub([],t,a._camera.position))},i=a.screenPointToMercatorRay(a.centerPoint);if(n.dir[2]<0){const r=e.altitudeFromMercatorZ(t[2],t[1]),s=a.rayIntersectionCoordinate(a.pointRayIntersection(a.centerPoint,r)),c=a.zoomDeltaToMovement(o(s),l)*(i.dir[2]/n.dir[2]);e.scale(g,n.dir,c)}else if(a._terrainEnabled()){const i=a.zoomDeltaToMovement(t,l);e.scale(g,n.dir,i)}}const v=e.add(f,f,g);a._translateCameraConstrained(v),l&&Math.abs(a.zoom-m)>1e-4&&a.recenterOnTerrain(),a.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(n,i,!0)}_fireEvents(t,n,i){const r=fr(this._eventsInProgress),a=fr(t),o={};for(const e in t){const{originalEvent:n}=t[e];this._eventsInProgress[e]||(o[`${e}start`]=n),this._eventsInProgress[e]=t[e]}!r&&a&&this._fireEvent("movestart",a.originalEvent);for(const e in o)this._fireEvent(e,o[e]);a&&this._fireEvent("move",a.originalEvent);for(const e in t){const{originalEvent:n}=t[e];this._fireEvent(e,n)}const s={};let l;for(const e in this._eventsInProgress){const{handlerName:t,originalEvent:i}=this._eventsInProgress[e];this._handlersById[t].isActive()||(delete this._eventsInProgress[e],l=n[t]||i,s[`${e}end`]=l)}for(const e in s)this._fireEvent(e,s[e]);const c=fr(this._eventsInProgress);if(i&&(r||a)&&!c){this._updatingCamera=!0;const t=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),n=e=>0!==e&&-this._bearingSnap<e&&e<this._bearingSnap;t?(n(t.bearing||this._map.getBearing())&&(t.bearing=0),this._map.easeTo(t,{originalEvent:l})):(this._map.fire(new e.Event("moveend",{originalEvent:l})),n(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,n){this._map.fire(new e.Event(t,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((e=>{delete this._frameId,this.handleEvent(new mr("renderFrame",{timeStamp:e})),this._applyChanges()}))}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}class _r extends e.Evented{constructor(t,n){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=n.bearingSnap,e.bindAll(["_renderFrameCallback"],this)}getCenter(){return new e.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(e,t){return this.jumpTo({center:e},t)}panBy(t,n,i){return t=e.pointGeometry.convert(t).mult(-1),this.panTo(this.transform.center,e.extend({offset:t},n),i)}panTo(t,n,i){return this.easeTo(e.extend({center:t},n),i)}getZoom(){return this.transform.zoom}setZoom(e,t){return this.jumpTo({zoom:e},t),this}zoomTo(t,n,i){return this.easeTo(e.extend({zoom:t},n),i)}zoomIn(e,t){return this.zoomTo(this.getZoom()+1,e,t),this}zoomOut(e,t){return this.zoomTo(this.getZoom()-1,e,t),this}getBearing(){return this.transform.bearing}setBearing(e,t){return this.jumpTo({bearing:e},t),this}getPadding(){return this.transform.padding}setPadding(e,t){return this.jumpTo({padding:e},t),this}rotateTo(t,n,i){return this.easeTo(e.extend({bearing:t},n),i)}resetNorth(t,n){return this.rotateTo(0,e.extend({duration:1e3},t),n),this}resetNorthPitch(t,n){return this.easeTo(e.extend({bearing:0,pitch:0,duration:1e3},t),n),this}snapToNorth(e,t){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,t):this}getPitch(){return this.transform.pitch}setPitch(e,t){return this.jumpTo({pitch:e},t),this}cameraForBounds(t,n){t=e.LngLatBounds.convert(t);const i=n&&n.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),i,n)}_extendCameraOptions(t){const n={top:0,bottom:0,right:0,left:0};if("number"==typeof(t=e.extend({padding:n,offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding){const e=t.padding;t.padding={top:e,bottom:e,right:e,left:e}}return t.padding=e.extend(n,t.padding),t}_cameraForBoxAndBearing(t,n,i,r){const a=this._extendCameraOptions(r),o=this.transform,s=o.padding,l=o.project(e.LngLat.convert(t)),c=o.project(e.LngLat.convert(n)),u=l.rotate(-e.degToRad(i)),h=c.rotate(-e.degToRad(i)),d=new e.pointGeometry(Math.max(u.x,h.x),Math.max(u.y,h.y)),p=new e.pointGeometry(Math.min(u.x,h.x),Math.min(u.y,h.y)),f=d.sub(p),m=(o.width-(s.left+s.right+a.padding.left+a.padding.right))/f.x,g=(o.height-(s.top+s.bottom+a.padding.top+a.padding.bottom))/f.y;if(g<0||m<0)return void e.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const v=Math.min(o.scaleZoom(o.scale*Math.min(m,g)),a.maxZoom),y="number"==typeof a.offset.x?new e.pointGeometry(a.offset.x,a.offset.y):e.pointGeometry.convert(a.offset),_=new e.pointGeometry((a.padding.left-a.padding.right)/2,(a.padding.top-a.padding.bottom)/2).rotate(i*Math.PI/180),x=y.add(_).mult(o.scale/o.zoomScale(v));return{center:o.unproject(l.add(c).div(2).sub(x)),zoom:v,bearing:i}}_cameraForBox(t,n,i,r,a){const o=this._extendCameraOptions(a);i=i||0,r=r||0,t=e.LngLat.convert(t),n=e.LngLat.convert(n);const s=this.transform.clone();s.padding=o.padding;const l=this.getFreeCameraOptions(),c=new e.LngLat(.5*(t.lng+n.lng),.5*(t.lat+n.lat)),u=.5*(i+r);if(s._camera.position[2]<e.mercatorZfromAltitude(u,c.lat))return void e.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");l.lookAtPoint(c),s.setFreeCameraOptions(l);const h=e.MercatorCoordinate.fromLngLat(t),d=e.MercatorCoordinate.fromLngLat(n),m=s.pointRayIntersection(s.centerPoint,u),g=[(v=s.rayIntersectionCoordinate(m)).x,v.y,v.z];var v;const y=s.screenPointToMercatorRay(s.centerPoint);let _,x=0;do{const n=Math.floor(s.zoom),a=1<<n,o=Math.min(a*h.x,a*d.x),l=Math.min(a*h.y,a*d.y),c=Math.max(a*h.x,a*d.x),u=Math.max(a*h.y,a*d.y),m=new f([o,l,i],[c,u,r]),v=p.fromInvProjectionMatrix(s.invProjMatrix,s.worldSize,n);if(2!==m.intersects(v)){_&&(s._camera.position=e.scaleAndAdd([],s._camera.position,y.dir,-_),s._updateStateFromCamera());break}const x=e.sub([],s._camera.position,g);_=.5*e.length(x),s._camera.position=e.scaleAndAdd([],s._camera.position,y.dir,_);try{s._updateStateFromCamera()}catch(t){return void e.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++x<10);return{center:s.center,zoom:s.zoom,bearing:s.bearing,pitch:s.pitch}}fitBounds(e,t,n){return this._fitInternal(this.cameraForBounds(e,t),t,n)}_raycastElevationBox(t,n){const i=this.transform.elevation;if(!i)return;const r=new e.pointGeometry(t.x,n.y),a=new e.pointGeometry(n.x,t.y),o=i.pointCoordinate(t);if(!o)return;const s=i.pointCoordinate(n);if(!s)return;const l=i.pointCoordinate(r);if(!l)return;const c=i.pointCoordinate(a);if(!c)return;const u=new e.MercatorCoordinate(o[0],o[1]).toLngLat(),h=new e.MercatorCoordinate(s[0],s[1]).toLngLat(),d=new e.MercatorCoordinate(l[0],l[1]).toLngLat(),p=new e.MercatorCoordinate(c[0],c[1]).toLngLat(),f=Math.min(u.lng,Math.min(h.lng,Math.min(d.lng,p.lng))),m=Math.min(u.lat,Math.min(h.lat,Math.min(d.lat,p.lat))),g=Math.max(u.lng,Math.max(h.lng,Math.max(d.lng,p.lng))),v=Math.max(u.lat,Math.max(h.lat,Math.max(d.lat,p.lat))),y=Math.min(o[3],Math.min(s[3],Math.min(l[3],c[3]))),_=Math.max(o[3],Math.max(s[3],Math.max(l[3],c[3])));return{minLngLat:new e.LngLat(f,m),maxLngLat:new e.LngLat(g,v),minAltitude:y,maxAltitude:_}}fitScreenCoordinates(t,n,i,r,a){let o,s,l,c;const u=e.pointGeometry.convert(t),h=e.pointGeometry.convert(n),d=this._raycastElevationBox(u,h);if(d)o=d.minLngLat,s=d.maxLngLat,l=d.minAltitude,c=d.maxAltitude;else{if(this.transform.isHorizonVisibleForPoints(u,h))return this;o=this.transform.pointLocation(u),s=this.transform.pointLocation(h)}return this._fitInternal(0===this.transform.pitch?this._cameraForBoxAndBearing(this.transform.pointLocation(e.pointGeometry.convert(t)),this.transform.pointLocation(e.pointGeometry.convert(n)),i,r):this._cameraForBox(o,s,l,c,r),r,a)}_fitInternal(t,n,i){return t?(delete(n=e.extend(t,n)).padding,n.linear?this.easeTo(n,i):this.flyTo(n,i)):this}jumpTo(t,n){this.stop();const i=this.transform;let r=!1,a=!1,o=!1;return"zoom"in t&&i.zoom!==+t.zoom&&(r=!0,i.zoom=+t.zoom),void 0!==t.center&&(i.center=e.LngLat.convert(t.center)),"bearing"in t&&i.bearing!==+t.bearing&&(a=!0,i.bearing=+t.bearing),"pitch"in t&&i.pitch!==+t.pitch&&(o=!0,i.pitch=+t.pitch),null==t.padding||i.isPaddingEqual(t.padding)||(i.padding=t.padding),this.fire(new e.Event("movestart",n)).fire(new e.Event("move",n)),r&&this.fire(new e.Event("zoomstart",n)).fire(new e.Event("zoom",n)).fire(new e.Event("zoomend",n)),a&&this.fire(new e.Event("rotatestart",n)).fire(new e.Event("rotate",n)).fire(new e.Event("rotateend",n)),o&&this.fire(new e.Event("pitchstart",n)).fire(new e.Event("pitch",n)).fire(new e.Event("pitchend",n)),this.fire(new e.Event("moveend",n))}getFreeCameraOptions(){return this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,n){this.stop();const i=this.transform,r=i.zoom,a=i.pitch,o=i.bearing;i.setFreeCameraOptions(t);const s=r!==i.zoom,l=a!==i.pitch,c=o!==i.bearing;return this.fire(new e.Event("movestart",n)).fire(new e.Event("move",n)),s&&this.fire(new e.Event("zoomstart",n)).fire(new e.Event("zoom",n)).fire(new e.Event("zoomend",n)),c&&this.fire(new e.Event("rotatestart",n)).fire(new e.Event("rotate",n)).fire(new e.Event("rotateend",n)),l&&this.fire(new e.Event("pitchstart",n)).fire(new e.Event("pitch",n)).fire(new e.Event("pitchend",n)),this.fire(new e.Event("moveend",n)),this}easeTo(t,n){this._stop(!1,t.easeId),(!1===(t=e.extend({offset:[0,0],duration:500,easing:e.ease},t)).animate||!t.essential&&e.exported.prefersReducedMotion)&&(t.duration=0);const i=this.transform,r=this.getZoom(),a=this.getBearing(),o=this.getPitch(),s=this.getPadding(),l="zoom"in t?+t.zoom:r,c="bearing"in t?this._normalizeBearing(t.bearing,a):a,u="pitch"in t?+t.pitch:o,h="padding"in t?t.padding:i.padding,d=e.pointGeometry.convert(t.offset);let p=i.centerPoint.add(d);const f=i.pointLocation(p),m=e.LngLat.convert(t.center||f);this._normalizeCenter(m);const g=i.project(f),v=i.project(m).sub(g),y=i.zoomScale(l-r);let _,x;t.around&&(_=e.LngLat.convert(t.around),x=i.locationPoint(_));const b={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||l!==r,this._rotating=this._rotating||a!==c,this._pitching=this._pitching||u!==o,this._padding=!i.isPaddingEqual(h),this._easeId=t.easeId,this._prepareEase(n,t.noMoveStart,b),this._ease((t=>{if(this._zooming&&(i.zoom=e.number(r,l,t)),this._rotating&&(i.bearing=e.number(a,c,t)),this._pitching&&(i.pitch=e.number(o,u,t)),this._padding&&(i.interpolatePadding(s,h,t),p=i.centerPoint.add(d)),_)i.setLocationAtPoint(_,x);else{const e=i.zoomScale(i.zoom-r),n=l>r?Math.min(2,y):Math.max(.5,y),a=Math.pow(n,1-t),o=i.unproject(g.add(v.mult(t*a)).mult(e));i.setLocationAtPoint(i.renderWorldCopies?o.wrap():o,p)}this._fireMoveEvents(n)}),(e=>{i.recenterOnTerrain(),this._afterEase(n,e)}),t),this}_prepareEase(t,n,i={}){this._moving=!0,this.transform.cameraElevationReference="sea",n||i.moving||this.fire(new e.Event("movestart",t)),this._zooming&&!i.zooming&&this.fire(new e.Event("zoomstart",t)),this._rotating&&!i.rotating&&this.fire(new e.Event("rotatestart",t)),this._pitching&&!i.pitching&&this.fire(new e.Event("pitchstart",t))}_fireMoveEvents(t){this.fire(new e.Event("move",t)),this._zooming&&this.fire(new e.Event("zoom",t)),this._rotating&&this.fire(new e.Event("rotate",t)),this._pitching&&this.fire(new e.Event("pitch",t))}_afterEase(t,n){if(this._easeId&&n&&this._easeId===n)return;delete this._easeId,this.transform.cameraElevationReference="ground";const i=this._zooming,r=this._rotating,a=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,i&&this.fire(new e.Event("zoomend",t)),r&&this.fire(new e.Event("rotateend",t)),a&&this.fire(new e.Event("pitchend",t)),this.fire(new e.Event("moveend",t))}flyTo(t,n){if(!t.essential&&e.exported.prefersReducedMotion){const i=e.pick(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(i,n)}this.stop(),t=e.extend({offset:[0,0],speed:1.2,curve:1.42,easing:e.ease},t);const i=this.transform,r=this.getZoom(),a=this.getBearing(),o=this.getPitch(),s=this.getPadding(),l="zoom"in t?e.clamp(+t.zoom,i.minZoom,i.maxZoom):r,c="bearing"in t?this._normalizeBearing(t.bearing,a):a,u="pitch"in t?+t.pitch:o,h="padding"in t?t.padding:i.padding,d=i.zoomScale(l-r),p=e.pointGeometry.convert(t.offset);let f=i.centerPoint.add(p);const m=i.pointLocation(f),g=e.LngLat.convert(t.center||m);this._normalizeCenter(g);const v=i.project(m),y=i.project(g).sub(v);let _=t.curve;const x=Math.max(i.width,i.height),b=x/d,w=y.mag();if("minZoom"in t){const n=e.clamp(Math.min(t.minZoom,r,l),i.minZoom,i.maxZoom),a=x/i.zoomScale(n-r);_=Math.sqrt(a/w*2)}const S=_*_;function T(e){const t=(b*b-x*x+(e?-1:1)*S*S*w*w)/(2*(e?b:x)*S*w);return Math.log(Math.sqrt(t*t+1)-t)}function E(e){return(Math.exp(e)-Math.exp(-e))/2}function M(e){return(Math.exp(e)+Math.exp(-e))/2}const k=T(0);let A=function(e){return M(k)/M(k+_*e)},C=function(e){return x*((M(k)*(E(t=k+_*e)/M(t))-E(k))/S)/w;var t},P=(T(1)-k)/_;if(Math.abs(w)<1e-6||!isFinite(P)){if(Math.abs(x-b)<1e-6)return this.easeTo(t,n);const e=b<x?-1:1;P=Math.abs(Math.log(b/x))/_,C=function(){return 0},A=function(t){return Math.exp(e*_*t)}}return t.duration="duration"in t?+t.duration:1e3*P/("screenSpeed"in t?+t.screenSpeed/_:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=a!==c,this._pitching=u!==o,this._padding=!i.isPaddingEqual(h),this._prepareEase(n,!1),this._ease((t=>{const d=t*P,m=1/A(d);i.zoom=1===t?l:r+i.scaleZoom(m),this._rotating&&(i.bearing=e.number(a,c,t)),this._pitching&&(i.pitch=e.number(o,u,t)),this._padding&&(i.interpolatePadding(s,h,t),f=i.centerPoint.add(p));const _=1===t?g:i.unproject(v.add(y.mult(C(d))).mult(m));i.setLocationAtPoint(i.renderWorldCopies?_.wrap():_,f),i._updateCenterElevation(),this._fireMoveEvents(n)}),(()=>this._afterEase(n)),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,t){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const e=this._onEaseEnd;delete this._onEaseEnd,e.call(this,t)}if(!e){const e=this.handlers;e&&e.stop(!1)}return this}_ease(t,n,i){!1===i.animate||0===i.duration?(t(1),n()):(this._easeStart=e.exported.now(),this._easeOptions=i,this._onEaseFrame=t,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((e.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,n){t=e.wrap(t,-180,180);const i=Math.abs(t-n);return Math.abs(t-360-n)<i&&(t-=360),Math.abs(t+360-n)<i&&(t+=360),t}_normalizeCenter(e){const t=this.transform;if(!t.renderWorldCopies||t.lngRange)return;const n=e.lng-t.center.lng;e.lng+=n>180?-360:n<-180?360:0}}class xr{constructor(t={}){this.options=t,e.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(e){const t=this.options&&this.options.compact;return this._map=e,this._container=a.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=a.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=a.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),t&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===t&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){a.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(e,t){const n=this._map._getUIString(`AttributionControl.${t}`);e.title=n,e.setAttribute("aria-label",n)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const n=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||e.config.ACCESS_TOKEN}];if(t){const i=n.reduce(((e,t,i)=>(t.value&&(e+=`${t.key}=${t.value}${i<n.length-1?"&":""}`),e)),"?");t.href=`${e.config.FEEDBACK_URL}/${i}${this._map._hash?this._map._hash.getHashString(!0):""}`,t.rel="noopener nofollow",this._setElementTitle(t,"MapFeedback")}}_updateData(e){!e||"metadata"!==e.sourceDataType&&"visibility"!==e.sourceDataType&&"style"!==e.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map((e=>"string"!=typeof e?"":e))):"string"==typeof this.options.customAttribution&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id}const t=this._map.style._sourceCaches;for(const i in t){const n=t[i];if(n.used){const t=n.getSource();t.attribution&&e.indexOf(t.attribution)<0&&e.push(t.attribution)}}e.sort(((e,t)=>e.length-t.length)),e=e.filter(((t,n)=>{for(let i=n+1;i<e.length;i++)if(e[i].indexOf(t)>=0)return!1;return!0}));const n=e.join(" | ");n!==this._attribHTML&&(this._attribHTML=n,e.length?(this._innerContainer.innerHTML=n,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class br{constructor(){e.bindAll(["_updateLogo"],this),e.bindAll(["_updateCompact"],this)}onAdd(e){this._map=e,this._container=a.create("div","mapboxgl-ctrl");const t=a.create("a","mapboxgl-ctrl-logo");return t.target="_blank",t.rel="noopener nofollow",t.href="https://www.mapbox.com/",t.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),t.setAttribute("rel","noopener nofollow"),this._container.appendChild(t),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){a.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(e){e&&"metadata"!==e.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const e=this._map.style._sourceCaches;if(0===Object.entries(e).length)return!0;for(const t in e){const n=e[t].getSource();if(n.hasOwnProperty("mapbox_logo")&&!n.mapbox_logo)return!1}return!0}_updateCompact(){const e=this._container.children;if(e.length){const t=e[0];this._map.getCanvasContainer().offsetWidth<250?t.classList.add("mapboxgl-compact"):t.classList.remove("mapboxgl-compact")}}}class wr{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const t=++this._id;return this._queue.push({callback:e,id:t,cancelled:!1}),t}remove(e){const t=this._currentlyRunning,n=t?this._queue.concat(t):this._queue;for(const i of n)if(i.id===e)return void(i.cancelled=!0)}run(e=0){const t=this._currentlyRunning=this._queue;this._queue=[];for(const n of t)if(!n.cancelled&&(n.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Sr(t,n,i){if(t=new e.LngLat(t.lng,t.lat),n){const r=new e.LngLat(t.lng-360,t.lat),a=new e.LngLat(t.lng+360,t.lat),o=360*Math.ceil(Math.abs(t.lng-i.center.lng)/360),s=i.locationPoint(t).distSqr(n),l=n.x<0||n.y<0||n.x>i.width||n.y>i.height;i.locationPoint(r).distSqr(n)<s&&(l||Math.abs(r.lng-i.center.lng)<o)?t=r:i.locationPoint(a).distSqr(n)<s&&(l||Math.abs(a.lng-i.center.lng)<o)&&(t=a)}for(;Math.abs(t.lng-i.center.lng)>180;){const e=i.locationPoint(t);if(e.x>=0&&e.y>=0&&e.x<=i.width&&e.y<=i.height)break;t.lng>i.center.lng?t.lng-=360:t.lng+=360}return t}const Tr={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Er(e,t,n){const i=e.classList;for(const r in Tr)i.remove(`mapboxgl-${n}-anchor-${r}`);i.add(`mapboxgl-${n}-anchor-${t}`)}class Mr extends e.Evented{constructor(t,n){if(super(),(t instanceof e.window.HTMLElement||n)&&(t=e.extend({element:t},n)),e.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&"auto"!==t.pitchAlignment?t.pitchAlignment:this._rotationAlignment,t&&t.element)this._element=t.element,this._offset=e.pointGeometry.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=a.create("div"),this._element.setAttribute("aria-label","Map marker");const n=a.createNS("http://www.w3.org/2000/svg","svg"),i=41,r=27;n.setAttributeNS(null,"display","block"),n.setAttributeNS(null,"height",`${i}px`),n.setAttributeNS(null,"width",`${r}px`),n.setAttributeNS(null,"viewBox",`0 0 ${r} ${i}`);const o=a.createNS("http://www.w3.org/2000/svg","g");o.setAttributeNS(null,"stroke","none"),o.setAttributeNS(null,"stroke-width","1"),o.setAttributeNS(null,"fill","none"),o.setAttributeNS(null,"fill-rule","evenodd");const s=a.createNS("http://www.w3.org/2000/svg","g");s.setAttributeNS(null,"fill-rule","nonzero");const l=a.createNS("http://www.w3.org/2000/svg","g");l.setAttributeNS(null,"transform","translate(3.0, 29.0)"),l.setAttributeNS(null,"fill","#000000");const c=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const e of c){const t=a.createNS("http://www.w3.org/2000/svg","ellipse");t.setAttributeNS(null,"opacity","0.04"),t.setAttributeNS(null,"cx","10.5"),t.setAttributeNS(null,"cy","5.80029008"),t.setAttributeNS(null,"rx",e.rx),t.setAttributeNS(null,"ry",e.ry),l.appendChild(t)}const u=a.createNS("http://www.w3.org/2000/svg","g");u.setAttributeNS(null,"fill",this._color);const h=a.createNS("http://www.w3.org/2000/svg","path");h.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),u.appendChild(h);const d=a.createNS("http://www.w3.org/2000/svg","g");d.setAttributeNS(null,"opacity","0.25"),d.setAttributeNS(null,"fill","#000000");const p=a.createNS("http://www.w3.org/2000/svg","path");p.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),d.appendChild(p);const f=a.createNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"transform","translate(6.0, 7.0)"),f.setAttributeNS(null,"fill","#FFFFFF");const m=a.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"transform","translate(8.0, 8.0)");const g=a.createNS("http://www.w3.org/2000/svg","circle");g.setAttributeNS(null,"fill","#000000"),g.setAttributeNS(null,"opacity","0.25"),g.setAttributeNS(null,"cx","5.5"),g.setAttributeNS(null,"cy","5.5"),g.setAttributeNS(null,"r","5.4999962");const v=a.createNS("http://www.w3.org/2000/svg","circle");v.setAttributeNS(null,"fill","#FFFFFF"),v.setAttributeNS(null,"cx","5.5"),v.setAttributeNS(null,"cy","5.5"),v.setAttributeNS(null,"r","5.4999962"),m.appendChild(g),m.appendChild(v),s.appendChild(l),s.appendChild(u),s.appendChild(d),s.appendChild(f),s.appendChild(m),n.appendChild(s),n.setAttributeNS(null,"height",i*this._scale+"px"),n.setAttributeNS(null,"width",r*this._scale+"px"),this._element.appendChild(n),this._offset=e.pointGeometry.convert(t&&t.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(e=>{e.preventDefault()})),this._element.addEventListener("mousedown",(e=>{e.preventDefault()})),Er(this._element,this._anchor,"marker"),this._popup=null}addTo(e){return this.remove(),this._map=e,e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("remove",this._clearFadeTimer),e._addMarker(this),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._map.off("remove",this._clearFadeTimer),this._map._removeMarker(this),delete this._map),this._clearFadeTimer(),a.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=e.LngLat.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const t=38.1,n=13.5,i=Math.sqrt(Math.pow(n,2)/2);e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-t],"bottom-left":[i,-1*(t-n+i)],"bottom-right":[-i,-1*(t-n+i)],left:[n,-1*(t-n)],right:[-n,-1*(t-n)]}:this._offset}this._popup=e,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(e){const t=e.code,n=e.charCode||e.keyCode;"Space"!==t&&"Enter"!==t&&32!==n&&13!==n||this.togglePopup()}_onMapClick(e){const t=e.originalEvent.target,n=this._element;this._popup&&(t===n||n.contains(t))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const e=this._popup;return e?(e.isOpen()?e.remove():e.addTo(this._map),this):this}_evaluateOpacity(){const e=this._pos?this._pos.sub(this._transformedOffset()):null;if(!this._withinScreenBounds(e))return void this._clearFadeTimer();const t=this._map.unproject(e);let n=!1;if(this._map.getTerrain()){const e=this._map.getFreeCameraOptions();if(e.position){const i=e.position.toLngLat();n=i.distanceTo(t)<.9*i.distanceTo(this._lngLat)}}const i=(1-this._map._queryFogOpacity(t))*(n?.2:1);this._element.style.opacity=`${i}`,this._popup&&this._popup._setOpacity(`${i}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_withinScreenBounds(e){const t=this._map.transform;return!!e&&e.x>=0&&e.x<t.width&&e.y>=0&&e.y<t.height}_update(e){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=Sr(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._transformedOffset());let t="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?t=`rotateZ(${this._rotation}deg)`:"map"===this._rotationAlignment&&(t=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let n="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?n="rotateX(0deg)":"map"===this._pitchAlignment&&(n=`rotateX(${this._map.getPitch()}deg)`),e&&"moveend"!==e.type||(this._pos=this._pos.round()),this._map._requestDomTask((()=>{this._map&&(this._element&&this._pos&&this._anchor&&a.setTransform(this._element,`${Tr[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${n} ${t}`),!this._map.getTerrain()&&!this._map.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}_transformedOffset(){if(!this._defaultMarker)return this._offset;const e=this._map.transform,t=this._offset.mult(this._scale);return"map"===this._rotationAlignment&&t._rotate(e.angle),"map"===this._pitchAlignment&&(t.y*=Math.cos(e._pitch)),t}getOffset(){return this._offset}setOffset(t){return this._offset=e.pointGeometry.convert(t),this._update(),this}_onMove(t){if(!this._isDragging){const e=this._clickTolerance||this._map._clickTolerance;this._isDragging=t.point.dist(this._pointerdownPos)>=e}this._isDragging&&(this._pos=t.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new e.Event("dragstart"))),this.fire(new e.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new e.Event("dragend")),this._state="inactive"}_addDragHandler(e){this._element.contains(e.originalEvent.target)&&(e.preventDefault(),this._positionDelta=e.point.sub(this._pos).add(this._transformedOffset()),this._pointerdownPos=e.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&"auto"!==e?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class kr{constructor(e){this.jumpTo(e)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const n=e.easeCubicInOut((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-n)+this._end*n}isEasing(e){return e>=this._startTime&&e<=this._endTime}jumpTo(e){this._startTime=-1/0,this._endTime=-1/0,this._start=e,this._end=e}easeTo(e,t,n){this._start=this.getValue(t),this._end=e,this._startTime=t,this._endTime=t+n}}const Ar={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},{HTMLImageElement:Cr,HTMLElement:Pr,ImageBitmap:Lr}=e.window,Ir={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function Rr(e){e.parentNode&&e.parentNode.removeChild(e)}const zr={showCompass:!0,showZoom:!0,visualizePitch:!1};class Dr{constructor(t,n,i=!1){this._clickTolerance=10,this.element=n,this.mouseRotate=new qi({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,i&&(this.mousePitch=new Zi({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),e.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),a.addEventListener(n,"mousedown",this.mousedown),a.addEventListener(n,"touchstart",this.touchstart,{passive:!1}),a.addEventListener(n,"touchmove",this.touchmove),a.addEventListener(n,"touchend",this.touchend),a.addEventListener(n,"touchcancel",this.reset)}down(e,t){this.mouseRotate.mousedown(e,t),this.mousePitch&&this.mousePitch.mousedown(e,t),a.disableDrag()}move(e,t){const n=this.map,i=this.mouseRotate.mousemoveWindow(e,t);if(i&&i.bearingDelta&&n.setBearing(n.getBearing()+i.bearingDelta),this.mousePitch){const i=this.mousePitch.mousemoveWindow(e,t);i&&i.pitchDelta&&n.setPitch(n.getPitch()+i.pitchDelta)}}off(){const e=this.element;a.removeEventListener(e,"mousedown",this.mousedown),a.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),a.removeEventListener(e,"touchmove",this.touchmove),a.removeEventListener(e,"touchend",this.touchend),a.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){a.enableDrag(),a.removeEventListener(e.window,"mousemove",this.mousemove),a.removeEventListener(e.window,"mouseup",this.mouseup)}mousedown(t){this.down(e.extend({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),a.mousePos(this.element,t)),a.addEventListener(e.window,"mousemove",this.mousemove),a.addEventListener(e.window,"mouseup",this.mouseup)}mousemove(e){this.move(e,a.mousePos(this.element,e))}mouseup(e){this.mouseRotate.mouseupWindow(e),this.mousePitch&&this.mousePitch.mouseupWindow(e),this.offTemp()}touchstart(e){1!==e.targetTouches.length?this.reset():(this._startPos=this._lastPos=a.touchPos(this.element,e.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>e.preventDefault()},this._startPos))}touchmove(e){1!==e.targetTouches.length?this.reset():(this._lastPos=a.touchPos(this.element,e.targetTouches)[0],this.move({preventDefault:()=>e.preventDefault()},this._lastPos))}touchend(e){0===e.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Or={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Br,Fr=0,Nr=!1;const Ur={maxWidth:100,unit:"metric"};function Vr(e,t,n){const i=n&&n.maxWidth||100,r=e._container.clientHeight/2,a=e.unproject([0,r]),o=e.unproject([i,r]),s=a.distanceTo(o);if(n&&"imperial"===n.unit){const n=3.2808*s;n>5280?jr(t,i,n/5280,e._getUIString("ScaleControl.Miles"),e):jr(t,i,n,e._getUIString("ScaleControl.Feet"),e)}else n&&"nautical"===n.unit?jr(t,i,s/1852,e._getUIString("ScaleControl.NauticalMiles"),e):s>=1e3?jr(t,i,s/1e3,e._getUIString("ScaleControl.Kilometers"),e):jr(t,i,s,e._getUIString("ScaleControl.Meters"),e)}function jr(e,t,n,i,r){const a=function(e){const t=Math.pow(10,`${Math.floor(e)}`.length-1);let n=e/t;return n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:n>=1?1:function(e){const t=Math.pow(10,Math.ceil(-Math.log(e)/Math.LN10));return Math.round(e*t)/t}(n),t*n}(n),o=a/n;r._requestDomTask((()=>{e.style.width=t*o+"px",e.innerHTML=`${a}&nbsp;${i}`}))}const Gr={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Hr=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Wr(t){if(t){if("number"==typeof t){const n=Math.round(Math.sqrt(.5*Math.pow(t,2)));return{center:new e.pointGeometry(0,0),top:new e.pointGeometry(0,t),"top-left":new e.pointGeometry(n,n),"top-right":new e.pointGeometry(-n,n),bottom:new e.pointGeometry(0,-t),"bottom-left":new e.pointGeometry(n,-n),"bottom-right":new e.pointGeometry(-n,-n),left:new e.pointGeometry(t,0),right:new e.pointGeometry(-t,0)}}if(t instanceof e.pointGeometry||Array.isArray(t)){const n=e.pointGeometry.convert(t);return{center:n,top:n,"top-left":n,"top-right":n,bottom:n,"bottom-left":n,"bottom-right":n,left:n,right:n}}return{center:e.pointGeometry.convert(t.center||[0,0]),top:e.pointGeometry.convert(t.top||[0,0]),"top-left":e.pointGeometry.convert(t["top-left"]||[0,0]),"top-right":e.pointGeometry.convert(t["top-right"]||[0,0]),bottom:e.pointGeometry.convert(t.bottom||[0,0]),"bottom-left":e.pointGeometry.convert(t["bottom-left"]||[0,0]),"bottom-right":e.pointGeometry.convert(t["bottom-right"]||[0,0]),left:e.pointGeometry.convert(t.left||[0,0]),right:e.pointGeometry.convert(t.right||[0,0])}}return Wr(new e.pointGeometry(0,0))}const qr={version:e.version,supported:t,setRTLTextPlugin:e.setRTLTextPlugin,getRTLTextPluginStatus:e.getRTLTextPluginStatus,Map:class extends _r{constructor(t){if(null!=(t=e.extend({},Ir,t)).minZoom&&null!=t.maxZoom&&t.minZoom>t.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=t.minPitch&&null!=t.maxPitch&&t.minPitch>t.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=t.minPitch&&t.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=t.maxPitch&&t.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Si(t.minZoom,t.maxZoom,t.minPitch,t.maxPitch,t.renderWorldCopies),t),this._interactive=t.interactive,this._maxTileCacheSize=t.maxTileCacheSize,this._failIfMajorPerformanceCaveat=t.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=t.preserveDrawingBuffer,this._antialias=t.antialias,this._trackResize=t.trackResize,this._bearingSnap=t.bearingSnap,this._refreshExpiredTiles=t.refreshExpiredTiles,this._fadeDuration=t.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=t.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=t.collectResourceTiming,this._optimizeForTerrain=t.optimizeForTerrain,this._renderTaskQueue=new wr,this._domRenderTaskQueue=new wr,this._controls=[],this._markers=[],this._mapId=e.uniqueId(),this._locale=e.extend({},Ar,t.locale),this._clickTolerance=t.clickTolerance,this._averageElevationLastSampledAt=-1/0,this._averageElevation=new kr(0),this._requestManager=new e.RequestManager(t.transformRequest,t.accessToken,t.testMode),this._silenceAuthErrors=!!t.testMode,"string"==typeof t.container){if(this._container=e.window.document.getElementById(t.container),!this._container)throw new Error(`Container '${t.container}' not found.`)}else{if(!(t.container instanceof Pr))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=t.container}if(t.maxBounds&&this.setMaxBounds(t.maxBounds),e.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),void 0!==e.window&&(e.window.addEventListener("online",this._onWindowOnline,!1),e.window.addEventListener("resize",this._onWindowResize,!1),e.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new yr(this,t),this._hash=t.hash&&new Ti("string"==typeof t.hash&&t.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:t.center,zoom:t.zoom,bearing:t.bearing,pitch:t.pitch}),t.bounds&&(this.resize(),this.fitBounds(t.bounds,e.extend({},t.fitBoundsOptions,{duration:0})))),this.resize(),this._localFontFamily=t.localFontFamily,this._localIdeographFontFamily=t.localIdeographFontFamily,t.style&&this.setStyle(t.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),t.attributionControl&&this.addControl(new xr({customAttribution:t.customAttribution})),this._logoControl=new br,this.addControl(this._logoControl,t.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)})),this.on("data",(t=>{this._update("style"===t.dataType),this.fire(new e.Event(`${t.dataType}data`,t))})),this.on("dataloading",(t=>{this.fire(new e.Event(`${t.dataType}dataloading`,t))}))}_getMapId(){return this._mapId}addControl(t,n){if(void 0===n&&(n=t.getDefaultPosition?t.getDefaultPosition():"top-right"),!t||!t.onAdd)return this.fire(new e.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const i=t.onAdd(this);this._controls.push(t);const r=this._controlPositions[n];return-1!==n.indexOf("bottom")?r.insertBefore(i,r.firstChild):r.appendChild(i),this}removeControl(t){if(!t||!t.onRemove)return this.fire(new e.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(t);return n>-1&&this._controls.splice(n,1),t.onRemove(this),this}hasControl(e){return this._controls.indexOf(e)>-1}resize(t){const n=this._containerDimensions(),i=n[0],r=n[1];this._resizeCanvas(i,r),this.transform.resize(i,r),this.painter.resize(i,r);const a=!this._moving;return a&&(this.stop(),this.fire(new e.Event("movestart",t)).fire(new e.Event("move",t))),this.fire(new e.Event("resize",t)),a&&this.fire(new e.Event("moveend",t)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(t){return this.transform.setMaxBounds(e.LngLatBounds.convert(t)),this._update()}setMinZoom(e){if((e=null==e?-2:e)>=-2&&e<=this.transform.maxZoom)return this.transform.minZoom=e,this._update(),this.getZoom()<e&&this.setZoom(e),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(e){if((e=null==e?22:e)>=this.transform.minZoom)return this.transform.maxZoom=e,this._update(),this.getZoom()>e&&this.setZoom(e),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(e){if((e=null==e?0:e)<0)throw new Error("minPitch must be greater than or equal to 0");if(e>=0&&e<=this.transform.maxPitch)return this.transform.minPitch=e,this._update(),this.getPitch()<e&&this.setPitch(e),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(e){if((e=null==e?85:e)>85)throw new Error("maxPitch must be less than or equal to 85");if(e>=this.transform.minPitch)return this.transform.maxPitch=e,this._update(),this.getPitch()>e&&this.setPitch(e),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(e){return this.transform.renderWorldCopies=e,this._update()}project(t){return this.transform.locationPoint3D(e.LngLat.convert(t))}unproject(t){return this.transform.pointLocation3D(e.pointGeometry.convert(t))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()}_createDelegatedListener(e,t,n){if("mouseenter"===e||"mouseover"===e){let i=!1;const r=r=>{const a=this.getLayer(t)?this.queryRenderedFeatures(r.point,{layers:[t]}):[];a.length?i||(i=!0,n.call(this,new Ri(e,this,r.originalEvent,{features:a}))):i=!1};return{layer:t,listener:n,delegates:{mousemove:r,mouseout:()=>{i=!1}}}}if("mouseleave"===e||"mouseout"===e){let i=!1;const r=r=>{(this.getLayer(t)?this.queryRenderedFeatures(r.point,{layers:[t]}):[]).length?i=!0:i&&(i=!1,n.call(this,new Ri(e,this,r.originalEvent)))},a=t=>{i&&(i=!1,n.call(this,new Ri(e,this,t.originalEvent)))};return{layer:t,listener:n,delegates:{mousemove:r,mouseout:a}}}{const i=e=>{const i=this.getLayer(t)?this.queryRenderedFeatures(e.point,{layers:[t]}):[];i.length&&(e.features=i,n.call(this,e),delete e.features)};return{layer:t,listener:n,delegates:{[e]:i}}}}on(e,t,n){if(void 0===n)return super.on(e,t);const i=this._createDelegatedListener(e,t,n);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[e]=this._delegatedListeners[e]||[],this._delegatedListeners[e].push(i);for(const r in i.delegates)this.on(r,i.delegates[r]);return this}once(e,t,n){if(void 0===n)return super.once(e,t);const i=this._createDelegatedListener(e,t,n);for(const r in i.delegates)this.once(r,i.delegates[r]);return this}off(e,t,n){return void 0===n?super.off(e,t):(this._delegatedListeners&&this._delegatedListeners[e]&&(i=>{const r=this._delegatedListeners[e];for(let e=0;e<r.length;e++){const i=r[e];if(i.layer===t&&i.listener===n){for(const e in i.delegates)this.off(e,i.delegates[e]);return r.splice(e,1),this}}})(),this)}queryRenderedFeatures(t,n){return this.style?(void 0!==n||void 0===t||t instanceof e.pointGeometry||Array.isArray(t)||(n=t,t=void 0),this.style.queryRenderedFeatures(t=t||[[0,0],[this.transform.width,this.transform.height]],n=n||{},this.transform)):[]}querySourceFeatures(e,t){return this.style.querySourceFeatures(e,t)}setStyle(t,n){return!1!==(n=e.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n)).diff&&n.localIdeographFontFamily===this._localIdeographFontFamily&&n.localFontFamily===this._localFontFamily&&this.style&&t?(this._diffStyle(t,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(t,n))}_getUIString(e){const t=this._locale[e];if(null==t)throw new Error(`Missing UI string '${e}'`);return t}_updateStyle(e,t){return this.style&&(this.style.setEventedParent(null),this.style._remove(),delete this.style),e&&(this.style=new Vt(this,t||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof e?this.style.loadURL(e):this.style.loadJSON(e)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Vt(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(t,n){if("string"==typeof t){const i=this._requestManager.normalizeStyleURL(t),r=this._requestManager.transformRequest(i,e.ResourceType.Style);e.getJSON(r,((t,i)=>{t?this.fire(new e.ErrorEvent(t)):i&&this._updateDiff(i,n)}))}else"object"==typeof t&&this._updateDiff(t,n)}_updateDiff(t,n){try{this.style.setState(t)&&this._update(!0)}catch(i){e.warnOnce(`Unable to perform style diff: ${i.message||i.error||i}.  Rebuilding the style from scratch.`),this._updateStyle(t,n)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():e.warnOnce("There is no style added to the map.")}addSource(e,t){return this._lazyInitEmptyStyle(),this.style.addSource(e,t),this._update(!0)}isSourceLoaded(t){const n=this.style&&this.style._getSourceCaches(t);if(0!==n.length)return n.every((e=>e.loaded()));this.fire(new e.ErrorEvent(new Error(`There is no source with ID '${t}'`)))}areTilesLoaded(){const e=this.style&&this.style._sourceCaches;for(const t in e){const n=e[t]._tiles;for(const e in n){const t=n[e];if("loaded"!==t.state&&"errored"!==t.state)return!1}}return!0}addSourceType(e,t,n){return this._lazyInitEmptyStyle(),this.style.addSourceType(e,t,n)}removeSource(e){return this.style.removeSource(e),this._updateTerrain(),this._update(!0)}getSource(e){return this.style.getSource(e)}addImage(t,n,{pixelRatio:i=1,sdf:r=!1,stretchX:a,stretchY:o,content:s}={}){if(this._lazyInitEmptyStyle(),n instanceof Cr||Lr&&n instanceof Lr){const{width:l,height:c,data:u}=e.exported.getImageData(n);this.style.addImage(t,{data:new e.RGBAImage({width:l,height:c},u),pixelRatio:i,stretchX:a,stretchY:o,content:s,sdf:r,version:0})}else{if(void 0===n.width||void 0===n.height)return this.fire(new e.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:l,height:c,data:u}=n,h=n;this.style.addImage(t,{data:new e.RGBAImage({width:l,height:c},new Uint8Array(u)),pixelRatio:i,stretchX:a,stretchY:o,content:s,sdf:r,version:0,userImage:h}),h.onAdd&&h.onAdd(this,t)}}}updateImage(t,n){const i=this.style.getImage(t);if(!i)return this.fire(new e.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const r=n instanceof Cr||Lr&&n instanceof Lr?e.exported.getImageData(n):n,{width:a,height:o,data:s}=r;return void 0===a||void 0===o?this.fire(new e.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):a!==i.data.width||o!==i.data.height?this.fire(new e.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(i.data.replace(s,!(n instanceof Cr||Lr&&n instanceof Lr)),void this.style.updateImage(t,i))}hasImage(t){return t?!!this.style.getImage(t):(this.fire(new e.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(e){this.style.removeImage(e)}loadImage(t,n){e.getImage(this._requestManager.transformRequest(t,e.ResourceType.Image),((t,i)=>{n(t,i instanceof Cr?e.exported.getImageData(i):i)}))}listImages(){return this.style.listImages()}addLayer(e,t){return this._lazyInitEmptyStyle(),this.style.addLayer(e,t),this._update(!0)}moveLayer(e,t){return this.style.moveLayer(e,t),this._update(!0)}removeLayer(e){return this.style.removeLayer(e),this._update(!0)}getLayer(e){return this.style.getLayer(e)}setLayerZoomRange(e,t,n){return this.style.setLayerZoomRange(e,t,n),this._update(!0)}setFilter(e,t,n={}){return this.style.setFilter(e,t,n),this._update(!0)}getFilter(e){return this.style.getFilter(e)}setPaintProperty(e,t,n,i={}){return this.style.setPaintProperty(e,t,n,i),this._update(!0)}getPaintProperty(e,t){return this.style.getPaintProperty(e,t)}setLayoutProperty(e,t,n,i={}){return this.style.setLayoutProperty(e,t,n,i),this._update(!0)}getLayoutProperty(e,t){return this.style.getLayoutProperty(e,t)}setLight(e,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(e,t),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(e){return this._lazyInitEmptyStyle(),this.style.setTerrain(e),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(e){return this._lazyInitEmptyStyle(),this.style.setFog(e),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(t){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(e.LngLat.convert(t),this.transform):0}queryTerrainElevation(t,n){const i=this.transform.elevation;return i?(n=e.extend({},{exaggerated:!0},n),i.getAtPoint(e.MercatorCoordinate.fromLngLat(t),null,n.exaggerated)):null}setFeatureState(e,t){return this.style.setFeatureState(e,t),this._update()}removeFeatureState(e,t){return this.style.removeFeatureState(e,t),this._update()}getFeatureState(e){return this.style.getFeatureState(e)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let e=0,t=0;return this._container&&(e=this._container.clientWidth||400,t=this._container.clientHeight||300),[e,t]}_detectMissingCSS(){"rgb(250, 128, 114)"!==e.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&e.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const e=this._container;e.classList.add("mapboxgl-map"),(this._missingCSSCanary=a.create("div","mapboxgl-canary",e)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=a.create("div","mapboxgl-canvas-container",e);this._interactive&&t.classList.add("mapboxgl-interactive"),this._canvas=a.create("canvas","mapboxgl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const n=this._containerDimensions();this._resizeCanvas(n[0],n[1]);const i=this._controlContainer=a.create("div","mapboxgl-control-container",e),r=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((e=>{r[e]=a.create("div",`mapboxgl-ctrl-${e}`,i)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(t,n){const i=e.exported.devicePixelRatio||1;this._canvas.width=i*t,this._canvas.height=i*n,this._canvas.style.width=`${t}px`,this._canvas.style.height=`${n}px`}_addMarker(e){this._markers.push(e)}_removeMarker(e){const t=this._markers.indexOf(e);-1!==t&&this._markers.splice(t,1)}_setupPainter(){const n=e.extend({},t.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),i=this._canvas.getContext("webgl",n)||this._canvas.getContext("experimental-webgl",n);i?(e.storeAuthState(i,!0),this.painter=new pi(i,this.transform),this.on("data",(e=>{"source"===e.dataType&&this.painter.setTileLoadedFlag(!0)})),e.exported$1.testSupport(i)):this.fire(new e.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(t){t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new e.Event("webglcontextlost",{originalEvent:t}))}_contextRestored(t){this._setupPainter(),this.resize(),this._update(),this.fire(new e.Event("webglcontextrestored",{originalEvent:t}))}_onMapScroll(e){if(e.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(e){return this.style?(this._styleDirty=this._styleDirty||e,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(e){return this._update(),this._renderTaskQueue.add(e)}_cancelRenderFrame(e){this._renderTaskQueue.remove(e)}_requestDomTask(e){!this.isMoving()&&this.loaded()?e():this._domRenderTaskQueue.add(e)}_render(t){let n;const i=this.painter.context.extTimerQuery,r=e.exported.now();this.listens("gpu-timing-frame")&&(n=i.createQueryEXT(),i.beginQueryEXT(i.TIME_ELAPSED_EXT,n));let a=this._updateAverageElevation(r);if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(t),this._domRenderTaskQueue.run(t),this._removed)return;let o=!1;const s=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const t=this.transform.zoom,n=e.exported.now();this.style.zoomHistory.update(t,n);const i=new e.EvaluationParameters(t,{now:n,fadeDuration:s,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),r=i.crossFadingFactor();1===r&&r===this._crossFadingFactor||(o=!0,this._crossFadingFactor=r),this.style.update(i)}if(this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0),this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,s,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:s,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new e.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new e.Event("load"))),this.style&&(this.style.hasTransitions()||o)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const t=e.exported.now()-r;i.endQueryEXT(i.TIME_ELAPSED_EXT,n),setTimeout((()=>{const r=i.getQueryObjectEXT(n,i.QUERY_RESULT_EXT)/1e6;i.deleteQueryEXT(n),this.fire(new e.Event("gpu-timing-frame",{cpuTime:t,gpuTime:r}))}),50)}if(this.listens("gpu-timing-layer")){const t=this.painter.collectGpuTimers();setTimeout((()=>{const n=this.painter.queryGpuTimers(t);this.fire(new e.Event("gpu-timing-layer",{layerTimes:n}))}),50)}const l=this._sourcesDirty||this._styleDirty||this._placementDirty||a;if(l||this._repaint)this.triggerRepaint();else{const t=!this.isMoving()&&this.loaded();if(t&&(a=this._updateAverageElevation(r,!0)),a)this.triggerRepaint();else if(this._triggerFrame(!1),t&&(this.fire(new e.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const t=this._calculateSpeedIndex();this.fire(new e.Event("speedindexcompleted",{speedIndex:t})),this.speedIndexTiming=!1}}return!this._loaded||this._fullyLoaded||l||(this._fullyLoaded=!0,this._authenticate()),this}_updateAverageElevation(e,t=!1){const n=e=>(this.transform.averageElevation=e,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&n(0);if((t||e-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(e)){const t=this.transform.averageElevation;let i=this.transform.sampleAverageElevation();isNaN(i)?i=0:this._averageElevationLastSampledAt=e;const r=Math.abs(t-i);if(r>1)this._averageElevation.easeTo(i,e,300);else if(r>1e-4)return this._averageElevation.jumpTo(i),n(i)}return!!this._averageElevation.isEasing(e)&&n(this._averageElevation.getValue(e))}_authenticate(){e.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(t=>{if(t&&(t.message===e.AUTH_ERR_MSG||401===t.status)){const t=this.painter.context.gl;e.storeAuthState(t,!1),this._logoControl instanceof br&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new e.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}})),e.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(()=>{}))}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const e=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const n=this.painter.context.gl,i=n.createFramebuffer();function r(e){n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0);const t=new Uint8Array(n.drawingBufferWidth*n.drawingBufferHeight*4);return n.readPixels(0,0,n.drawingBufferWidth,n.drawingBufferHeight,n.RGBA,n.UNSIGNED_BYTE,t),t}return n.bindFramebuffer(n.FRAMEBUFFER,i),this._canvasPixelComparison(r(e),t.canvasCopies.map(r),t.timeStamps)}_canvasPixelComparison(e,t,n){let i=n[1]-n[0];const r=e.length/4;for(let a=0;a<t.length;a++){const o=t[a];let s=0;for(let t=0;t<o.length;t+=4)o[t]===e[t]&&o[t+1]===e[t+1]&&o[t+2]===e[t+2]&&o[t+3]===e[t+3]&&(s+=1);i+=(n[a+2]-n[a+1])*(1-s/r)}return i}remove(){this._hash&&this._hash.remove();for(const e of this._controls)e.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),void 0!==e.window&&(e.window.removeEventListener("resize",this._onWindowResize,!1),e.window.removeEventListener("orientationchange",this._onWindowResize,!1),e.window.removeEventListener("online",this._onWindowOnline,!1));const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),Rr(this._canvasContainer),Rr(this._controlContainer),Rr(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),e.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new e.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(t){this._renderNextFrame=this._renderNextFrame||t,this.style&&!this._frame&&(this._frame=e.exported.frame((e=>{const t=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,t&&this._render(e)})))}_onWindowOnline(){this._update()}_onWindowResize(e){this._trackResize&&this.resize({originalEvent:e})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(e){this._showTileBoundaries!==e&&(this._showTileBoundaries=e,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(e){this._showTerrainWireframe!==e&&(this._showTerrainWireframe=e,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(e){this._speedIndexTiming!==e&&(this._speedIndexTiming=e,this._update())}get showPadding(){return!!this._showPadding}set showPadding(e){this._showPadding!==e&&(this._showPadding=e,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(e){this._showCollisionBoxes!==e&&(this._showCollisionBoxes=e,e?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(e){this._showOverdrawInspector!==e&&(this._showOverdrawInspector=e,this._update())}get repaint(){return!!this._repaint}set repaint(e){this._repaint!==e&&(this._repaint=e,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(e){this._vertices=e,this._update()}_setCacheLimits(t,n){e.setCacheLimits(t,n)}get version(){return e.version}},NavigationControl:class{constructor(t){this.options=e.extend({},zr,t),this._container=a.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this.options.showZoom&&(e.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(e=>this._map.zoomIn({},{originalEvent:e}))),a.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(e=>this._map.zoomOut({},{originalEvent:e}))),a.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(e.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})})),this._compassIcon=a.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))}_updateZoomButtons(){const e=this._map.getZoom(),t=e===this._map.getMaxZoom(),n=e===this._map.getMinZoom();this._zoomInButton.disabled=t,this._zoomOutButton.disabled=n,this._zoomInButton.setAttribute("aria-disabled",t.toString()),this._zoomOutButton.setAttribute("aria-disabled",n.toString())}_rotateCompassArrow(){const e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._map._requestDomTask((()=>{this._compassIcon&&(this._compassIcon.style.transform=e)}))}onAdd(e){return this._map=e,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Dr(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){a.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(e,t){const n=a.create("button",e,this._container);return n.type="button",n.addEventListener("click",t),n}_setButtonTitle(e,t){const n=this._map._getUIString(`NavigationControl.${t}`);e.title=n,e.setAttribute("aria-label",n)}},GeolocateControl:class extends e.Evented{constructor(t){super(),this.options=e.extend({},Or,t),e.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(t){var n;return this._map=t,this._container=a.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),n=this._setupUI,void 0!==Br?n(Br):void 0!==e.window.navigator.permissions?e.window.navigator.permissions.query({name:"geolocation"}).then((e=>{Br="denied"!==e.state,n(Br)})):(Br=!!e.window.navigator.geolocation,n(Br)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(e.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),a.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Fr=0,Nr=!1}_isOutOfMapMaxBounds(e){const t=this._map.getMaxBounds(),n=e.coords;return t&&(n.longitude<t.getWest()||n.longitude>t.getEast()||n.latitude<t.getSouth()||n.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(t){if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new e.Event("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(t),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new e.Event("geolocate",t)),this._finish()}}_updateCamera(t){const n=new e.LngLat(t.coords.longitude,t.coords.latitude),i=t.coords.accuracy,r=this._map.getBearing(),a=e.extend({bearing:r},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(i),a,{geolocateSource:!0})}_updateMarker(t){if(t){const n=new e.LngLat(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const e=this._map._container.clientHeight/2,t=this._map.unproject([0,e]),n=this._map.unproject([100,e]),i=t.distanceTo(n)/100,r=Math.ceil(2*this._accuracy/i);this._circleElement.style.width=`${r}px`,this._circleElement.style.height=`${r}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(t){if(this._map){if(this.options.trackUserLocation)if(1===t.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=e,this._geolocateButton.setAttribute("aria-label",e),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===t.code&&Nr)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new e.Event("error",t)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(t){if(this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this._geolocateButton=a.create("button","mapboxgl-ctrl-geolocate",this._container),a.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",!1===t){e.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}else{const e=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=e,this._geolocateButton.setAttribute("aria-label",e)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=a.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new Mr(this._dotElement),this._circleElement=a.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Mr({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(t=>{t.geolocateSource||"ACTIVE_LOCK"!==this._watchState||t.originalEvent&&"resize"===t.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new e.Event("trackuserlocationend")))}))}trigger(){if(!this._setup)return e.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new e.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Fr--,Nr=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new e.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new e.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let t;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Fr++,Fr>1?(t={maximumAge:6e5,timeout:0},Nr=!0):(t=this.options.positionOptions,Nr=!1),this._geolocationWatchID=e.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,t)}}else e.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){e.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:xr,ScaleControl:class{constructor(t){this.options=e.extend({},Ur,t),e.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){Vr(this._map,this._container,this.options)}onAdd(e){return this._map=e,this._container=a.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",e.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){a.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(e){this.options.unit=e,Vr(this._map,this._container,this.options)}},FullscreenControl:class{constructor(t){this._fullscreen=!1,t&&t.container&&(t.container instanceof e.window.HTMLElement?this._container=t.container:e.warnOnce("Full screen control 'container' must be a DOM element.")),e.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in e.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in e.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(t){return this._map=t,this._container||(this._container=this._map.getContainer()),this._controlContainer=a.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",e.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){a.remove(this._controlContainer),this._map=null,e.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!e.window.document.fullscreenEnabled&&!e.window.document.webkitFullscreenEnabled)}_setupUI(){const t=this._fullscreenButton=a.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);a.create("span","mapboxgl-ctrl-icon",t).setAttribute("aria-hidden",!0),t.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),e.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const e=this._getTitle();this._fullscreenButton.setAttribute("aria-label",e),this._fullscreenButton.title=e}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(e.window.document.fullscreenElement||e.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?e.window.document.exitFullscreen?e.window.document.exitFullscreen():e.window.document.webkitCancelFullScreen&&e.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends e.Evented{constructor(t){super(),this.options=e.extend(Object.create(Gr),t),e.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(t){return this._map&&this.remove(),this._map=t,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new e.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&a.remove(this._content),this._container&&(a.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new e.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=e.LngLat.convert(t),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(t){return this.setDOMContent(e.window.document.createTextNode(t))}setHTML(t){const n=e.window.document.createDocumentFragment(),i=e.window.document.createElement("body");let r;for(i.innerHTML=t;r=i.firstChild,r;)n.appendChild(r);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(e){return this.options.maxWidth=e,this._update(),this}setDOMContent(e){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=a.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(e),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(e){this._container&&this._container.classList.add(e)}removeClassName(e){this._container&&this._container.classList.remove(e)}setOffset(e){return this.options.offset=e,this._update(),this}toggleClassName(e){if(this._container)return this._container.classList.toggle(e)}_createCloseButton(){this.options.closeButton&&(this._closeButton=a.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(e){this._update(e.point)}_onMouseMove(e){this._update(e.point)}_onDrag(e){this._update(e.point)}_update(e){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(this._container||(this._container=a.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=a.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach((e=>this._container.classList.add(e))),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Sr(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!e)return;const t=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);let n=this.options.anchor;const i=Wr(this.options.offset);if(!n){const e=this._container.offsetWidth,r=this._container.offsetHeight;let a;a=t.y+i.bottom.y<r?["top"]:t.y>this._map.transform.height-r?["bottom"]:[],t.x<e/2?a.push("left"):t.x>this._map.transform.width-e/2&&a.push("right"),n=0===a.length?"bottom":a.join("-")}const r=t.add(i[n]).round();this._map._requestDomTask((()=>{this._container&&n&&(a.setTransform(this._container,`${Tr[n]} translate(${r.x}px,${r.y}px)`),Er(this._container,n,"popup"))}))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const e=this._container.querySelector(Hr);e&&e.focus()}_onClose(){this.remove()}_setOpacity(e){this._content&&(this._content.style.opacity=e),this._tip&&(this._tip.style.opacity=e)}},Marker:Mr,Style:Vt,LngLat:e.LngLat,LngLatBounds:e.LngLatBounds,Point:e.pointGeometry,MercatorCoordinate:e.MercatorCoordinate,FreeCameraOptions:bi,Evented:e.Evented,config:e.config,prewarm:function(){De().acquire(Ie)},clearPrewarmedResources:function(){const e=ze;e&&(e.isPreloaded()&&1===e.numActive()?(e.release(Ie),ze=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return e.config.ACCESS_TOKEN},set accessToken(t){e.config.ACCESS_TOKEN=t},get baseApiUrl(){return e.config.API_URL},set baseApiUrl(t){e.config.API_URL=t},get workerCount(){return Re.workerCount},set workerCount(e){Re.workerCount=e},get maxParallelImageRequests(){return e.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(t){e.config.MAX_PARALLEL_IMAGE_REQUESTS=t},clearStorage(t){e.clearTileCache(t)},workerUrl:"",workerClass:null,setNow:e.exported.setNow,restoreNow:e.exported.restoreNow};return qr})),n}()},function(e,t,n){"use strict";var i=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable;function o(e){if(null===e||void 0===e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var i={};return"abcdefghijklmnopqrst".split("").forEach((function(e){i[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},i)).join("")}catch(r){return!1}}()?Object.assign:function(e,t){for(var n,s,l=o(e),c=1;c<arguments.length;c++){for(var u in n=Object(arguments[c]))r.call(n,u)&&(l[u]=n[u]);if(i){s=i(n);for(var h=0;h<s.length;h++)a.call(n,s[h])&&(l[s[h]]=n[s[h]])}}return l}},function(e,t,n){"use strict";n.d(t,"a",(function(){return dt})),n.d(t,"b",(function(){return Te}));var i=n(8),r=n.n(i),a=n(11),o=n(19);function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var l=n(10),c=n(12),u=n(4);function h(e,t,n){return(h="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Object(u.a)(e)););return e}(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(n):r.value}})(e,t,n||e)}function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}for(var p,f=n(6),m=n(1),g=n(2),v=n(0),y=n(3),_=100,x=301,b=302,w=306,S=307,T=1e3,E=1001,M=1002,k=1003,A=1004,C=1005,P=1006,L=1008,I=1009,R=1012,z=1014,D=1015,O=1016,B=1020,F=1022,N=1023,U=1026,V=1027,j=2300,G=2301,H=2302,W=2400,q=2401,Z=2402,$=2500,X=2501,Y=3e3,J=3001,K=3007,Q=3002,ee=7680,te=35044,ne=35048,ie="300 es",re=function(){function e(){Object(v.a)(this,e)}return Object(y.a)(e,[{key:"addEventListener",value:function(e,t){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}},{key:"hasEventListener",value:function(e,t){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}},{key:"removeEventListener",value:function(e,t){if(void 0!==this._listeners){var n=this._listeners[e];if(void 0!==n){var i=n.indexOf(t);-1!==i&&n.splice(i,1)}}}},{key:"dispatchEvent",value:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var n=t.slice(0),i=0,r=n.length;i<r;i++)n[i].call(this,e);e.target=null}}}}]),e}(),ae=[],oe=0;oe<256;oe++)ae[oe]=(oe<16?"0":"")+oe.toString(16);var se=Math.PI/180,le=180/Math.PI;function ce(){var e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(ae[255&e]+ae[e>>8&255]+ae[e>>16&255]+ae[e>>24&255]+"-"+ae[255&t]+ae[t>>8&255]+"-"+ae[t>>16&15|64]+ae[t>>24&255]+"-"+ae[63&n|128]+ae[n>>8&255]+"-"+ae[n>>16&255]+ae[n>>24&255]+ae[255&i]+ae[i>>8&255]+ae[i>>16&255]+ae[i>>24&255]).toUpperCase()}function ue(e,t,n){return Math.max(t,Math.min(n,e))}function he(e,t){return(e%t+t)%t}function de(e,t,n){return(1-n)*e+n*t}function pe(e){return 0===(e&e-1)&&0!==e}function fe(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}var me=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Object(v.a)(this,e),this.x=t,this.y=n}return Object(y.a)(e,[{key:"width",get:function(){return this.x},set:function(e){this.x=e}},{key:"height",get:function(){return this.y},set:function(e){this.y=e}},{key:"set",value:function(e,t){return this.x=e,this.y=t,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this}},{key:"add",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}},{key:"sub",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"applyMatrix3",value:function(e){var t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}},{key:"clampScalar",value:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}},{key:"clampLength",value:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y}},{key:"cross",value:function(e){return this.x*e.y-this.y*e.x}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"angle",value:function(){var e=Math.atan2(-this.y,-this.x)+Math.PI;return e}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n}},{key:"manhattanDistanceTo",value:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e}},{key:"fromBufferAttribute",value:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}},{key:"rotateAround",value:function(e,t){var n=Math.cos(t),i=Math.sin(t),r=this.x-e.x,a=this.y-e.y;return this.x=r*n-a*i+e.x,this.y=r*i+a*n+e.y,this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this}}]),e}();me.prototype.isVector2=!0;var ge,ve=function(){function e(){Object(v.a)(this,e),this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}return Object(y.a)(e,[{key:"set",value:function(e,t,n,i,r,a,o,s,l){var c=this.elements;return c[0]=e,c[1]=i,c[2]=o,c[3]=t,c[4]=r,c[5]=s,c[6]=n,c[7]=a,c[8]=l,this}},{key:"identity",value:function(){return this.set(1,0,0,0,1,0,0,0,1),this}},{key:"copy",value:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}},{key:"extractBasis",value:function(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}},{key:"setFromMatrix4",value:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}},{key:"multiply",value:function(e){return this.multiplyMatrices(this,e)}},{key:"premultiply",value:function(e){return this.multiplyMatrices(e,this)}},{key:"multiplyMatrices",value:function(e,t){var n=e.elements,i=t.elements,r=this.elements,a=n[0],o=n[3],s=n[6],l=n[1],c=n[4],u=n[7],h=n[2],d=n[5],p=n[8],f=i[0],m=i[3],g=i[6],v=i[1],y=i[4],_=i[7],x=i[2],b=i[5],w=i[8];return r[0]=a*f+o*v+s*x,r[3]=a*m+o*y+s*b,r[6]=a*g+o*_+s*w,r[1]=l*f+c*v+u*x,r[4]=l*m+c*y+u*b,r[7]=l*g+c*_+u*w,r[2]=h*f+d*v+p*x,r[5]=h*m+d*y+p*b,r[8]=h*g+d*_+p*w,this}},{key:"multiplyScalar",value:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}},{key:"determinant",value:function(){var e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],a=e[4],o=e[5],s=e[6],l=e[7],c=e[8];return t*a*c-t*o*l-n*r*c+n*o*s+i*r*l-i*a*s}},{key:"invert",value:function(){var e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],a=e[4],o=e[5],s=e[6],l=e[7],c=e[8],u=c*a-o*l,h=o*s-c*r,d=l*r-a*s,p=t*u+n*h+i*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);var f=1/p;return e[0]=u*f,e[1]=(i*l-c*n)*f,e[2]=(o*n-i*a)*f,e[3]=h*f,e[4]=(c*t-i*s)*f,e[5]=(i*r-o*t)*f,e[6]=d*f,e[7]=(n*s-l*t)*f,e[8]=(a*t-n*r)*f,this}},{key:"transpose",value:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}},{key:"getNormalMatrix",value:function(e){return this.setFromMatrix4(e).invert().transpose()}},{key:"transposeIntoArray",value:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}},{key:"setUvTransform",value:function(e,t,n,i,r,a,o){var s=Math.cos(r),l=Math.sin(r);return this.set(n*s,n*l,-n*(s*a+l*o)+a+e,-i*l,i*s,-i*(-l*a+s*o)+o+t,0,0,1),this}},{key:"scale",value:function(e,t){var n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}},{key:"rotate",value:function(e){var t=Math.cos(e),n=Math.sin(e),i=this.elements,r=i[0],a=i[3],o=i[6],s=i[1],l=i[4],c=i[7];return i[0]=t*r+n*s,i[3]=t*a+n*l,i[6]=t*o+n*c,i[1]=-n*r+t*s,i[4]=-n*a+t*l,i[7]=-n*o+t*c,this}},{key:"translate",value:function(e,t){var n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}},{key:"equals",value:function(e){for(var t=this.elements,n=e.elements,i=0;i<9;i++)if(t[i]!==n[i])return!1;return!0}},{key:"fromArray",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<9;n++)this.elements[n]=e[n+t];return this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}},{key:"clone",value:function(){return(new this.constructor).fromArray(this.elements)}}]),e}();ve.prototype.isMatrix3=!0;var ye=function(){function e(){Object(v.a)(this,e)}return Object(y.a)(e,null,[{key:"getDataURL",value:function(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;var t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===ge&&(ge=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),ge.width=e.width,ge.height=e.height;var n=ge.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=ge}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}}]),e}(),_e=0,xe=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.DEFAULT_IMAGE,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.DEFAULT_MAPPING,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:E,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:P,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:L,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:N,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:I,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:1,d=arguments.length>9&&void 0!==arguments[9]?arguments[9]:Y;return Object(v.a)(this,n),e=t.call(this),Object.defineProperty(Object(f.a)(e),"id",{value:_e++}),e.uuid=ce(),e.name="",e.image=i,e.mipmaps=[],e.mapping=r,e.wrapS=a,e.wrapT=o,e.magFilter=s,e.minFilter=l,e.anisotropy=h,e.format=c,e.internalFormat=null,e.type=u,e.offset=new me(0,0),e.repeat=new me(1,1),e.center=new me(0,0),e.rotation=0,e.matrixAutoUpdate=!0,e.matrix=new ve,e.generateMipmaps=!0,e.premultiplyAlpha=!1,e.flipY=!0,e.unpackAlignment=4,e.encoding=d,e.version=0,e.onUpdate=null,e}return Object(y.a)(n,[{key:"updateMatrix",value:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this}},{key:"toJSON",value:function(e){var t=void 0===e||"string"===typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];var n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){var i=this.image;if(void 0===i.uuid&&(i.uuid=ce()),!t&&void 0===e.images[i.uuid]){var r;if(Array.isArray(i)){r=[];for(var a=0,o=i.length;a<o;a++)i[a].isDataTexture?r.push(be(i[a].image)):r.push(be(i[a]))}else r=be(i);e.images[i.uuid]={uuid:i.uuid,url:r}}n.image=i.uuid}return t||(e.textures[this.uuid]=n),n}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}},{key:"transformUv",value:function(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case T:e.x=e.x-Math.floor(e.x);break;case E:e.x=e.x<0?0:1;break;case M:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case T:e.y=e.y-Math.floor(e.y);break;case E:e.y=e.y<0?0:1;break;case M:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}},{key:"needsUpdate",set:function(e){!0===e&&this.version++}}]),n}(re);function be(e){return"undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap?ye.getDataURL(e):e.data?{data:Array.prototype.slice.call(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}xe.DEFAULT_IMAGE=void 0,xe.DEFAULT_MAPPING=300,xe.prototype.isTexture=!0;var we=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;Object(v.a)(this,e),this.x=t,this.y=n,this.z=i,this.w=r}return Object(y.a)(e,[{key:"width",get:function(){return this.z},set:function(e){this.z=e}},{key:"height",get:function(){return this.w},set:function(e){this.w=e}},{key:"set",value:function(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setZ",value:function(e){return this.z=e,this}},{key:"setW",value:function(e){return this.w=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}},{key:"add",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}},{key:"sub",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}},{key:"applyMatrix4",value:function(e){var t=this.x,n=this.y,i=this.z,r=this.w,a=e.elements;return this.x=a[0]*t+a[4]*n+a[8]*i+a[12]*r,this.y=a[1]*t+a[5]*n+a[9]*i+a[13]*r,this.z=a[2]*t+a[6]*n+a[10]*i+a[14]*r,this.w=a[3]*t+a[7]*n+a[11]*i+a[15]*r,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"setAxisAngleFromQuaternion",value:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}},{key:"setAxisAngleFromRotationMatrix",value:function(e){var t,n,i,r,a=.01,o=.1,s=e.elements,l=s[0],c=s[4],u=s[8],h=s[1],d=s[5],p=s[9],f=s[2],m=s[6],g=s[10];if(Math.abs(c-h)<a&&Math.abs(u-f)<a&&Math.abs(p-m)<a){if(Math.abs(c+h)<o&&Math.abs(u+f)<o&&Math.abs(p+m)<o&&Math.abs(l+d+g-3)<o)return this.set(1,0,0,0),this;t=Math.PI;var v=(l+1)/2,y=(d+1)/2,_=(g+1)/2,x=(c+h)/4,b=(u+f)/4,w=(p+m)/4;return v>y&&v>_?v<a?(n=0,i=.707106781,r=.707106781):(i=x/(n=Math.sqrt(v)),r=b/n):y>_?y<a?(n=.707106781,i=0,r=.707106781):(n=x/(i=Math.sqrt(y)),r=w/i):_<a?(n=.707106781,i=.707106781,r=0):(n=b/(r=Math.sqrt(_)),i=w/r),this.set(n,i,r,t),this}var S=Math.sqrt((m-p)*(m-p)+(u-f)*(u-f)+(h-c)*(h-c));return Math.abs(S)<.001&&(S=1),this.x=(m-p)/S,this.y=(u-f)/S,this.z=(h-c)/S,this.w=Math.acos((l+d+g-1)/2),this}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}},{key:"clampScalar",value:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}},{key:"clampLength",value:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}},{key:"fromBufferAttribute",value:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}]),e}();we.prototype.isVector4=!0;var Se=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e,i,r){var a;return Object(v.a)(this,n),(a=t.call(this)).width=e,a.height=i,a.depth=1,a.scissor=new we(0,0,e,i),a.scissorTest=!1,a.viewport=new we(0,0,e,i),r=r||{},a.texture=new xe(void 0,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),a.texture.image={},a.texture.image.width=e,a.texture.image.height=i,a.texture.image.depth=1,a.texture.generateMipmaps=void 0!==r.generateMipmaps&&r.generateMipmaps,a.texture.minFilter=void 0!==r.minFilter?r.minFilter:P,a.depthBuffer=void 0===r.depthBuffer||r.depthBuffer,a.stencilBuffer=void 0!==r.stencilBuffer&&r.stencilBuffer,a.depthTexture=void 0!==r.depthTexture?r.depthTexture:null,a}return Object(y.a)(n,[{key:"setTexture",value:function(e){e.image={width:this.width,height:this.height,depth:this.depth},this.texture=e}},{key:"setSize",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this.width===e&&this.height===t&&this.depth===n||(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.image=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},this.texture.image),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}}]),n}(re);Se.prototype.isWebGLRenderTarget=!0,function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e,i,r){var a;Object(v.a)(this,n);var o=(a=t.call(this,e,i)).texture;a.texture=[];for(var s=0;s<r;s++)a.texture[s]=o.clone();return a}return Object(y.a)(n,[{key:"setSize",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(var i=0,r=this.texture.length;i<r;i++)this.texture[i].image.width=e,this.texture[i].image.height=t,this.texture[i].image.depth=n;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}},{key:"copy",value:function(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this.texture.length=0;for(var t=0,n=e.texture.length;t<n;t++)this.texture[t]=e.texture[t].clone();return this}}]),n}(Se).prototype.isWebGLMultipleRenderTargets=!0,function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e,i,r){var a;return Object(v.a)(this,n),(a=t.call(this,e,i,r)).samples=4,a}return Object(y.a)(n,[{key:"copy",value:function(e){return h(Object(u.a)(n.prototype),"copy",this).call(this,e),this.samples=e.samples,this}}]),n}(Se).prototype.isWebGLMultisampleRenderTarget=!0;var Te=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;Object(v.a)(this,e),this._x=t,this._y=n,this._z=i,this._w=r}return Object(y.a)(e,[{key:"x",get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},{key:"w",get:function(){return this._w},set:function(e){this._w=e,this._onChangeCallback()}},{key:"set",value:function(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}},{key:"clone",value:function(){return new this.constructor(this._x,this._y,this._z,this._w)}},{key:"copy",value:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}},{key:"setFromEuler",value:function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var n=e._x,i=e._y,r=e._z,a=e._order,o=Math.cos,s=Math.sin,l=o(n/2),c=o(i/2),u=o(r/2),h=s(n/2),d=s(i/2),p=s(r/2);switch(a){case"XYZ":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"YXZ":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"ZXY":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"ZYX":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"YZX":this._x=h*c*u+l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u-h*d*p;break;case"XZY":this._x=h*c*u-l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u+h*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return!1!==t&&this._onChangeCallback(),this}},{key:"setFromAxisAngle",value:function(e,t){var n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}},{key:"setFromRotationMatrix",value:function(e){var t=e.elements,n=t[0],i=t[4],r=t[8],a=t[1],o=t[5],s=t[9],l=t[2],c=t[6],u=t[10],h=n+o+u;if(h>0){var d=.5/Math.sqrt(h+1);this._w=.25/d,this._x=(c-s)*d,this._y=(r-l)*d,this._z=(a-i)*d}else if(n>o&&n>u){var p=2*Math.sqrt(1+n-o-u);this._w=(c-s)/p,this._x=.25*p,this._y=(i+a)/p,this._z=(r+l)/p}else if(o>u){var f=2*Math.sqrt(1+o-n-u);this._w=(r-l)/f,this._x=(i+a)/f,this._y=.25*f,this._z=(s+c)/f}else{var m=2*Math.sqrt(1+u-n-o);this._w=(a-i)/m,this._x=(r+l)/m,this._y=(s+c)/m,this._z=.25*m}return this._onChangeCallback(),this}},{key:"setFromUnitVectors",value:function(e,t){var n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}},{key:"angleTo",value:function(e){return 2*Math.acos(Math.abs(ue(this.dot(e),-1,1)))}},{key:"rotateTowards",value:function(e,t){var n=this.angleTo(e);if(0===n)return this;var i=Math.min(1,t/n);return this.slerp(e,i),this}},{key:"identity",value:function(){return this.set(0,0,0,1)}},{key:"invert",value:function(){return this.conjugate()}},{key:"conjugate",value:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}},{key:"dot",value:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}},{key:"lengthSq",value:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}},{key:"length",value:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}},{key:"normalize",value:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}},{key:"premultiply",value:function(e){return this.multiplyQuaternions(e,this)}},{key:"multiplyQuaternions",value:function(e,t){var n=e._x,i=e._y,r=e._z,a=e._w,o=t._x,s=t._y,l=t._z,c=t._w;return this._x=n*c+a*o+i*l-r*s,this._y=i*c+a*s+r*o-n*l,this._z=r*c+a*l+n*s-i*o,this._w=a*c-n*o-i*s-r*l,this._onChangeCallback(),this}},{key:"slerp",value:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var n=this._x,i=this._y,r=this._z,a=this._w,o=a*e._w+n*e._x+i*e._y+r*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=a,this._x=n,this._y=i,this._z=r,this;var s=1-o*o;if(s<=Number.EPSILON){var l=1-t;return this._w=l*a+t*this._w,this._x=l*n+t*this._x,this._y=l*i+t*this._y,this._z=l*r+t*this._z,this.normalize(),this._onChangeCallback(),this}var c=Math.sqrt(s),u=Math.atan2(c,o),h=Math.sin((1-t)*u)/c,d=Math.sin(t*u)/c;return this._w=a*h+this._w*d,this._x=n*h+this._x*d,this._y=i*h+this._y*d,this._z=r*h+this._z*d,this._onChangeCallback(),this}},{key:"slerpQuaternions",value:function(e,t,n){this.copy(e).slerp(t,n)}},{key:"equals",value:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}},{key:"fromBufferAttribute",value:function(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}},{key:"_onChange",value:function(e){return this._onChangeCallback=e,this}},{key:"_onChangeCallback",value:function(){}}],[{key:"slerp",value:function(e,t,n,i){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),n.slerpQuaternions(e,t,i)}},{key:"slerpFlat",value:function(e,t,n,i,r,a,o){var s=n[i+0],l=n[i+1],c=n[i+2],u=n[i+3],h=r[a+0],d=r[a+1],p=r[a+2],f=r[a+3];if(0===o)return e[t+0]=s,e[t+1]=l,e[t+2]=c,void(e[t+3]=u);if(1===o)return e[t+0]=h,e[t+1]=d,e[t+2]=p,void(e[t+3]=f);if(u!==f||s!==h||l!==d||c!==p){var m=1-o,g=s*h+l*d+c*p+u*f,v=g>=0?1:-1,y=1-g*g;if(y>Number.EPSILON){var _=Math.sqrt(y),x=Math.atan2(_,g*v);m=Math.sin(m*x)/_,o=Math.sin(o*x)/_}var b=o*v;if(s=s*m+h*b,l=l*m+d*b,c=c*m+p*b,u=u*m+f*b,m===1-o){var w=1/Math.sqrt(s*s+l*l+c*c+u*u);s*=w,l*=w,c*=w,u*=w}}e[t]=s,e[t+1]=l,e[t+2]=c,e[t+3]=u}},{key:"multiplyQuaternionsFlat",value:function(e,t,n,i,r,a){var o=n[i],s=n[i+1],l=n[i+2],c=n[i+3],u=r[a],h=r[a+1],d=r[a+2],p=r[a+3];return e[t]=o*p+c*u+s*d-l*h,e[t+1]=s*p+c*h+l*u-o*d,e[t+2]=l*p+c*d+o*h-s*u,e[t+3]=c*p-o*u-s*h-l*d,e}}]),e}();Te.prototype.isQuaternion=!0;var Ee=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Object(v.a)(this,e),this.x=t,this.y=n,this.z=i}return Object(y.a)(e,[{key:"set",value:function(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this.z=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setZ",value:function(e){return this.z=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:"add",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}},{key:"sub",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:"multiplyVectors",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}},{key:"applyEuler",value:function(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(ke.setFromEuler(e))}},{key:"applyAxisAngle",value:function(e,t){return this.applyQuaternion(ke.setFromAxisAngle(e,t))}},{key:"applyMatrix3",value:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*i,this.y=r[1]*t+r[4]*n+r[7]*i,this.z=r[2]*t+r[5]*n+r[8]*i,this}},{key:"applyNormalMatrix",value:function(e){return this.applyMatrix3(e).normalize()}},{key:"applyMatrix4",value:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements,a=1/(r[3]*t+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*i+r[12])*a,this.y=(r[1]*t+r[5]*n+r[9]*i+r[13])*a,this.z=(r[2]*t+r[6]*n+r[10]*i+r[14])*a,this}},{key:"applyQuaternion",value:function(e){var t=this.x,n=this.y,i=this.z,r=e.x,a=e.y,o=e.z,s=e.w,l=s*t+a*i-o*n,c=s*n+o*t-r*i,u=s*i+r*n-a*t,h=-r*t-a*n-o*i;return this.x=l*s+h*-r+c*-o-u*-a,this.y=c*s+h*-a+u*-r-l*-o,this.z=u*s+h*-o+l*-a-c*-r,this}},{key:"project",value:function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}},{key:"unproject",value:function(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}},{key:"transformDirection",value:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i,this.y=r[1]*t+r[5]*n+r[9]*i,this.z=r[2]*t+r[6]*n+r[10]*i,this.normalize()}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}},{key:"clampScalar",value:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}},{key:"clampLength",value:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}},{key:"cross",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}},{key:"crossVectors",value:function(e,t){var n=e.x,i=e.y,r=e.z,a=t.x,o=t.y,s=t.z;return this.x=i*s-r*o,this.y=r*a-n*s,this.z=n*o-i*a,this}},{key:"projectOnVector",value:function(e){var t=e.lengthSq();if(0===t)return this.set(0,0,0);var n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}},{key:"projectOnPlane",value:function(e){return Me.copy(this).projectOnVector(e),this.sub(Me)}},{key:"reflect",value:function(e){return this.sub(Me.copy(e).multiplyScalar(2*this.dot(e)))}},{key:"angleTo",value:function(e){var t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;var n=this.dot(e)/t;return Math.acos(ue(n,-1,1))}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}},{key:"manhattanDistanceTo",value:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}},{key:"setFromSpherical",value:function(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}},{key:"setFromSphericalCoords",value:function(e,t,n){var i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}},{key:"setFromCylindrical",value:function(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}},{key:"setFromCylindricalCoords",value:function(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}},{key:"setFromMatrixPosition",value:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}},{key:"setFromMatrixScale",value:function(e){var t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}},{key:"setFromMatrixColumn",value:function(e,t){return this.fromArray(e.elements,4*t)}},{key:"setFromMatrix3Column",value:function(e,t){return this.fromArray(e.elements,3*t)}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}},{key:"fromBufferAttribute",value:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}]),e}();Ee.prototype.isVector3=!0;var Me=new Ee,ke=new Te,Ae=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Ee(1/0,1/0,1/0),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Ee(-1/0,-1/0,-1/0);Object(v.a)(this,e),this.min=t,this.max=n}return Object(y.a)(e,[{key:"set",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:"setFromArray",value:function(e){for(var t=1/0,n=1/0,i=1/0,r=-1/0,a=-1/0,o=-1/0,s=0,l=e.length;s<l;s+=3){var c=e[s],u=e[s+1],h=e[s+2];c<t&&(t=c),u<n&&(n=u),h<i&&(i=h),c>r&&(r=c),u>a&&(a=u),h>o&&(o=h)}return this.min.set(t,n,i),this.max.set(r,a,o),this}},{key:"setFromBufferAttribute",value:function(e){for(var t=1/0,n=1/0,i=1/0,r=-1/0,a=-1/0,o=-1/0,s=0,l=e.count;s<l;s++){var c=e.getX(s),u=e.getY(s),h=e.getZ(s);c<t&&(t=c),u<n&&(n=u),h<i&&(i=h),c>r&&(r=c),u>a&&(a=u),h>o&&(o=h)}return this.min.set(t,n,i),this.max.set(r,a,o),this}},{key:"setFromPoints",value:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}},{key:"setFromCenterAndSize",value:function(e,t){var n=Pe.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}},{key:"setFromObject",value:function(e){return this.makeEmpty(),this.expandByObject(e)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:"getCenter",value:function(e){return void 0===e&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new Ee),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(e){return void 0===e&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new Ee),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}},{key:"expandByPoint",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:"expandByVector",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:"expandByScalar",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:"expandByObject",value:function(e){e.updateWorldMatrix(!1,!1);var t=e.geometry;void 0!==t&&(null===t.boundingBox&&t.computeBoundingBox(),Le.copy(t.boundingBox),Le.applyMatrix4(e.matrixWorld),this.union(Le));for(var n=e.children,i=0,r=n.length;i<r;i++)this.expandByObject(n[i]);return this}},{key:"containsPoint",value:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}},{key:"containsBox",value:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}},{key:"getParameter",value:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new Ee),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}},{key:"intersectsBox",value:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}},{key:"intersectsSphere",value:function(e){return this.clampPoint(e.center,Pe),Pe.distanceToSquared(e.center)<=e.radius*e.radius}},{key:"intersectsPlane",value:function(e){var t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}},{key:"intersectsTriangle",value:function(e){if(this.isEmpty())return!1;this.getCenter(Fe),Ne.subVectors(this.max,Fe),Ie.subVectors(e.a,Fe),Re.subVectors(e.b,Fe),ze.subVectors(e.c,Fe),De.subVectors(Re,Ie),Oe.subVectors(ze,Re),Be.subVectors(Ie,ze);var t=[0,-De.z,De.y,0,-Oe.z,Oe.y,0,-Be.z,Be.y,De.z,0,-De.x,Oe.z,0,-Oe.x,Be.z,0,-Be.x,-De.y,De.x,0,-Oe.y,Oe.x,0,-Be.y,Be.x,0];return!!je(t,Ie,Re,ze,Ne)&&(!!je(t=[1,0,0,0,1,0,0,0,1],Ie,Re,ze,Ne)&&(Ue.crossVectors(De,Oe),je(t=[Ue.x,Ue.y,Ue.z],Ie,Re,ze,Ne)))}},{key:"clampPoint",value:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new Ee),t.copy(e).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(e){return Pe.copy(e).clamp(this.min,this.max).sub(e).length()}},{key:"getBoundingSphere",value:function(e){return void 0===e&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(e.center),e.radius=.5*this.getSize(Pe).length(),e}},{key:"intersect",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:"applyMatrix4",value:function(e){return this.isEmpty()||(Ce[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Ce[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Ce[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Ce[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Ce[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Ce[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Ce[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Ce[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Ce)),this}},{key:"translate",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:"equals",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),e}();Ae.prototype.isBox3=!0;var Ce=[new Ee,new Ee,new Ee,new Ee,new Ee,new Ee,new Ee,new Ee],Pe=new Ee,Le=new Ae,Ie=new Ee,Re=new Ee,ze=new Ee,De=new Ee,Oe=new Ee,Be=new Ee,Fe=new Ee,Ne=new Ee,Ue=new Ee,Ve=new Ee;function je(e,t,n,i,r){for(var a=0,o=e.length-3;a<=o;a+=3){Ve.fromArray(e,a);var s=r.x*Math.abs(Ve.x)+r.y*Math.abs(Ve.y)+r.z*Math.abs(Ve.z),l=t.dot(Ve),c=n.dot(Ve),u=i.dot(Ve);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>s)return!1}return!0}var Ge=new Ae,He=new Ee,We=new Ee,qe=new Ee,Ze=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Ee,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;Object(v.a)(this,e),this.center=t,this.radius=n}return Object(y.a)(e,[{key:"set",value:function(e,t){return this.center.copy(e),this.radius=t,this}},{key:"setFromPoints",value:function(e,t){var n=this.center;void 0!==t?n.copy(t):Ge.setFromPoints(e).getCenter(n);for(var i=0,r=0,a=e.length;r<a;r++)i=Math.max(i,n.distanceToSquared(e[r]));return this.radius=Math.sqrt(i),this}},{key:"copy",value:function(e){return this.center.copy(e.center),this.radius=e.radius,this}},{key:"isEmpty",value:function(){return this.radius<0}},{key:"makeEmpty",value:function(){return this.center.set(0,0,0),this.radius=-1,this}},{key:"containsPoint",value:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}},{key:"distanceToPoint",value:function(e){return e.distanceTo(this.center)-this.radius}},{key:"intersectsSphere",value:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}},{key:"intersectsBox",value:function(e){return e.intersectsSphere(this)}},{key:"intersectsPlane",value:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}},{key:"clampPoint",value:function(e,t){var n=this.center.distanceToSquared(e);return void 0===t&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new Ee),t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}},{key:"getBoundingBox",value:function(e){return void 0===e&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new Ae),this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}},{key:"applyMatrix4",value:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}},{key:"translate",value:function(e){return this.center.add(e),this}},{key:"expandByPoint",value:function(e){qe.subVectors(e,this.center);var t=qe.lengthSq();if(t>this.radius*this.radius){var n=Math.sqrt(t),i=.5*(n-this.radius);this.center.add(qe.multiplyScalar(i/n)),this.radius+=i}return this}},{key:"union",value:function(e){return We.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(He.copy(e.center).add(We)),this.expandByPoint(He.copy(e.center).sub(We)),this}},{key:"equals",value:function(e){return e.center.equals(this.center)&&e.radius===this.radius}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}(),$e=new Ee,Xe=new Ee,Ye=new Ee,Je=new Ee,Ke=new Ee,Qe=new Ee,et=new Ee,tt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Ee,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Ee(0,0,-1);Object(v.a)(this,e),this.origin=t,this.direction=n}return Object(y.a)(e,[{key:"set",value:function(e,t){return this.origin.copy(e),this.direction.copy(t),this}},{key:"copy",value:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}},{key:"at",value:function(e,t){return void 0===t&&(console.warn("THREE.Ray: .at() target is now required"),t=new Ee),t.copy(this.direction).multiplyScalar(e).add(this.origin)}},{key:"lookAt",value:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this}},{key:"recast",value:function(e){return this.origin.copy(this.at(e,$e)),this}},{key:"closestPointToPoint",value:function(e,t){void 0===t&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new Ee),t.subVectors(e,this.origin);var n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)}},{key:"distanceToPoint",value:function(e){return Math.sqrt(this.distanceSqToPoint(e))}},{key:"distanceSqToPoint",value:function(e){var t=$e.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):($e.copy(this.direction).multiplyScalar(t).add(this.origin),$e.distanceToSquared(e))}},{key:"distanceSqToSegment",value:function(e,t,n,i){Xe.copy(e).add(t).multiplyScalar(.5),Ye.copy(t).sub(e).normalize(),Je.copy(this.origin).sub(Xe);var r,a,o,s,l=.5*e.distanceTo(t),c=-this.direction.dot(Ye),u=Je.dot(this.direction),h=-Je.dot(Ye),d=Je.lengthSq(),p=Math.abs(1-c*c);if(p>0)if(a=c*u-h,s=l*p,(r=c*h-u)>=0)if(a>=-s)if(a<=s){var f=1/p;o=(r*=f)*(r+c*(a*=f)+2*u)+a*(c*r+a+2*h)+d}else a=l,o=-(r=Math.max(0,-(c*a+u)))*r+a*(a+2*h)+d;else a=-l,o=-(r=Math.max(0,-(c*a+u)))*r+a*(a+2*h)+d;else a<=-s?o=-(r=Math.max(0,-(-c*l+u)))*r+(a=r>0?-l:Math.min(Math.max(-l,-h),l))*(a+2*h)+d:a<=s?(r=0,o=(a=Math.min(Math.max(-l,-h),l))*(a+2*h)+d):o=-(r=Math.max(0,-(c*l+u)))*r+(a=r>0?l:Math.min(Math.max(-l,-h),l))*(a+2*h)+d;else a=c>0?-l:l,o=-(r=Math.max(0,-(c*a+u)))*r+a*(a+2*h)+d;return n&&n.copy(this.direction).multiplyScalar(r).add(this.origin),i&&i.copy(Ye).multiplyScalar(a).add(Xe),o}},{key:"intersectSphere",value:function(e,t){$e.subVectors(e.center,this.origin);var n=$e.dot(this.direction),i=$e.dot($e)-n*n,r=e.radius*e.radius;if(i>r)return null;var a=Math.sqrt(r-i),o=n-a,s=n+a;return o<0&&s<0?null:o<0?this.at(s,t):this.at(o,t)}},{key:"intersectsSphere",value:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}},{key:"distanceToPlane",value:function(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;var n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}},{key:"intersectPlane",value:function(e,t){var n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}},{key:"intersectsPlane",value:function(e){var t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}},{key:"intersectBox",value:function(e,t){var n,i,r,a,o,s,l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(n=(e.min.x-h.x)*l,i=(e.max.x-h.x)*l):(n=(e.max.x-h.x)*l,i=(e.min.x-h.x)*l),c>=0?(r=(e.min.y-h.y)*c,a=(e.max.y-h.y)*c):(r=(e.max.y-h.y)*c,a=(e.min.y-h.y)*c),n>a||r>i?null:((r>n||n!==n)&&(n=r),(a<i||i!==i)&&(i=a),u>=0?(o=(e.min.z-h.z)*u,s=(e.max.z-h.z)*u):(o=(e.max.z-h.z)*u,s=(e.min.z-h.z)*u),n>s||o>i?null:((o>n||n!==n)&&(n=o),(s<i||i!==i)&&(i=s),i<0?null:this.at(n>=0?n:i,t)))}},{key:"intersectsBox",value:function(e){return null!==this.intersectBox(e,$e)}},{key:"intersectTriangle",value:function(e,t,n,i,r){Ke.subVectors(t,e),Qe.subVectors(n,e),et.crossVectors(Ke,Qe);var a,o=this.direction.dot(et);if(o>0){if(i)return null;a=1}else{if(!(o<0))return null;a=-1,o=-o}Je.subVectors(this.origin,e);var s=a*this.direction.dot(Qe.crossVectors(Je,Qe));if(s<0)return null;var l=a*this.direction.dot(Ke.cross(Je));if(l<0)return null;if(s+l>o)return null;var c=-a*Je.dot(et);return c<0?null:this.at(c/o,r)}},{key:"applyMatrix4",value:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}},{key:"equals",value:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}(),nt=function(){function e(){Object(v.a)(this,e),this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}return Object(y.a)(e,[{key:"set",value:function(e,t,n,i,r,a,o,s,l,c,u,h,d,p,f,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=i,g[1]=r,g[5]=a,g[9]=o,g[13]=s,g[2]=l,g[6]=c,g[10]=u,g[14]=h,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}},{key:"identity",value:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}},{key:"clone",value:function(){return(new e).fromArray(this.elements)}},{key:"copy",value:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}},{key:"copyPosition",value:function(e){var t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}},{key:"setFromMatrix3",value:function(e){var t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}},{key:"extractBasis",value:function(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}},{key:"makeBasis",value:function(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}},{key:"extractRotation",value:function(e){var t=this.elements,n=e.elements,i=1/it.setFromMatrixColumn(e,0).length(),r=1/it.setFromMatrixColumn(e,1).length(),a=1/it.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[7]=0,t[8]=n[8]*a,t[9]=n[9]*a,t[10]=n[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:"makeRotationFromEuler",value:function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,n=e.x,i=e.y,r=e.z,a=Math.cos(n),o=Math.sin(n),s=Math.cos(i),l=Math.sin(i),c=Math.cos(r),u=Math.sin(r);if("XYZ"===e.order){var h=a*c,d=a*u,p=o*c,f=o*u;t[0]=s*c,t[4]=-s*u,t[8]=l,t[1]=d+p*l,t[5]=h-f*l,t[9]=-o*s,t[2]=f-h*l,t[6]=p+d*l,t[10]=a*s}else if("YXZ"===e.order){var m=s*c,g=s*u,v=l*c,y=l*u;t[0]=m+y*o,t[4]=v*o-g,t[8]=a*l,t[1]=a*u,t[5]=a*c,t[9]=-o,t[2]=g*o-v,t[6]=y+m*o,t[10]=a*s}else if("ZXY"===e.order){var _=s*c,x=s*u,b=l*c,w=l*u;t[0]=_-w*o,t[4]=-a*u,t[8]=b+x*o,t[1]=x+b*o,t[5]=a*c,t[9]=w-_*o,t[2]=-a*l,t[6]=o,t[10]=a*s}else if("ZYX"===e.order){var S=a*c,T=a*u,E=o*c,M=o*u;t[0]=s*c,t[4]=E*l-T,t[8]=S*l+M,t[1]=s*u,t[5]=M*l+S,t[9]=T*l-E,t[2]=-l,t[6]=o*s,t[10]=a*s}else if("YZX"===e.order){var k=a*s,A=a*l,C=o*s,P=o*l;t[0]=s*c,t[4]=P-k*u,t[8]=C*u+A,t[1]=u,t[5]=a*c,t[9]=-o*c,t[2]=-l*c,t[6]=A*u+C,t[10]=k-P*u}else if("XZY"===e.order){var L=a*s,I=a*l,R=o*s,z=o*l;t[0]=s*c,t[4]=-u,t[8]=l*c,t[1]=L*u+z,t[5]=a*c,t[9]=I*u-R,t[2]=R*u-I,t[6]=o*c,t[10]=z*u+L}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:"makeRotationFromQuaternion",value:function(e){return this.compose(at,e,ot)}},{key:"lookAt",value:function(e,t,n){var i=this.elements;return ct.subVectors(e,t),0===ct.lengthSq()&&(ct.z=1),ct.normalize(),st.crossVectors(n,ct),0===st.lengthSq()&&(1===Math.abs(n.z)?ct.x+=1e-4:ct.z+=1e-4,ct.normalize(),st.crossVectors(n,ct)),st.normalize(),lt.crossVectors(ct,st),i[0]=st.x,i[4]=lt.x,i[8]=ct.x,i[1]=st.y,i[5]=lt.y,i[9]=ct.y,i[2]=st.z,i[6]=lt.z,i[10]=ct.z,this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}},{key:"premultiply",value:function(e){return this.multiplyMatrices(e,this)}},{key:"multiplyMatrices",value:function(e,t){var n=e.elements,i=t.elements,r=this.elements,a=n[0],o=n[4],s=n[8],l=n[12],c=n[1],u=n[5],h=n[9],d=n[13],p=n[2],f=n[6],m=n[10],g=n[14],v=n[3],y=n[7],_=n[11],x=n[15],b=i[0],w=i[4],S=i[8],T=i[12],E=i[1],M=i[5],k=i[9],A=i[13],C=i[2],P=i[6],L=i[10],I=i[14],R=i[3],z=i[7],D=i[11],O=i[15];return r[0]=a*b+o*E+s*C+l*R,r[4]=a*w+o*M+s*P+l*z,r[8]=a*S+o*k+s*L+l*D,r[12]=a*T+o*A+s*I+l*O,r[1]=c*b+u*E+h*C+d*R,r[5]=c*w+u*M+h*P+d*z,r[9]=c*S+u*k+h*L+d*D,r[13]=c*T+u*A+h*I+d*O,r[2]=p*b+f*E+m*C+g*R,r[6]=p*w+f*M+m*P+g*z,r[10]=p*S+f*k+m*L+g*D,r[14]=p*T+f*A+m*I+g*O,r[3]=v*b+y*E+_*C+x*R,r[7]=v*w+y*M+_*P+x*z,r[11]=v*S+y*k+_*L+x*D,r[15]=v*T+y*A+_*I+x*O,this}},{key:"multiplyScalar",value:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}},{key:"determinant",value:function(){var e=this.elements,t=e[0],n=e[4],i=e[8],r=e[12],a=e[1],o=e[5],s=e[9],l=e[13],c=e[2],u=e[6],h=e[10],d=e[14];return e[3]*(+r*s*u-i*l*u-r*o*h+n*l*h+i*o*d-n*s*d)+e[7]*(+t*s*d-t*l*h+r*a*h-i*a*d+i*l*c-r*s*c)+e[11]*(+t*l*u-t*o*d-r*a*u+n*a*d+r*o*c-n*l*c)+e[15]*(-i*o*c-t*s*u+t*o*h+i*a*u-n*a*h+n*s*c)}},{key:"transpose",value:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}},{key:"setPosition",value:function(e,t,n){var i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}},{key:"invert",value:function(){var e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],a=e[4],o=e[5],s=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11],p=e[12],f=e[13],m=e[14],g=e[15],v=u*m*l-f*h*l+f*s*d-o*m*d-u*s*g+o*h*g,y=p*h*l-c*m*l-p*s*d+a*m*d+c*s*g-a*h*g,_=c*f*l-p*u*l+p*o*d-a*f*d-c*o*g+a*u*g,x=p*u*s-c*f*s-p*o*h+a*f*h+c*o*m-a*u*m,b=t*v+n*y+i*_+r*x;if(0===b)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);var w=1/b;return e[0]=v*w,e[1]=(f*h*r-u*m*r-f*i*d+n*m*d+u*i*g-n*h*g)*w,e[2]=(o*m*r-f*s*r+f*i*l-n*m*l-o*i*g+n*s*g)*w,e[3]=(u*s*r-o*h*r-u*i*l+n*h*l+o*i*d-n*s*d)*w,e[4]=y*w,e[5]=(c*m*r-p*h*r+p*i*d-t*m*d-c*i*g+t*h*g)*w,e[6]=(p*s*r-a*m*r-p*i*l+t*m*l+a*i*g-t*s*g)*w,e[7]=(a*h*r-c*s*r+c*i*l-t*h*l-a*i*d+t*s*d)*w,e[8]=_*w,e[9]=(p*u*r-c*f*r-p*n*d+t*f*d+c*n*g-t*u*g)*w,e[10]=(a*f*r-p*o*r+p*n*l-t*f*l-a*n*g+t*o*g)*w,e[11]=(c*o*r-a*u*r-c*n*l+t*u*l+a*n*d-t*o*d)*w,e[12]=x*w,e[13]=(c*f*i-p*u*i+p*n*h-t*f*h-c*n*m+t*u*m)*w,e[14]=(p*o*i-a*f*i-p*n*s+t*f*s+a*n*m-t*o*m)*w,e[15]=(a*u*i-c*o*i+c*n*s-t*u*s-a*n*h+t*o*h)*w,this}},{key:"scale",value:function(e){var t=this.elements,n=e.x,i=e.y,r=e.z;return t[0]*=n,t[4]*=i,t[8]*=r,t[1]*=n,t[5]*=i,t[9]*=r,t[2]*=n,t[6]*=i,t[10]*=r,t[3]*=n,t[7]*=i,t[11]*=r,this}},{key:"getMaxScaleOnAxis",value:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))}},{key:"makeTranslation",value:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}},{key:"makeRotationX",value:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}},{key:"makeRotationY",value:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}},{key:"makeRotationZ",value:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}},{key:"makeRotationAxis",value:function(e,t){var n=Math.cos(t),i=Math.sin(t),r=1-n,a=e.x,o=e.y,s=e.z,l=r*a,c=r*o;return this.set(l*a+n,l*o-i*s,l*s+i*o,0,l*o+i*s,c*o+n,c*s-i*a,0,l*s-i*o,c*s+i*a,r*s*s+n,0,0,0,0,1),this}},{key:"makeScale",value:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}},{key:"makeShear",value:function(e,t,n,i,r,a){return this.set(1,n,r,0,e,1,a,0,t,i,1,0,0,0,0,1),this}},{key:"compose",value:function(e,t,n){var i=this.elements,r=t._x,a=t._y,o=t._z,s=t._w,l=r+r,c=a+a,u=o+o,h=r*l,d=r*c,p=r*u,f=a*c,m=a*u,g=o*u,v=s*l,y=s*c,_=s*u,x=n.x,b=n.y,w=n.z;return i[0]=(1-(f+g))*x,i[1]=(d+_)*x,i[2]=(p-y)*x,i[3]=0,i[4]=(d-_)*b,i[5]=(1-(h+g))*b,i[6]=(m+v)*b,i[7]=0,i[8]=(p+y)*w,i[9]=(m-v)*w,i[10]=(1-(h+f))*w,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}},{key:"decompose",value:function(e,t,n){var i=this.elements,r=it.set(i[0],i[1],i[2]).length(),a=it.set(i[4],i[5],i[6]).length(),o=it.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),e.x=i[12],e.y=i[13],e.z=i[14],rt.copy(this);var s=1/r,l=1/a,c=1/o;return rt.elements[0]*=s,rt.elements[1]*=s,rt.elements[2]*=s,rt.elements[4]*=l,rt.elements[5]*=l,rt.elements[6]*=l,rt.elements[8]*=c,rt.elements[9]*=c,rt.elements[10]*=c,t.setFromRotationMatrix(rt),n.x=r,n.y=a,n.z=o,this}},{key:"makePerspective",value:function(e,t,n,i,r,a){void 0===a&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var o=this.elements,s=2*r/(t-e),l=2*r/(n-i),c=(t+e)/(t-e),u=(n+i)/(n-i),h=-(a+r)/(a-r),d=-2*a*r/(a-r);return o[0]=s,o[4]=0,o[8]=c,o[12]=0,o[1]=0,o[5]=l,o[9]=u,o[13]=0,o[2]=0,o[6]=0,o[10]=h,o[14]=d,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}},{key:"makeOrthographic",value:function(e,t,n,i,r,a){var o=this.elements,s=1/(t-e),l=1/(n-i),c=1/(a-r),u=(t+e)*s,h=(n+i)*l,d=(a+r)*c;return o[0]=2*s,o[4]=0,o[8]=0,o[12]=-u,o[1]=0,o[5]=2*l,o[9]=0,o[13]=-h,o[2]=0,o[6]=0,o[10]=-2*c,o[14]=-d,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}},{key:"equals",value:function(e){for(var t=this.elements,n=e.elements,i=0;i<16;i++)if(t[i]!==n[i])return!1;return!0}},{key:"fromArray",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<16;n++)this.elements[n]=e[n+t];return this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}]),e}();nt.prototype.isMatrix4=!0;var it=new Ee,rt=new nt,at=new Ee(0,0,0),ot=new Ee(1,1,1),st=new Ee,lt=new Ee,ct=new Ee,ut=new nt,ht=new Te,dt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.DefaultOrder;Object(v.a)(this,e),this._x=t,this._y=n,this._z=i,this._order=r}return Object(y.a)(e,[{key:"x",get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},{key:"order",get:function(){return this._order},set:function(e){this._order=e,this._onChangeCallback()}},{key:"set",value:function(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._order=i||this._order,this._onChangeCallback(),this}},{key:"clone",value:function(){return new this.constructor(this._x,this._y,this._z,this._order)}},{key:"copy",value:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}},{key:"setFromRotationMatrix",value:function(e,t,n){var i=e.elements,r=i[0],a=i[4],o=i[8],s=i[1],l=i[5],c=i[9],u=i[2],h=i[6],d=i[10];switch(t=t||this._order){case"XYZ":this._y=Math.asin(ue(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-a,r)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-ue(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(o,d),this._z=Math.atan2(s,l)):(this._y=Math.atan2(-u,r),this._z=0);break;case"ZXY":this._x=Math.asin(ue(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-u,d),this._z=Math.atan2(-a,l)):(this._y=0,this._z=Math.atan2(s,r));break;case"ZYX":this._y=Math.asin(-ue(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(h,d),this._z=Math.atan2(s,r)):(this._x=0,this._z=Math.atan2(-a,l));break;case"YZX":this._z=Math.asin(ue(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-u,r)):(this._x=0,this._y=Math.atan2(o,d));break;case"XZY":this._z=Math.asin(-ue(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(o,r)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!1!==n&&this._onChangeCallback(),this}},{key:"setFromQuaternion",value:function(e,t,n){return ut.makeRotationFromQuaternion(e),this.setFromRotationMatrix(ut,t,n)}},{key:"setFromVector3",value:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)}},{key:"reorder",value:function(e){return ht.setFromEuler(this),this.setFromQuaternion(ht,e)}},{key:"equals",value:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}},{key:"fromArray",value:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}},{key:"toVector3",value:function(e){return e?e.set(this._x,this._y,this._z):new Ee(this._x,this._y,this._z)}},{key:"_onChange",value:function(e){return this._onChangeCallback=e,this}},{key:"_onChangeCallback",value:function(){}}]),e}();dt.prototype.isEuler=!0,dt.DefaultOrder="XYZ",dt.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];var pt=function(){function e(){Object(v.a)(this,e),this.mask=1}return Object(y.a)(e,[{key:"set",value:function(e){this.mask=1<<e|0}},{key:"enable",value:function(e){this.mask|=1<<e|0}},{key:"enableAll",value:function(){this.mask=-1}},{key:"toggle",value:function(e){this.mask^=1<<e|0}},{key:"disable",value:function(e){this.mask&=~(1<<e|0)}},{key:"disableAll",value:function(){this.mask=0}},{key:"test",value:function(e){return 0!==(this.mask&e.mask)}}]),e}(),ft=0,mt=new Ee,gt=new Te,vt=new nt,yt=new Ee,_t=new Ee,xt=new Ee,bt=new Te,wt=new Ee(1,0,0),St=new Ee(0,1,0),Tt=new Ee(0,0,1),Et={type:"added"},Mt={type:"removed"},kt=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(){var e;Object(v.a)(this,n),e=t.call(this),Object.defineProperty(Object(f.a)(e),"id",{value:ft++}),e.uuid=ce(),e.name="",e.type="Object3D",e.parent=null,e.children=[],e.up=n.DefaultUp.clone();var i=new Ee,r=new dt,a=new Te,o=new Ee(1,1,1);return r._onChange((function(){a.setFromEuler(r,!1)})),a._onChange((function(){r.setFromQuaternion(a,void 0,!1)})),Object.defineProperties(Object(f.a)(e),{position:{configurable:!0,enumerable:!0,value:i},rotation:{configurable:!0,enumerable:!0,value:r},quaternion:{configurable:!0,enumerable:!0,value:a},scale:{configurable:!0,enumerable:!0,value:o},modelViewMatrix:{value:new nt},normalMatrix:{value:new ve}}),e.matrix=new nt,e.matrixWorld=new nt,e.matrixAutoUpdate=n.DefaultMatrixAutoUpdate,e.matrixWorldNeedsUpdate=!1,e.layers=new pt,e.visible=!0,e.castShadow=!1,e.receiveShadow=!1,e.frustumCulled=!0,e.renderOrder=0,e.animations=[],e.userData={},e}return Object(y.a)(n,[{key:"onBeforeRender",value:function(){}},{key:"onAfterRender",value:function(){}},{key:"applyMatrix4",value:function(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}},{key:"applyQuaternion",value:function(e){return this.quaternion.premultiply(e),this}},{key:"setRotationFromAxisAngle",value:function(e,t){this.quaternion.setFromAxisAngle(e,t)}},{key:"setRotationFromEuler",value:function(e){this.quaternion.setFromEuler(e,!0)}},{key:"setRotationFromMatrix",value:function(e){this.quaternion.setFromRotationMatrix(e)}},{key:"setRotationFromQuaternion",value:function(e){this.quaternion.copy(e)}},{key:"rotateOnAxis",value:function(e,t){return gt.setFromAxisAngle(e,t),this.quaternion.multiply(gt),this}},{key:"rotateOnWorldAxis",value:function(e,t){return gt.setFromAxisAngle(e,t),this.quaternion.premultiply(gt),this}},{key:"rotateX",value:function(e){return this.rotateOnAxis(wt,e)}},{key:"rotateY",value:function(e){return this.rotateOnAxis(St,e)}},{key:"rotateZ",value:function(e){return this.rotateOnAxis(Tt,e)}},{key:"translateOnAxis",value:function(e,t){return mt.copy(e).applyQuaternion(this.quaternion),this.position.add(mt.multiplyScalar(t)),this}},{key:"translateX",value:function(e){return this.translateOnAxis(wt,e)}},{key:"translateY",value:function(e){return this.translateOnAxis(St,e)}},{key:"translateZ",value:function(e){return this.translateOnAxis(Tt,e)}},{key:"localToWorld",value:function(e){return e.applyMatrix4(this.matrixWorld)}},{key:"worldToLocal",value:function(e){return e.applyMatrix4(vt.copy(this.matrixWorld).invert())}},{key:"lookAt",value:function(e,t,n){e.isVector3?yt.copy(e):yt.set(e,t,n);var i=this.parent;this.updateWorldMatrix(!0,!1),_t.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?vt.lookAt(_t,yt,this.up):vt.lookAt(yt,_t,this.up),this.quaternion.setFromRotationMatrix(vt),i&&(vt.extractRotation(i.matrixWorld),gt.setFromRotationMatrix(vt),this.quaternion.premultiply(gt.invert()))}},{key:"add",value:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(Et)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}},{key:"remove",value:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var n=this.children.indexOf(e);return-1!==n&&(e.parent=null,this.children.splice(n,1),e.dispatchEvent(Mt)),this}},{key:"removeFromParent",value:function(){var e=this.parent;return null!==e&&e.remove(this),this}},{key:"clear",value:function(){for(var e=0;e<this.children.length;e++){var t=this.children[e];t.parent=null,t.dispatchEvent(Mt)}return this.children.length=0,this}},{key:"attach",value:function(e){return this.updateWorldMatrix(!0,!1),vt.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),vt.multiply(e.parent.matrixWorld)),e.applyMatrix4(vt),this.add(e),e.updateWorldMatrix(!1,!0),this}},{key:"getObjectById",value:function(e){return this.getObjectByProperty("id",e)}},{key:"getObjectByName",value:function(e){return this.getObjectByProperty("name",e)}},{key:"getObjectByProperty",value:function(e,t){if(this[e]===t)return this;for(var n=0,i=this.children.length;n<i;n++){var r=this.children[n].getObjectByProperty(e,t);if(void 0!==r)return r}}},{key:"getWorldPosition",value:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new Ee),this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}},{key:"getWorldQuaternion",value:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),e=new Te),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_t,e,xt),e}},{key:"getWorldScale",value:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),e=new Ee),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_t,bt,e),e}},{key:"getWorldDirection",value:function(e){void 0===e&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new Ee),this.updateWorldMatrix(!0,!1);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}},{key:"raycast",value:function(){}},{key:"traverse",value:function(e){e(this);for(var t=this.children,n=0,i=t.length;n<i;n++)t[n].traverse(e)}},{key:"traverseVisible",value:function(e){if(!1!==this.visible){e(this);for(var t=this.children,n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}}},{key:"traverseAncestors",value:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}},{key:"updateMatrix",value:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}},{key:"updateMatrixWorld",value:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=this.children,n=0,i=t.length;n<i;n++)t[n].updateMatrixWorld(e)}},{key:"updateWorldMatrix",value:function(e,t){var n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t)for(var i=this.children,r=0,a=i.length;r<a;r++)i[r].updateWorldMatrix(!1,!0)}},{key:"toJSON",value:function(e){var t=void 0===e||"string"===typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var i={};function r(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isMesh||this.isLine||this.isPoints){i.geometry=r(e.geometries,this.geometry);var a=this.geometry.parameters;if(void 0!==a&&void 0!==a.shapes){var o=a.shapes;if(Array.isArray(o))for(var s=0,l=o.length;s<l;s++){var c=o[s];r(e.shapes,c)}else r(e.shapes,o)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){for(var u=[],h=0,d=this.material.length;h<d;h++)u.push(r(e.materials,this.material[h]));i.material=u}else i.material=r(e.materials,this.material);if(this.children.length>0){i.children=[];for(var p=0;p<this.children.length;p++)i.children.push(this.children[p].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(var f=0;f<this.animations.length;f++){var m=this.animations[f];i.animations.push(r(e.animations,m))}}if(t){var g=S(e.geometries),v=S(e.materials),y=S(e.textures),_=S(e.images),x=S(e.shapes),b=S(e.skeletons),w=S(e.animations);g.length>0&&(n.geometries=g),v.length>0&&(n.materials=v),y.length>0&&(n.textures=y),_.length>0&&(n.images=_),x.length>0&&(n.shapes=x),b.length>0&&(n.skeletons=b),w.length>0&&(n.animations=w)}return n.object=i,n;function S(e){var t=[];for(var n in e){var i=e[n];delete i.metadata,t.push(i)}return t}}},{key:"clone",value:function(e){return(new this.constructor).copy(this,e)}},{key:"copy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(var n=0;n<e.children.length;n++){var i=e.children[n];this.add(i.clone())}return this}}]),n}(re);kt.DefaultUp=new Ee(0,1,0),kt.DefaultMatrixAutoUpdate=!0,kt.prototype.isObject3D=!0;var At=new Ee,Ct=new Ee,Pt=new ve,Lt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Ee(1,0,0),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Object(v.a)(this,e),this.normal=t,this.constant=n}return Object(y.a)(e,[{key:"set",value:function(e,t){return this.normal.copy(e),this.constant=t,this}},{key:"setComponents",value:function(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this}},{key:"setFromNormalAndCoplanarPoint",value:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}},{key:"setFromCoplanarPoints",value:function(e,t,n){var i=At.subVectors(n,t).cross(Ct.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}},{key:"copy",value:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this}},{key:"normalize",value:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}},{key:"negate",value:function(){return this.constant*=-1,this.normal.negate(),this}},{key:"distanceToPoint",value:function(e){return this.normal.dot(e)+this.constant}},{key:"distanceToSphere",value:function(e){return this.distanceToPoint(e.center)-e.radius}},{key:"projectPoint",value:function(e,t){return void 0===t&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new Ee),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}},{key:"intersectLine",value:function(e,t){void 0===t&&(console.warn("THREE.Plane: .intersectLine() target is now required"),t=new Ee);var n=e.delta(At),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;var r=-(e.start.dot(this.normal)+this.constant)/i;return r<0||r>1?null:t.copy(n).multiplyScalar(r).add(e.start)}},{key:"intersectsLine",value:function(e){var t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}},{key:"intersectsBox",value:function(e){return e.intersectsPlane(this)}},{key:"intersectsSphere",value:function(e){return e.intersectsPlane(this)}},{key:"coplanarPoint",value:function(e){return void 0===e&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new Ee),e.copy(this.normal).multiplyScalar(-this.constant)}},{key:"applyMatrix4",value:function(e,t){var n=t||Pt.getNormalMatrix(e),i=this.coplanarPoint(At).applyMatrix4(e),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this}},{key:"translate",value:function(e){return this.constant-=e.dot(this.normal),this}},{key:"equals",value:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}();Lt.prototype.isPlane=!0;var It=new Ee,Rt=new Ee,zt=new Ee,Dt=new Ee,Ot=new Ee,Bt=new Ee,Ft=new Ee,Nt=new Ee,Ut=new Ee,Vt=new Ee,jt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Ee,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Ee,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Ee;Object(v.a)(this,e),this.a=t,this.b=n,this.c=i}return Object(y.a)(e,[{key:"set",value:function(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}},{key:"setFromPointsAndIndices",value:function(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}},{key:"getArea",value:function(){return It.subVectors(this.c,this.b),Rt.subVectors(this.a,this.b),.5*It.cross(Rt).length()}},{key:"getMidpoint",value:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new Ee),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}},{key:"getNormal",value:function(t){return e.getNormal(this.a,this.b,this.c,t)}},{key:"getPlane",value:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new Lt),e.setFromCoplanarPoints(this.a,this.b,this.c)}},{key:"getBarycoord",value:function(t,n){return e.getBarycoord(t,this.a,this.b,this.c,n)}},{key:"getUV",value:function(t,n,i,r,a){return e.getUV(t,this.a,this.b,this.c,n,i,r,a)}},{key:"containsPoint",value:function(t){return e.containsPoint(t,this.a,this.b,this.c)}},{key:"isFrontFacing",value:function(t){return e.isFrontFacing(this.a,this.b,this.c,t)}},{key:"intersectsBox",value:function(e){return e.intersectsTriangle(this)}},{key:"closestPointToPoint",value:function(e,t){void 0===t&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),t=new Ee);var n,i,r=this.a,a=this.b,o=this.c;Ot.subVectors(a,r),Bt.subVectors(o,r),Nt.subVectors(e,r);var s=Ot.dot(Nt),l=Bt.dot(Nt);if(s<=0&&l<=0)return t.copy(r);Ut.subVectors(e,a);var c=Ot.dot(Ut),u=Bt.dot(Ut);if(c>=0&&u<=c)return t.copy(a);var h=s*u-c*l;if(h<=0&&s>=0&&c<=0)return n=s/(s-c),t.copy(r).addScaledVector(Ot,n);Vt.subVectors(e,o);var d=Ot.dot(Vt),p=Bt.dot(Vt);if(p>=0&&d<=p)return t.copy(o);var f=d*l-s*p;if(f<=0&&l>=0&&p<=0)return i=l/(l-p),t.copy(r).addScaledVector(Bt,i);var m=c*p-d*u;if(m<=0&&u-c>=0&&d-p>=0)return Ft.subVectors(o,a),i=(u-c)/(u-c+(d-p)),t.copy(a).addScaledVector(Ft,i);var g=1/(m+f+h);return n=f*g,i=h*g,t.copy(r).addScaledVector(Ot,n).addScaledVector(Bt,i)}},{key:"equals",value:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}],[{key:"getNormal",value:function(e,t,n,i){void 0===i&&(console.warn("THREE.Triangle: .getNormal() target is now required"),i=new Ee),i.subVectors(n,t),It.subVectors(e,t),i.cross(It);var r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}},{key:"getBarycoord",value:function(e,t,n,i,r){It.subVectors(i,t),Rt.subVectors(n,t),zt.subVectors(e,t);var a=It.dot(It),o=It.dot(Rt),s=It.dot(zt),l=Rt.dot(Rt),c=Rt.dot(zt),u=a*l-o*o;if(void 0===r&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),r=new Ee),0===u)return r.set(-2,-1,-1);var h=1/u,d=(l*s-o*c)*h,p=(a*c-o*s)*h;return r.set(1-d-p,p,d)}},{key:"containsPoint",value:function(e,t,n,i){return this.getBarycoord(e,t,n,i,Dt),Dt.x>=0&&Dt.y>=0&&Dt.x+Dt.y<=1}},{key:"getUV",value:function(e,t,n,i,r,a,o,s){return this.getBarycoord(e,t,n,i,Dt),s.set(0,0),s.addScaledVector(r,Dt.x),s.addScaledVector(a,Dt.y),s.addScaledVector(o,Dt.z),s}},{key:"isFrontFacing",value:function(e,t,n,i){return It.subVectors(n,t),Rt.subVectors(e,t),It.cross(Rt).dot(i)<0}}]),e}(),Gt=0,Ht=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(){var e;return Object(v.a)(this,n),e=t.call(this),Object.defineProperty(Object(f.a)(e),"id",{value:Gt++}),e.uuid=ce(),e.name="",e.type="Material",e.fog=!0,e.blending=1,e.side=0,e.vertexColors=!1,e.opacity=1,e.transparent=!1,e.blendSrc=204,e.blendDst=205,e.blendEquation=_,e.blendSrcAlpha=null,e.blendDstAlpha=null,e.blendEquationAlpha=null,e.depthFunc=3,e.depthTest=!0,e.depthWrite=!0,e.stencilWriteMask=255,e.stencilFunc=519,e.stencilRef=0,e.stencilFuncMask=255,e.stencilFail=ee,e.stencilZFail=ee,e.stencilZPass=ee,e.stencilWrite=!1,e.clippingPlanes=null,e.clipIntersection=!1,e.clipShadows=!1,e.shadowSide=null,e.colorWrite=!0,e.precision=null,e.polygonOffset=!1,e.polygonOffsetFactor=0,e.polygonOffsetUnits=0,e.dithering=!1,e.alphaTest=0,e.alphaToCoverage=!1,e.premultipliedAlpha=!1,e.visible=!0,e.toneMapped=!0,e.userData={},e.version=0,e}return Object(y.a)(n,[{key:"onBuild",value:function(){}},{key:"onBeforeCompile",value:function(){}},{key:"customProgramCacheKey",value:function(){return this.onBeforeCompile.toString()}},{key:"setValues",value:function(e){if(void 0!==e)for(var t in e){var n=e[t];if(void 0!==n)if("shading"!==t){var i=this[t];void 0!==i?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===n;else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}}},{key:"toJSON",value:function(e){var t=void 0===e||"string"===typeof e;t&&(e={textures:{},images:{}});var n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function i(e){var t=[];for(var n in e){var i=e[n];delete i.metadata,t.push(i)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(n.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),0!==this.side&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(n.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(n.morphTargets=!0),!0===this.morphNormals&&(n.morphNormals=!0),!0===this.flatShading&&(n.flatShading=this.flatShading),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t){var r=i(e.textures),a=i(e.images);r.length>0&&(n.textures=r),a.length>0&&(n.images=a)}return n}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;var t=e.clippingPlanes,n=null;if(null!==t){var i=t.length;n=new Array(i);for(var r=0;r!==i;++r)n[r]=t[r].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}},{key:"needsUpdate",set:function(e){!0===e&&this.version++}}]),n}(re);Ht.prototype.isMaterial=!0;var Wt={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},qt={h:0,s:0,l:0},Zt={h:0,s:0,l:0};function $t(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}function Xt(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function Yt(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}var Jt=function(){function e(t,n,i){return Object(v.a)(this,e),void 0===n&&void 0===i?this.set(t):this.setRGB(t,n,i)}return Object(y.a)(e,[{key:"set",value:function(e){return e&&e.isColor?this.copy(e):"number"===typeof e?this.setHex(e):"string"===typeof e&&this.setStyle(e),this}},{key:"setScalar",value:function(e){return this.r=e,this.g=e,this.b=e,this}},{key:"setHex",value:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this}},{key:"setRGB",value:function(e,t,n){return this.r=e,this.g=t,this.b=n,this}},{key:"setHSL",value:function(e,t,n){if(e=he(e,1),t=ue(t,0,1),n=ue(n,0,1),0===t)this.r=this.g=this.b=n;else{var i=n<=.5?n*(1+t):n+t-n*t,r=2*n-i;this.r=$t(r,i,e+1/3),this.g=$t(r,i,e),this.b=$t(r,i,e-1/3)}return this}},{key:"setStyle",value:function(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}var n;if(n=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){var i,r=n[1],a=n[2];switch(r){case"rgb":case"rgba":if(i=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(255,parseInt(i[1],10))/255,this.g=Math.min(255,parseInt(i[2],10))/255,this.b=Math.min(255,parseInt(i[3],10))/255,t(i[4]),this;if(i=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(100,parseInt(i[1],10))/100,this.g=Math.min(100,parseInt(i[2],10))/100,this.b=Math.min(100,parseInt(i[3],10))/100,t(i[4]),this;break;case"hsl":case"hsla":if(i=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a)){var o=parseFloat(i[1])/360,s=parseInt(i[2],10)/100,l=parseInt(i[3],10)/100;return t(i[4]),this.setHSL(o,s,l)}}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(e)){var c=n[1],u=c.length;if(3===u)return this.r=parseInt(c.charAt(0)+c.charAt(0),16)/255,this.g=parseInt(c.charAt(1)+c.charAt(1),16)/255,this.b=parseInt(c.charAt(2)+c.charAt(2),16)/255,this;if(6===u)return this.r=parseInt(c.charAt(0)+c.charAt(1),16)/255,this.g=parseInt(c.charAt(2)+c.charAt(3),16)/255,this.b=parseInt(c.charAt(4)+c.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this}},{key:"setColorName",value:function(e){var t=Wt[e.toLowerCase()];return void 0!==t?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this}},{key:"clone",value:function(){return new this.constructor(this.r,this.g,this.b)}},{key:"copy",value:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}},{key:"copyGammaToLinear",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this}},{key:"copyLinearToGamma",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=t>0?1/t:1;return this.r=Math.pow(e.r,n),this.g=Math.pow(e.g,n),this.b=Math.pow(e.b,n),this}},{key:"convertGammaToLinear",value:function(e){return this.copyGammaToLinear(this,e),this}},{key:"convertLinearToGamma",value:function(e){return this.copyLinearToGamma(this,e),this}},{key:"copySRGBToLinear",value:function(e){return this.r=Xt(e.r),this.g=Xt(e.g),this.b=Xt(e.b),this}},{key:"copyLinearToSRGB",value:function(e){return this.r=Yt(e.r),this.g=Yt(e.g),this.b=Yt(e.b),this}},{key:"convertSRGBToLinear",value:function(){return this.copySRGBToLinear(this),this}},{key:"convertLinearToSRGB",value:function(){return this.copyLinearToSRGB(this),this}},{key:"getHex",value:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}},{key:"getHexString",value:function(){return("000000"+this.getHex().toString(16)).slice(-6)}},{key:"getHSL",value:function(e){void 0===e&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});var t,n,i=this.r,r=this.g,a=this.b,o=Math.max(i,r,a),s=Math.min(i,r,a),l=(s+o)/2;if(s===o)t=0,n=0;else{var c=o-s;switch(n=l<=.5?c/(o+s):c/(2-o-s),o){case i:t=(r-a)/c+(r<a?6:0);break;case r:t=(a-i)/c+2;break;case a:t=(i-r)/c+4}t/=6}return e.h=t,e.s=n,e.l=l,e}},{key:"getStyle",value:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}},{key:"offsetHSL",value:function(e,t,n){return this.getHSL(qt),qt.h+=e,qt.s+=t,qt.l+=n,this.setHSL(qt.h,qt.s,qt.l),this}},{key:"add",value:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}},{key:"addColors",value:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}},{key:"addScalar",value:function(e){return this.r+=e,this.g+=e,this.b+=e,this}},{key:"sub",value:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}},{key:"multiply",value:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}},{key:"multiplyScalar",value:function(e){return this.r*=e,this.g*=e,this.b*=e,this}},{key:"lerp",value:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}},{key:"lerpColors",value:function(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}},{key:"lerpHSL",value:function(e,t){this.getHSL(qt),e.getHSL(Zt);var n=de(qt.h,Zt.h,t),i=de(qt.s,Zt.s,t),r=de(qt.l,Zt.l,t);return this.setHSL(n,i,r),this}},{key:"equals",value:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}},{key:"fromBufferAttribute",value:function(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),!0===e.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}},{key:"toJSON",value:function(){return this.getHex()}}]),e}();Jt.NAMES=Wt,Jt.prototype.isColor=!0,Jt.prototype.r=1,Jt.prototype.g=1,Jt.prototype.b=1;var Kt=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e){var i;return Object(v.a)(this,n),(i=t.call(this)).type="MeshBasicMaterial",i.color=new Jt(16777215),i.map=null,i.lightMap=null,i.lightMapIntensity=1,i.aoMap=null,i.aoMapIntensity=1,i.specularMap=null,i.alphaMap=null,i.envMap=null,i.combine=0,i.reflectivity=1,i.refractionRatio=.98,i.wireframe=!1,i.wireframeLinewidth=1,i.wireframeLinecap="round",i.wireframeLinejoin="round",i.morphTargets=!1,i.setValues(e),i}return Object(y.a)(n,[{key:"copy",value:function(e){return h(Object(u.a)(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.morphTargets=e.morphTargets,this}}]),n}(Ht);Kt.prototype.isMeshBasicMaterial=!0;var Qt=new Ee,en=new me,tn=function(){function e(t,n,i){if(Object(v.a)(this,e),Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=n,this.count=void 0!==t?t.length/n:0,this.normalized=!0===i,this.usage=te,this.updateRange={offset:0,count:-1},this.version=0}return Object(y.a)(e,[{key:"onUploadCallback",value:function(){}},{key:"needsUpdate",set:function(e){!0===e&&this.version++}},{key:"setUsage",value:function(e){return this.usage=e,this}},{key:"copy",value:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}},{key:"copyAt",value:function(e,t,n){e*=this.itemSize,n*=t.itemSize;for(var i=0,r=this.itemSize;i<r;i++)this.array[e+i]=t.array[n+i];return this}},{key:"copyArray",value:function(e){return this.array.set(e),this}},{key:"copyColorsArray",value:function(e){for(var t=this.array,n=0,i=0,r=e.length;i<r;i++){var a=e[i];void 0===a&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),a=new Jt),t[n++]=a.r,t[n++]=a.g,t[n++]=a.b}return this}},{key:"copyVector2sArray",value:function(e){for(var t=this.array,n=0,i=0,r=e.length;i<r;i++){var a=e[i];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),a=new me),t[n++]=a.x,t[n++]=a.y}return this}},{key:"copyVector3sArray",value:function(e){for(var t=this.array,n=0,i=0,r=e.length;i<r;i++){var a=e[i];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i),a=new Ee),t[n++]=a.x,t[n++]=a.y,t[n++]=a.z}return this}},{key:"copyVector4sArray",value:function(e){for(var t=this.array,n=0,i=0,r=e.length;i<r;i++){var a=e[i];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i),a=new we),t[n++]=a.x,t[n++]=a.y,t[n++]=a.z,t[n++]=a.w}return this}},{key:"applyMatrix3",value:function(e){if(2===this.itemSize)for(var t=0,n=this.count;t<n;t++)en.fromBufferAttribute(this,t),en.applyMatrix3(e),this.setXY(t,en.x,en.y);else if(3===this.itemSize)for(var i=0,r=this.count;i<r;i++)Qt.fromBufferAttribute(this,i),Qt.applyMatrix3(e),this.setXYZ(i,Qt.x,Qt.y,Qt.z);return this}},{key:"applyMatrix4",value:function(e){for(var t=0,n=this.count;t<n;t++)Qt.x=this.getX(t),Qt.y=this.getY(t),Qt.z=this.getZ(t),Qt.applyMatrix4(e),this.setXYZ(t,Qt.x,Qt.y,Qt.z);return this}},{key:"applyNormalMatrix",value:function(e){for(var t=0,n=this.count;t<n;t++)Qt.x=this.getX(t),Qt.y=this.getY(t),Qt.z=this.getZ(t),Qt.applyNormalMatrix(e),this.setXYZ(t,Qt.x,Qt.y,Qt.z);return this}},{key:"transformDirection",value:function(e){for(var t=0,n=this.count;t<n;t++)Qt.x=this.getX(t),Qt.y=this.getY(t),Qt.z=this.getZ(t),Qt.transformDirection(e),this.setXYZ(t,Qt.x,Qt.y,Qt.z);return this}},{key:"set",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this}},{key:"getX",value:function(e){return this.array[e*this.itemSize]}},{key:"setX",value:function(e,t){return this.array[e*this.itemSize]=t,this}},{key:"getY",value:function(e){return this.array[e*this.itemSize+1]}},{key:"setY",value:function(e,t){return this.array[e*this.itemSize+1]=t,this}},{key:"getZ",value:function(e){return this.array[e*this.itemSize+2]}},{key:"setZ",value:function(e,t){return this.array[e*this.itemSize+2]=t,this}},{key:"getW",value:function(e){return this.array[e*this.itemSize+3]}},{key:"setW",value:function(e,t){return this.array[e*this.itemSize+3]=t,this}},{key:"setXY",value:function(e,t,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this}},{key:"setXYZ",value:function(e,t,n,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this}},{key:"setXYZW",value:function(e,t,n,i,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=r,this}},{key:"onUpload",value:function(e){return this.onUploadCallback=e,this}},{key:"clone",value:function(){return new this.constructor(this.array,this.itemSize).copy(this)}},{key:"toJSON",value:function(){var e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==te&&(e.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(e.updateRange=this.updateRange),e}}]),e}();tn.prototype.isBufferAttribute=!0;var nn=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e,i,r){return Object(v.a)(this,n),t.call(this,new Uint16Array(e),i,r)}return n}(tn),rn=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e,i,r){return Object(v.a)(this,n),t.call(this,new Uint32Array(e),i,r)}return n}(tn);(function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e,i,r){return Object(v.a)(this,n),t.call(this,new Uint16Array(e),i,r)}return n})(tn).prototype.isFloat16BufferAttribute=!0;var an=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e,i,r){return Object(v.a)(this,n),t.call(this,new Float32Array(e),i,r)}return n}(tn);function on(e){if(0===e.length)return-1/0;for(var t=e[0],n=1,i=e.length;n<i;++n)e[n]>t&&(t=e[n]);return t}Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;var sn=0,ln=new nt,cn=new kt,un=new Ee,hn=new Ae,dn=new Ae,pn=new Ee,fn=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(){var e;return Object(v.a)(this,n),e=t.call(this),Object.defineProperty(Object(f.a)(e),"id",{value:sn++}),e.uuid=ce(),e.name="",e.type="BufferGeometry",e.index=null,e.attributes={},e.morphAttributes={},e.morphTargetsRelative=!1,e.groups=[],e.boundingBox=null,e.boundingSphere=null,e.drawRange={start:0,count:1/0},e.userData={},e}return Object(y.a)(n,[{key:"getIndex",value:function(){return this.index}},{key:"setIndex",value:function(e){return Array.isArray(e)?this.index=new(on(e)>65535?rn:nn)(e,1):this.index=e,this}},{key:"getAttribute",value:function(e){return this.attributes[e]}},{key:"setAttribute",value:function(e,t){return this.attributes[e]=t,this}},{key:"deleteAttribute",value:function(e){return delete this.attributes[e],this}},{key:"hasAttribute",value:function(e){return void 0!==this.attributes[e]}},{key:"addGroup",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.groups.push({start:e,count:t,materialIndex:n})}},{key:"clearGroups",value:function(){this.groups=[]}},{key:"setDrawRange",value:function(e,t){this.drawRange.start=e,this.drawRange.count=t}},{key:"applyMatrix4",value:function(e){var t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);var n=this.attributes.normal;if(void 0!==n){var i=(new ve).getNormalMatrix(e);n.applyNormalMatrix(i),n.needsUpdate=!0}var r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(e),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}},{key:"applyQuaternion",value:function(e){return ln.makeRotationFromQuaternion(e),this.applyMatrix4(ln),this}},{key:"rotateX",value:function(e){return ln.makeRotationX(e),this.applyMatrix4(ln),this}},{key:"rotateY",value:function(e){return ln.makeRotationY(e),this.applyMatrix4(ln),this}},{key:"rotateZ",value:function(e){return ln.makeRotationZ(e),this.applyMatrix4(ln),this}},{key:"translate",value:function(e,t,n){return ln.makeTranslation(e,t,n),this.applyMatrix4(ln),this}},{key:"scale",value:function(e,t,n){return ln.makeScale(e,t,n),this.applyMatrix4(ln),this}},{key:"lookAt",value:function(e){return cn.lookAt(e),cn.updateMatrix(),this.applyMatrix4(cn.matrix),this}},{key:"center",value:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(un).negate(),this.translate(un.x,un.y,un.z),this}},{key:"setFromPoints",value:function(e){for(var t=[],n=0,i=e.length;n<i;n++){var r=e[n];t.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new an(t,3)),this}},{key:"computeBoundingBox",value:function(){null===this.boundingBox&&(this.boundingBox=new Ae);var e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Ee(-1/0,-1/0,-1/0),new Ee(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(var n=0,i=t.length;n<i;n++){var r=t[n];hn.setFromBufferAttribute(r),this.morphTargetsRelative?(pn.addVectors(this.boundingBox.min,hn.min),this.boundingBox.expandByPoint(pn),pn.addVectors(this.boundingBox.max,hn.max),this.boundingBox.expandByPoint(pn)):(this.boundingBox.expandByPoint(hn.min),this.boundingBox.expandByPoint(hn.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}},{key:"computeBoundingSphere",value:function(){null===this.boundingSphere&&(this.boundingSphere=new Ze);var e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Ee,1/0);if(e){var n=this.boundingSphere.center;if(hn.setFromBufferAttribute(e),t)for(var i=0,r=t.length;i<r;i++){var a=t[i];dn.setFromBufferAttribute(a),this.morphTargetsRelative?(pn.addVectors(hn.min,dn.min),hn.expandByPoint(pn),pn.addVectors(hn.max,dn.max),hn.expandByPoint(pn)):(hn.expandByPoint(dn.min),hn.expandByPoint(dn.max))}hn.getCenter(n);for(var o=0,s=0,l=e.count;s<l;s++)pn.fromBufferAttribute(e,s),o=Math.max(o,n.distanceToSquared(pn));if(t)for(var c=0,u=t.length;c<u;c++)for(var h=t[c],d=this.morphTargetsRelative,p=0,f=h.count;p<f;p++)pn.fromBufferAttribute(h,p),d&&(un.fromBufferAttribute(e,p),pn.add(un)),o=Math.max(o,n.distanceToSquared(pn));this.boundingSphere.radius=Math.sqrt(o),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}},{key:"computeFaceNormals",value:function(){}},{key:"computeTangents",value:function(){var e=this.index,t=this.attributes;if(null!==e&&void 0!==t.position&&void 0!==t.normal&&void 0!==t.uv){var n=e.array,i=t.position.array,r=t.normal.array,a=t.uv.array,o=i.length/3;void 0===t.tangent&&this.setAttribute("tangent",new tn(new Float32Array(4*o),4));for(var s=t.tangent.array,l=[],c=[],u=0;u<o;u++)l[u]=new Ee,c[u]=new Ee;var h=new Ee,d=new Ee,p=new Ee,f=new me,m=new me,g=new me,v=new Ee,y=new Ee,_=this.groups;0===_.length&&(_=[{start:0,count:n.length}]);for(var x=0,b=_.length;x<b;++x)for(var w=_[x],S=w.start,T=S,E=S+w.count;T<E;T+=3)O(n[T+0],n[T+1],n[T+2]);for(var M=new Ee,k=new Ee,A=new Ee,C=new Ee,P=0,L=_.length;P<L;++P)for(var I=_[P],R=I.start,z=R,D=R+I.count;z<D;z+=3)B(n[z+0]),B(n[z+1]),B(n[z+2])}else console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");function O(e,t,n){h.fromArray(i,3*e),d.fromArray(i,3*t),p.fromArray(i,3*n),f.fromArray(a,2*e),m.fromArray(a,2*t),g.fromArray(a,2*n),d.sub(h),p.sub(h),m.sub(f),g.sub(f);var r=1/(m.x*g.y-g.x*m.y);isFinite(r)&&(v.copy(d).multiplyScalar(g.y).addScaledVector(p,-m.y).multiplyScalar(r),y.copy(p).multiplyScalar(m.x).addScaledVector(d,-g.x).multiplyScalar(r),l[e].add(v),l[t].add(v),l[n].add(v),c[e].add(y),c[t].add(y),c[n].add(y))}function B(e){A.fromArray(r,3*e),C.copy(A);var t=l[e];M.copy(t),M.sub(A.multiplyScalar(A.dot(t))).normalize(),k.crossVectors(C,t);var n=k.dot(c[e])<0?-1:1;s[4*e]=M.x,s[4*e+1]=M.y,s[4*e+2]=M.z,s[4*e+3]=n}}},{key:"computeVertexNormals",value:function(){var e=this.index,t=this.getAttribute("position");if(void 0!==t){var n=this.getAttribute("normal");if(void 0===n)n=new tn(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(var i=0,r=n.count;i<r;i++)n.setXYZ(i,0,0,0);var a=new Ee,o=new Ee,s=new Ee,l=new Ee,c=new Ee,u=new Ee,h=new Ee,d=new Ee;if(e)for(var p=0,f=e.count;p<f;p+=3){var m=e.getX(p+0),g=e.getX(p+1),v=e.getX(p+2);a.fromBufferAttribute(t,m),o.fromBufferAttribute(t,g),s.fromBufferAttribute(t,v),h.subVectors(s,o),d.subVectors(a,o),h.cross(d),l.fromBufferAttribute(n,m),c.fromBufferAttribute(n,g),u.fromBufferAttribute(n,v),l.add(h),c.add(h),u.add(h),n.setXYZ(m,l.x,l.y,l.z),n.setXYZ(g,c.x,c.y,c.z),n.setXYZ(v,u.x,u.y,u.z)}else for(var y=0,_=t.count;y<_;y+=3)a.fromBufferAttribute(t,y+0),o.fromBufferAttribute(t,y+1),s.fromBufferAttribute(t,y+2),h.subVectors(s,o),d.subVectors(a,o),h.cross(d),n.setXYZ(y+0,h.x,h.y,h.z),n.setXYZ(y+1,h.x,h.y,h.z),n.setXYZ(y+2,h.x,h.y,h.z);this.normalizeNormals(),n.needsUpdate=!0}}},{key:"merge",value:function(e,t){if(e&&e.isBufferGeometry){void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var n=this.attributes;for(var i in n)if(void 0!==e.attributes[i])for(var r=n[i].array,a=e.attributes[i],o=a.array,s=a.itemSize*t,l=Math.min(o.length,r.length-s),c=0,u=s;c<l;c++,u++)r[u]=o[c];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)}},{key:"normalizeNormals",value:function(){for(var e=this.attributes.normal,t=0,n=e.count;t<n;t++)pn.fromBufferAttribute(e,t),pn.normalize(),e.setXYZ(t,pn.x,pn.y,pn.z)}},{key:"toNonIndexed",value:function(){function e(e,t){for(var n=e.array,i=e.itemSize,r=e.normalized,a=new n.constructor(t.length*i),o=0,s=0,l=0,c=t.length;l<c;l++){o=t[l]*i;for(var u=0;u<i;u++)a[s++]=n[o++]}return new tn(a,i,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;var t=new n,i=this.index.array,r=this.attributes;for(var a in r){var o=e(r[a],i);t.setAttribute(a,o)}var s=this.morphAttributes;for(var l in s){for(var c=[],u=s[l],h=0,d=u.length;h<d;h++){var p=e(u[h],i);c.push(p)}t.morphAttributes[l]=c}t.morphTargetsRelative=this.morphTargetsRelative;for(var f=this.groups,m=0,g=f.length;m<g;m++){var v=f[m];t.addGroup(v.start,v.count,v.materialIndex)}return t}},{key:"toJSON",value:function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){var t=this.parameters;for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};var i=this.index;null!==i&&(e.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)});var r=this.attributes;for(var a in r){var o=r[a];e.data.attributes[a]=o.toJSON(e.data)}var s={},l=!1;for(var c in this.morphAttributes){for(var u=this.morphAttributes[c],h=[],d=0,p=u.length;d<p;d++){var f=u[d];h.push(f.toJSON(e.data))}h.length>0&&(s[c]=h,l=!0)}l&&(e.data.morphAttributes=s,e.data.morphTargetsRelative=this.morphTargetsRelative);var m=this.groups;m.length>0&&(e.data.groups=JSON.parse(JSON.stringify(m)));var g=this.boundingSphere;return null!==g&&(e.data.boundingSphere={center:g.center.toArray(),radius:g.radius}),e}},{key:"clone",value:function(){return(new n).copy(this)}},{key:"copy",value:function(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;var t={};this.name=e.name;var n=e.index;null!==n&&this.setIndex(n.clone(t));var i=e.attributes;for(var r in i){var a=i[r];this.setAttribute(r,a.clone(t))}var o=e.morphAttributes;for(var s in o){for(var l=[],c=o[s],u=0,h=c.length;u<h;u++)l.push(c[u].clone(t));this.morphAttributes[s]=l}this.morphTargetsRelative=e.morphTargetsRelative;for(var d=e.groups,p=0,f=d.length;p<f;p++){var m=d[p];this.addGroup(m.start,m.count,m.materialIndex)}var g=e.boundingBox;null!==g&&(this.boundingBox=g.clone());var v=e.boundingSphere;return null!==v&&(this.boundingSphere=v.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}}]),n}(re);fn.prototype.isBufferGeometry=!0;var mn=new nt,gn=new tt,vn=new Ze,yn=new Ee,_n=new Ee,xn=new Ee,bn=new Ee,wn=new Ee,Sn=new Ee,Tn=new Ee,En=new Ee,Mn=new Ee,kn=new me,An=new me,Cn=new me,Pn=new Ee,Ln=new Ee,In=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new fn,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Kt;return Object(v.a)(this,n),(e=t.call(this)).type="Mesh",e.geometry=i,e.material=r,e.updateMorphTargets(),e}return Object(y.a)(n,[{key:"copy",value:function(e){return h(Object(u.a)(n.prototype),"copy",this).call(this,e),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}},{key:"updateMorphTargets",value:function(){var e=this.geometry;if(e.isBufferGeometry){var t=e.morphAttributes,n=Object.keys(t);if(n.length>0){var i=t[n[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var r=0,a=i.length;r<a;r++){var o=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=r}}}}else{var s=e.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}},{key:"raycast",value:function(e,t){var n,i=this.geometry,r=this.material,a=this.matrixWorld;if(void 0!==r&&(null===i.boundingSphere&&i.computeBoundingSphere(),vn.copy(i.boundingSphere),vn.applyMatrix4(a),!1!==e.ray.intersectsSphere(vn)&&(mn.copy(a).invert(),gn.copy(e.ray).applyMatrix4(mn),null===i.boundingBox||!1!==gn.intersectsBox(i.boundingBox))))if(i.isBufferGeometry){var o=i.index,s=i.attributes.position,l=i.morphAttributes.position,c=i.morphTargetsRelative,u=i.attributes.uv,h=i.attributes.uv2,d=i.groups,p=i.drawRange;if(null!==o)if(Array.isArray(r))for(var f=0,m=d.length;f<m;f++)for(var g=d[f],v=r[g.materialIndex],y=Math.max(g.start,p.start),_=Math.min(g.start+g.count,p.start+p.count);y<_;y+=3){var x=o.getX(y),b=o.getX(y+1),w=o.getX(y+2);(n=Rn(this,v,e,gn,s,l,c,u,h,x,b,w))&&(n.faceIndex=Math.floor(y/3),n.face.materialIndex=g.materialIndex,t.push(n))}else for(var S=Math.max(0,p.start),T=Math.min(o.count,p.start+p.count);S<T;S+=3){var E=o.getX(S),M=o.getX(S+1),k=o.getX(S+2);(n=Rn(this,r,e,gn,s,l,c,u,h,E,M,k))&&(n.faceIndex=Math.floor(S/3),t.push(n))}else if(void 0!==s)if(Array.isArray(r))for(var A=0,C=d.length;A<C;A++)for(var P=d[A],L=r[P.materialIndex],I=Math.max(P.start,p.start),R=Math.min(P.start+P.count,p.start+p.count);I<R;I+=3){(n=Rn(this,L,e,gn,s,l,c,u,h,I,I+1,I+2))&&(n.faceIndex=Math.floor(I/3),n.face.materialIndex=P.materialIndex,t.push(n))}else for(var z=Math.max(0,p.start),D=Math.min(s.count,p.start+p.count);z<D;z+=3){(n=Rn(this,r,e,gn,s,l,c,u,h,z,z+1,z+2))&&(n.faceIndex=Math.floor(z/3),t.push(n))}}else i.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}]),n}(kt);function Rn(e,t,n,i,r,a,o,s,l,c,u,h){yn.fromBufferAttribute(r,c),_n.fromBufferAttribute(r,u),xn.fromBufferAttribute(r,h);var d=e.morphTargetInfluences;if(t.morphTargets&&a&&d){Tn.set(0,0,0),En.set(0,0,0),Mn.set(0,0,0);for(var p=0,f=a.length;p<f;p++){var m=d[p],g=a[p];0!==m&&(bn.fromBufferAttribute(g,c),wn.fromBufferAttribute(g,u),Sn.fromBufferAttribute(g,h),o?(Tn.addScaledVector(bn,m),En.addScaledVector(wn,m),Mn.addScaledVector(Sn,m)):(Tn.addScaledVector(bn.sub(yn),m),En.addScaledVector(wn.sub(_n),m),Mn.addScaledVector(Sn.sub(xn),m)))}yn.add(Tn),_n.add(En),xn.add(Mn)}e.isSkinnedMesh&&(e.boneTransform(c,yn),e.boneTransform(u,_n),e.boneTransform(h,xn));var v=function(e,t,n,i,r,a,o,s){if(null===(1===t.side?i.intersectTriangle(o,a,r,!0,s):i.intersectTriangle(r,a,o,2!==t.side,s)))return null;Ln.copy(s),Ln.applyMatrix4(e.matrixWorld);var l=n.ray.origin.distanceTo(Ln);return l<n.near||l>n.far?null:{distance:l,point:Ln.clone(),object:e}}(e,t,n,i,yn,_n,xn,Pn);if(v){s&&(kn.fromBufferAttribute(s,c),An.fromBufferAttribute(s,u),Cn.fromBufferAttribute(s,h),v.uv=jt.getUV(Pn,yn,_n,xn,kn,An,Cn,new me)),l&&(kn.fromBufferAttribute(l,c),An.fromBufferAttribute(l,u),Cn.fromBufferAttribute(l,h),v.uv2=jt.getUV(Pn,yn,_n,xn,kn,An,Cn,new me));var y={a:c,b:u,c:h,normal:new Ee,materialIndex:0};jt.getNormal(yn,_n,xn,y.normal),v.face=y}return v}In.prototype.isMesh=!0;var zn=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;Object(v.a)(this,n),(e=t.call(this)).type="BoxGeometry",e.parameters={width:i,height:r,depth:a,widthSegments:o,heightSegments:s,depthSegments:l};var c=Object(f.a)(e);o=Math.floor(o),s=Math.floor(s),l=Math.floor(l);var u=[],h=[],d=[],p=[],m=0,g=0;function y(e,t,n,i,r,a,o,s,l,f,v){for(var y=a/l,_=o/f,x=a/2,b=o/2,w=s/2,S=l+1,T=f+1,E=0,M=0,k=new Ee,A=0;A<T;A++)for(var C=A*_-b,P=0;P<S;P++){var L=P*y-x;k[e]=L*i,k[t]=C*r,k[n]=w,h.push(k.x,k.y,k.z),k[e]=0,k[t]=0,k[n]=s>0?1:-1,d.push(k.x,k.y,k.z),p.push(P/l),p.push(1-A/f),E+=1}for(var I=0;I<f;I++)for(var R=0;R<l;R++){var z=m+R+S*I,D=m+R+S*(I+1),O=m+(R+1)+S*(I+1),B=m+(R+1)+S*I;u.push(z,D,B),u.push(D,O,B),M+=6}c.addGroup(g,M,v),g+=M,m+=E}return y("z","y","x",-1,-1,a,r,i,l,s,0),y("z","y","x",1,-1,a,r,-i,l,s,1),y("x","z","y",1,1,i,a,r,o,l,2),y("x","z","y",1,-1,i,a,-r,o,l,3),y("x","y","z",1,-1,i,r,a,o,s,4),y("x","y","z",-1,-1,i,r,-a,o,s,5),e.setIndex(u),e.setAttribute("position",new an(h,3)),e.setAttribute("normal",new an(d,3)),e.setAttribute("uv",new an(p,2)),e}return n}(fn);function Dn(e){var t={};for(var n in e)for(var i in t[n]={},e[n]){var r=e[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?t[n][i]=r.clone():Array.isArray(r)?t[n][i]=r.slice():t[n][i]=r}return t}function On(e){for(var t={},n=0;n<e.length;n++){var i=Dn(e[n]);for(var r in i)t[r]=i[r]}return t}var Bn={clone:Dn,merge:On},Fn=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e){var i;return Object(v.a)(this,n),(i=t.call(this)).type="ShaderMaterial",i.defines={},i.uniforms={},i.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",i.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",i.linewidth=1,i.wireframe=!1,i.wireframeLinewidth=1,i.fog=!1,i.lights=!1,i.clipping=!1,i.morphTargets=!1,i.morphNormals=!1,i.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},i.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},i.index0AttributeName=void 0,i.uniformsNeedUpdate=!1,i.glslVersion=null,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),i.setValues(e)),i}return Object(y.a)(n,[{key:"copy",value:function(e){return h(Object(u.a)(n.prototype),"copy",this).call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Dn(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}},{key:"toJSON",value:function(e){var t=h(Object(u.a)(n.prototype),"toJSON",this).call(this,e);for(var i in t.glslVersion=this.glslVersion,t.uniforms={},this.uniforms){var r=this.uniforms[i].value;r&&r.isTexture?t.uniforms[i]={type:"t",value:r.toJSON(e).uuid}:r&&r.isColor?t.uniforms[i]={type:"c",value:r.getHex()}:r&&r.isVector2?t.uniforms[i]={type:"v2",value:r.toArray()}:r&&r.isVector3?t.uniforms[i]={type:"v3",value:r.toArray()}:r&&r.isVector4?t.uniforms[i]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?t.uniforms[i]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?t.uniforms[i]={type:"m4",value:r.toArray()}:t.uniforms[i]={value:r}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;var a={};for(var o in this.extensions)!0===this.extensions[o]&&(a[o]=!0);return Object.keys(a).length>0&&(t.extensions=a),t}}]),n}(Ht);Fn.prototype.isShaderMaterial=!0;var Nn=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(){var e;return Object(v.a)(this,n),(e=t.call(this)).type="Camera",e.matrixWorldInverse=new nt,e.projectionMatrix=new nt,e.projectionMatrixInverse=new nt,e}return Object(y.a)(n,[{key:"copy",value:function(e,t){return h(Object(u.a)(n.prototype),"copy",this).call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}},{key:"getWorldDirection",value:function(e){void 0===e&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new Ee),this.updateWorldMatrix(!0,!1);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}},{key:"updateMatrixWorld",value:function(e){h(Object(u.a)(n.prototype),"updateMatrixWorld",this).call(this,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}},{key:"updateWorldMatrix",value:function(e,t){h(Object(u.a)(n.prototype),"updateWorldMatrix",this).call(this,e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),n}(kt);Nn.prototype.isCamera=!0;var Un=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2e3;return Object(v.a)(this,n),(e=t.call(this)).type="PerspectiveCamera",e.fov=i,e.zoom=1,e.near=a,e.far=o,e.focus=10,e.aspect=r,e.view=null,e.filmGauge=35,e.filmOffset=0,e.updateProjectionMatrix(),e}return Object(y.a)(n,[{key:"copy",value:function(e,t){return h(Object(u.a)(n.prototype),"copy",this).call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}},{key:"setFocalLength",value:function(e){var t=.5*this.getFilmHeight()/e;this.fov=2*le*Math.atan(t),this.updateProjectionMatrix()}},{key:"getFocalLength",value:function(){var e=Math.tan(.5*se*this.fov);return.5*this.getFilmHeight()/e}},{key:"getEffectiveFOV",value:function(){return 2*le*Math.atan(Math.tan(.5*se*this.fov)/this.zoom)}},{key:"getFilmWidth",value:function(){return this.filmGauge*Math.min(this.aspect,1)}},{key:"getFilmHeight",value:function(){return this.filmGauge/Math.max(this.aspect,1)}},{key:"setViewOffset",value:function(e,t,n,i,r,a){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}},{key:"clearViewOffset",value:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}},{key:"updateProjectionMatrix",value:function(){var e=this.near,t=e*Math.tan(.5*se*this.fov)/this.zoom,n=2*t,i=this.aspect*n,r=-.5*i,a=this.view;if(null!==this.view&&this.view.enabled){var o=a.fullWidth,s=a.fullHeight;r+=a.offsetX*i/o,t-=a.offsetY*n/s,i*=a.width/o,n*=a.height/s}var l=this.filmOffset;0!==l&&(r+=e*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,t,t-n,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}},{key:"toJSON",value:function(e){var t=h(Object(u.a)(n.prototype),"toJSON",this).call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}]),n}(Nn);Un.prototype.isPerspectiveCamera=!0;var Vn=90,jn=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e,i,r){var a;if(Object(v.a)(this,n),(a=t.call(this)).type="CubeCamera",!0!==r.isWebGLCubeRenderTarget)return console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter."),Object(c.a)(a);a.renderTarget=r;var o=new Un(Vn,1,e,i);o.layers=a.layers,o.up.set(0,-1,0),o.lookAt(new Ee(1,0,0)),a.add(o);var s=new Un(Vn,1,e,i);s.layers=a.layers,s.up.set(0,-1,0),s.lookAt(new Ee(-1,0,0)),a.add(s);var l=new Un(Vn,1,e,i);l.layers=a.layers,l.up.set(0,0,1),l.lookAt(new Ee(0,1,0)),a.add(l);var u=new Un(Vn,1,e,i);u.layers=a.layers,u.up.set(0,0,-1),u.lookAt(new Ee(0,-1,0)),a.add(u);var h=new Un(Vn,1,e,i);h.layers=a.layers,h.up.set(0,-1,0),h.lookAt(new Ee(0,0,1)),a.add(h);var d=new Un(Vn,1,e,i);return d.layers=a.layers,d.up.set(0,-1,0),d.lookAt(new Ee(0,0,-1)),a.add(d),a}return Object(y.a)(n,[{key:"update",value:function(e,t){null===this.parent&&this.updateMatrixWorld();var n=this.renderTarget,i=Object(l.a)(this.children,6),r=i[0],a=i[1],o=i[2],s=i[3],c=i[4],u=i[5],h=e.xr.enabled,d=e.getRenderTarget();e.xr.enabled=!1;var p=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,r),e.setRenderTarget(n,1),e.render(t,a),e.setRenderTarget(n,2),e.render(t,o),e.setRenderTarget(n,3),e.render(t,s),e.setRenderTarget(n,4),e.render(t,c),n.texture.generateMipmaps=p,e.setRenderTarget(n,5),e.render(t,u),e.setRenderTarget(d),e.xr.enabled=h}}]),n}(kt),Gn=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e,i,r,a,o,s,l,c,u,h){var d;return Object(v.a)(this,n),e=void 0!==e?e:[],i=void 0!==i?i:x,l=void 0!==l?l:F,(d=t.call(this,e,i,r,a,o,s,l,c,u,h))._needsFlipEnvMap=!0,d.flipY=!1,d}return Object(y.a)(n,[{key:"images",get:function(){return this.image},set:function(e){this.image=e}}]),n}(xe);Gn.prototype.isCubeTexture=!0;var Hn=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e,i,r){var a;return Object(v.a)(this,n),Number.isInteger(i)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),i=r),a=t.call(this,e,e,i),i=i||{},a.texture=new Gn(void 0,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),a.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,a.texture.minFilter=void 0!==i.minFilter?i.minFilter:P,a.texture._needsFlipEnvMap=!1,a}return Object(y.a)(n,[{key:"fromEquirectangularTexture",value:function(e,t){this.texture.type=t.type,this.texture.format=N,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;var n={tEquirect:{value:null}},i="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",r="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",a=new zn(5,5,5),o=new Fn({name:"CubemapFromEquirect",uniforms:Dn(n),vertexShader:i,fragmentShader:r,side:1,blending:0});o.uniforms.tEquirect.value=t;var s=new In(a,o),l=t.minFilter;return t.minFilter===L&&(t.minFilter=P),new jn(1,10,this).update(e,s),t.minFilter=l,s.geometry.dispose(),s.material.dispose(),this}},{key:"clear",value:function(e,t,n,i){for(var r=e.getRenderTarget(),a=0;a<6;a++)e.setRenderTarget(this,a),e.clear(t,n,i);e.setRenderTarget(r)}}]),n}(Se);Hn.prototype.isWebGLCubeRenderTarget=!0;var Wn=new Ze,qn=new Ee,Zn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Lt,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Lt,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Lt,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Lt,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Lt,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new Lt;Object(v.a)(this,e),this.planes=[t,n,i,r,a,o]}return Object(y.a)(e,[{key:"set",value:function(e,t,n,i,r,a){var o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(n),o[3].copy(i),o[4].copy(r),o[5].copy(a),this}},{key:"copy",value:function(e){for(var t=this.planes,n=0;n<6;n++)t[n].copy(e.planes[n]);return this}},{key:"setFromProjectionMatrix",value:function(e){var t=this.planes,n=e.elements,i=n[0],r=n[1],a=n[2],o=n[3],s=n[4],l=n[5],c=n[6],u=n[7],h=n[8],d=n[9],p=n[10],f=n[11],m=n[12],g=n[13],v=n[14],y=n[15];return t[0].setComponents(o-i,u-s,f-h,y-m).normalize(),t[1].setComponents(o+i,u+s,f+h,y+m).normalize(),t[2].setComponents(o+r,u+l,f+d,y+g).normalize(),t[3].setComponents(o-r,u-l,f-d,y-g).normalize(),t[4].setComponents(o-a,u-c,f-p,y-v).normalize(),t[5].setComponents(o+a,u+c,f+p,y+v).normalize(),this}},{key:"intersectsObject",value:function(e){var t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),Wn.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Wn)}},{key:"intersectsSprite",value:function(e){return Wn.center.set(0,0,0),Wn.radius=.7071067811865476,Wn.applyMatrix4(e.matrixWorld),this.intersectsSphere(Wn)}},{key:"intersectsSphere",value:function(e){for(var t=this.planes,n=e.center,i=-e.radius,r=0;r<6;r++){if(t[r].distanceToPoint(n)<i)return!1}return!0}},{key:"intersectsBox",value:function(e){for(var t=this.planes,n=0;n<6;n++){var i=t[n];if(qn.x=i.normal.x>0?e.max.x:e.min.x,qn.y=i.normal.y>0?e.max.y:e.min.y,qn.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(qn)<0)return!1}return!0}},{key:"containsPoint",value:function(e){for(var t=this.planes,n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}();function $n(){var e=null,t=!1,n=null,i=null;function r(t,a){n(t,a),i=e.requestAnimationFrame(r)}return{start:function(){!0!==t&&null!==n&&(i=e.requestAnimationFrame(r),t=!0)},stop:function(){e.cancelAnimationFrame(i),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function Xn(e,t){var n=t.isWebGL2,i=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),i.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);var n=i.get(t);n&&(e.deleteBuffer(n.buffer),i.delete(t))},update:function(t,r){if(t.isGLBufferAttribute){var a=i.get(t);(!a||a.version<t.version)&&i.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version})}else{t.isInterleavedBufferAttribute&&(t=t.data);var o=i.get(t);void 0===o?i.set(t,function(t,i){var r=t.array,a=t.usage,o=e.createBuffer();e.bindBuffer(i,o),e.bufferData(i,r,a),t.onUploadCallback();var s=5126;return r instanceof Float32Array?s=5126:r instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):r instanceof Uint16Array?t.isFloat16BufferAttribute?n?s=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):s=5123:r instanceof Int16Array?s=5122:r instanceof Uint32Array?s=5125:r instanceof Int32Array?s=5124:r instanceof Int8Array?s=5120:(r instanceof Uint8Array||r instanceof Uint8ClampedArray)&&(s=5121),{buffer:o,type:s,bytesPerElement:r.BYTES_PER_ELEMENT,version:t.version}}(t,r)):o.version<t.version&&(!function(t,i,r){var a=i.array,o=i.updateRange;e.bindBuffer(r,t),-1===o.count?e.bufferSubData(r,0,a):(n?e.bufferSubData(r,o.offset*a.BYTES_PER_ELEMENT,a,o.offset,o.count):e.bufferSubData(r,o.offset*a.BYTES_PER_ELEMENT,a.subarray(o.offset,o.offset+o.count)),o.count=-1)}(o.buffer,t,r),o.version=t.version)}}}}var Yn=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;Object(v.a)(this,n),(e=t.call(this)).type="PlaneGeometry",e.parameters={width:i,height:r,widthSegments:a,heightSegments:o};for(var s=i/2,l=r/2,c=Math.floor(a),u=Math.floor(o),h=c+1,d=u+1,p=i/c,f=r/u,m=[],g=[],y=[],_=[],x=0;x<d;x++)for(var b=x*f-l,w=0;w<h;w++){var S=w*p-s;g.push(S,-b,0),y.push(0,0,1),_.push(w/c),_.push(1-x/u)}for(var T=0;T<u;T++)for(var E=0;E<c;E++){var M=E+h*T,k=E+h*(T+1),A=E+1+h*(T+1),C=E+1+h*T;m.push(M,k,C),m.push(k,A,C)}return e.setIndex(m),e.setAttribute("position",new an(g,3)),e.setAttribute("normal",new an(y,3)),e.setAttribute("uv",new an(_,2)),e}return n}(fn),Jn={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\t\tvec2 f = fract( uv );\n\t\tuv += 0.5 - f;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x += texelSize;\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.y += texelSize;\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x -= texelSize;\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tvec3 tm = mix( tl, tr, f.x );\n\t\tvec3 bm = mix( bl, br, f.x );\n\t\treturn mix( tm, bm, f.y );\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value ) {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), rawDiffuseColor, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), rawDiffuseColor, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat specularRoughness;\n\tvec3 specularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\t\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\t\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\t#ifdef USE_TRANSMISSIONMAP\n\t\ttotalTransmission *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSNMAP\n\t\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition.xyz / vWorldPosition.w;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n\tfloat ior = ( 1.0 + 0.4 * reflectivity ) / ( 1.0 - 0.4 * reflectivity );\n\tvec3 f0 = vec3( pow( ior - 1.0, 2.0 ) / pow( ior + 1.0, 2.0 ) );\n\tvec3 f90 = vec3( 1.0 );\n\tvec3 f_transmission = totalTransmission * getIBLVolumeRefraction(\n\t\tnormal, v, viewDir, roughnessFactor, diffuseColor.rgb, f0, f90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\n\t\tattenuationColor, attenuationDistance);\n\tdiffuseColor.rgb = mix( diffuseColor.rgb, f_transmission, totalTransmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec4 vWorldPosition;\n\tvec3 getVolumeTransmissionRay(vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix) {\n\t\tvec3 refractionVector = refract(-v, normalize(n), 1.0 / ior);\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length(vec3(modelMatrix[0].xyz));\n\t\tmodelScale.y = length(vec3(modelMatrix[1].xyz));\n\t\tmodelScale.z = length(vec3(modelMatrix[2].xyz));\n\t\treturn normalize(refractionVector) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness(float roughness, float ior) {\n\t\treturn roughness * clamp(ior * 2.0 - 2.0, 0.0, 1.0);\n\t}\n\tvec3 getTransmissionSample(vec2 fragCoord, float roughness, float ior) {\n\t\tfloat framebufferLod = log2(transmissionSamplerSize.x) * applyIorToRoughness(roughness, ior);\n\t\treturn texture2DLodEXT(transmissionSamplerMap, fragCoord.xy, framebufferLod).rgb;\n\t}\n\tvec3 applyVolumeAttenuation(vec3 radiance, float transmissionDistance, vec3 attenuationColor, float attenuationDistance) {\n\t\tif (attenuationDistance == 0.0) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log(attenuationColor) / attenuationDistance;\n\t\t\tvec3 transmittance = exp(-attenuationCoefficient * transmissionDistance);\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec3 getIBLVolumeRefraction(vec3 n, vec3 v, vec3 viewDir, float perceptualRoughness, vec3 baseColor, vec3 f0, vec3 f90,\n\t\tvec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness, vec3 attenuationColor, float attenuationDistance) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay(n, v, thickness, ior, modelMatrix);\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4(refractedRayExit, 1.0);\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec3 transmittedLight = getTransmissionSample(refractionCoords, perceptualRoughness, ior);\n\t\tvec3 attenuatedColor = applyVolumeAttenuation(transmittedLight, length(transmissionRay), attenuationColor, attenuationDistance);\n\t\tfloat NdotV = saturate(dot(n, viewDir));\n\t\tvec2 brdf = integrateSpecularBRDF(NdotV, perceptualRoughness);\n\t\tvec3 specularColor = f0 * brdf.x + f90 * brdf.y;\n\t\treturn (1.0 - specularColor) * attenuatedColor * baseColor;\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform vec3 attenuationColor;\n\tuniform float attenuationDistance;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <transmission_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#ifdef USE_TRANSMISSION\n\t\tfloat totalTransmission = transmission;\n\t\tfloat thicknessFactor = thickness;\n\t#endif\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\tvec3 rawDiffuseColor = diffuseColor.rgb;\n\t#include <transmission_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#ifdef USE_TRANSMISSION\n\tvarying vec4 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition;\n#endif\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},Kn={common:{diffuse:{value:new Jt(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new ve},uv2Transform:{value:new ve},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new me(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Jt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Jt(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new ve}},sprite:{diffuse:{value:new Jt(16777215)},opacity:{value:1},center:{value:new me(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new ve}}},Qn={basic:{uniforms:On([Kn.common,Kn.specularmap,Kn.envmap,Kn.aomap,Kn.lightmap,Kn.fog]),vertexShader:Jn.meshbasic_vert,fragmentShader:Jn.meshbasic_frag},lambert:{uniforms:On([Kn.common,Kn.specularmap,Kn.envmap,Kn.aomap,Kn.lightmap,Kn.emissivemap,Kn.fog,Kn.lights,{emissive:{value:new Jt(0)}}]),vertexShader:Jn.meshlambert_vert,fragmentShader:Jn.meshlambert_frag},phong:{uniforms:On([Kn.common,Kn.specularmap,Kn.envmap,Kn.aomap,Kn.lightmap,Kn.emissivemap,Kn.bumpmap,Kn.normalmap,Kn.displacementmap,Kn.fog,Kn.lights,{emissive:{value:new Jt(0)},specular:{value:new Jt(1118481)},shininess:{value:30}}]),vertexShader:Jn.meshphong_vert,fragmentShader:Jn.meshphong_frag},standard:{uniforms:On([Kn.common,Kn.envmap,Kn.aomap,Kn.lightmap,Kn.emissivemap,Kn.bumpmap,Kn.normalmap,Kn.displacementmap,Kn.roughnessmap,Kn.metalnessmap,Kn.fog,Kn.lights,{emissive:{value:new Jt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Jn.meshphysical_vert,fragmentShader:Jn.meshphysical_frag},toon:{uniforms:On([Kn.common,Kn.aomap,Kn.lightmap,Kn.emissivemap,Kn.bumpmap,Kn.normalmap,Kn.displacementmap,Kn.gradientmap,Kn.fog,Kn.lights,{emissive:{value:new Jt(0)}}]),vertexShader:Jn.meshtoon_vert,fragmentShader:Jn.meshtoon_frag},matcap:{uniforms:On([Kn.common,Kn.bumpmap,Kn.normalmap,Kn.displacementmap,Kn.fog,{matcap:{value:null}}]),vertexShader:Jn.meshmatcap_vert,fragmentShader:Jn.meshmatcap_frag},points:{uniforms:On([Kn.points,Kn.fog]),vertexShader:Jn.points_vert,fragmentShader:Jn.points_frag},dashed:{uniforms:On([Kn.common,Kn.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Jn.linedashed_vert,fragmentShader:Jn.linedashed_frag},depth:{uniforms:On([Kn.common,Kn.displacementmap]),vertexShader:Jn.depth_vert,fragmentShader:Jn.depth_frag},normal:{uniforms:On([Kn.common,Kn.bumpmap,Kn.normalmap,Kn.displacementmap,{opacity:{value:1}}]),vertexShader:Jn.normal_vert,fragmentShader:Jn.normal_frag},sprite:{uniforms:On([Kn.sprite,Kn.fog]),vertexShader:Jn.sprite_vert,fragmentShader:Jn.sprite_frag},background:{uniforms:{uvTransform:{value:new ve},t2D:{value:null}},vertexShader:Jn.background_vert,fragmentShader:Jn.background_frag},cube:{uniforms:On([Kn.envmap,{opacity:{value:1}}]),vertexShader:Jn.cube_vert,fragmentShader:Jn.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Jn.equirect_vert,fragmentShader:Jn.equirect_frag},distanceRGBA:{uniforms:On([Kn.common,Kn.displacementmap,{referencePosition:{value:new Ee},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Jn.distanceRGBA_vert,fragmentShader:Jn.distanceRGBA_frag},shadow:{uniforms:On([Kn.lights,Kn.fog,{color:{value:new Jt(0)},opacity:{value:1}}]),vertexShader:Jn.shadow_vert,fragmentShader:Jn.shadow_frag}};function ei(e,t,n,i,r){var a,o,s=new Jt(0),l=0,c=null,u=0,h=null;function d(e,t){n.buffers.color.setClear(e.r,e.g,e.b,t,r)}return{getClearColor:function(){return s},setClearColor:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;s.set(e),d(s,l=t)},getClearAlpha:function(){return l},setClearAlpha:function(e){d(s,l=e)},render:function(n,r){var p=!1,f=!0===r.isScene?r.background:null;f&&f.isTexture&&(f=t.get(f));var m=e.xr,g=m.getSession&&m.getSession();g&&"additive"===g.environmentBlendMode&&(f=null),null===f?d(s,l):f&&f.isColor&&(d(f,1),p=!0),(e.autoClear||p)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),f&&(f.isCubeTexture||f.mapping===w)?(void 0===o&&((o=new In(new zn(1,1,1),new Fn({name:"BackgroundCubeMaterial",uniforms:Dn(Qn.cube.uniforms),vertexShader:Qn.cube.vertexShader,fragmentShader:Qn.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),o.geometry.deleteAttribute("uv"),o.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(o.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(o)),o.material.uniforms.envMap.value=f,o.material.uniforms.flipEnvMap.value=f.isCubeTexture&&f._needsFlipEnvMap?-1:1,c===f&&u===f.version&&h===e.toneMapping||(o.material.needsUpdate=!0,c=f,u=f.version,h=e.toneMapping),n.unshift(o,o.geometry,o.material,0,0,null)):f&&f.isTexture&&(void 0===a&&((a=new In(new Yn(2,2),new Fn({name:"BackgroundMaterial",uniforms:Dn(Qn.background.uniforms),vertexShader:Qn.background.vertexShader,fragmentShader:Qn.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(a.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(a)),a.material.uniforms.t2D.value=f,!0===f.matrixAutoUpdate&&f.updateMatrix(),a.material.uniforms.uvTransform.value.copy(f.matrix),c===f&&u===f.version&&h===e.toneMapping||(a.material.needsUpdate=!0,c=f,u=f.version,h=e.toneMapping),n.unshift(a,a.geometry,a.material,0,0,null))}}}function ti(e,t,n,i){var r=e.getParameter(34921),a=i.isWebGL2?null:t.get("OES_vertex_array_object"),o=i.isWebGL2||null!==a,s={},l=d(null),c=l;function u(t){return i.isWebGL2?e.bindVertexArray(t):a.bindVertexArrayOES(t)}function h(t){return i.isWebGL2?e.deleteVertexArray(t):a.deleteVertexArrayOES(t)}function d(e){for(var t=[],n=[],i=[],a=0;a<r;a++)t[a]=0,n[a]=0,i[a]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:n,attributeDivisors:i,object:e,attributes:{},index:null}}function p(){for(var e=c.newAttributes,t=0,n=e.length;t<n;t++)e[t]=0}function f(e){m(e,0)}function m(n,r){var a=c.newAttributes,o=c.enabledAttributes,s=c.attributeDivisors;(a[n]=1,0===o[n]&&(e.enableVertexAttribArray(n),o[n]=1),s[n]!==r)&&((i.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,r),s[n]=r)}function g(){for(var t=c.newAttributes,n=c.enabledAttributes,i=0,r=n.length;i<r;i++)n[i]!==t[i]&&(e.disableVertexAttribArray(i),n[i]=0)}function v(t,n,r,a,o,s){!0!==i.isWebGL2||5124!==r&&5125!==r?e.vertexAttribPointer(t,n,r,a,o,s):e.vertexAttribIPointer(t,n,r,o,s)}function y(){_(),c!==l&&u((c=l).object)}function _(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(r,l,h,y,_){var x=!1;if(o){var b=function(t,n,r){var o=!0===r.wireframe,l=s[t.id];void 0===l&&(l={},s[t.id]=l);var c=l[n.id];void 0===c&&(c={},l[n.id]=c);var u=c[o];void 0===u&&(u=d(i.isWebGL2?e.createVertexArray():a.createVertexArrayOES()),c[o]=u);return u}(y,h,l);c!==b&&u((c=b).object),(x=function(e,t){var n=c.attributes,i=e.attributes,r=0;for(var a in i){var o=n[a],s=i[a];if(void 0===o)return!0;if(o.attribute!==s)return!0;if(o.data!==s.data)return!0;r++}return c.attributesNum!==r||c.index!==t}(y,_))&&function(e,t){var n={},i=e.attributes,r=0;for(var a in i){var o=i[a],s={};s.attribute=o,o.data&&(s.data=o.data),n[a]=s,r++}c.attributes=n,c.attributesNum=r,c.index=t}(y,_)}else{var w=!0===l.wireframe;c.geometry===y.id&&c.program===h.id&&c.wireframe===w||(c.geometry=y.id,c.program=h.id,c.wireframe=w,x=!0)}!0===r.isInstancedMesh&&(x=!0),null!==_&&n.update(_,34963),x&&(!function(r,a,o,s){if(!1===i.isWebGL2&&(r.isInstancedMesh||s.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;p();var l=s.attributes,c=o.getAttributes(),u=a.defaultAttributeValues;for(var h in c){var d=c[h];if(d>=0){var y=l[h];if(void 0!==y){var _=y.normalized,x=y.itemSize,b=n.get(y);if(void 0===b)continue;var w=b.buffer,S=b.type,T=b.bytesPerElement;if(y.isInterleavedBufferAttribute){var E=y.data,M=E.stride,k=y.offset;E&&E.isInstancedInterleavedBuffer?(m(d,E.meshPerAttribute),void 0===s._maxInstanceCount&&(s._maxInstanceCount=E.meshPerAttribute*E.count)):f(d),e.bindBuffer(34962,w),v(d,x,S,_,M*T,k*T)}else y.isInstancedBufferAttribute?(m(d,y.meshPerAttribute),void 0===s._maxInstanceCount&&(s._maxInstanceCount=y.meshPerAttribute*y.count)):f(d),e.bindBuffer(34962,w),v(d,x,S,_,0,0)}else if("instanceMatrix"===h){var A=n.get(r.instanceMatrix);if(void 0===A)continue;var C=A.buffer,P=A.type;m(d+0,1),m(d+1,1),m(d+2,1),m(d+3,1),e.bindBuffer(34962,C),e.vertexAttribPointer(d+0,4,P,!1,64,0),e.vertexAttribPointer(d+1,4,P,!1,64,16),e.vertexAttribPointer(d+2,4,P,!1,64,32),e.vertexAttribPointer(d+3,4,P,!1,64,48)}else if("instanceColor"===h){var L=n.get(r.instanceColor);if(void 0===L)continue;var I=L.buffer,R=L.type;m(d,1),e.bindBuffer(34962,I),e.vertexAttribPointer(d,3,R,!1,12,0)}else if(void 0!==u){var z=u[h];if(void 0!==z)switch(z.length){case 2:e.vertexAttrib2fv(d,z);break;case 3:e.vertexAttrib3fv(d,z);break;case 4:e.vertexAttrib4fv(d,z);break;default:e.vertexAttrib1fv(d,z)}}}}g()}(r,l,h,y),null!==_&&e.bindBuffer(34963,n.get(_).buffer))},reset:y,resetDefaultState:_,dispose:function(){for(var e in y(),s){var t=s[e];for(var n in t){var i=t[n];for(var r in i)h(i[r].object),delete i[r];delete t[n]}delete s[e]}},releaseStatesOfGeometry:function(e){if(void 0!==s[e.id]){var t=s[e.id];for(var n in t){var i=t[n];for(var r in i)h(i[r].object),delete i[r];delete t[n]}delete s[e.id]}},releaseStatesOfProgram:function(e){for(var t in s){var n=s[t];if(void 0!==n[e.id]){var i=n[e.id];for(var r in i)h(i[r].object),delete i[r];delete n[e.id]}}},initAttributes:p,enableAttribute:f,disableUnusedAttributes:g}}function ni(e,t,n,i){var r,a=i.isWebGL2;this.setMode=function(e){r=e},this.render=function(t,i){e.drawArrays(r,t,i),n.update(i,r,1)},this.renderInstances=function(i,o,s){if(0!==s){var l,c;if(a)l=e,c="drawArraysInstanced";else if(c="drawArraysInstancedANGLE",null===(l=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[c](r,i,o,s),n.update(o,r,s)}}}function ii(e,t,n){var i;function r(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}var a="undefined"!==typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!==typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext,o=void 0!==n.precision?n.precision:"highp",s=r(o);s!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",s,"instead."),o=s);var l=a||t.has("WEBGL_draw_buffers"),c=!0===n.logarithmicDepthBuffer,u=e.getParameter(34930),h=e.getParameter(35660),d=e.getParameter(3379),p=e.getParameter(34076),f=e.getParameter(34921),m=e.getParameter(36347),g=e.getParameter(36348),v=e.getParameter(36349),y=h>0,_=a||t.has("OES_texture_float");return{isWebGL2:a,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==i)return i;if(!0===t.has("EXT_texture_filter_anisotropic")){var n=t.get("EXT_texture_filter_anisotropic");i=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i},getMaxPrecision:r,precision:o,logarithmicDepthBuffer:c,maxTextures:u,maxVertexTextures:h,maxTextureSize:d,maxCubemapSize:p,maxAttributes:f,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:v,vertexTextures:y,floatFragmentTextures:_,floatVertexTextures:y&&_,maxSamples:a?e.getParameter(36183):0}}function ri(e){var t=this,n=null,i=0,r=!1,a=!1,o=new Lt,s=new ve,l={value:null,needsUpdate:!1};function c(){l.value!==n&&(l.value=n,l.needsUpdate=i>0),t.numPlanes=i,t.numIntersection=0}function u(e,n,i,r){var a=null!==e?e.length:0,c=null;if(0!==a){if(c=l.value,!0!==r||null===c){var u=i+4*a,h=n.matrixWorldInverse;s.getNormalMatrix(h),(null===c||c.length<u)&&(c=new Float32Array(u));for(var d=0,p=i;d!==a;++d,p+=4)o.copy(e[d]).applyMatrix4(h,s),o.normal.toArray(c,p),c[p+3]=o.constant}l.value=c,l.needsUpdate=!0}return t.numPlanes=a,t.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t,a){var o=0!==e.length||t||0!==i||r;return r=t,n=u(e,a,0),i=e.length,o},this.beginShadows=function(){a=!0,u(null)},this.endShadows=function(){a=!1,c()},this.setState=function(t,o,s){var h=t.clippingPlanes,d=t.clipIntersection,p=t.clipShadows,f=e.get(t);if(!r||null===h||0===h.length||a&&!p)a?u(null):c();else{var m=a?0:i,g=4*m,v=f.clippingState||null;l.value=v,v=u(h,o,g,s);for(var y=0;y!==g;++y)v[y]=n[y];f.clippingState=v,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=m}}}function ai(e){var t=new WeakMap;function n(e,t){return 303===t?e.mapping=x:304===t&&(e.mapping=b),e}function i(e){var n=e.target;n.removeEventListener("dispose",i);var r=t.get(n);void 0!==r&&(t.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture){var a=r.mapping;if(303===a||304===a){if(t.has(r))return n(t.get(r).texture,r.mapping);var o=r.image;if(o&&o.height>0){var s=e.getRenderTarget(),l=new Hn(o.height/2);return l.fromEquirectangularTexture(e,r),t.set(r,l),e.setRenderTarget(s),r.addEventListener("dispose",i),n(l.texture,r.mapping)}return null}}return r},dispose:function(){t=new WeakMap}}}function oi(e){var t={};function n(n){if(void 0!==t[n])return t[n];var i;switch(n){case"WEBGL_depth_texture":i=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=e.getExtension(n)}return t[n]=i,i}return{has:function(e){return null!==n(e)},init:function(e){e.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float")},get:function(e){var t=n(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function si(e,t,n,i){var r={},a=new WeakMap;function o(e){var s=e.target;for(var l in null!==s.index&&t.remove(s.index),s.attributes)t.remove(s.attributes[l]);s.removeEventListener("dispose",o),delete r[s.id];var c=a.get(s);c&&(t.remove(c),a.delete(s)),i.releaseStatesOfGeometry(s),!0===s.isInstancedBufferGeometry&&delete s._maxInstanceCount,n.memory.geometries--}function s(e){var n=[],i=e.index,r=e.attributes.position,o=0;if(null!==i){var s=i.array;o=i.version;for(var l=0,c=s.length;l<c;l+=3){var u=s[l+0],h=s[l+1],d=s[l+2];n.push(u,h,h,d,d,u)}}else{var p=r.array;o=r.version;for(var f=0,m=p.length/3-1;f<m;f+=3){var g=f+0,v=f+1,y=f+2;n.push(g,v,v,y,y,g)}}var _=new(on(n)>65535?rn:nn)(n,1);_.version=o;var x=a.get(e);x&&t.remove(x),a.set(e,_)}return{get:function(e,t){return!0===r[t.id]||(t.addEventListener("dispose",o),r[t.id]=!0,n.memory.geometries++),t},update:function(e){var n=e.attributes;for(var i in n)t.update(n[i],34962);var r=e.morphAttributes;for(var a in r)for(var o=r[a],s=0,l=o.length;s<l;s++)t.update(o[s],34962)},getWireframeAttribute:function(e){var t=a.get(e);if(t){var n=e.index;null!==n&&t.version<n.version&&s(e)}else s(e);return a.get(e)}}}function li(e,t,n,i){var r,a,o,s=i.isWebGL2;this.setMode=function(e){r=e},this.setIndex=function(e){a=e.type,o=e.bytesPerElement},this.render=function(t,i){e.drawElements(r,i,a,t*o),n.update(i,r,1)},this.renderInstances=function(i,l,c){if(0!==c){var u,h;if(s)u=e,h="drawElementsInstanced";else if(h="drawElementsInstancedANGLE",null===(u=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[h](r,l,a,i*o,c),n.update(l,r,c)}}}function ci(e){var t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,n,i){switch(t.calls++,n){case 4:t.triangles+=i*(e/3);break;case 1:t.lines+=i*(e/2);break;case 3:t.lines+=i*(e-1);break;case 2:t.lines+=i*e;break;case 0:t.points+=i*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function ui(e,t){return e[0]-t[0]}function hi(e,t){return Math.abs(t[1])-Math.abs(e[1])}function di(e){for(var t={},n=new Float32Array(8),i=[],r=0;r<8;r++)i[r]=[r,0];return{update:function(r,a,o,s){var l=r.morphTargetInfluences,c=void 0===l?0:l.length,u=t[a.id];if(void 0===u){u=[];for(var h=0;h<c;h++)u[h]=[h,0];t[a.id]=u}for(var d=0;d<c;d++){var p=u[d];p[0]=d,p[1]=l[d]}u.sort(hi);for(var f=0;f<8;f++)f<c&&u[f][1]?(i[f][0]=u[f][0],i[f][1]=u[f][1]):(i[f][0]=Number.MAX_SAFE_INTEGER,i[f][1]=0);i.sort(ui);for(var m=o.morphTargets&&a.morphAttributes.position,g=o.morphNormals&&a.morphAttributes.normal,v=0,y=0;y<8;y++){var _=i[y],x=_[0],b=_[1];x!==Number.MAX_SAFE_INTEGER&&b?(m&&a.getAttribute("morphTarget"+y)!==m[x]&&a.setAttribute("morphTarget"+y,m[x]),g&&a.getAttribute("morphNormal"+y)!==g[x]&&a.setAttribute("morphNormal"+y,g[x]),n[y]=b,v+=b):(m&&!0===a.hasAttribute("morphTarget"+y)&&a.deleteAttribute("morphTarget"+y),g&&!0===a.hasAttribute("morphNormal"+y)&&a.deleteAttribute("morphNormal"+y),n[y]=0)}var w=a.morphTargetsRelative?1:1-v;s.getUniforms().setValue(e,"morphTargetBaseInfluence",w),s.getUniforms().setValue(e,"morphTargetInfluences",n)}}}function pi(e,t,n,i){var r=new WeakMap;function a(e){var t=e.target;t.removeEventListener("dispose",a),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(e){var o=i.render.frame,s=e.geometry,l=t.get(e,s);return r.get(l)!==o&&(t.update(l),r.set(l,o)),e.isInstancedMesh&&(!1===e.hasEventListener("dispose",a)&&e.addEventListener("dispose",a),n.update(e.instanceMatrix,34962),null!==e.instanceColor&&n.update(e.instanceColor,34962)),l},dispose:function(){r=new WeakMap}}}Qn.physical={uniforms:On([Qn.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new me(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new Jt(0)},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new me},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Jt(0)}}]),vertexShader:Jn.meshphysical_vert,fragmentShader:Jn.meshphysical_frag};var fi=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return Object(v.a)(this,n),(e=t.call(this,null)).image={data:i,width:r,height:a,depth:o},e.magFilter=k,e.minFilter=k,e.wrapR=E,e.generateMipmaps=!1,e.flipY=!1,e.unpackAlignment=1,e.needsUpdate=!0,e}return n}(xe);fi.prototype.isDataTexture2DArray=!0;var mi=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return Object(v.a)(this,n),(e=t.call(this,null)).image={data:i,width:r,height:a,depth:o},e.magFilter=k,e.minFilter=k,e.wrapR=E,e.generateMipmaps=!1,e.flipY=!1,e.unpackAlignment=1,e.needsUpdate=!0,e}return n}(xe);mi.prototype.isDataTexture3D=!0;var gi=new xe,vi=new fi,yi=new mi,_i=new Gn,xi=[],bi=[],wi=new Float32Array(16),Si=new Float32Array(9),Ti=new Float32Array(4);function Ei(e,t,n){var i=e[0];if(i<=0||i>0)return e;var r=t*n,a=xi[r];if(void 0===a&&(a=new Float32Array(r),xi[r]=a),0!==t){i.toArray(a,0);for(var o=1,s=0;o!==t;++o)s+=n,e[o].toArray(a,s)}return a}function Mi(e,t){if(e.length!==t.length)return!1;for(var n=0,i=e.length;n<i;n++)if(e[n]!==t[n])return!1;return!0}function ki(e,t){for(var n=0,i=t.length;n<i;n++)e[n]=t[n]}function Ai(e,t){var n=bi[t];void 0===n&&(n=new Int32Array(t),bi[t]=n);for(var i=0;i!==t;++i)n[i]=e.allocateTextureUnit();return n}function Ci(e,t){var n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function Pi(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Mi(n,t))return;e.uniform2fv(this.addr,t),ki(n,t)}}function Li(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(Mi(n,t))return;e.uniform3fv(this.addr,t),ki(n,t)}}function Ii(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Mi(n,t))return;e.uniform4fv(this.addr,t),ki(n,t)}}function Ri(e,t){var n=this.cache,i=t.elements;if(void 0===i){if(Mi(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),ki(n,t)}else{if(Mi(n,i))return;Ti.set(i),e.uniformMatrix2fv(this.addr,!1,Ti),ki(n,i)}}function zi(e,t){var n=this.cache,i=t.elements;if(void 0===i){if(Mi(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),ki(n,t)}else{if(Mi(n,i))return;Si.set(i),e.uniformMatrix3fv(this.addr,!1,Si),ki(n,i)}}function Di(e,t){var n=this.cache,i=t.elements;if(void 0===i){if(Mi(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),ki(n,t)}else{if(Mi(n,i))return;wi.set(i),e.uniformMatrix4fv(this.addr,!1,wi),ki(n,i)}}function Oi(e,t){var n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function Bi(e,t){var n=this.cache;Mi(n,t)||(e.uniform2iv(this.addr,t),ki(n,t))}function Fi(e,t){var n=this.cache;Mi(n,t)||(e.uniform3iv(this.addr,t),ki(n,t))}function Ni(e,t){var n=this.cache;Mi(n,t)||(e.uniform4iv(this.addr,t),ki(n,t))}function Ui(e,t){var n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function Vi(e,t){var n=this.cache;Mi(n,t)||(e.uniform2uiv(this.addr,t),ki(n,t))}function ji(e,t){var n=this.cache;Mi(n,t)||(e.uniform3uiv(this.addr,t),ki(n,t))}function Gi(e,t){var n=this.cache;Mi(n,t)||(e.uniform4uiv(this.addr,t),ki(n,t))}function Hi(e,t,n){var i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.safeSetTexture2D(t||gi,r)}function Wi(e,t,n){var i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(t||yi,r)}function qi(e,t,n){var i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.safeSetTextureCube(t||_i,r)}function Zi(e,t,n){var i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture2DArray(t||vi,r)}function $i(e,t){e.uniform1fv(this.addr,t)}function Xi(e,t){var n=Ei(t,this.size,2);e.uniform2fv(this.addr,n)}function Yi(e,t){var n=Ei(t,this.size,3);e.uniform3fv(this.addr,n)}function Ji(e,t){var n=Ei(t,this.size,4);e.uniform4fv(this.addr,n)}function Ki(e,t){var n=Ei(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function Qi(e,t){var n=Ei(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function er(e,t){var n=Ei(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function tr(e,t){e.uniform1iv(this.addr,t)}function nr(e,t){e.uniform2iv(this.addr,t)}function ir(e,t){e.uniform3iv(this.addr,t)}function rr(e,t){e.uniform4iv(this.addr,t)}function ar(e,t){e.uniform1uiv(this.addr,t)}function or(e,t){e.uniform2uiv(this.addr,t)}function sr(e,t){e.uniform3uiv(this.addr,t)}function lr(e,t){e.uniform4uiv(this.addr,t)}function cr(e,t,n){var i=t.length,r=Ai(n,i);e.uniform1iv(this.addr,r);for(var a=0;a!==i;++a)n.safeSetTexture2D(t[a]||gi,r[a])}function ur(e,t,n){var i=t.length,r=Ai(n,i);e.uniform1iv(this.addr,r);for(var a=0;a!==i;++a)n.safeSetTextureCube(t[a]||_i,r[a])}function hr(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=function(e){switch(e){case 5126:return Ci;case 35664:return Pi;case 35665:return Li;case 35666:return Ii;case 35674:return Ri;case 35675:return zi;case 35676:return Di;case 5124:case 35670:return Oi;case 35667:case 35671:return Bi;case 35668:case 35672:return Fi;case 35669:case 35673:return Ni;case 5125:return Ui;case 36294:return Vi;case 36295:return ji;case 36296:return Gi;case 35678:case 36198:case 36298:case 36306:case 35682:return Hi;case 35679:case 36299:case 36307:return Wi;case 35680:case 36300:case 36308:case 36293:return qi;case 36289:case 36303:case 36311:case 36292:return Zi}}(t.type)}function dr(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return $i;case 35664:return Xi;case 35665:return Yi;case 35666:return Ji;case 35674:return Ki;case 35675:return Qi;case 35676:return er;case 5124:case 35670:return tr;case 35667:case 35671:return nr;case 35668:case 35672:return ir;case 35669:case 35673:return rr;case 5125:return ar;case 36294:return or;case 36295:return sr;case 36296:return lr;case 35678:case 36198:case 36298:case 36306:case 35682:return cr;case 35680:case 36300:case 36308:case 36293:return ur}}(t.type)}function pr(e){this.id=e,this.seq=[],this.map={}}dr.prototype.updateCache=function(e){var t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),ki(t,e)},pr.prototype.setValue=function(e,t,n){for(var i=this.seq,r=0,a=i.length;r!==a;++r){var o=i[r];o.setValue(e,t[o.id],n)}};var fr=/(\w+)(\])?(\[|\.)?/g;function mr(e,t){e.seq.push(t),e.map[t.id]=t}function gr(e,t,n){var i=e.name,r=i.length;for(fr.lastIndex=0;;){var a=fr.exec(i),o=fr.lastIndex,s=a[1],l="]"===a[2],c=a[3];if(l&&(s|=0),void 0===c||"["===c&&o+2===r){mr(n,void 0===c?new hr(s,e,t):new dr(s,e,t));break}var u=n.map[s];void 0===u&&mr(n,u=new pr(s)),n=u}}function vr(e,t){this.seq=[],this.map={};for(var n=e.getProgramParameter(t,35718),i=0;i<n;++i){var r=e.getActiveUniform(t,i);gr(r,e.getUniformLocation(t,r.name),this)}}function yr(e,t,n){var i=e.createShader(t);return e.shaderSource(i,n),e.compileShader(i),i}vr.prototype.setValue=function(e,t,n,i){var r=this.map[t];void 0!==r&&r.setValue(e,n,i)},vr.prototype.setOptional=function(e,t,n){var i=t[n];void 0!==i&&this.setValue(e,n,i)},vr.upload=function(e,t,n,i){for(var r=0,a=t.length;r!==a;++r){var o=t[r],s=n[o.id];!1!==s.needsUpdate&&o.setValue(e,s.value,i)}},vr.seqWithValue=function(e,t){for(var n=[],i=0,r=e.length;i!==r;++i){var a=e[i];a.id in t&&n.push(a)}return n};var _r=0;function xr(e){switch(e){case Y:return["Linear","( value )"];case J:return["sRGB","( value )"];case Q:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case K:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case 3003:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}function br(e,t,n){var i=e.getShaderParameter(t,35713),r=e.getShaderInfoLog(t).trim();return i&&""===r?"":"THREE.WebGLShader: gl.getShaderInfoLog() "+n+"\n"+r+function(e){for(var t=e.split("\n"),n=0;n<t.length;n++)t[n]=n+1+": "+t[n];return t.join("\n")}(e.getShaderSource(t))}function wr(e,t){var n=xr(t);return"vec4 "+e+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function Sr(e,t){var n=xr(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function Tr(e,t){var n;switch(t){case 1:n="Linear";break;case 2:n="Reinhard";break;case 3:n="OptimizedCineon";break;case 4:n="ACESFilmic";break;case 5:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function Er(e){return""!==e}function Mr(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function kr(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var Ar=/^[ \t]*#include +<([\w\d./]+)>/gm;function Cr(e){return e.replace(Ar,Pr)}function Pr(e,t){var n=Jn[t];if(void 0===n)throw new Error("Can not resolve #include <"+t+">");return Cr(n)}var Lr=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,Ir=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Rr(e){return e.replace(Ir,Dr).replace(Lr,zr)}function zr(e,t,n,i){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),Dr(e,t,n,i)}function Dr(e,t,n,i){for(var r="",a=parseInt(t);a<parseInt(n);a++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+a+" ]").replace(/UNROLLED_LOOP_INDEX/g,a);return r}function Or(e){var t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function Br(e,t,n,i){var r,a,o=e.getContext(),s=n.defines,l=n.vertexShader,c=n.fragmentShader,u=function(e){var t="SHADOWMAP_TYPE_BASIC";return 1===e.shadowMapType?t="SHADOWMAP_TYPE_PCF":2===e.shadowMapType?t="SHADOWMAP_TYPE_PCF_SOFT":3===e.shadowMapType&&(t="SHADOWMAP_TYPE_VSM"),t}(n),h=function(e){var t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case x:case b:t="ENVMAP_TYPE_CUBE";break;case w:case S:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),d=function(e){var t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case b:case S:t="ENVMAP_MODE_REFRACTION"}return t}(n),p=function(e){var t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case 0:t="ENVMAP_BLENDING_MULTIPLY";break;case 1:t="ENVMAP_BLENDING_MIX";break;case 2:t="ENVMAP_BLENDING_ADD"}return t}(n),f=e.gammaFactor>0?e.gammaFactor:1,m=n.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUV||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission>0)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Er).join("\n")}(n),g=function(e){var t=[];for(var n in e){var i=e[n];!1!==i&&t.push("#define "+n+" "+i)}return t.join("\n")}(s),v=o.createProgram(),y=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?((r=[g].filter(Er).join("\n")).length>0&&(r+="\n"),(a=[m,g].filter(Er).join("\n")).length>0&&(a+="\n")):(r=[Or(n),"#define SHADER_NAME "+n.shaderName,g,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+f,"#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+d:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+u:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Er).join("\n"),a=[m,Or(n),"#define SHADER_NAME "+n.shaderName,g,n.alphaTest?"#define ALPHATEST "+n.alphaTest+(n.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+f,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+h:"",n.envMap?"#define "+d:"",n.envMap?"#define "+p:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.sheen?"#define USE_SHEEN":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+u:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(n.extensionShaderTextureLOD||n.envMap)&&n.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==n.toneMapping?"#define TONE_MAPPING":"",0!==n.toneMapping?Jn.tonemapping_pars_fragment:"",0!==n.toneMapping?Tr("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",Jn.encodings_pars_fragment,n.map?wr("mapTexelToLinear",n.mapEncoding):"",n.matcap?wr("matcapTexelToLinear",n.matcapEncoding):"",n.envMap?wr("envMapTexelToLinear",n.envMapEncoding):"",n.emissiveMap?wr("emissiveMapTexelToLinear",n.emissiveMapEncoding):"",n.lightMap?wr("lightMapTexelToLinear",n.lightMapEncoding):"",Sr("linearToOutputTexel",n.outputEncoding),n.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(Er).join("\n")),l=kr(l=Mr(l=Cr(l),n),n),c=kr(c=Mr(c=Cr(c),n),n),l=Rr(l),c=Rr(c),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(y="#version 300 es\n",r=["#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+r,a=["#define varying in",n.glslVersion===ie?"":"out highp vec4 pc_fragColor;",n.glslVersion===ie?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+a);var _,T,E=y+a+c,M=yr(o,35633,y+r+l),k=yr(o,35632,E);if(o.attachShader(v,M),o.attachShader(v,k),void 0!==n.index0AttributeName?o.bindAttribLocation(v,0,n.index0AttributeName):!0===n.morphTargets&&o.bindAttribLocation(v,0,"position"),o.linkProgram(v),e.debug.checkShaderErrors){var A=o.getProgramInfoLog(v).trim(),C=o.getShaderInfoLog(M).trim(),P=o.getShaderInfoLog(k).trim(),L=!0,I=!0;if(!1===o.getProgramParameter(v,35714)){L=!1;var R=br(o,M,"vertex"),z=br(o,k,"fragment");console.error("THREE.WebGLProgram: shader error: ",o.getError(),"35715",o.getProgramParameter(v,35715),"gl.getProgramInfoLog",A,R,z)}else""!==A?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",A):""!==C&&""!==P||(I=!1);I&&(this.diagnostics={runnable:L,programLog:A,vertexShader:{log:C,prefix:r},fragmentShader:{log:P,prefix:a}})}return o.deleteShader(M),o.deleteShader(k),this.getUniforms=function(){return void 0===_&&(_=new vr(o,v)),_},this.getAttributes=function(){return void 0===T&&(T=function(e,t){for(var n={},i=e.getProgramParameter(t,35721),r=0;r<i;r++){var a=e.getActiveAttrib(t,r).name;n[a]=e.getAttribLocation(t,a)}return n}(o,v)),T},this.destroy=function(){i.releaseStatesOfProgram(this),o.deleteProgram(v),this.program=void 0},this.name=n.shaderName,this.id=_r++,this.cacheKey=t,this.usedTimes=1,this.program=v,this.vertexShader=M,this.fragmentShader=k,this}function Fr(e,t,n,i,r,a){var o=[],s=i.isWebGL2,l=i.logarithmicDepthBuffer,c=i.floatVertexTextures,u=i.maxVertexUniforms,h=i.vertexTextures,d=i.precision,p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},f=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexAlphas","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen","transmission","transmissionMap","thicknessMap"];function m(e){var t;return e&&e.isTexture?t=e.encoding:e&&e.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),t=e.texture.encoding):t=Y,t}return{getParameters:function(r,o,f,g,v){var y,_,x=g.fog,b=r.isMeshStandardMaterial?g.environment:null,T=t.get(r.envMap||b),E=p[r.type],M=v.isSkinnedMesh?function(e){var t=e.skeleton.bones;if(c)return 1024;var n=u,i=Math.floor((n-20)/4),r=Math.min(i,t.length);return r<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+r+"."),0):r}(v):0;if(null!==r.precision&&(d=i.getMaxPrecision(r.precision))!==r.precision&&console.warn("THREE.WebGLProgram.getParameters:",r.precision,"not supported, using",d,"instead."),E){var k=Qn[E];y=k.vertexShader,_=k.fragmentShader}else y=r.vertexShader,_=r.fragmentShader;var A=e.getRenderTarget();return{isWebGL2:s,shaderID:E,shaderName:r.type,vertexShader:y,fragmentShader:_,defines:r.defines,isRawShaderMaterial:!0===r.isRawShaderMaterial,glslVersion:r.glslVersion,precision:d,instancing:!0===v.isInstancedMesh,instancingColor:!0===v.isInstancedMesh&&null!==v.instanceColor,supportsVertexTextures:h,outputEncoding:null!==A?m(A.texture):e.outputEncoding,map:!!r.map,mapEncoding:m(r.map),matcap:!!r.matcap,matcapEncoding:m(r.matcap),envMap:!!T,envMapMode:T&&T.mapping,envMapEncoding:m(T),envMapCubeUV:!!T&&(T.mapping===w||T.mapping===S),lightMap:!!r.lightMap,lightMapEncoding:m(r.lightMap),aoMap:!!r.aoMap,emissiveMap:!!r.emissiveMap,emissiveMapEncoding:m(r.emissiveMap),bumpMap:!!r.bumpMap,normalMap:!!r.normalMap,objectSpaceNormalMap:1===r.normalMapType,tangentSpaceNormalMap:0===r.normalMapType,clearcoatMap:!!r.clearcoatMap,clearcoatRoughnessMap:!!r.clearcoatRoughnessMap,clearcoatNormalMap:!!r.clearcoatNormalMap,displacementMap:!!r.displacementMap,roughnessMap:!!r.roughnessMap,metalnessMap:!!r.metalnessMap,specularMap:!!r.specularMap,alphaMap:!!r.alphaMap,gradientMap:!!r.gradientMap,sheen:!!r.sheen,transmission:!!r.transmission,transmissionMap:!!r.transmissionMap,thicknessMap:!!r.thicknessMap,combine:r.combine,vertexTangents:r.normalMap&&r.vertexTangents,vertexColors:r.vertexColors,vertexAlphas:!0===r.vertexColors&&v.geometry&&v.geometry.attributes.color&&4===v.geometry.attributes.color.itemSize,vertexUvs:!!r.map||!!r.bumpMap||!!r.normalMap||!!r.specularMap||!!r.alphaMap||!!r.emissiveMap||!!r.roughnessMap||!!r.metalnessMap||!!r.clearcoatMap||!!r.clearcoatRoughnessMap||!!r.clearcoatNormalMap||!!r.displacementMap||!!r.transmission||!!r.transmissionMap||!!r.thicknessMap,uvsVertexOnly:!(r.map||r.bumpMap||r.normalMap||r.specularMap||r.alphaMap||r.emissiveMap||r.roughnessMap||r.metalnessMap||r.clearcoatNormalMap||r.transmission||r.transmissionMap||r.thicknessMap)&&!!r.displacementMap,fog:!!x,useFog:r.fog,fogExp2:x&&x.isFogExp2,flatShading:!!r.flatShading,sizeAttenuation:r.sizeAttenuation,logarithmicDepthBuffer:l,skinning:!0===v.isSkinnedMesh&&M>0,maxBones:M,useVertexTexture:c,morphTargets:r.morphTargets,morphNormals:r.morphNormals,numDirLights:o.directional.length,numPointLights:o.point.length,numSpotLights:o.spot.length,numRectAreaLights:o.rectArea.length,numHemiLights:o.hemi.length,numDirLightShadows:o.directionalShadowMap.length,numPointLightShadows:o.pointShadowMap.length,numSpotLightShadows:o.spotShadowMap.length,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:r.dithering,shadowMapEnabled:e.shadowMap.enabled&&f.length>0,shadowMapType:e.shadowMap.type,toneMapping:r.toneMapped?e.toneMapping:0,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:r.premultipliedAlpha,alphaTest:r.alphaTest,doubleSided:2===r.side,flipSided:1===r.side,depthPacking:void 0!==r.depthPacking&&r.depthPacking,index0AttributeName:r.index0AttributeName,extensionDerivatives:r.extensions&&r.extensions.derivatives,extensionFragDepth:r.extensions&&r.extensions.fragDepth,extensionDrawBuffers:r.extensions&&r.extensions.drawBuffers,extensionShaderTextureLOD:r.extensions&&r.extensions.shaderTextureLOD,rendererExtensionFragDepth:s||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:s||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:s||n.has("EXT_shader_texture_lod"),customProgramCacheKey:r.customProgramCacheKey()}},getProgramCacheKey:function(t){var n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.fragmentShader),n.push(t.vertexShader)),void 0!==t.defines)for(var i in t.defines)n.push(i),n.push(t.defines[i]);if(!1===t.isRawShaderMaterial){for(var r=0;r<f.length;r++)n.push(t[f[r]]);n.push(e.outputEncoding),n.push(e.gammaFactor)}return n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){var t,n=p[e.type];if(n){var i=Qn[n];t=Bn.clone(i.uniforms)}else t=e.uniforms;return t},acquireProgram:function(t,n){for(var i,a=0,s=o.length;a<s;a++){var l=o[a];if(l.cacheKey===n){++(i=l).usedTimes;break}}return void 0===i&&(i=new Br(e,n,t,r),o.push(i)),i},releaseProgram:function(e){if(0===--e.usedTimes){var t=o.indexOf(e);o[t]=o[o.length-1],o.pop(),e.destroy()}},programs:o}}function Nr(){var e=new WeakMap;return{get:function(t){var n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,i){e.get(t)[n]=i},dispose:function(){e=new WeakMap}}}function Ur(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function Vr(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function jr(e){var t=[],n=0,i=[],r=[],a=[],o={id:-1};function s(i,r,a,s,l,c){var u=t[n],h=e.get(a);return void 0===u?(u={id:i.id,object:i,geometry:r,material:a,program:h.program||o,groupOrder:s,renderOrder:i.renderOrder,z:l,group:c},t[n]=u):(u.id=i.id,u.object=i,u.geometry=r,u.material=a,u.program=h.program||o,u.groupOrder=s,u.renderOrder=i.renderOrder,u.z=l,u.group=c),n++,u}return{opaque:i,transmissive:r,transparent:a,init:function(){n=0,i.length=0,r.length=0,a.length=0},push:function(e,t,n,o,l,c){var u=s(e,t,n,o,l,c);n.transmission>0?r.push(u):!0===n.transparent?a.push(u):i.push(u)},unshift:function(e,t,n,o,l,c){var u=s(e,t,n,o,l,c);n.transmission>0?r.unshift(u):!0===n.transparent?a.unshift(u):i.unshift(u)},finish:function(){for(var e=n,i=t.length;e<i;e++){var r=t[e];if(null===r.id)break;r.id=null,r.object=null,r.geometry=null,r.material=null,r.program=null,r.group=null}},sort:function(e,t){i.length>1&&i.sort(e||Ur),r.length>1&&r.sort(t||Vr),a.length>1&&a.sort(t||Vr)}}}function Gr(e){var t=new WeakMap;return{get:function(n,i){var r;return!1===t.has(n)?(r=new jr(e),t.set(n,[r])):i>=t.get(n).length?(r=new jr(e),t.get(n).push(r)):r=t.get(n)[i],r},dispose:function(){t=new WeakMap}}}function Hr(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var n;switch(t.type){case"DirectionalLight":n={direction:new Ee,color:new Jt};break;case"SpotLight":n={position:new Ee,direction:new Ee,color:new Jt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new Ee,color:new Jt,distance:0,decay:0};break;case"HemisphereLight":n={direction:new Ee,skyColor:new Jt,groundColor:new Jt};break;case"RectAreaLight":n={color:new Jt,position:new Ee,halfWidth:new Ee,halfHeight:new Ee}}return e[t.id]=n,n}}}var Wr=0;function qr(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function Zr(e,t){for(var n=new Hr,i=function(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new me};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new me,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},a=0;a<9;a++)r.probe.push(new Ee);var o=new Ee,s=new nt,l=new nt;return{setup:function(a){for(var o=0,s=0,l=0,c=0;c<9;c++)r.probe[c].set(0,0,0);var u=0,h=0,d=0,p=0,f=0,m=0,g=0,v=0;a.sort(qr);for(var y=0,_=a.length;y<_;y++){var x=a[y],b=x.color,w=x.intensity,S=x.distance,T=x.shadow&&x.shadow.map?x.shadow.map.texture:null;if(x.isAmbientLight)o+=b.r*w,s+=b.g*w,l+=b.b*w;else if(x.isLightProbe)for(var E=0;E<9;E++)r.probe[E].addScaledVector(x.sh.coefficients[E],w);else if(x.isDirectionalLight){var M=n.get(x);if(M.color.copy(x.color).multiplyScalar(x.intensity),x.castShadow){var k=x.shadow,A=i.get(x);A.shadowBias=k.bias,A.shadowNormalBias=k.normalBias,A.shadowRadius=k.radius,A.shadowMapSize=k.mapSize,r.directionalShadow[u]=A,r.directionalShadowMap[u]=T,r.directionalShadowMatrix[u]=x.shadow.matrix,m++}r.directional[u]=M,u++}else if(x.isSpotLight){var C=n.get(x);if(C.position.setFromMatrixPosition(x.matrixWorld),C.color.copy(b).multiplyScalar(w),C.distance=S,C.coneCos=Math.cos(x.angle),C.penumbraCos=Math.cos(x.angle*(1-x.penumbra)),C.decay=x.decay,x.castShadow){var P=x.shadow,L=i.get(x);L.shadowBias=P.bias,L.shadowNormalBias=P.normalBias,L.shadowRadius=P.radius,L.shadowMapSize=P.mapSize,r.spotShadow[d]=L,r.spotShadowMap[d]=T,r.spotShadowMatrix[d]=x.shadow.matrix,v++}r.spot[d]=C,d++}else if(x.isRectAreaLight){var I=n.get(x);I.color.copy(b).multiplyScalar(w),I.halfWidth.set(.5*x.width,0,0),I.halfHeight.set(0,.5*x.height,0),r.rectArea[p]=I,p++}else if(x.isPointLight){var R=n.get(x);if(R.color.copy(x.color).multiplyScalar(x.intensity),R.distance=x.distance,R.decay=x.decay,x.castShadow){var z=x.shadow,D=i.get(x);D.shadowBias=z.bias,D.shadowNormalBias=z.normalBias,D.shadowRadius=z.radius,D.shadowMapSize=z.mapSize,D.shadowCameraNear=z.camera.near,D.shadowCameraFar=z.camera.far,r.pointShadow[h]=D,r.pointShadowMap[h]=T,r.pointShadowMatrix[h]=x.shadow.matrix,g++}r.point[h]=R,h++}else if(x.isHemisphereLight){var O=n.get(x);O.skyColor.copy(x.color).multiplyScalar(w),O.groundColor.copy(x.groundColor).multiplyScalar(w),r.hemi[f]=O,f++}}p>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(r.rectAreaLTC1=Kn.LTC_FLOAT_1,r.rectAreaLTC2=Kn.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(r.rectAreaLTC1=Kn.LTC_HALF_1,r.rectAreaLTC2=Kn.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=o,r.ambient[1]=s,r.ambient[2]=l;var B=r.hash;B.directionalLength===u&&B.pointLength===h&&B.spotLength===d&&B.rectAreaLength===p&&B.hemiLength===f&&B.numDirectionalShadows===m&&B.numPointShadows===g&&B.numSpotShadows===v||(r.directional.length=u,r.spot.length=d,r.rectArea.length=p,r.point.length=h,r.hemi.length=f,r.directionalShadow.length=m,r.directionalShadowMap.length=m,r.pointShadow.length=g,r.pointShadowMap.length=g,r.spotShadow.length=v,r.spotShadowMap.length=v,r.directionalShadowMatrix.length=m,r.pointShadowMatrix.length=g,r.spotShadowMatrix.length=v,B.directionalLength=u,B.pointLength=h,B.spotLength=d,B.rectAreaLength=p,B.hemiLength=f,B.numDirectionalShadows=m,B.numPointShadows=g,B.numSpotShadows=v,r.version=Wr++)},setupView:function(e,t){for(var n=0,i=0,a=0,c=0,u=0,h=t.matrixWorldInverse,d=0,p=e.length;d<p;d++){var f=e[d];if(f.isDirectionalLight){var m=r.directional[n];m.direction.setFromMatrixPosition(f.matrixWorld),o.setFromMatrixPosition(f.target.matrixWorld),m.direction.sub(o),m.direction.transformDirection(h),n++}else if(f.isSpotLight){var g=r.spot[a];g.position.setFromMatrixPosition(f.matrixWorld),g.position.applyMatrix4(h),g.direction.setFromMatrixPosition(f.matrixWorld),o.setFromMatrixPosition(f.target.matrixWorld),g.direction.sub(o),g.direction.transformDirection(h),a++}else if(f.isRectAreaLight){var v=r.rectArea[c];v.position.setFromMatrixPosition(f.matrixWorld),v.position.applyMatrix4(h),l.identity(),s.copy(f.matrixWorld),s.premultiply(h),l.extractRotation(s),v.halfWidth.set(.5*f.width,0,0),v.halfHeight.set(0,.5*f.height,0),v.halfWidth.applyMatrix4(l),v.halfHeight.applyMatrix4(l),c++}else if(f.isPointLight){var y=r.point[i];y.position.setFromMatrixPosition(f.matrixWorld),y.position.applyMatrix4(h),i++}else if(f.isHemisphereLight){var _=r.hemi[u];_.direction.setFromMatrixPosition(f.matrixWorld),_.direction.transformDirection(h),_.direction.normalize(),u++}}},state:r}}function $r(e,t){var n=new Zr(e,t),i=[],r=[];return{init:function(){i.length=0,r.length=0},state:{lightsArray:i,shadowsArray:r,lights:n},setupLights:function(){n.setup(i)},setupLightsView:function(e){n.setupView(i,e)},pushLight:function(e){i.push(e)},pushShadow:function(e){r.push(e)}}}function Xr(e,t){var n=new WeakMap;return{get:function(i){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return!1===n.has(i)?(r=new $r(e,t),n.set(i,[r])):a>=n.get(i).length?(r=new $r(e,t),n.get(i).push(r)):r=n.get(i)[a],r},dispose:function(){n=new WeakMap}}}var Yr=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e){var i;return Object(v.a)(this,n),(i=t.call(this)).type="MeshDepthMaterial",i.depthPacking=3200,i.morphTargets=!1,i.map=null,i.alphaMap=null,i.displacementMap=null,i.displacementScale=1,i.displacementBias=0,i.wireframe=!1,i.wireframeLinewidth=1,i.fog=!1,i.setValues(e),i}return Object(y.a)(n,[{key:"copy",value:function(e){return h(Object(u.a)(n.prototype),"copy",this).call(this,e),this.depthPacking=e.depthPacking,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}]),n}(Ht);Yr.prototype.isMeshDepthMaterial=!0;var Jr=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e){var i;return Object(v.a)(this,n),(i=t.call(this)).type="MeshDistanceMaterial",i.referencePosition=new Ee,i.nearDistance=1,i.farDistance=1e3,i.morphTargets=!1,i.map=null,i.alphaMap=null,i.displacementMap=null,i.displacementScale=1,i.displacementBias=0,i.fog=!1,i.setValues(e),i}return Object(y.a)(n,[{key:"copy",value:function(e){return h(Object(u.a)(n.prototype),"copy",this).call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}]),n}(Ht);Jr.prototype.isMeshDistanceMaterial=!0;function Kr(e,t,n){var i=new Zn,r=new me,a=new me,o=new we,s=[],l=[],c={},u=n.maxTextureSize,h={0:1,1:0,2:2},d=new Fn({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new me},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );\n\tfor ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean * HALF_SAMPLE_RATE;\n\tsquared_mean = squared_mean * HALF_SAMPLE_RATE;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),p=d.clone();p.defines.HORIZONTAL_PASS=1;var f=new fn;f.setAttribute("position",new tn(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var m=new In(f,d),g=this;function v(n,i){var r=t.update(m);d.uniforms.shadow_pass.value=n.map.texture,d.uniforms.resolution.value=n.mapSize,d.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(i,null,r,d,m,null),p.uniforms.shadow_pass.value=n.mapPass.texture,p.uniforms.resolution.value=n.mapSize,p.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(i,null,r,p,m,null)}function y(e){var t=e<<0,n=s[t];return void 0===n&&(n=new Yr({depthPacking:3201,morphTargets:e}),s[t]=n),n}function _(e){var t=e<<0,n=l[t];return void 0===n&&(n=new Jr({morphTargets:e}),l[t]=n),n}function x(t,n,i,r,a,o,s){var l=null,u=y,d=t.customDepthMaterial;if(!0===r.isPointLight&&(u=_,d=t.customDistanceMaterial),void 0===d){var p=!1;!0===i.morphTargets&&(p=n.morphAttributes&&n.morphAttributes.position&&n.morphAttributes.position.length>0),l=u(p)}else l=d;if(e.localClippingEnabled&&!0===i.clipShadows&&0!==i.clippingPlanes.length){var f=l.uuid,m=i.uuid,g=c[f];void 0===g&&(g={},c[f]=g);var v=g[m];void 0===v&&(v=l.clone(),g[m]=v),l=v}return l.visible=i.visible,l.wireframe=i.wireframe,l.side=3===s?null!==i.shadowSide?i.shadowSide:i.side:null!==i.shadowSide?i.shadowSide:h[i.side],l.clipShadows=i.clipShadows,l.clippingPlanes=i.clippingPlanes,l.clipIntersection=i.clipIntersection,l.wireframeLinewidth=i.wireframeLinewidth,l.linewidth=i.linewidth,!0===r.isPointLight&&!0===l.isMeshDistanceMaterial&&(l.referencePosition.setFromMatrixPosition(r.matrixWorld),l.nearDistance=a,l.farDistance=o),l}function b(n,r,a,o,s){if(!1!==n.visible){if(n.layers.test(r.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&3===s)&&(!n.frustumCulled||i.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,n.matrixWorld);var l=t.update(n),c=n.material;if(Array.isArray(c))for(var u=l.groups,h=0,d=u.length;h<d;h++){var p=u[h],f=c[p.materialIndex];if(f&&f.visible){var m=x(n,l,f,o,a.near,a.far,s);e.renderBufferDirect(a,null,l,m,n,p)}}else if(c.visible){var g=x(n,l,c,o,a.near,a.far,s);e.renderBufferDirect(a,null,l,g,n,null)}}for(var v=n.children,y=0,_=v.length;y<_;y++)b(v[y],r,a,o,s)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(t,n,s){if(!1!==g.enabled&&(!1!==g.autoUpdate||!1!==g.needsUpdate)&&0!==t.length){var l=e.getRenderTarget(),c=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),d=e.state;d.setBlending(0),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);for(var p=0,f=t.length;p<f;p++){var m=t[p],y=m.shadow;if(void 0!==y){if(!1!==y.autoUpdate||!1!==y.needsUpdate){r.copy(y.mapSize);var _=y.getFrameExtents();if(r.multiply(_),a.copy(y.mapSize),(r.x>u||r.y>u)&&(r.x>u&&(a.x=Math.floor(u/_.x),r.x=a.x*_.x,y.mapSize.x=a.x),r.y>u&&(a.y=Math.floor(u/_.y),r.y=a.y*_.y,y.mapSize.y=a.y)),null===y.map&&!y.isPointLightShadow&&3===this.type){var x={minFilter:P,magFilter:P,format:N};y.map=new Se(r.x,r.y,x),y.map.texture.name=m.name+".shadowMap",y.mapPass=new Se(r.x,r.y,x),y.camera.updateProjectionMatrix()}if(null===y.map){var w={minFilter:k,magFilter:k,format:N};y.map=new Se(r.x,r.y,w),y.map.texture.name=m.name+".shadowMap",y.camera.updateProjectionMatrix()}e.setRenderTarget(y.map),e.clear();for(var S=y.getViewportCount(),T=0;T<S;T++){var E=y.getViewport(T);o.set(a.x*E.x,a.y*E.y,a.x*E.z,a.y*E.w),d.viewport(o),y.updateMatrices(m,T),i=y.getFrustum(),b(n,s,y.camera,m,this.type)}y.isPointLightShadow||3!==this.type||v(y,s),y.needsUpdate=!1}}else console.warn("THREE.WebGLShadowMap:",m,"has no shadow.")}g.needsUpdate=!1,e.setRenderTarget(l,c,h)}}}function Qr(e,t,n){var i,r,a=n.isWebGL2;var o=new function(){var t=!1,n=new we,i=null,r=new we(0,0,0,0);return{setMask:function(n){i===n||t||(e.colorMask(n,n,n,n),i=n)},setLocked:function(e){t=e},setClear:function(t,i,a,o,s){!0===s&&(t*=o,i*=o,a*=o),n.set(t,i,a,o),!1===r.equals(n)&&(e.clearColor(t,i,a,o),r.copy(n))},reset:function(){t=!1,i=null,r.set(-1,0,0,0)}}},l=new function(){var t=!1,n=null,i=null,r=null;return{setTest:function(e){e?V(2929):j(2929)},setMask:function(i){n===i||t||(e.depthMask(i),n=i)},setFunc:function(t){if(i!==t){if(t)switch(t){case 0:e.depthFunc(512);break;case 1:e.depthFunc(519);break;case 2:e.depthFunc(513);break;case 3:e.depthFunc(515);break;case 4:e.depthFunc(514);break;case 5:e.depthFunc(518);break;case 6:e.depthFunc(516);break;case 7:e.depthFunc(517);break;default:e.depthFunc(515)}else e.depthFunc(515);i=t}},setLocked:function(e){t=e},setClear:function(t){r!==t&&(e.clearDepth(t),r=t)},reset:function(){t=!1,n=null,i=null,r=null}}},c=new function(){var t=!1,n=null,i=null,r=null,a=null,o=null,s=null,l=null,c=null;return{setTest:function(e){t||(e?V(2960):j(2960))},setMask:function(i){n===i||t||(e.stencilMask(i),n=i)},setFunc:function(t,n,o){i===t&&r===n&&a===o||(e.stencilFunc(t,n,o),i=t,r=n,a=o)},setOp:function(t,n,i){o===t&&s===n&&l===i||(e.stencilOp(t,n,i),o=t,s=n,l=i)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,n=null,i=null,r=null,a=null,o=null,s=null,l=null,c=null}}},u={},h=null,d={},p=null,f=!1,m=null,g=null,v=null,y=null,x=null,b=null,w=null,S=!1,T=null,E=null,M=null,k=null,A=null,C=e.getParameter(35661),P=!1,L=0,I=e.getParameter(7938);-1!==I.indexOf("WebGL")?(L=parseFloat(/^WebGL (\d)/.exec(I)[1]),P=L>=1):-1!==I.indexOf("OpenGL ES")&&(L=parseFloat(/^OpenGL ES (\d)/.exec(I)[1]),P=L>=2);var R=null,z={},D=e.getParameter(3088),O=e.getParameter(2978),B=(new we).fromArray(D),F=(new we).fromArray(O);function N(t,n,i){var r=new Uint8Array(4),a=e.createTexture();e.bindTexture(t,a),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(var o=0;o<i;o++)e.texImage2D(n+o,0,6408,1,1,0,6408,5121,r);return a}var U={};function V(t){!0!==u[t]&&(e.enable(t),u[t]=!0)}function j(t){!1!==u[t]&&(e.disable(t),u[t]=!1)}U[3553]=N(3553,3553,1),U[34067]=N(34067,34069,6),o.setClear(0,0,0,1),l.setClear(1),c.setClear(0),V(2929),l.setFunc(3),Z(!1),$(1),V(2884),q(0);var G=(s(i={},_,32774),s(i,101,32778),s(i,102,32779),i);if(a)G[103]=32775,G[104]=32776;else{var H=t.get("EXT_blend_minmax");null!==H&&(G[103]=H.MIN_EXT,G[104]=H.MAX_EXT)}var W=(s(r={},200,0),s(r,201,1),s(r,202,768),s(r,204,770),s(r,210,776),s(r,208,774),s(r,206,772),s(r,203,769),s(r,205,771),s(r,209,775),s(r,207,773),r);function q(t,n,i,r,a,o,s,l){if(0!==t){if(!1===f&&(V(3042),f=!0),5===t)a=a||n,o=o||i,s=s||r,n===g&&a===x||(e.blendEquationSeparate(G[n],G[a]),g=n,x=a),i===v&&r===y&&o===b&&s===w||(e.blendFuncSeparate(W[i],W[r],W[o],W[s]),v=i,y=r,b=o,w=s),m=t,S=null;else if(t!==m||l!==S){if(g===_&&x===_||(e.blendEquation(32774),g=_,x=_),l)switch(t){case 1:e.blendFuncSeparate(1,771,1,771);break;case 2:e.blendFunc(1,1);break;case 3:e.blendFuncSeparate(0,0,769,771);break;case 4:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case 1:e.blendFuncSeparate(770,771,1,771);break;case 2:e.blendFunc(770,1);break;case 3:e.blendFunc(0,769);break;case 4:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}v=null,y=null,b=null,w=null,m=t,S=l}}else!0===f&&(j(3042),f=!1)}function Z(t){T!==t&&(t?e.frontFace(2304):e.frontFace(2305),T=t)}function $(t){0!==t?(V(2884),t!==E&&(1===t?e.cullFace(1029):2===t?e.cullFace(1028):e.cullFace(1032))):j(2884),E=t}function X(t,n,i){t?(V(32823),k===n&&A===i||(e.polygonOffset(n,i),k=n,A=i)):j(32823)}function Y(t){void 0===t&&(t=33984+C-1),R!==t&&(e.activeTexture(t),R=t)}return{buffers:{color:o,depth:l,stencil:c},enable:V,disable:j,bindFramebuffer:function(t,n){return null===n&&null!==h&&(n=h),d[t]!==n&&(e.bindFramebuffer(t,n),d[t]=n,a&&(36009===t&&(d[36160]=n),36160===t&&(d[36009]=n)),!0)},bindXRFramebuffer:function(t){t!==h&&(e.bindFramebuffer(36160,t),h=t)},useProgram:function(t){return p!==t&&(e.useProgram(t),p=t,!0)},setBlending:q,setMaterial:function(e,t){2===e.side?j(2884):V(2884);var n=1===e.side;t&&(n=!n),Z(n),1===e.blending&&!1===e.transparent?q(0):q(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),l.setFunc(e.depthFunc),l.setTest(e.depthTest),l.setMask(e.depthWrite),o.setMask(e.colorWrite);var i=e.stencilWrite;c.setTest(i),i&&(c.setMask(e.stencilWriteMask),c.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),c.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),X(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage?V(32926):j(32926)},setFlipSided:Z,setCullFace:$,setLineWidth:function(t){t!==M&&(P&&e.lineWidth(t),M=t)},setPolygonOffset:X,setScissorTest:function(e){e?V(3089):j(3089)},activeTexture:Y,bindTexture:function(t,n){null===R&&Y();var i=z[R];void 0===i&&(i={type:void 0,texture:void 0},z[R]=i),i.type===t&&i.texture===n||(e.bindTexture(t,n||U[t]),i.type=t,i.texture=n)},unbindTexture:function(){var t=z[R];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(t){!1===B.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),B.copy(t))},viewport:function(t){!1===F.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),F.copy(t))},reset:function(){e.disable(3042),e.disable(2884),e.disable(2929),e.disable(32823),e.disable(3089),e.disable(2960),e.disable(32926),e.blendEquation(32774),e.blendFunc(1,0),e.blendFuncSeparate(1,0,1,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(513),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(519,0,4294967295),e.stencilOp(7680,7680,7680),e.clearStencil(0),e.cullFace(1029),e.frontFace(2305),e.polygonOffset(0,0),e.activeTexture(33984),e.bindFramebuffer(36160,null),!0===a&&(e.bindFramebuffer(36009,null),e.bindFramebuffer(36008,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),u={},R=null,z={},h=null,d={},p=null,f=!1,m=null,g=null,v=null,y=null,x=null,b=null,w=null,S=!1,T=null,E=null,M=null,k=null,A=null,B.set(0,0,e.canvas.width,e.canvas.height),F.set(0,0,e.canvas.width,e.canvas.height),o.reset(),l.reset(),c.reset()}}}function ea(e,t,n,i,r,a,o){var l,c,u,h=r.isWebGL2,d=r.maxTextures,p=r.maxCubemapSize,f=r.maxTextureSize,m=r.maxSamples,g=new WeakMap,v=!1;try{v="undefined"!==typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(re){}function y(e,t){return v?new OffscreenCanvas(e,t):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function _(e,t,n,i){var r=1;if((e.width>i||e.height>i)&&(r=i/Math.max(e.width,e.height)),r<1||!0===t){if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap){var a=t?fe:Math.floor,o=a(r*e.width),s=a(r*e.height);void 0===u&&(u=y(o,s));var l=n?y(o,s):u;return l.width=o,l.height=s,l.getContext("2d").drawImage(e,0,0,o,s),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+o+"x"+s+")."),l}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function x(e){return pe(e.width)&&pe(e.height)}function b(e,t){return e.generateMipmaps&&t&&e.minFilter!==k&&e.minFilter!==P}function w(t,n,r,a){e.generateMipmap(t),i.get(n).__maxMipLevel=Math.log2(Math.max(r,a))}function S(n,i,r){if(!1===h)return i;if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}var a=i;return 6403===i&&(5126===r&&(a=33326),5131===r&&(a=33325),5121===r&&(a=33321)),6407===i&&(5126===r&&(a=34837),5131===r&&(a=34843),5121===r&&(a=32849)),6408===i&&(5126===r&&(a=34836),5131===r&&(a=34842),5121===r&&(a=32856)),33325!==a&&33326!==a&&34842!==a&&34836!==a||t.get("EXT_color_buffer_float"),a}function I(e){return e===k||e===A||e===C?9728:9729}function j(t){var n=t.target;n.removeEventListener("dispose",j),function(t){var n=i.get(t);if(void 0===n.__webglInit)return;e.deleteTexture(n.__webglTexture),i.remove(t)}(n),n.isVideoTexture&&g.delete(n),o.memory.textures--}function G(t){var n=t.target;n.removeEventListener("dispose",G),function(t){var n=t.texture,r=i.get(t),a=i.get(n);if(!t)return;void 0!==a.__webglTexture&&(e.deleteTexture(a.__webglTexture),o.memory.textures--);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLCubeRenderTarget)for(var s=0;s<6;s++)e.deleteFramebuffer(r.__webglFramebuffer[s]),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer[s]);else e.deleteFramebuffer(r.__webglFramebuffer),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer),r.__webglMultisampledFramebuffer&&e.deleteFramebuffer(r.__webglMultisampledFramebuffer),r.__webglColorRenderbuffer&&e.deleteRenderbuffer(r.__webglColorRenderbuffer),r.__webglDepthRenderbuffer&&e.deleteRenderbuffer(r.__webglDepthRenderbuffer);if(t.isWebGLMultipleRenderTargets)for(var l=0,c=n.length;l<c;l++){var u=i.get(n[l]);u.__webglTexture&&(e.deleteTexture(u.__webglTexture),o.memory.textures--),i.remove(n[l])}i.remove(n),i.remove(t)}(n)}var H=0;function W(e,t){var r=i.get(e);if(e.isVideoTexture&&function(e){var t=o.render.frame;g.get(e)!==t&&(g.set(e,t),e.update())}(e),e.version>0&&r.__version!==e.version){var a=e.image;if(void 0===a)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==a.complete)return void J(r,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(33984+t),n.bindTexture(3553,r.__webglTexture)}function q(t,r){var o=i.get(t);t.version>0&&o.__version!==t.version?function(t,i,r){if(6!==i.image.length)return;Y(t,i),n.activeTexture(33984+r),n.bindTexture(34067,t.__webglTexture),e.pixelStorei(37440,i.flipY),e.pixelStorei(37441,i.premultiplyAlpha),e.pixelStorei(3317,i.unpackAlignment),e.pixelStorei(37443,0);for(var o=i&&(i.isCompressedTexture||i.image[0].isCompressedTexture),s=i.image[0]&&i.image[0].isDataTexture,l=[],c=0;c<6;c++)l[c]=o||s?s?i.image[c].image:i.image[c]:_(i.image[c],!1,!0,p);var u,d=l[0],f=x(d)||h,m=a.convert(i.format),g=a.convert(i.type),v=S(i.internalFormat,m,g);if(X(34067,i,f),o){for(var y=0;y<6;y++){u=l[y].mipmaps;for(var T=0;T<u.length;T++){var E=u[T];i.format!==N&&i.format!==F?null!==m?n.compressedTexImage2D(34069+y,T,v,E.width,E.height,0,E.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):n.texImage2D(34069+y,T,v,E.width,E.height,0,m,g,E.data)}}t.__maxMipLevel=u.length-1}else{u=i.mipmaps;for(var M=0;M<6;M++)if(s){n.texImage2D(34069+M,0,v,l[M].width,l[M].height,0,m,g,l[M].data);for(var k=0;k<u.length;k++){var A=u[k].image[M].image;n.texImage2D(34069+M,k+1,v,A.width,A.height,0,m,g,A.data)}}else{n.texImage2D(34069+M,0,v,m,g,l[M]);for(var C=0;C<u.length;C++){var P=u[C];n.texImage2D(34069+M,C+1,v,m,g,P.image[M])}}t.__maxMipLevel=u.length}b(i,f)&&w(34067,i,d.width,d.height);t.__version=i.version,i.onUpdate&&i.onUpdate(i)}(o,t,r):(n.activeTexture(33984+r),n.bindTexture(34067,o.__webglTexture))}var Z=(s(l={},T,10497),s(l,E,33071),s(l,M,33648),l),$=(s(c={},k,9728),s(c,A,9984),s(c,C,9986),s(c,P,9729),s(c,1007,9985),s(c,L,9987),c);function X(n,a,o){if(o?(e.texParameteri(n,10242,Z[a.wrapS]),e.texParameteri(n,10243,Z[a.wrapT]),32879!==n&&35866!==n||e.texParameteri(n,32882,Z[a.wrapR]),e.texParameteri(n,10240,$[a.magFilter]),e.texParameteri(n,10241,$[a.minFilter])):(e.texParameteri(n,10242,33071),e.texParameteri(n,10243,33071),32879!==n&&35866!==n||e.texParameteri(n,32882,33071),a.wrapS===E&&a.wrapT===E||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(n,10240,I(a.magFilter)),e.texParameteri(n,10241,I(a.minFilter)),a.minFilter!==k&&a.minFilter!==P&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===t.has("EXT_texture_filter_anisotropic")){var s=t.get("EXT_texture_filter_anisotropic");if(a.type===D&&!1===t.has("OES_texture_float_linear"))return;if(!1===h&&a.type===O&&!1===t.has("OES_texture_half_float_linear"))return;(a.anisotropy>1||i.get(a).__currentAnisotropy)&&(e.texParameterf(n,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a.anisotropy,r.getMaxAnisotropy())),i.get(a).__currentAnisotropy=a.anisotropy)}}function Y(t,n){void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",j),t.__webglTexture=e.createTexture(),o.memory.textures++)}function J(t,i,r){var o=3553;i.isDataTexture2DArray&&(o=35866),i.isDataTexture3D&&(o=32879),Y(t,i),n.activeTexture(33984+r),n.bindTexture(o,t.__webglTexture),e.pixelStorei(37440,i.flipY),e.pixelStorei(37441,i.premultiplyAlpha),e.pixelStorei(3317,i.unpackAlignment),e.pixelStorei(37443,0);var s,l=function(e){return!h&&(e.wrapS!==E||e.wrapT!==E||e.minFilter!==k&&e.minFilter!==P)}(i)&&!1===x(i.image),c=_(i.image,l,!1,f),u=x(c)||h,d=a.convert(i.format),p=a.convert(i.type),m=S(i.internalFormat,d,p);X(o,i,u);var g=i.mipmaps;if(i.isDepthTexture)m=6402,h?m=i.type===D?36012:i.type===z?33190:i.type===B?35056:33189:i.type===D&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),i.format===U&&6402===m&&i.type!==R&&i.type!==z&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),i.type=R,p=a.convert(i.type)),i.format===V&&6402===m&&(m=34041,i.type!==B&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),i.type=B,p=a.convert(i.type))),n.texImage2D(3553,0,m,c.width,c.height,0,d,p,null);else if(i.isDataTexture)if(g.length>0&&u){for(var v=0,y=g.length;v<y;v++)s=g[v],n.texImage2D(3553,v,m,s.width,s.height,0,d,p,s.data);i.generateMipmaps=!1,t.__maxMipLevel=g.length-1}else n.texImage2D(3553,0,m,c.width,c.height,0,d,p,c.data),t.__maxMipLevel=0;else if(i.isCompressedTexture){for(var T=0,M=g.length;T<M;T++)s=g[T],i.format!==N&&i.format!==F?null!==d?n.compressedTexImage2D(3553,T,m,s.width,s.height,0,s.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texImage2D(3553,T,m,s.width,s.height,0,d,p,s.data);t.__maxMipLevel=g.length-1}else if(i.isDataTexture2DArray)n.texImage3D(35866,0,m,c.width,c.height,c.depth,0,d,p,c.data),t.__maxMipLevel=0;else if(i.isDataTexture3D)n.texImage3D(32879,0,m,c.width,c.height,c.depth,0,d,p,c.data),t.__maxMipLevel=0;else if(g.length>0&&u){for(var A=0,C=g.length;A<C;A++)s=g[A],n.texImage2D(3553,A,m,d,p,s);i.generateMipmaps=!1,t.__maxMipLevel=g.length-1}else n.texImage2D(3553,0,m,d,p,c),t.__maxMipLevel=0;b(i,u)&&w(o,i,c.width,c.height),t.__version=i.version,i.onUpdate&&i.onUpdate(i)}function K(t,r,o,s,l){var c=a.convert(o.format),u=a.convert(o.type),h=S(o.internalFormat,c,u);32879===l||35866===l?n.texImage3D(l,0,h,r.width,r.height,r.depth,0,c,u,null):n.texImage2D(l,0,h,r.width,r.height,0,c,u,null),n.bindFramebuffer(36160,t),e.framebufferTexture2D(36160,s,l,i.get(o).__webglTexture,0),n.bindFramebuffer(36160,null)}function Q(t,n,i){if(e.bindRenderbuffer(36161,t),n.depthBuffer&&!n.stencilBuffer){var r=33189;if(i){var o=n.depthTexture;o&&o.isDepthTexture&&(o.type===D?r=36012:o.type===z&&(r=33190));var s=te(n);e.renderbufferStorageMultisample(36161,s,r,n.width,n.height)}else e.renderbufferStorage(36161,r,n.width,n.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(n.depthBuffer&&n.stencilBuffer){if(i){var l=te(n);e.renderbufferStorageMultisample(36161,l,35056,n.width,n.height)}else e.renderbufferStorage(36161,34041,n.width,n.height);e.framebufferRenderbuffer(36160,33306,36161,t)}else{var c=!0===n.isWebGLMultipleRenderTargets?n.texture[0]:n.texture,u=a.convert(c.format),h=a.convert(c.type),d=S(c.internalFormat,u,h);if(i){var p=te(n);e.renderbufferStorageMultisample(36161,p,d,n.width,n.height)}else e.renderbufferStorage(36161,d,n.width,n.height)}e.bindRenderbuffer(36161,null)}function ee(t){var r=i.get(t),a=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture){if(a)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(36160,t),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");i.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),W(r.depthTexture,0);var a=i.get(r.depthTexture).__webglTexture;if(r.depthTexture.format===U)e.framebufferTexture2D(36160,36096,3553,a,0);else{if(r.depthTexture.format!==V)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(36160,33306,3553,a,0)}}(r.__webglFramebuffer,t)}else if(a){r.__webglDepthbuffer=[];for(var o=0;o<6;o++)n.bindFramebuffer(36160,r.__webglFramebuffer[o]),r.__webglDepthbuffer[o]=e.createRenderbuffer(),Q(r.__webglDepthbuffer[o],t,!1)}else n.bindFramebuffer(36160,r.__webglFramebuffer),r.__webglDepthbuffer=e.createRenderbuffer(),Q(r.__webglDepthbuffer,t,!1);n.bindFramebuffer(36160,null)}function te(e){return h&&e.isWebGLMultisampleRenderTarget?Math.min(m,e.samples):0}var ne=!1,ie=!1;this.allocateTextureUnit=function(){var e=H;return e>=d&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+d),H+=1,e},this.resetTextureUnits=function(){H=0},this.setTexture2D=W,this.setTexture2DArray=function(e,t){var r=i.get(e);e.version>0&&r.__version!==e.version?J(r,e,t):(n.activeTexture(33984+t),n.bindTexture(35866,r.__webglTexture))},this.setTexture3D=function(e,t){var r=i.get(e);e.version>0&&r.__version!==e.version?J(r,e,t):(n.activeTexture(33984+t),n.bindTexture(32879,r.__webglTexture))},this.setTextureCube=q,this.setupRenderTarget=function(t){var s=t.texture,l=i.get(t),c=i.get(s);t.addEventListener("dispose",G),!0!==t.isWebGLMultipleRenderTargets&&(c.__webglTexture=e.createTexture(),c.__version=s.version,o.memory.textures++);var u=!0===t.isWebGLCubeRenderTarget,d=!0===t.isWebGLMultipleRenderTargets,p=!0===t.isWebGLMultisampleRenderTarget,f=s.isDataTexture3D||s.isDataTexture2DArray,m=x(t)||h;if(!h||s.format!==F||s.type!==D&&s.type!==O||(s.format=N,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),u){l.__webglFramebuffer=[];for(var g=0;g<6;g++)l.__webglFramebuffer[g]=e.createFramebuffer()}else if(l.__webglFramebuffer=e.createFramebuffer(),d)if(r.drawBuffers)for(var v=t.texture,y=0,_=v.length;y<_;y++){var T=i.get(v[y]);void 0===T.__webglTexture&&(T.__webglTexture=e.createTexture(),o.memory.textures++)}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(p)if(h){l.__webglMultisampledFramebuffer=e.createFramebuffer(),l.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,l.__webglColorRenderbuffer);var E=a.convert(s.format),M=a.convert(s.type),k=S(s.internalFormat,E,M),A=te(t);e.renderbufferStorageMultisample(36161,A,k,t.width,t.height),n.bindFramebuffer(36160,l.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064,36161,l.__webglColorRenderbuffer),e.bindRenderbuffer(36161,null),t.depthBuffer&&(l.__webglDepthRenderbuffer=e.createRenderbuffer(),Q(l.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(u){n.bindTexture(34067,c.__webglTexture),X(34067,s,m);for(var C=0;C<6;C++)K(l.__webglFramebuffer[C],t,s,36064,34069+C);b(s,m)&&w(34067,s,t.width,t.height),n.bindTexture(34067,null)}else if(d){for(var P=t.texture,L=0,I=P.length;L<I;L++){var R=P[L],z=i.get(R);n.bindTexture(3553,z.__webglTexture),X(3553,R,m),K(l.__webglFramebuffer,t,R,36064+L,3553),b(R,m)&&w(3553,R,t.width,t.height)}n.bindTexture(3553,null)}else{var B=3553;if(f)if(h)B=s.isDataTexture3D?32879:35866;else console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.");n.bindTexture(B,c.__webglTexture),X(B,s,m),K(l.__webglFramebuffer,t,s,36064,B),b(s,m)&&w(3553,s,t.width,t.height),n.bindTexture(3553,null)}t.depthBuffer&&ee(t)},this.updateRenderTargetMipmap=function(e){for(var t=x(e)||h,r=!0===e.isWebGLMultipleRenderTargets?e.texture:[e.texture],a=0,o=r.length;a<o;a++){var s=r[a];if(b(s,t)){var l=e.isWebGLCubeRenderTarget?34067:3553,c=i.get(s).__webglTexture;n.bindTexture(l,c),w(l,s,e.width,e.height),n.bindTexture(l,null)}}},this.updateMultisampleRenderTarget=function(t){if(t.isWebGLMultisampleRenderTarget)if(h){var r=t.width,a=t.height,o=16384;t.depthBuffer&&(o|=256),t.stencilBuffer&&(o|=1024);var s=i.get(t);n.bindFramebuffer(36008,s.__webglMultisampledFramebuffer),n.bindFramebuffer(36009,s.__webglFramebuffer),e.blitFramebuffer(0,0,r,a,0,0,r,a,o,9728),n.bindFramebuffer(36008,null),n.bindFramebuffer(36009,s.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(e,t){e&&e.isWebGLRenderTarget&&(!1===ne&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),ne=!0),e=e.texture),W(e,t)},this.safeSetTextureCube=function(e,t){e&&e.isWebGLCubeRenderTarget&&(!1===ie&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),ie=!0),e=e.texture),q(e,t)}}function ta(e,t,n){var i=n.isWebGL2;return{convert:function(e){var n;if(e===I)return 5121;if(1017===e)return 32819;if(1018===e)return 32820;if(1019===e)return 33635;if(1010===e)return 5120;if(1011===e)return 5122;if(e===R)return 5123;if(1013===e)return 5124;if(e===z)return 5125;if(e===D)return 5126;if(e===O)return i?5131:null!==(n=t.get("OES_texture_half_float"))?n.HALF_FLOAT_OES:null;if(1021===e)return 6406;if(e===F)return 6407;if(e===N)return 6408;if(1024===e)return 6409;if(1025===e)return 6410;if(e===U)return 6402;if(e===V)return 34041;if(1028===e)return 6403;if(1029===e)return 36244;if(1030===e)return 33319;if(1031===e)return 33320;if(1032===e)return 36248;if(1033===e)return 36249;if(33776===e||33777===e||33778===e||33779===e){if(null===(n=t.get("WEBGL_compressed_texture_s3tc")))return null;if(33776===e)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===e)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===e)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===e)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===e||35841===e||35842===e||35843===e){if(null===(n=t.get("WEBGL_compressed_texture_pvrtc")))return null;if(35840===e)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===e)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===e)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===e)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===e)return null!==(n=t.get("WEBGL_compressed_texture_etc1"))?n.COMPRESSED_RGB_ETC1_WEBGL:null;if((37492===e||37496===e)&&null!==(n=t.get("WEBGL_compressed_texture_etc"))){if(37492===e)return n.COMPRESSED_RGB8_ETC2;if(37496===e)return n.COMPRESSED_RGBA8_ETC2_EAC}return 37808===e||37809===e||37810===e||37811===e||37812===e||37813===e||37814===e||37815===e||37816===e||37817===e||37818===e||37819===e||37820===e||37821===e||37840===e||37841===e||37842===e||37843===e||37844===e||37845===e||37846===e||37847===e||37848===e||37849===e||37850===e||37851===e||37852===e||37853===e?null!==(n=t.get("WEBGL_compressed_texture_astc"))?e:null:36492===e?null!==(n=t.get("EXT_texture_compression_bptc"))?e:null:e===B?i?34042:null!==(n=t.get("WEBGL_depth_texture"))?n.UNSIGNED_INT_24_8_WEBGL:null:void 0}}}var na=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return Object(v.a)(this,n),(e=t.call(this)).cameras=i,e}return n}(Un);na.prototype.isArrayCamera=!0;var ia=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(){var e;return Object(v.a)(this,n),(e=t.call(this)).type="Group",e}return n}(kt);ia.prototype.isGroup=!0;var ra={type:"move"},aa=function(){function e(){Object(v.a)(this,e),this._targetRay=null,this._grip=null,this._hand=null}return Object(y.a)(e,[{key:"getHandSpace",value:function(){return null===this._hand&&(this._hand=new ia,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}},{key:"getTargetRaySpace",value:function(){return null===this._targetRay&&(this._targetRay=new ia,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Ee,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Ee),this._targetRay}},{key:"getGripSpace",value:function(){return null===this._grip&&(this._grip=new ia,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Ee,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Ee),this._grip}},{key:"dispatchEvent",value:function(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}},{key:"disconnect",value:function(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}},{key:"update",value:function(e,t,n){var i=null,r=null,a=null,s=this._targetRay,l=this._grip,c=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState)if(null!==s&&null!==(i=t.getPose(e.targetRaySpace,n))&&(s.matrix.fromArray(i.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),i.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(i.linearVelocity)):s.hasLinearVelocity=!1,i.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(i.angularVelocity)):s.hasAngularVelocity=!1,this.dispatchEvent(ra)),c&&e.hand){a=!0;var u,h=Object(o.a)(e.hand.values());try{for(h.s();!(u=h.n()).done;){var d=u.value,p=t.getJointPose(d,n);if(void 0===c.joints[d.jointName]){var f=new ia;f.matrixAutoUpdate=!1,f.visible=!1,c.joints[d.jointName]=f,c.add(f)}var m=c.joints[d.jointName];null!==p&&(m.matrix.fromArray(p.transform.matrix),m.matrix.decompose(m.position,m.rotation,m.scale),m.jointRadius=p.radius),m.visible=null!==p}}catch(_){h.e(_)}finally{h.f()}var g=c.joints["index-finger-tip"],v=c.joints["thumb-tip"],y=g.position.distanceTo(v.position);c.inputState.pinching&&y>.025?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&y<=.015&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==l&&e.gripSpace&&null!==(r=t.getPose(e.gripSpace,n))&&(l.matrix.fromArray(r.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),r.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(r.linearVelocity)):l.hasLinearVelocity=!1,r.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(r.angularVelocity)):l.hasAngularVelocity=!1);return null!==s&&(s.visible=null!==i),null!==l&&(l.visible=null!==r),null!==c&&(c.visible=null!==a),this}}]),e}(),oa=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e,i){var o;Object(v.a)(this,n),o=t.call(this);var s=Object(f.a)(o),l=e.state,c=null,u=1,h=null,d="local-floor",p=null,m=[],g=new Map,y=new Un;y.layers.enable(1),y.viewport=new we;var _=new Un;_.layers.enable(2),_.viewport=new we;var x=[y,_],b=new na;b.layers.enable(1),b.layers.enable(2);var w=null,S=null;function T(e){var t=g.get(e.inputSource);t&&t.dispatchEvent({type:e.type,data:e.inputSource})}function E(){g.forEach((function(e,t){e.disconnect(t)})),g.clear(),w=null,S=null,l.bindXRFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),L.stop(),s.isPresenting=!1,s.dispatchEvent({type:"sessionend"})}function M(e){for(var t=c.inputSources,n=0;n<m.length;n++)g.set(t[n],m[n]);for(var i=0;i<e.removed.length;i++){var r=e.removed[i],a=g.get(r);a&&(a.dispatchEvent({type:"disconnected",data:r}),g.delete(r))}for(var o=0;o<e.added.length;o++){var s=e.added[o],l=g.get(s);l&&l.dispatchEvent({type:"connected",data:s})}}o.cameraAutoUpdate=!0,o.enabled=!1,o.isPresenting=!1,o.getController=function(e){var t=m[e];return void 0===t&&(t=new aa,m[e]=t),t.getTargetRaySpace()},o.getControllerGrip=function(e){var t=m[e];return void 0===t&&(t=new aa,m[e]=t),t.getGripSpace()},o.getHand=function(e){var t=m[e];return void 0===t&&(t=new aa,m[e]=t),t.getHandSpace()},o.setFramebufferScaleFactor=function(e){u=e,!0===s.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},o.setReferenceSpaceType=function(e){d=e,!0===s.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},o.getReferenceSpace=function(){return h},o.getSession=function(){return c},o.setSession=function(){var e=Object(a.a)(r.a.mark((function e(t){var n,a,o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(c=t)){e.next=24;break}if(c.addEventListener("select",T),c.addEventListener("selectstart",T),c.addEventListener("selectend",T),c.addEventListener("squeeze",T),c.addEventListener("squeezestart",T),c.addEventListener("squeezeend",T),c.addEventListener("end",E),c.addEventListener("inputsourceschange",M),!0===(n=i.getContextAttributes()).xrCompatible){e.next=14;break}return e.next=14,i.makeXRCompatible();case 14:return a={antialias:n.antialias,alpha:n.alpha,depth:n.depth,stencil:n.stencil,framebufferScaleFactor:u},o=new XRWebGLLayer(c,i,a),c.updateRenderState({baseLayer:o}),e.next=19,c.requestReferenceSpace(d);case 19:h=e.sent,L.setContext(c),L.start(),s.isPresenting=!0,s.dispatchEvent({type:"sessionstart"});case 24:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();var k=new Ee,A=new Ee;function C(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}o.updateCamera=function(e){if(null!==c){b.near=_.near=y.near=e.near,b.far=_.far=y.far=e.far,w===b.near&&S===b.far||(c.updateRenderState({depthNear:b.near,depthFar:b.far}),w=b.near,S=b.far);var t=e.parent,n=b.cameras;C(b,t);for(var i=0;i<n.length;i++)C(n[i],t);e.matrixWorld.copy(b.matrixWorld),e.matrix.copy(b.matrix),e.matrix.decompose(e.position,e.quaternion,e.scale);for(var r=e.children,a=0,o=r.length;a<o;a++)r[a].updateMatrixWorld(!0);2===n.length?function(e,t,n){k.setFromMatrixPosition(t.matrixWorld),A.setFromMatrixPosition(n.matrixWorld);var i=k.distanceTo(A),r=t.projectionMatrix.elements,a=n.projectionMatrix.elements,o=r[14]/(r[10]-1),s=r[14]/(r[10]+1),l=(r[9]+1)/r[5],c=(r[9]-1)/r[5],u=(r[8]-1)/r[0],h=(a[8]+1)/a[0],d=o*u,p=o*h,f=i/(-u+h),m=f*-u;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(f),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();var g=o+f,v=s+f,y=d-m,_=p+(i-m),x=l*s/v*g,b=c*s/v*g;e.projectionMatrix.makePerspective(y,_,x,b,g,v)}(b,y,_):b.projectionMatrix.copy(y.projectionMatrix)}},o.getCamera=function(){return b};var P=null;var L=new $n;return L.setAnimationLoop((function(e,t){if(null!==(p=t.getViewerPose(h))){var n=p.views,i=c.renderState.baseLayer;l.bindXRFramebuffer(i.framebuffer);var r=!1;n.length!==b.cameras.length&&(b.cameras.length=0,r=!0);for(var a=0;a<n.length;a++){var o=n[a],s=i.getViewport(o),u=x[a];u.matrix.fromArray(o.transform.matrix),u.projectionMatrix.fromArray(o.projectionMatrix),u.viewport.set(s.x,s.y,s.width,s.height),0===a&&b.matrix.copy(u.matrix),!0===r&&b.cameras.push(u)}}for(var d=c.inputSources,f=0;f<m.length;f++){var g=m[f],v=d[f];g.update(v,t,h)}P&&P(e,t)})),o.setAnimationLoop=function(e){P=e},o.dispose=function(){},o}return n}(re);function sa(e){function t(t,n){t.opacity.value=n.opacity,n.color&&t.diffuse.value.copy(n.color),n.emissive&&t.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),n.map&&(t.map.value=n.map),n.alphaMap&&(t.alphaMap.value=n.alphaMap),n.specularMap&&(t.specularMap.value=n.specularMap);var i,r,a=e.get(n).envMap;if(a){t.envMap.value=a,t.flipEnvMap.value=a.isCubeTexture&&a._needsFlipEnvMap?-1:1,t.reflectivity.value=n.reflectivity,t.refractionRatio.value=n.refractionRatio;var o=e.get(a).__maxMipLevel;void 0!==o&&(t.maxMipLevel.value=o)}n.lightMap&&(t.lightMap.value=n.lightMap,t.lightMapIntensity.value=n.lightMapIntensity),n.aoMap&&(t.aoMap.value=n.aoMap,t.aoMapIntensity.value=n.aoMapIntensity),n.map?i=n.map:n.specularMap?i=n.specularMap:n.displacementMap?i=n.displacementMap:n.normalMap?i=n.normalMap:n.bumpMap?i=n.bumpMap:n.roughnessMap?i=n.roughnessMap:n.metalnessMap?i=n.metalnessMap:n.alphaMap?i=n.alphaMap:n.emissiveMap?i=n.emissiveMap:n.clearcoatMap?i=n.clearcoatMap:n.clearcoatNormalMap?i=n.clearcoatNormalMap:n.clearcoatRoughnessMap&&(i=n.clearcoatRoughnessMap),void 0!==i&&(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate&&i.updateMatrix(),t.uvTransform.value.copy(i.matrix)),n.aoMap?r=n.aoMap:n.lightMap&&(r=n.lightMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),t.uv2Transform.value.copy(r.matrix))}function n(t,n){t.roughness.value=n.roughness,t.metalness.value=n.metalness,n.roughnessMap&&(t.roughnessMap.value=n.roughnessMap),n.metalnessMap&&(t.metalnessMap.value=n.metalnessMap),n.emissiveMap&&(t.emissiveMap.value=n.emissiveMap),n.bumpMap&&(t.bumpMap.value=n.bumpMap,t.bumpScale.value=n.bumpScale,1===n.side&&(t.bumpScale.value*=-1)),n.normalMap&&(t.normalMap.value=n.normalMap,t.normalScale.value.copy(n.normalScale),1===n.side&&t.normalScale.value.negate()),n.displacementMap&&(t.displacementMap.value=n.displacementMap,t.displacementScale.value=n.displacementScale,t.displacementBias.value=n.displacementBias),e.get(n).envMap&&(t.envMapIntensity.value=n.envMapIntensity)}return{refreshFogUniforms:function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)},refreshMaterialUniforms:function(e,i,r,a,o){i.isMeshBasicMaterial?t(e,i):i.isMeshLambertMaterial?(t(e,i),function(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}(e,i)):i.isMeshToonMaterial?(t(e,i),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap);t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,i)):i.isMeshPhongMaterial?(t(e,i),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,i)):i.isMeshStandardMaterial?(t(e,i),i.isMeshPhysicalMaterial?function(e,t,i){n(e,t),e.reflectivity.value=t.reflectivity,e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.sheen&&e.sheen.value.copy(t.sheen);t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap);t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap);t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,1===t.side&&e.clearcoatNormalScale.value.negate());e.transmission.value=t.transmission,t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap);t.transmission>0&&(e.transmissionSamplerMap.value=i.texture,e.transmissionSamplerSize.value.set(i.width,i.height));e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap);e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor)}(e,i,o):n(e,i)):i.isMeshMatcapMaterial?(t(e,i),function(e,t){t.matcap&&(e.matcap.value=t.matcap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,i)):i.isMeshDepthMaterial?(t(e,i),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,i)):i.isMeshDistanceMaterial?(t(e,i),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias);e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(e,i)):i.isMeshNormalMaterial?(t(e,i),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,i)):i.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(e,i),i.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,i)):i.isPointsMaterial?function(e,t,n,i){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*n,e.scale.value=.5*i,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);var r;t.map?r=t.map:t.alphaMap&&(r=t.alphaMap);void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix))}(e,i,r,a):i.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);var n;t.map?n=t.map:t.alphaMap&&(n=t.alphaMap);void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}(e,i):i.isShadowMaterial?(e.color.value.copy(i.color),e.opacity.value=i.opacity):i.isShaderMaterial&&(i.uniformsNeedUpdate=!1)}}}function la(e){var t=void 0!==(e=e||{}).canvas?e.canvas:function(){var e=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return e.style.display="block",e}(),n=void 0!==e.context?e.context:null,i=void 0!==e.alpha&&e.alpha,r=void 0===e.depth||e.depth,a=void 0===e.stencil||e.stencil,o=void 0!==e.antialias&&e.antialias,s=void 0===e.premultipliedAlpha||e.premultipliedAlpha,l=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,c=void 0!==e.powerPreference?e.powerPreference:"default",u=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat,h=null,d=null,p=[],f=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=Y,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1;var m=this,g=!1,v=0,y=0,_=null,x=-1,b=null,w=new we,S=new we,T=null,M=t.width,A=t.height,C=1,P=null,R=null,z=new we(0,0,M,A),B=new we(0,0,M,A),F=!1,U=[],V=new Zn,j=!1,G=!1,H=null,W=new nt,q=new Ee,Z={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function $(){return null===_?C:1}var X,J,K,Q,ee,te,ne,ie,re,ae,oe,se,le,ce,ue,he,de,pe,fe,ge,ve,ye,_e=n;function xe(e,n){for(var i=0;i<e.length;i++){var r=e[i],a=t.getContext(r,n);if(null!==a)return a}return null}try{var be={alpha:i,depth:r,stencil:a,antialias:o,premultipliedAlpha:s,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:u};if(t.addEventListener("webglcontextlost",Ae,!1),t.addEventListener("webglcontextrestored",Ce,!1),null===_e){var Te=["webgl2","webgl","experimental-webgl"];if(!0===m.isWebGL1Renderer&&Te.shift(),null===(_e=xe(Te,be)))throw xe(Te)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===_e.getShaderPrecisionFormat&&(_e.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(Ve){throw console.error("THREE.WebGLRenderer: "+Ve.message),Ve}function Me(){X=new oi(_e),J=new ii(_e,X,e),X.init(J),ve=new ta(_e,X,J),K=new Qr(_e,X,J),U[0]=1029,Q=new ci(_e),ee=new Nr,te=new ea(_e,X,K,ee,J,ve,Q),ne=new ai(m),ie=new Xn(_e,J),ye=new ti(_e,X,ie,J),re=new si(_e,ie,Q,ye),ae=new pi(_e,re,ie,Q),pe=new di(_e),ue=new ri(ee),oe=new Fr(m,ne,X,J,ye,ue),se=new sa(ee),le=new Gr(ee),ce=new Xr(X,J),de=new ei(m,ne,K,ae,s),he=new Kr(m,ae,J),fe=new ni(_e,X,Q,J),ge=new li(_e,X,Q,J),Q.programs=oe.programs,m.capabilities=J,m.extensions=X,m.properties=ee,m.renderLists=le,m.shadowMap=he,m.state=K,m.info=Q}Me();var ke=new oa(m,_e);function Ae(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),g=!0}function Ce(){console.log("THREE.WebGLRenderer: Context Restored."),g=!1;var e=Q.autoReset,t=he.enabled,n=he.autoUpdate,i=he.needsUpdate,r=he.type;Me(),Q.autoReset=e,he.enabled=t,he.autoUpdate=n,he.needsUpdate=i,he.type=r}function Pe(e){var t=e.target;t.removeEventListener("dispose",Pe),function(e){(function(e){var t=ee.get(e).programs;void 0!==t&&t.forEach((function(e){oe.releaseProgram(e)}))})(e),ee.remove(e)}(t)}this.xr=ke,this.getContext=function(){return _e},this.getContextAttributes=function(){return _e.getContextAttributes()},this.forceContextLoss=function(){var e=X.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=X.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return C},this.setPixelRatio=function(e){void 0!==e&&(C=e,this.setSize(M,A,!1))},this.getSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),e=new me),e.set(M,A)},this.setSize=function(e,n,i){ke.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(M=e,A=n,t.width=Math.floor(e*C),t.height=Math.floor(n*C),!1!==i&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),e=new me),e.set(M*C,A*C).floor()},this.setDrawingBufferSize=function(e,n,i){M=e,A=n,C=i,t.width=Math.floor(e*i),t.height=Math.floor(n*i),this.setViewport(0,0,e,n)},this.getCurrentViewport=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),e=new we),e.copy(w)},this.getViewport=function(e){return e.copy(z)},this.setViewport=function(e,t,n,i){e.isVector4?z.set(e.x,e.y,e.z,e.w):z.set(e,t,n,i),K.viewport(w.copy(z).multiplyScalar(C).floor())},this.getScissor=function(e){return e.copy(B)},this.setScissor=function(e,t,n,i){e.isVector4?B.set(e.x,e.y,e.z,e.w):B.set(e,t,n,i),K.scissor(S.copy(B).multiplyScalar(C).floor())},this.getScissorTest=function(){return F},this.setScissorTest=function(e){K.setScissorTest(F=e)},this.setOpaqueSort=function(e){P=e},this.setTransparentSort=function(e){R=e},this.getClearColor=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getClearColor() now requires a Color as an argument"),e=new Jt),e.copy(de.getClearColor())},this.setClearColor=function(){de.setClearColor.apply(de,arguments)},this.getClearAlpha=function(){return de.getClearAlpha()},this.setClearAlpha=function(){de.setClearAlpha.apply(de,arguments)},this.clear=function(e,t,n){var i=0;(void 0===e||e)&&(i|=16384),(void 0===t||t)&&(i|=256),(void 0===n||n)&&(i|=1024),_e.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Ae,!1),t.removeEventListener("webglcontextrestored",Ce,!1),le.dispose(),ce.dispose(),ee.dispose(),ne.dispose(),ae.dispose(),ye.dispose(),ke.dispose(),ke.removeEventListener("sessionstart",Ie),ke.removeEventListener("sessionend",Re),H&&(H.dispose(),H=null),ze.stop()},this.renderBufferImmediate=function(e,t){ye.initAttributes();var n=ee.get(e);e.hasPositions&&!n.position&&(n.position=_e.createBuffer()),e.hasNormals&&!n.normal&&(n.normal=_e.createBuffer()),e.hasUvs&&!n.uv&&(n.uv=_e.createBuffer()),e.hasColors&&!n.color&&(n.color=_e.createBuffer());var i=t.getAttributes();e.hasPositions&&(_e.bindBuffer(34962,n.position),_e.bufferData(34962,e.positionArray,35048),ye.enableAttribute(i.position),_e.vertexAttribPointer(i.position,3,5126,!1,0,0)),e.hasNormals&&(_e.bindBuffer(34962,n.normal),_e.bufferData(34962,e.normalArray,35048),ye.enableAttribute(i.normal),_e.vertexAttribPointer(i.normal,3,5126,!1,0,0)),e.hasUvs&&(_e.bindBuffer(34962,n.uv),_e.bufferData(34962,e.uvArray,35048),ye.enableAttribute(i.uv),_e.vertexAttribPointer(i.uv,2,5126,!1,0,0)),e.hasColors&&(_e.bindBuffer(34962,n.color),_e.bufferData(34962,e.colorArray,35048),ye.enableAttribute(i.color),_e.vertexAttribPointer(i.color,3,5126,!1,0,0)),ye.disableUnusedAttributes(),_e.drawArrays(4,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,n,i,r,a){null===t&&(t=Z);var o=r.isMesh&&r.matrixWorld.determinant()<0,s=Ue(e,t,i,r);K.setMaterial(i,o);var l=n.index,c=n.attributes.position;if(null===l){if(void 0===c||0===c.count)return}else if(0===l.count)return;var u,h=1;!0===i.wireframe&&(l=re.getWireframeAttribute(n),h=2),(i.morphTargets||i.morphNormals)&&pe.update(r,n,i,s),ye.setup(r,i,s,n,l);var d=fe;null!==l&&(u=ie.get(l),(d=ge).setIndex(u));var p=null!==l?l.count:c.count,f=n.drawRange.start*h,m=n.drawRange.count*h,g=null!==a?a.start*h:0,v=null!==a?a.count*h:1/0,y=Math.max(f,g),_=Math.min(p,f+m,g+v)-1,x=Math.max(0,_-y+1);if(0!==x){if(r.isMesh)!0===i.wireframe?(K.setLineWidth(i.wireframeLinewidth*$()),d.setMode(1)):d.setMode(4);else if(r.isLine){var b=i.linewidth;void 0===b&&(b=1),K.setLineWidth(b*$()),r.isLineSegments?d.setMode(1):r.isLineLoop?d.setMode(2):d.setMode(3)}else r.isPoints?d.setMode(0):r.isSprite&&d.setMode(4);if(r.isInstancedMesh)d.renderInstances(y,x,r.count);else if(n.isInstancedBufferGeometry){var w=Math.min(n.instanceCount,n._maxInstanceCount);d.renderInstances(y,x,w)}else d.render(y,x)}},this.compile=function(e,t){(d=ce.get(e)).init(),e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(d.pushLight(e),e.castShadow&&d.pushShadow(e))})),d.setupLights(),e.traverse((function(t){var n=t.material;if(n)if(Array.isArray(n))for(var i=0;i<n.length;i++){Fe(n[i],e,t)}else Fe(n,e,t)}))};var Le=null;function Ie(){ze.stop()}function Re(){ze.start()}var ze=new $n;function De(e,t,n,i){if(!1!==e.visible){if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)d.pushLight(e),e.castShadow&&d.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||V.intersectsSprite(e)){i&&q.setFromMatrixPosition(e.matrixWorld).applyMatrix4(W);var r=ae.update(e),a=e.material;a.visible&&h.push(e,r,a,n,q.z,null)}}else if(e.isImmediateRenderObject)i&&q.setFromMatrixPosition(e.matrixWorld).applyMatrix4(W),h.push(e,null,e.material,n,q.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==Q.render.frame&&(e.skeleton.update(),e.skeleton.frame=Q.render.frame),!e.frustumCulled||V.intersectsObject(e))){i&&q.setFromMatrixPosition(e.matrixWorld).applyMatrix4(W);var o=ae.update(e),s=e.material;if(Array.isArray(s))for(var l=o.groups,c=0,u=l.length;c<u;c++){var p=l[c],f=s[p.materialIndex];f&&f.visible&&h.push(e,o,f,n,q.z,p)}else s.visible&&h.push(e,o,s,n,q.z,null)}for(var m=e.children,g=0,v=m.length;g<v;g++)De(m[g],t,n,i)}}function Oe(e,t,n){for(var i=!0===t.isScene?t.overrideMaterial:null,r=0,a=e.length;r<a;r++){var o=e[r],s=o.object,l=o.geometry,c=null===i?o.material:i,u=o.group;if(n.isArrayCamera)for(var h=n.cameras,p=0,f=h.length;p<f;p++){var m=h[p];s.layers.test(m.layers)&&(K.viewport(w.copy(m.viewport)),d.setupLightsView(m),Be(s,t,m,l,c,u))}else Be(s,t,n,l,c,u)}}function Be(e,t,n,i,r,a){if(e.onBeforeRender(m,t,n,i,r,a),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){var o=Ue(n,t,r,e);K.setMaterial(r),ye.reset(),function(e,t){e.render((function(e){m.renderBufferImmediate(e,t)}))}(e,o)}else m.renderBufferDirect(n,t,i,r,e,a);e.onAfterRender(m,t,n,i,r,a)}function Fe(e,t,n){!0!==t.isScene&&(t=Z);var i=ee.get(e),r=d.state.lights,a=d.state.shadowsArray,o=r.state.version,s=oe.getParameters(e,r.state,a,t,n),l=oe.getProgramCacheKey(s),c=i.programs;i.environment=e.isMeshStandardMaterial?t.environment:null,i.fog=t.fog,i.envMap=ne.get(e.envMap||i.environment),void 0===c&&(e.addEventListener("dispose",Pe),c=new Map,i.programs=c);var u=c.get(l);if(void 0!==u){if(i.currentProgram===u&&i.lightsStateVersion===o)return Ne(e,s),u}else s.uniforms=oe.getUniforms(e),e.onBuild(s,m),e.onBeforeCompile(s,m),u=oe.acquireProgram(s,l),c.set(l,u),i.uniforms=s.uniforms;var h=i.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(h.clippingPlanes=ue.uniform),Ne(e,s),i.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),i.lightsStateVersion=o,i.needsLights&&(h.ambientLightColor.value=r.state.ambient,h.lightProbe.value=r.state.probe,h.directionalLights.value=r.state.directional,h.directionalLightShadows.value=r.state.directionalShadow,h.spotLights.value=r.state.spot,h.spotLightShadows.value=r.state.spotShadow,h.rectAreaLights.value=r.state.rectArea,h.ltc_1.value=r.state.rectAreaLTC1,h.ltc_2.value=r.state.rectAreaLTC2,h.pointLights.value=r.state.point,h.pointLightShadows.value=r.state.pointShadow,h.hemisphereLights.value=r.state.hemi,h.directionalShadowMap.value=r.state.directionalShadowMap,h.directionalShadowMatrix.value=r.state.directionalShadowMatrix,h.spotShadowMap.value=r.state.spotShadowMap,h.spotShadowMatrix.value=r.state.spotShadowMatrix,h.pointShadowMap.value=r.state.pointShadowMap,h.pointShadowMatrix.value=r.state.pointShadowMatrix);var p=u.getUniforms(),f=vr.seqWithValue(p.seq,h);return i.currentProgram=u,i.uniformsList=f,u}function Ne(e,t){var n=ee.get(e);n.outputEncoding=t.outputEncoding,n.instancing=t.instancing,n.skinning=t.skinning,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas}function Ue(e,t,n,i){!0!==t.isScene&&(t=Z),te.resetTextureUnits();var r=t.fog,a=n.isMeshStandardMaterial?t.environment:null,o=null===_?m.outputEncoding:_.texture.encoding,s=ne.get(n.envMap||a),l=!0===n.vertexColors&&i.geometry&&i.geometry.attributes.color&&4===i.geometry.attributes.color.itemSize,c=ee.get(n),u=d.state.lights;if(!0===j&&(!0===G||e!==b)){var h=e===b&&n.id===x;ue.setState(n,e,h)}var p=!1;n.version===c.__version?c.needsLights&&c.lightsStateVersion!==u.state.version||c.outputEncoding!==o||i.isInstancedMesh&&!1===c.instancing?p=!0:i.isInstancedMesh||!0!==c.instancing?i.isSkinnedMesh&&!1===c.skinning?p=!0:i.isSkinnedMesh||!0!==c.skinning?c.envMap!==s||n.fog&&c.fog!==r?p=!0:void 0===c.numClippingPlanes||c.numClippingPlanes===ue.numPlanes&&c.numIntersection===ue.numIntersection?c.vertexAlphas!==l&&(p=!0):p=!0:p=!0:p=!0:(p=!0,c.__version=n.version);var f=c.currentProgram;!0===p&&(f=Fe(n,t,i));var g,v,y=!1,w=!1,S=!1,T=f.getUniforms(),E=c.uniforms;if(K.useProgram(f.program)&&(y=!0,w=!0,S=!0),n.id!==x&&(x=n.id,w=!0),y||b!==e){if(T.setValue(_e,"projectionMatrix",e.projectionMatrix),J.logarithmicDepthBuffer&&T.setValue(_e,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),b!==e&&(b=e,w=!0,S=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap){var M=T.map.cameraPosition;void 0!==M&&M.setValue(_e,q.setFromMatrixPosition(e.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&T.setValue(_e,"isOrthographic",!0===e.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.isShadowMaterial||i.isSkinnedMesh)&&T.setValue(_e,"viewMatrix",e.matrixWorldInverse)}if(i.isSkinnedMesh){T.setOptional(_e,i,"bindMatrix"),T.setOptional(_e,i,"bindMatrixInverse");var k=i.skeleton;k&&(J.floatVertexTextures?(null===k.boneTexture&&k.computeBoneTexture(),T.setValue(_e,"boneTexture",k.boneTexture,te),T.setValue(_e,"boneTextureSize",k.boneTextureSize)):T.setOptional(_e,k,"boneMatrices"))}return(w||c.receiveShadow!==i.receiveShadow)&&(c.receiveShadow=i.receiveShadow,T.setValue(_e,"receiveShadow",i.receiveShadow)),w&&(T.setValue(_e,"toneMappingExposure",m.toneMappingExposure),c.needsLights&&(v=S,(g=E).ambientLightColor.needsUpdate=v,g.lightProbe.needsUpdate=v,g.directionalLights.needsUpdate=v,g.directionalLightShadows.needsUpdate=v,g.pointLights.needsUpdate=v,g.pointLightShadows.needsUpdate=v,g.spotLights.needsUpdate=v,g.spotLightShadows.needsUpdate=v,g.rectAreaLights.needsUpdate=v,g.hemisphereLights.needsUpdate=v),r&&n.fog&&se.refreshFogUniforms(E,r),se.refreshMaterialUniforms(E,n,C,A,H),vr.upload(_e,c.uniformsList,E,te)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(vr.upload(_e,c.uniformsList,E,te),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&T.setValue(_e,"center",i.center),T.setValue(_e,"modelViewMatrix",i.modelViewMatrix),T.setValue(_e,"normalMatrix",i.normalMatrix),T.setValue(_e,"modelMatrix",i.matrixWorld),f}ze.setAnimationLoop((function(e){Le&&Le(e)})),"undefined"!==typeof window&&ze.setContext(window),this.setAnimationLoop=function(e){Le=e,ke.setAnimationLoop(e),null===e?ze.stop():ze.start()},ke.addEventListener("sessionstart",Ie),ke.addEventListener("sessionend",Re),this.render=function(e,t){if(void 0===t||!0===t.isCamera){if(!0!==g){!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),!0===ke.enabled&&!0===ke.isPresenting&&(!0===ke.cameraAutoUpdate&&ke.updateCamera(t),t=ke.getCamera()),!0===e.isScene&&e.onBeforeRender(m,e,t,_),(d=ce.get(e,f.length)).init(),f.push(d),W.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),V.setFromProjectionMatrix(W),G=this.localClippingEnabled,j=ue.init(this.clippingPlanes,G,t),(h=le.get(e,p.length)).init(),p.push(h),De(e,t,0,m.sortObjects),h.finish(),!0===m.sortObjects&&h.sort(P,R),!0===j&&ue.beginShadows();var n=d.state.shadowsArray;he.render(n,e,t),d.setupLights(),d.setupLightsView(t),!0===j&&ue.endShadows(),!0===this.info.autoReset&&this.info.reset(),de.render(h,e);var i=h.opaque,r=h.transmissive,a=h.transparent;i.length>0&&Oe(i,e,t),r.length>0&&function(e,t,n,i){null===H&&(H=new Se(1024,1024,{generateMipmaps:!0,minFilter:L,magFilter:k,wrapS:E,wrapT:E}));var r=m.getRenderTarget();m.setRenderTarget(H),m.clear(),Oe(e,n,i),te.updateRenderTargetMipmap(H),m.setRenderTarget(r),Oe(t,n,i)}(i,r,e,t),a.length>0&&Oe(a,e,t),null!==_&&(te.updateRenderTargetMipmap(_),te.updateMultisampleRenderTarget(_)),!0===e.isScene&&e.onAfterRender(m,e,t),K.buffers.depth.setTest(!0),K.buffers.depth.setMask(!0),K.buffers.color.setMask(!0),K.setPolygonOffset(!1),ye.resetDefaultState(),x=-1,b=null,f.pop(),d=f.length>0?f[f.length-1]:null,p.pop(),h=p.length>0?p[p.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return v},this.getActiveMipmapLevel=function(){return y},this.getRenderTarget=function(){return _},this.setRenderTarget=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;_=e,v=t,y=n,e&&void 0===ee.get(e).__webglFramebuffer&&te.setupRenderTarget(e);var i=null,r=!1,a=!1;if(e){var o=e.texture;(o.isDataTexture3D||o.isDataTexture2DArray)&&(a=!0);var s=ee.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(i=s[t],r=!0):i=e.isWebGLMultisampleRenderTarget?ee.get(e).__webglMultisampledFramebuffer:s,w.copy(e.viewport),S.copy(e.scissor),T=e.scissorTest}else w.copy(z).multiplyScalar(C).floor(),S.copy(B).multiplyScalar(C).floor(),T=F;var l=K.bindFramebuffer(36160,i);if(l&&J.drawBuffers){var c=!1;if(e)if(e.isWebGLMultipleRenderTargets){var u=e.texture;if(U.length!==u.length||36064!==U[0]){for(var h=0,d=u.length;h<d;h++)U[h]=36064+h;U.length=u.length,c=!0}}else 1===U.length&&36064===U[0]||(U[0]=36064,U.length=1,c=!0);else 1===U.length&&1029===U[0]||(U[0]=1029,U.length=1,c=!0);c&&(J.isWebGL2?_e.drawBuffers(U):X.get("WEBGL_draw_buffers").drawBuffersWEBGL(U))}if(K.viewport(w),K.scissor(S),K.setScissorTest(T),r){var p=ee.get(e.texture);_e.framebufferTexture2D(36160,36064,34069+t,p.__webglTexture,n)}else if(a){var f=ee.get(e.texture),m=t||0;_e.framebufferTextureLayer(36160,36064,f.__webglTexture,n||0,m)}},this.readRenderTargetPixels=function(e,t,n,i,r,a,o){if(e&&e.isWebGLRenderTarget){var s=ee.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==o&&(s=s[o]),s){K.bindFramebuffer(36160,s);try{var l=e.texture,c=l.format,u=l.type;if(c!==N&&ve.convert(c)!==_e.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");var h=u===O&&(X.has("EXT_color_buffer_half_float")||J.isWebGL2&&X.has("EXT_color_buffer_float"));if(u!==I&&ve.convert(u)!==_e.getParameter(35738)&&(u!==D||!(J.isWebGL2||X.has("OES_texture_float")||X.has("WEBGL_color_buffer_float")))&&!h)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===_e.checkFramebufferStatus(36160)?t>=0&&t<=e.width-i&&n>=0&&n<=e.height-r&&_e.readPixels(t,n,i,r,ve.convert(c),ve.convert(u),a):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{var d=null!==_?ee.get(_).__webglFramebuffer:null;K.bindFramebuffer(36160,d)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=Math.pow(2,-n),r=Math.floor(t.image.width*i),a=Math.floor(t.image.height*i),o=ve.convert(t.format);J.isWebGL2&&(6407===o&&(o=32849),6408===o&&(o=32856)),te.setTexture2D(t,0),_e.copyTexImage2D(3553,n,o,e.x,e.y,r,a,0),K.unbindTexture()},this.copyTextureToTexture=function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=t.image.width,a=t.image.height,o=ve.convert(n.format),s=ve.convert(n.type);te.setTexture2D(n,0),_e.pixelStorei(37440,n.flipY),_e.pixelStorei(37441,n.premultiplyAlpha),_e.pixelStorei(3317,n.unpackAlignment),t.isDataTexture?_e.texSubImage2D(3553,i,e.x,e.y,r,a,o,s,t.image.data):t.isCompressedTexture?_e.compressedTexSubImage2D(3553,i,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,o,t.mipmaps[0].data):_e.texSubImage2D(3553,i,e.x,e.y,o,s,t.image),0===i&&n.generateMipmaps&&_e.generateMipmap(3553),K.unbindTexture()},this.copyTextureToTexture3D=function(e,t,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(m.isWebGL1Renderer)console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");else{var a,o=n.image,s=o.width,l=o.height,c=o.data,u=ve.convert(i.format),h=ve.convert(i.type);if(i.isDataTexture3D)te.setTexture3D(i,0),a=32879;else{if(!i.isDataTexture2DArray)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");te.setTexture2DArray(i,0),a=35866}_e.pixelStorei(37440,i.flipY),_e.pixelStorei(37441,i.premultiplyAlpha),_e.pixelStorei(3317,i.unpackAlignment);var d=_e.getParameter(3314),p=_e.getParameter(32878),f=_e.getParameter(3316),g=_e.getParameter(3315),v=_e.getParameter(32877);_e.pixelStorei(3314,s),_e.pixelStorei(32878,l),_e.pixelStorei(3316,e.min.x),_e.pixelStorei(3315,e.min.y),_e.pixelStorei(32877,e.min.z),_e.texSubImage3D(a,r,t.x,t.y,t.z,e.max.x-e.min.x+1,e.max.y-e.min.y+1,e.max.z-e.min.z+1,u,h,c),_e.pixelStorei(3314,d),_e.pixelStorei(32878,p),_e.pixelStorei(3316,f),_e.pixelStorei(3315,g),_e.pixelStorei(32877,v),0===r&&i.generateMipmaps&&_e.generateMipmap(a),K.unbindTexture()}},this.initTexture=function(e){te.setTexture2D(e,0),K.unbindTexture()},this.resetState=function(){v=0,y=0,_=null,K.reset(),ye.reset()},"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}(function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(){return Object(v.a)(this,n),t.apply(this,arguments)}return n})(la).prototype.isWebGL1Renderer=!0;var ca=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25e-5;Object(v.a)(this,e),this.name="",this.color=new Jt(t),this.density=n}return Object(y.a)(e,[{key:"clone",value:function(){return new e(this.color,this.density)}},{key:"toJSON",value:function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}]),e}();ca.prototype.isFogExp2=!0;var ua=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;Object(v.a)(this,e),this.name="",this.color=new Jt(t),this.near=n,this.far=i}return Object(y.a)(e,[{key:"clone",value:function(){return new e(this.color,this.near,this.far)}},{key:"toJSON",value:function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}]),e}();ua.prototype.isFog=!0;var ha=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(){var e;return Object(v.a)(this,n),(e=t.call(this)).type="Scene",e.background=null,e.environment=null,e.fog=null,e.overrideMaterial=null,e.autoUpdate=!0,"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:Object(f.a)(e)})),e}return Object(y.a)(n,[{key:"copy",value:function(e,t){return h(Object(u.a)(n.prototype),"copy",this).call(this,e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}},{key:"toJSON",value:function(e){var t=h(Object(u.a)(n.prototype),"toJSON",this).call(this,e);return null!==this.background&&(t.object.background=this.background.toJSON(e)),null!==this.environment&&(t.object.environment=this.environment.toJSON(e)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}]),n}(kt);ha.prototype.isScene=!0;var da=function(){function e(t,n){Object(v.a)(this,e),this.array=t,this.stride=n,this.count=void 0!==t?t.length/n:0,this.usage=te,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=ce()}return Object(y.a)(e,[{key:"onUploadCallback",value:function(){}},{key:"needsUpdate",set:function(e){!0===e&&this.version++}},{key:"setUsage",value:function(e){return this.usage=e,this}},{key:"copy",value:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}},{key:"copyAt",value:function(e,t,n){e*=this.stride,n*=t.stride;for(var i=0,r=this.stride;i<r;i++)this.array[e+i]=t.array[n+i];return this}},{key:"set",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this}},{key:"clone",value:function(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=ce()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);var t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}},{key:"onUpload",value:function(e){return this.onUploadCallback=e,this}},{key:"toJSON",value:function(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=ce()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}]),e}();da.prototype.isInterleavedBuffer=!0;var pa=new Ee,fa=function(){function e(t,n,i,r){Object(v.a)(this,e),this.name="",this.data=t,this.itemSize=n,this.offset=i,this.normalized=!0===r}return Object(y.a)(e,[{key:"count",get:function(){return this.data.count}},{key:"array",get:function(){return this.data.array}},{key:"needsUpdate",set:function(e){this.data.needsUpdate=e}},{key:"applyMatrix4",value:function(e){for(var t=0,n=this.data.count;t<n;t++)pa.x=this.getX(t),pa.y=this.getY(t),pa.z=this.getZ(t),pa.applyMatrix4(e),this.setXYZ(t,pa.x,pa.y,pa.z);return this}},{key:"applyNormalMatrix",value:function(e){for(var t=0,n=this.count;t<n;t++)pa.x=this.getX(t),pa.y=this.getY(t),pa.z=this.getZ(t),pa.applyNormalMatrix(e),this.setXYZ(t,pa.x,pa.y,pa.z);return this}},{key:"transformDirection",value:function(e){for(var t=0,n=this.count;t<n;t++)pa.x=this.getX(t),pa.y=this.getY(t),pa.z=this.getZ(t),pa.transformDirection(e),this.setXYZ(t,pa.x,pa.y,pa.z);return this}},{key:"setX",value:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this}},{key:"setY",value:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this}},{key:"setZ",value:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this}},{key:"setW",value:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this}},{key:"getX",value:function(e){return this.data.array[e*this.data.stride+this.offset]}},{key:"getY",value:function(e){return this.data.array[e*this.data.stride+this.offset+1]}},{key:"getZ",value:function(e){return this.data.array[e*this.data.stride+this.offset+2]}},{key:"getW",value:function(e){return this.data.array[e*this.data.stride+this.offset+3]}},{key:"setXY",value:function(e,t,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this}},{key:"setXYZ",value:function(e,t,n,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this}},{key:"setXYZW",value:function(e,t,n,i,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this.data.array[e+3]=r,this}},{key:"clone",value:function(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");for(var n=[],i=0;i<this.count;i++)for(var r=i*this.data.stride+this.offset,a=0;a<this.itemSize;a++)n.push(this.data.array[r+a]);return new tn(new this.array.constructor(n),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new e(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}},{key:"toJSON",value:function(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");for(var t=[],n=0;n<this.count;n++)for(var i=n*this.data.stride+this.offset,r=0;r<this.itemSize;r++)t.push(this.data.array[i+r]);return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}]),e}();fa.prototype.isInterleavedBufferAttribute=!0;var ma,ga=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e){var i;return Object(v.a)(this,n),(i=t.call(this)).type="SpriteMaterial",i.color=new Jt(16777215),i.map=null,i.alphaMap=null,i.rotation=0,i.sizeAttenuation=!0,i.transparent=!0,i.setValues(e),i}return Object(y.a)(n,[{key:"copy",value:function(e){return h(Object(u.a)(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this}}]),n}(Ht);ga.prototype.isSpriteMaterial=!0;var va=new Ee,ya=new Ee,_a=new Ee,xa=new me,ba=new me,wa=new nt,Sa=new Ee,Ta=new Ee,Ea=new Ee,Ma=new me,ka=new me,Aa=new me,Ca=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e){var i;if(Object(v.a)(this,n),(i=t.call(this)).type="Sprite",void 0===ma){ma=new fn;var r=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),a=new da(r,5);ma.setIndex([0,1,2,0,2,3]),ma.setAttribute("position",new fa(a,3,0,!1)),ma.setAttribute("uv",new fa(a,2,3,!1))}return i.geometry=ma,i.material=void 0!==e?e:new ga,i.center=new me(.5,.5),i}return Object(y.a)(n,[{key:"raycast",value:function(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),ya.setFromMatrixScale(this.matrixWorld),wa.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),_a.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&ya.multiplyScalar(-_a.z);var n,i,r=this.material.rotation;0!==r&&(i=Math.cos(r),n=Math.sin(r));var a=this.center;Pa(Sa.set(-.5,-.5,0),_a,a,ya,n,i),Pa(Ta.set(.5,-.5,0),_a,a,ya,n,i),Pa(Ea.set(.5,.5,0),_a,a,ya,n,i),Ma.set(0,0),ka.set(1,0),Aa.set(1,1);var o=e.ray.intersectTriangle(Sa,Ta,Ea,!1,va);if(null!==o||(Pa(Ta.set(-.5,.5,0),_a,a,ya,n,i),ka.set(0,1),null!==(o=e.ray.intersectTriangle(Sa,Ea,Ta,!1,va)))){var s=e.ray.origin.distanceTo(va);s<e.near||s>e.far||t.push({distance:s,point:va.clone(),uv:jt.getUV(va,Sa,Ta,Ea,Ma,ka,Aa,new me),face:null,object:this})}}},{key:"copy",value:function(e){return h(Object(u.a)(n.prototype),"copy",this).call(this,e),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}]),n}(kt);function Pa(e,t,n,i,r,a){xa.subVectors(e,n).addScalar(.5).multiply(i),void 0!==r?(ba.x=a*xa.x-r*xa.y,ba.y=r*xa.x+a*xa.y):ba.copy(xa),e.copy(t),e.x+=ba.x,e.y+=ba.y,e.applyMatrix4(wa)}Ca.prototype.isSprite=!0;var La=new Ee,Ia=new we,Ra=new we,za=new Ee,Da=new nt,Oa=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e,i){var r;return Object(v.a)(this,n),(r=t.call(this,e,i)).type="SkinnedMesh",r.bindMode="attached",r.bindMatrix=new nt,r.bindMatrixInverse=new nt,r}return Object(y.a)(n,[{key:"copy",value:function(e){return h(Object(u.a)(n.prototype),"copy",this).call(this,e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}},{key:"bind",value:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}},{key:"pose",value:function(){this.skeleton.pose()}},{key:"normalizeSkinWeights",value:function(){for(var e=new we,t=this.geometry.attributes.skinWeight,n=0,i=t.count;n<i;n++){e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.w=t.getW(n);var r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}},{key:"updateMatrixWorld",value:function(e){h(Object(u.a)(n.prototype),"updateMatrixWorld",this).call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}},{key:"boneTransform",value:function(e,t){var n=this.skeleton,i=this.geometry;Ia.fromBufferAttribute(i.attributes.skinIndex,e),Ra.fromBufferAttribute(i.attributes.skinWeight,e),La.fromBufferAttribute(i.attributes.position,e).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(var r=0;r<4;r++){var a=Ra.getComponent(r);if(0!==a){var o=Ia.getComponent(r);Da.multiplyMatrices(n.bones[o].matrixWorld,n.boneInverses[o]),t.addScaledVector(za.copy(La).applyMatrix4(Da),a)}}return t.applyMatrix4(this.bindMatrixInverse)}}]),n}(In);Oa.prototype.isSkinnedMesh=!0;var Ba=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(){var e;return Object(v.a)(this,n),(e=t.call(this)).type="Bone",e}return n}(kt);Ba.prototype.isBone=!0;var Fa=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e,i,r,a,o,s,l,c,u,h,d,p){var f;return Object(v.a)(this,n),(f=t.call(this,null,s,l,c,u,h,a,o,d,p)).image={data:e||null,width:i||1,height:r||1},f.magFilter=void 0!==u?u:k,f.minFilter=void 0!==h?h:k,f.generateMipmaps=!1,f.flipY=!1,f.unpackAlignment=1,f.needsUpdate=!0,f}return n}(xe);Fa.prototype.isDataTexture=!0;var Na=new nt,Ua=new nt,Va=[],ja=new In,Ga=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e,i,r){var a;return Object(v.a)(this,n),(a=t.call(this,e,i)).instanceMatrix=new tn(new Float32Array(16*r),16),a.instanceColor=null,a.count=r,a.frustumCulled=!1,a}return Object(y.a)(n,[{key:"copy",value:function(e){return h(Object(u.a)(n.prototype),"copy",this).call(this,e),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}},{key:"getColorAt",value:function(e,t){t.fromArray(this.instanceColor.array,3*e)}},{key:"getMatrixAt",value:function(e,t){t.fromArray(this.instanceMatrix.array,16*e)}},{key:"raycast",value:function(e,t){var n=this.matrixWorld,i=this.count;if(ja.geometry=this.geometry,ja.material=this.material,void 0!==ja.material)for(var r=0;r<i;r++){this.getMatrixAt(r,Na),Ua.multiplyMatrices(n,Na),ja.matrixWorld=Ua,ja.raycast(e,Va);for(var a=0,o=Va.length;a<o;a++){var s=Va[a];s.instanceId=r,s.object=this,t.push(s)}Va.length=0}}},{key:"setColorAt",value:function(e,t){null===this.instanceColor&&(this.instanceColor=new tn(new Float32Array(3*this.count),3)),t.toArray(this.instanceColor.array,3*e)}},{key:"setMatrixAt",value:function(e,t){t.toArray(this.instanceMatrix.array,16*e)}},{key:"updateMorphTargets",value:function(){}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}}]),n}(In);Ga.prototype.isInstancedMesh=!0;var Ha=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e){var i;return Object(v.a)(this,n),(i=t.call(this)).type="LineBasicMaterial",i.color=new Jt(16777215),i.linewidth=1,i.linecap="round",i.linejoin="round",i.morphTargets=!1,i.setValues(e),i}return Object(y.a)(n,[{key:"copy",value:function(e){return h(Object(u.a)(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.morphTargets=e.morphTargets,this}}]),n}(Ht);Ha.prototype.isLineBasicMaterial=!0;var Wa=new Ee,qa=new Ee,Za=new nt,$a=new tt,Xa=new Ze,Ya=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new fn,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Ha;return Object(v.a)(this,n),(e=t.call(this)).type="Line",e.geometry=i,e.material=r,e.updateMorphTargets(),e}return Object(y.a)(n,[{key:"copy",value:function(e){return h(Object(u.a)(n.prototype),"copy",this).call(this,e),this.material=e.material,this.geometry=e.geometry,this}},{key:"computeLineDistances",value:function(){var e=this.geometry;if(e.isBufferGeometry)if(null===e.index){for(var t=e.attributes.position,n=[0],i=1,r=t.count;i<r;i++)Wa.fromBufferAttribute(t,i-1),qa.fromBufferAttribute(t,i),n[i]=n[i-1],n[i]+=Wa.distanceTo(qa);e.setAttribute("lineDistance",new an(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}},{key:"raycast",value:function(e,t){var n=this.geometry,i=this.matrixWorld,r=e.params.Line.threshold,a=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Xa.copy(n.boundingSphere),Xa.applyMatrix4(i),Xa.radius+=r,!1!==e.ray.intersectsSphere(Xa)){Za.copy(i).invert(),$a.copy(e.ray).applyMatrix4(Za);var o=r/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o,l=new Ee,c=new Ee,u=new Ee,h=new Ee,d=this.isLineSegments?2:1;if(n.isBufferGeometry){var p=n.index,f=n.attributes.position;if(null!==p)for(var m=Math.max(0,a.start),g=Math.min(p.count,a.start+a.count)-1;m<g;m+=d){var v=p.getX(m),y=p.getX(m+1);if(l.fromBufferAttribute(f,v),c.fromBufferAttribute(f,y),!($a.distanceSqToSegment(l,c,h,u)>s)){h.applyMatrix4(this.matrixWorld);var _=e.ray.origin.distanceTo(h);_<e.near||_>e.far||t.push({distance:_,point:u.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this})}}else for(var x=Math.max(0,a.start),b=Math.min(f.count,a.start+a.count)-1;x<b;x+=d){if(l.fromBufferAttribute(f,x),c.fromBufferAttribute(f,x+1),!($a.distanceSqToSegment(l,c,h,u)>s)){h.applyMatrix4(this.matrixWorld);var w=e.ray.origin.distanceTo(h);w<e.near||w>e.far||t.push({distance:w,point:u.clone().applyMatrix4(this.matrixWorld),index:x,face:null,faceIndex:null,object:this})}}}else n.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}},{key:"updateMorphTargets",value:function(){var e=this.geometry;if(e.isBufferGeometry){var t=e.morphAttributes,n=Object.keys(t);if(n.length>0){var i=t[n[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var r=0,a=i.length;r<a;r++){var o=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=r}}}}else{var s=e.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}]),n}(kt);Ya.prototype.isLine=!0;var Ja=new Ee,Ka=new Ee,Qa=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e,i){var r;return Object(v.a)(this,n),(r=t.call(this,e,i)).type="LineSegments",r}return Object(y.a)(n,[{key:"computeLineDistances",value:function(){var e=this.geometry;if(e.isBufferGeometry)if(null===e.index){for(var t=e.attributes.position,n=[],i=0,r=t.count;i<r;i+=2)Ja.fromBufferAttribute(t,i),Ka.fromBufferAttribute(t,i+1),n[i]=0===i?0:n[i-1],n[i+1]=n[i]+Ja.distanceTo(Ka);e.setAttribute("lineDistance",new an(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}]),n}(Ya);Qa.prototype.isLineSegments=!0;var eo=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e,i){var r;return Object(v.a)(this,n),(r=t.call(this,e,i)).type="LineLoop",r}return n}(Ya);eo.prototype.isLineLoop=!0;var to=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e){var i;return Object(v.a)(this,n),(i=t.call(this)).type="PointsMaterial",i.color=new Jt(16777215),i.map=null,i.alphaMap=null,i.size=1,i.sizeAttenuation=!0,i.morphTargets=!1,i.setValues(e),i}return Object(y.a)(n,[{key:"copy",value:function(e){return h(Object(u.a)(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this}}]),n}(Ht);to.prototype.isPointsMaterial=!0;var no=new nt,io=new tt,ro=new Ze,ao=new Ee,oo=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new fn,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new to;return Object(v.a)(this,n),(e=t.call(this)).type="Points",e.geometry=i,e.material=r,e.updateMorphTargets(),e}return Object(y.a)(n,[{key:"copy",value:function(e){return h(Object(u.a)(n.prototype),"copy",this).call(this,e),this.material=e.material,this.geometry=e.geometry,this}},{key:"raycast",value:function(e,t){var n=this.geometry,i=this.matrixWorld,r=e.params.Points.threshold,a=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),ro.copy(n.boundingSphere),ro.applyMatrix4(i),ro.radius+=r,!1!==e.ray.intersectsSphere(ro)){no.copy(i).invert(),io.copy(e.ray).applyMatrix4(no);var o=r/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o;if(n.isBufferGeometry){var l=n.index,c=n.attributes.position;if(null!==l)for(var u=Math.max(0,a.start),h=Math.min(l.count,a.start+a.count);u<h;u++){var d=l.getX(u);ao.fromBufferAttribute(c,d),so(ao,d,s,i,e,t,this)}else for(var p=Math.max(0,a.start),f=Math.min(c.count,a.start+a.count);p<f;p++)ao.fromBufferAttribute(c,p),so(ao,p,s,i,e,t,this)}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}},{key:"updateMorphTargets",value:function(){var e=this.geometry;if(e.isBufferGeometry){var t=e.morphAttributes,n=Object.keys(t);if(n.length>0){var i=t[n[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var r=0,a=i.length;r<a;r++){var o=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=r}}}}else{var s=e.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}]),n}(kt);function so(e,t,n,i,r,a,o){var s=io.distanceSqToPoint(e);if(s<n){var l=new Ee;io.closestPointToPoint(e,l),l.applyMatrix4(i);var c=r.ray.origin.distanceTo(l);if(c<r.near||c>r.far)return;a.push({distance:c,distanceToRay:Math.sqrt(s),point:l,index:t,face:null,object:o})}}oo.prototype.isPoints=!0,function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e,i,r,a,o,s,l,c,u){var h;Object(v.a)(this,n),(h=t.call(this,e,i,r,a,o,s,l,c,u)).format=void 0!==l?l:F,h.minFilter=void 0!==s?s:P,h.magFilter=void 0!==o?o:P,h.generateMipmaps=!1;var d=Object(f.a)(h);return"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback((function t(){d.needsUpdate=!0,e.requestVideoFrameCallback(t)})),h}return Object(y.a)(n,[{key:"clone",value:function(){return new this.constructor(this.image).copy(this)}},{key:"update",value:function(){var e=this.image;!1==="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}]),n}(xe).prototype.isVideoTexture=!0;var lo=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e,i,r,a,o,s,l,c,u,h,d,p){var f;return Object(v.a)(this,n),(f=t.call(this,null,s,l,c,u,h,a,o,d,p)).image={width:i,height:r},f.mipmaps=e,f.flipY=!1,f.generateMipmaps=!1,f}return n}(xe);lo.prototype.isCompressedTexture=!0,function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e,i,r,a,o,s,l,c,u){var h;return Object(v.a)(this,n),(h=t.call(this,e,i,r,a,o,s,l,c,u)).needsUpdate=!0,h}return n}(xe).prototype.isCanvasTexture=!0,function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e,i,r,a,o,s,l,c,u,h){var d;if(Object(v.a)(this,n),(h=void 0!==h?h:U)!==U&&h!==V)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");return void 0===r&&h===U&&(r=R),void 0===r&&h===V&&(r=B),(d=t.call(this,null,a,o,s,l,c,h,r,u)).image={width:e,height:i},d.magFilter=void 0!==l?l:k,d.minFilter=void 0!==c?c:k,d.flipY=!1,d.generateMipmaps=!1,d}return n}(xe).prototype.isDepthTexture=!0;new Ee,new Ee,new Ee,new jt;var co=function(e,t,n){n=n||2;var i,r,a,o,s,l,c,u=t&&t.length,h=u?t[0]*n:e.length,d=uo(e,0,h,n,!0),p=[];if(!d||d.next===d.prev)return p;if(u&&(d=function(e,t,n,i){var r,a,o,s=[];for(r=0,a=t.length;r<a;r++)(o=uo(e,t[r]*i,r<a-1?t[r+1]*i:e.length,i,!1))===o.next&&(o.steiner=!0),s.push(wo(o));for(s.sort(yo),r=0;r<s.length;r++)_o(s[r],n),n=ho(n,n.next);return n}(e,t,d,n)),e.length>80*n){i=a=e[0],r=o=e[1];for(var f=n;f<h;f+=n)(s=e[f])<i&&(i=s),(l=e[f+1])<r&&(r=l),s>a&&(a=s),l>o&&(o=l);c=0!==(c=Math.max(a-i,o-r))?1/c:0}return po(d,p,n,i,r,c),p};function uo(e,t,n,i,r){var a,o;if(r===function(e,t,n,i){for(var r=0,a=t,o=n-i;a<n;a+=i)r+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return r}(e,t,n,i)>0)for(a=t;a<n;a+=i)o=Io(a,e[a],e[a+1],o);else for(a=n-i;a>=t;a-=i)o=Io(a,e[a],e[a+1],o);return o&&Mo(o,o.next)&&(Ro(o),o=o.next),o}function ho(e,t){if(!e)return e;t||(t=e);var n,i=e;do{if(n=!1,i.steiner||!Mo(i,i.next)&&0!==Eo(i.prev,i,i.next))i=i.next;else{if(Ro(i),(i=t=i.prev)===i.next)break;n=!0}}while(n||i!==t);return t}function po(e,t,n,i,r,a,o){if(e){!o&&a&&function(e,t,n,i){var r=e;do{null===r.z&&(r.z=bo(r.x,r.y,t,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){var t,n,i,r,a,o,s,l,c=1;do{for(n=e,e=null,a=null,o=0;n;){for(o++,i=n,s=0,t=0;t<c&&(s++,i=i.nextZ);t++);for(l=c;s>0||l>0&&i;)0!==s&&(0===l||!i||n.z<=i.z)?(r=n,n=n.nextZ,s--):(r=i,i=i.nextZ,l--),a?a.nextZ=r:e=r,r.prevZ=a,a=r;n=i}a.nextZ=null,c*=2}while(o>1)}(r)}(e,i,r,a);for(var s,l,c=e;e.prev!==e.next;)if(s=e.prev,l=e.next,a?mo(e,i,r,a):fo(e))t.push(s.i/n),t.push(e.i/n),t.push(l.i/n),Ro(e),e=l.next,c=l.next;else if((e=l)===c){o?1===o?po(e=go(ho(e),t,n),t,n,i,r,a,2):2===o&&vo(e,t,n,i,r,a):po(ho(e),t,n,i,r,a,1);break}}}function fo(e){var t=e.prev,n=e,i=e.next;if(Eo(t,n,i)>=0)return!1;for(var r=e.next.next;r!==e.prev;){if(So(t.x,t.y,n.x,n.y,i.x,i.y,r.x,r.y)&&Eo(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function mo(e,t,n,i){var r=e.prev,a=e,o=e.next;if(Eo(r,a,o)>=0)return!1;for(var s=r.x<a.x?r.x<o.x?r.x:o.x:a.x<o.x?a.x:o.x,l=r.y<a.y?r.y<o.y?r.y:o.y:a.y<o.y?a.y:o.y,c=r.x>a.x?r.x>o.x?r.x:o.x:a.x>o.x?a.x:o.x,u=r.y>a.y?r.y>o.y?r.y:o.y:a.y>o.y?a.y:o.y,h=bo(s,l,t,n,i),d=bo(c,u,t,n,i),p=e.prevZ,f=e.nextZ;p&&p.z>=h&&f&&f.z<=d;){if(p!==e.prev&&p!==e.next&&So(r.x,r.y,a.x,a.y,o.x,o.y,p.x,p.y)&&Eo(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,f!==e.prev&&f!==e.next&&So(r.x,r.y,a.x,a.y,o.x,o.y,f.x,f.y)&&Eo(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;p&&p.z>=h;){if(p!==e.prev&&p!==e.next&&So(r.x,r.y,a.x,a.y,o.x,o.y,p.x,p.y)&&Eo(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;f&&f.z<=d;){if(f!==e.prev&&f!==e.next&&So(r.x,r.y,a.x,a.y,o.x,o.y,f.x,f.y)&&Eo(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function go(e,t,n){var i=e;do{var r=i.prev,a=i.next.next;!Mo(r,a)&&ko(r,i,i.next,a)&&Po(r,a)&&Po(a,r)&&(t.push(r.i/n),t.push(i.i/n),t.push(a.i/n),Ro(i),Ro(i.next),i=e=a),i=i.next}while(i!==e);return ho(i)}function vo(e,t,n,i,r,a){var o=e;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&To(o,s)){var l=Lo(o,s);return o=ho(o,o.next),l=ho(l,l.next),po(o,t,n,i,r,a),void po(l,t,n,i,r,a)}s=s.next}o=o.next}while(o!==e)}function yo(e,t){return e.x-t.x}function _o(e,t){if(t=function(e,t){var n,i=t,r=e.x,a=e.y,o=-1/0;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){var s=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(s<=r&&s>o){if(o=s,s===r){if(a===i.y)return i;if(a===i.next.y)return i.next}n=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!n)return null;if(r===o)return n;var l,c=n,u=n.x,h=n.y,d=1/0;i=n;do{r>=i.x&&i.x>=u&&r!==i.x&&So(a<h?r:o,a,u,h,a<h?o:r,a,i.x,i.y)&&(l=Math.abs(a-i.y)/(r-i.x),Po(i,e)&&(l<d||l===d&&(i.x>n.x||i.x===n.x&&xo(n,i)))&&(n=i,d=l)),i=i.next}while(i!==c);return n}(e,t)){var n=Lo(t,e);ho(t,t.next),ho(n,n.next)}}function xo(e,t){return Eo(e.prev,e,t.prev)<0&&Eo(t.next,e,e.next)<0}function bo(e,t,n,i,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*r)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function wo(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function So(e,t,n,i,r,a,o,s){return(r-o)*(t-s)-(e-o)*(a-s)>=0&&(e-o)*(i-s)-(n-o)*(t-s)>=0&&(n-o)*(a-s)-(r-o)*(i-s)>=0}function To(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&ko(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(Po(e,t)&&Po(t,e)&&function(e,t){var n=e,i=!1,r=(e.x+t.x)/2,a=(e.y+t.y)/2;do{n.y>a!==n.next.y>a&&n.next.y!==n.y&&r<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}(e,t)&&(Eo(e.prev,e,t.prev)||Eo(e,t.prev,t))||Mo(e,t)&&Eo(e.prev,e,e.next)>0&&Eo(t.prev,t,t.next)>0)}function Eo(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function Mo(e,t){return e.x===t.x&&e.y===t.y}function ko(e,t,n,i){var r=Co(Eo(e,t,n)),a=Co(Eo(e,t,i)),o=Co(Eo(n,i,e)),s=Co(Eo(n,i,t));return r!==a&&o!==s||(!(0!==r||!Ao(e,n,t))||(!(0!==a||!Ao(e,i,t))||(!(0!==o||!Ao(n,e,i))||!(0!==s||!Ao(n,t,i)))))}function Ao(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function Co(e){return e>0?1:e<0?-1:0}function Po(e,t){return Eo(e.prev,e,e.next)<0?Eo(e,t,e.next)>=0&&Eo(e,e.prev,t)>=0:Eo(e,t,e.prev)<0||Eo(e,e.next,t)<0}function Lo(e,t){var n=new zo(e.i,e.x,e.y),i=new zo(t.i,t.x,t.y),r=e.next,a=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,i.next=n,n.prev=i,a.next=i,i.prev=a,i}function Io(e,t,n,i){var r=new zo(e,t,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function Ro(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function zo(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}var Do=function(){function e(){Object(v.a)(this,e)}return Object(y.a)(e,null,[{key:"area",value:function(e){for(var t=e.length,n=0,i=t-1,r=0;r<t;i=r++)n+=e[i].x*e[r].y-e[r].x*e[i].y;return.5*n}},{key:"isClockWise",value:function(t){return e.area(t)<0}},{key:"triangulateShape",value:function(e,t){var n=[],i=[],r=[];Oo(e),Bo(n,e);var a=e.length;t.forEach(Oo);for(var o=0;o<t.length;o++)i.push(a),a+=t[o].length,Bo(n,t[o]);for(var s=co(n,i),l=0;l<s.length;l+=3)r.push(s.slice(l,l+3));return r}}]),e}();function Oo(e){var t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function Bo(e,t){for(var n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}var Fo=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e,i){var r;Object(v.a)(this,n),(r=t.call(this)).type="ExtrudeGeometry",r.parameters={shapes:e,options:i},e=Array.isArray(e)?e:[e];for(var a=Object(f.a)(r),o=[],s=[],l=0,c=e.length;l<c;l++){u(e[l])}function u(e){var t=[],n=void 0!==i.curveSegments?i.curveSegments:12,r=void 0!==i.steps?i.steps:1,l=void 0!==i.depth?i.depth:100,c=void 0===i.bevelEnabled||i.bevelEnabled,u=void 0!==i.bevelThickness?i.bevelThickness:6,h=void 0!==i.bevelSize?i.bevelSize:u-2,d=void 0!==i.bevelOffset?i.bevelOffset:0,p=void 0!==i.bevelSegments?i.bevelSegments:3,f=i.extrudePath,m=void 0!==i.UVGenerator?i.UVGenerator:No;void 0!==i.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),l=i.amount);var g,v,y,_,x,b=!1;f&&(g=f.getSpacedPoints(r),b=!0,c=!1,v=f.computeFrenetFrames(r,!1),y=new Ee,_=new Ee,x=new Ee),c||(p=0,u=0,h=0,d=0);var w=e.extractPoints(n),S=w.shape,T=w.holes;if(!Do.isClockWise(S)){S=S.reverse();for(var E=0,M=T.length;E<M;E++){var k=T[E];Do.isClockWise(k)&&(T[E]=k.reverse())}}for(var A=Do.triangulateShape(S,T),C=S,P=0,L=T.length;P<L;P++){var I=T[P];S=S.concat(I)}function R(e,t,n){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(n).add(e)}var z=S.length,D=A.length;function O(e,t,n){var i,r,a,o=e.x-t.x,s=e.y-t.y,l=n.x-e.x,c=n.y-e.y,u=o*o+s*s,h=o*c-s*l;if(Math.abs(h)>Number.EPSILON){var d=Math.sqrt(u),p=Math.sqrt(l*l+c*c),f=t.x-s/d,m=t.y+o/d,g=((n.x-c/p-f)*c-(n.y+l/p-m)*l)/(o*c-s*l),v=(i=f+o*g-e.x)*i+(r=m+s*g-e.y)*r;if(v<=2)return new me(i,r);a=Math.sqrt(v/2)}else{var y=!1;o>Number.EPSILON?l>Number.EPSILON&&(y=!0):o<-Number.EPSILON?l<-Number.EPSILON&&(y=!0):Math.sign(s)===Math.sign(c)&&(y=!0),y?(i=-s,r=o,a=Math.sqrt(u)):(i=o,r=s,a=Math.sqrt(u/2))}return new me(i/a,r/a)}for(var B=[],F=0,N=C.length,U=N-1,V=F+1;F<N;F++,U++,V++)U===N&&(U=0),V===N&&(V=0),B[F]=O(C[F],C[U],C[V]);for(var j,G=[],H=B.concat(),W=0,q=T.length;W<q;W++){var Z=T[W];j=[];for(var $=0,X=Z.length,Y=X-1,J=$+1;$<X;$++,Y++,J++)Y===X&&(Y=0),J===X&&(J=0),j[$]=O(Z[$],Z[Y],Z[J]);G.push(j),H=H.concat(j)}for(var K=0;K<p;K++){for(var Q=K/p,ee=u*Math.cos(Q*Math.PI/2),te=h*Math.sin(Q*Math.PI/2)+d,ne=0,ie=C.length;ne<ie;ne++){var re=R(C[ne],B[ne],te);Re(re.x,re.y,-ee)}for(var ae=0,oe=T.length;ae<oe;ae++){var se=T[ae];j=G[ae];for(var le=0,ce=se.length;le<ce;le++){var ue=R(se[le],j[le],te);Re(ue.x,ue.y,-ee)}}}for(var he=h+d,de=0;de<z;de++){var pe=c?R(S[de],H[de],he):S[de];b?(_.copy(v.normals[0]).multiplyScalar(pe.x),y.copy(v.binormals[0]).multiplyScalar(pe.y),x.copy(g[0]).add(_).add(y),Re(x.x,x.y,x.z)):Re(pe.x,pe.y,0)}for(var fe=1;fe<=r;fe++)for(var ge=0;ge<z;ge++){var ve=c?R(S[ge],H[ge],he):S[ge];b?(_.copy(v.normals[fe]).multiplyScalar(ve.x),y.copy(v.binormals[fe]).multiplyScalar(ve.y),x.copy(g[fe]).add(_).add(y),Re(x.x,x.y,x.z)):Re(ve.x,ve.y,l/r*fe)}for(var ye=p-1;ye>=0;ye--){for(var _e=ye/p,xe=u*Math.cos(_e*Math.PI/2),be=h*Math.sin(_e*Math.PI/2)+d,we=0,Se=C.length;we<Se;we++){var Te=R(C[we],B[we],be);Re(Te.x,Te.y,l+xe)}for(var Me=0,ke=T.length;Me<ke;Me++){var Ae=T[Me];j=G[Me];for(var Ce=0,Pe=Ae.length;Ce<Pe;Ce++){var Le=R(Ae[Ce],j[Ce],be);b?Re(Le.x,Le.y+g[r-1].y,g[r-1].x+xe):Re(Le.x,Le.y,l+xe)}}}function Ie(e,t){for(var n=e.length;--n>=0;){var i=n,a=n-1;a<0&&(a=e.length-1);for(var o=0,s=r+2*p;o<s;o++){var l=z*o,c=z*(o+1);De(t+i+l,t+a+l,t+a+c,t+i+c)}}}function Re(e,n,i){t.push(e),t.push(n),t.push(i)}function ze(e,t,n){Oe(e),Oe(t),Oe(n);var i=o.length/3,r=m.generateTopUV(a,o,i-3,i-2,i-1);Be(r[0]),Be(r[1]),Be(r[2])}function De(e,t,n,i){Oe(e),Oe(t),Oe(i),Oe(t),Oe(n),Oe(i);var r=o.length/3,s=m.generateSideWallUV(a,o,r-6,r-3,r-2,r-1);Be(s[0]),Be(s[1]),Be(s[3]),Be(s[1]),Be(s[2]),Be(s[3])}function Oe(e){o.push(t[3*e+0]),o.push(t[3*e+1]),o.push(t[3*e+2])}function Be(e){s.push(e.x),s.push(e.y)}!function(){var e=o.length/3;if(c){for(var t=0,n=z*t,i=0;i<D;i++){var s=A[i];ze(s[2]+n,s[1]+n,s[0]+n)}n=z*(t=r+2*p);for(var l=0;l<D;l++){var u=A[l];ze(u[0]+n,u[1]+n,u[2]+n)}}else{for(var h=0;h<D;h++){var d=A[h];ze(d[2],d[1],d[0])}for(var f=0;f<D;f++){var m=A[f];ze(m[0]+z*r,m[1]+z*r,m[2]+z*r)}}a.addGroup(e,o.length/3-e,0)}(),function(){var e=o.length/3,t=0;Ie(C,t),t+=C.length;for(var n=0,i=T.length;n<i;n++){var r=T[n];Ie(r,t),t+=r.length}a.addGroup(e,o.length/3-e,1)}()}return r.setAttribute("position",new an(o,3)),r.setAttribute("uv",new an(s,2)),r.computeVertexNormals(),r}return Object(y.a)(n,[{key:"toJSON",value:function(){var e=h(Object(u.a)(n.prototype),"toJSON",this).call(this);return function(e,t,n){if(n.shapes=[],Array.isArray(e))for(var i=0,r=e.length;i<r;i++){var a=e[i];n.shapes.push(a.uuid)}else n.shapes.push(e.uuid);void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON());return n}(this.parameters.shapes,this.parameters.options,e)}}]),n}(fn),No={generateTopUV:function(e,t,n,i,r){var a=t[3*n],o=t[3*n+1],s=t[3*i],l=t[3*i+1],c=t[3*r],u=t[3*r+1];return[new me(a,o),new me(s,l),new me(c,u)]},generateSideWallUV:function(e,t,n,i,r,a){var o=t[3*n],s=t[3*n+1],l=t[3*n+2],c=t[3*i],u=t[3*i+1],h=t[3*i+2],d=t[3*r],p=t[3*r+1],f=t[3*r+2],m=t[3*a],g=t[3*a+1],v=t[3*a+2];return Math.abs(s-u)<Math.abs(o-c)?[new me(o,1-l),new me(c,1-h),new me(d,1-f),new me(m,1-v)]:[new me(s,1-l),new me(u,1-h),new me(p,1-f),new me(g,1-v)]}};var Uo=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e){var i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12;Object(v.a)(this,n),(i=t.call(this)).type="ShapeGeometry",i.parameters={shapes:e,curveSegments:r};var a=[],o=[],s=[],l=[],c=0,u=0;if(!1===Array.isArray(e))d(e);else for(var h=0;h<e.length;h++)d(e[h]),i.addGroup(c,u,h),c+=u,u=0;function d(e){var t=o.length/3,n=e.extractPoints(r),i=n.shape,c=n.holes;!1===Do.isClockWise(i)&&(i=i.reverse());for(var h=0,d=c.length;h<d;h++){var p=c[h];!0===Do.isClockWise(p)&&(c[h]=p.reverse())}for(var f=Do.triangulateShape(i,c),m=0,g=c.length;m<g;m++){var v=c[m];i=i.concat(v)}for(var y=0,_=i.length;y<_;y++){var x=i[y];o.push(x.x,x.y,0),s.push(0,0,1),l.push(x.x,x.y)}for(var b=0,w=f.length;b<w;b++){var S=f[b],T=S[0]+t,E=S[1]+t,M=S[2]+t;a.push(T,E,M),u+=3}}return i.setIndex(a),i.setAttribute("position",new an(o,3)),i.setAttribute("normal",new an(s,3)),i.setAttribute("uv",new an(l,2)),i}return Object(y.a)(n,[{key:"toJSON",value:function(){var e=h(Object(u.a)(n.prototype),"toJSON",this).call(this);return function(e,t){if(t.shapes=[],Array.isArray(e))for(var n=0,i=e.length;n<i;n++){var r=e[n];t.shapes.push(r.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}}]),n}(fn);var Vo=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e){var i;return Object(v.a)(this,n),(i=t.call(this)).type="ShadowMaterial",i.color=new Jt(0),i.transparent=!0,i.setValues(e),i}return Object(y.a)(n,[{key:"copy",value:function(e){return h(Object(u.a)(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this}}]),n}(Ht);Vo.prototype.isShadowMaterial=!0;var jo=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e){var i;return Object(v.a)(this,n),(i=t.call(this,e)).type="RawShaderMaterial",i}return n}(Fn);jo.prototype.isRawShaderMaterial=!0;var Go=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e){var i;return Object(v.a)(this,n),(i=t.call(this)).defines={STANDARD:""},i.type="MeshStandardMaterial",i.color=new Jt(16777215),i.roughness=1,i.metalness=0,i.map=null,i.lightMap=null,i.lightMapIntensity=1,i.aoMap=null,i.aoMapIntensity=1,i.emissive=new Jt(0),i.emissiveIntensity=1,i.emissiveMap=null,i.bumpMap=null,i.bumpScale=1,i.normalMap=null,i.normalMapType=0,i.normalScale=new me(1,1),i.displacementMap=null,i.displacementScale=1,i.displacementBias=0,i.roughnessMap=null,i.metalnessMap=null,i.alphaMap=null,i.envMap=null,i.envMapIntensity=1,i.refractionRatio=.98,i.wireframe=!1,i.wireframeLinewidth=1,i.wireframeLinecap="round",i.wireframeLinejoin="round",i.morphTargets=!1,i.morphNormals=!1,i.flatShading=!1,i.vertexTangents=!1,i.setValues(e),i}return Object(y.a)(n,[{key:"copy",value:function(e){return h(Object(u.a)(n.prototype),"copy",this).call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this.vertexTangents=e.vertexTangents,this}}]),n}(Ht);Go.prototype.isMeshStandardMaterial=!0;var Ho=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e){var i;return Object(v.a)(this,n),(i=t.call(this)).defines={STANDARD:"",PHYSICAL:""},i.type="MeshPhysicalMaterial",i.clearcoat=0,i.clearcoatMap=null,i.clearcoatRoughness=0,i.clearcoatRoughnessMap=null,i.clearcoatNormalScale=new me(1,1),i.clearcoatNormalMap=null,i.reflectivity=.5,Object.defineProperty(Object(f.a)(i),"ior",{get:function(){return(1+.4*this.reflectivity)/(1-.4*this.reflectivity)},set:function(e){this.reflectivity=ue(2.5*(e-1)/(e+1),0,1)}}),i.sheen=null,i.transmission=0,i.transmissionMap=null,i.thickness=.01,i.thicknessMap=null,i.attenuationDistance=0,i.attenuationColor=new Jt(1,1,1),i.setValues(e),i}return Object(y.a)(n,[{key:"copy",value:function(e){return h(Object(u.a)(n.prototype),"copy",this).call(this,e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.reflectivity=e.reflectivity,e.sheen?this.sheen=(this.sheen||new Jt).copy(e.sheen):this.sheen=null,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this}}]),n}(Go);Ho.prototype.isMeshPhysicalMaterial=!0;var Wo=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e){var i;return Object(v.a)(this,n),(i=t.call(this)).type="MeshPhongMaterial",i.color=new Jt(16777215),i.specular=new Jt(1118481),i.shininess=30,i.map=null,i.lightMap=null,i.lightMapIntensity=1,i.aoMap=null,i.aoMapIntensity=1,i.emissive=new Jt(0),i.emissiveIntensity=1,i.emissiveMap=null,i.bumpMap=null,i.bumpScale=1,i.normalMap=null,i.normalMapType=0,i.normalScale=new me(1,1),i.displacementMap=null,i.displacementScale=1,i.displacementBias=0,i.specularMap=null,i.alphaMap=null,i.envMap=null,i.combine=0,i.reflectivity=1,i.refractionRatio=.98,i.wireframe=!1,i.wireframeLinewidth=1,i.wireframeLinecap="round",i.wireframeLinejoin="round",i.morphTargets=!1,i.morphNormals=!1,i.flatShading=!1,i.setValues(e),i}return Object(y.a)(n,[{key:"copy",value:function(e){return h(Object(u.a)(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this}}]),n}(Ht);Wo.prototype.isMeshPhongMaterial=!0;var qo=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e){var i;return Object(v.a)(this,n),(i=t.call(this)).defines={TOON:""},i.type="MeshToonMaterial",i.color=new Jt(16777215),i.map=null,i.gradientMap=null,i.lightMap=null,i.lightMapIntensity=1,i.aoMap=null,i.aoMapIntensity=1,i.emissive=new Jt(0),i.emissiveIntensity=1,i.emissiveMap=null,i.bumpMap=null,i.bumpScale=1,i.normalMap=null,i.normalMapType=0,i.normalScale=new me(1,1),i.displacementMap=null,i.displacementScale=1,i.displacementBias=0,i.alphaMap=null,i.wireframe=!1,i.wireframeLinewidth=1,i.wireframeLinecap="round",i.wireframeLinejoin="round",i.morphTargets=!1,i.morphNormals=!1,i.setValues(e),i}return Object(y.a)(n,[{key:"copy",value:function(e){return h(Object(u.a)(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this}}]),n}(Ht);qo.prototype.isMeshToonMaterial=!0;var Zo=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e){var i;return Object(v.a)(this,n),(i=t.call(this)).type="MeshNormalMaterial",i.bumpMap=null,i.bumpScale=1,i.normalMap=null,i.normalMapType=0,i.normalScale=new me(1,1),i.displacementMap=null,i.displacementScale=1,i.displacementBias=0,i.wireframe=!1,i.wireframeLinewidth=1,i.fog=!1,i.morphTargets=!1,i.morphNormals=!1,i.flatShading=!1,i.setValues(e),i}return Object(y.a)(n,[{key:"copy",value:function(e){return h(Object(u.a)(n.prototype),"copy",this).call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this}}]),n}(Ht);Zo.prototype.isMeshNormalMaterial=!0;var $o=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e){var i;return Object(v.a)(this,n),(i=t.call(this)).type="MeshLambertMaterial",i.color=new Jt(16777215),i.map=null,i.lightMap=null,i.lightMapIntensity=1,i.aoMap=null,i.aoMapIntensity=1,i.emissive=new Jt(0),i.emissiveIntensity=1,i.emissiveMap=null,i.specularMap=null,i.alphaMap=null,i.envMap=null,i.combine=0,i.reflectivity=1,i.refractionRatio=.98,i.wireframe=!1,i.wireframeLinewidth=1,i.wireframeLinecap="round",i.wireframeLinejoin="round",i.morphTargets=!1,i.morphNormals=!1,i.setValues(e),i}return Object(y.a)(n,[{key:"copy",value:function(e){return h(Object(u.a)(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this}}]),n}(Ht);$o.prototype.isMeshLambertMaterial=!0;var Xo=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e){var i;return Object(v.a)(this,n),(i=t.call(this)).defines={MATCAP:""},i.type="MeshMatcapMaterial",i.color=new Jt(16777215),i.matcap=null,i.map=null,i.bumpMap=null,i.bumpScale=1,i.normalMap=null,i.normalMapType=0,i.normalScale=new me(1,1),i.displacementMap=null,i.displacementScale=1,i.displacementBias=0,i.alphaMap=null,i.morphTargets=!1,i.morphNormals=!1,i.flatShading=!1,i.setValues(e),i}return Object(y.a)(n,[{key:"copy",value:function(e){return h(Object(u.a)(n.prototype),"copy",this).call(this,e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this}}]),n}(Ht);Xo.prototype.isMeshMatcapMaterial=!0;var Yo=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e){var i;return Object(v.a)(this,n),(i=t.call(this)).type="LineDashedMaterial",i.scale=1,i.dashSize=3,i.gapSize=1,i.setValues(e),i}return Object(y.a)(n,[{key:"copy",value:function(e){return h(Object(u.a)(n.prototype),"copy",this).call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}]),n}(Ha);Yo.prototype.isLineDashedMaterial=!0;var Jo={arraySlice:function(e,t,n){return Jo.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==n?n:e.length)):e.slice(t,n)},convertArray:function(e,t,n){return!e||!n&&e.constructor===t?e:"number"===typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){for(var t=e.length,n=new Array(t),i=0;i!==t;++i)n[i]=i;return n.sort((function(t,n){return e[t]-e[n]})),n},sortedArray:function(e,t,n){for(var i=e.length,r=new e.constructor(i),a=0,o=0;o!==i;++a)for(var s=n[a]*t,l=0;l!==t;++l)r[o++]=e[s+l];return r},flattenJSON:function(e,t,n,i){for(var r=1,a=e[0];void 0!==a&&void 0===a[i];)a=e[r++];if(void 0!==a){var o=a[i];if(void 0!==o)if(Array.isArray(o))do{void 0!==(o=a[i])&&(t.push(a.time),n.push.apply(n,o)),a=e[r++]}while(void 0!==a);else if(void 0!==o.toArray)do{void 0!==(o=a[i])&&(t.push(a.time),o.toArray(n,n.length)),a=e[r++]}while(void 0!==a);else do{void 0!==(o=a[i])&&(t.push(a.time),n.push(o)),a=e[r++]}while(void 0!==a)}},subclip:function(e,t,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:30,a=e.clone();a.name=t;for(var o=[],s=0;s<a.tracks.length;++s){for(var l=a.tracks[s],c=l.getValueSize(),u=[],h=[],d=0;d<l.times.length;++d){var p=l.times[d]*r;if(!(p<n||p>=i)){u.push(l.times[d]);for(var f=0;f<c;++f)h.push(l.values[d*c+f])}}0!==u.length&&(l.times=Jo.convertArray(u,l.times.constructor),l.values=Jo.convertArray(h,l.values.constructor),o.push(l))}a.tracks=o;for(var m=1/0,g=0;g<a.tracks.length;++g)m>a.tracks[g].times[0]&&(m=a.tracks[g].times[0]);for(var v=0;v<a.tracks.length;++v)a.tracks[v].shift(-1*m);return a.resetDuration(),a},makeClipAdditive:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:30;i<=0&&(i=30);for(var r=n.tracks.length,a=t/i,o=function(t){var i=n.tracks[t],r=i.ValueTypeName;if("bool"===r||"string"===r)return"continue";var o=e.tracks.find((function(e){return e.name===i.name&&e.ValueTypeName===r}));if(void 0===o)return"continue";var s=0,l=i.getValueSize();i.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(s=l/3);var c=0,u=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=u/3);var h=i.times.length-1,d=void 0;if(a<=i.times[0]){var p=s,f=l-s;d=Jo.arraySlice(i.values,p,f)}else if(a>=i.times[h]){var m=h*l+s,g=m+l-s;d=Jo.arraySlice(i.values,m,g)}else{var v=i.createInterpolant(),y=s,_=l-s;v.evaluate(a),d=Jo.arraySlice(v.resultBuffer,y,_)}"quaternion"===r&&(new Te).fromArray(d).normalize().conjugate().toArray(d);for(var x=o.times.length,b=0;b<x;++b){var w=b*u+c;if("quaternion"===r)Te.multiplyQuaternionsFlat(o.values,w,d,0,o.values,w);else for(var S=u-2*c,T=0;T<S;++T)o.values[w+T]-=d[T]}},s=0;s<r;++s)o(s);return e.blendMode=X,e}},Ko=function(){function e(t,n,i,r){Object(v.a)(this,e),this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new n.constructor(i),this.sampleValues=n,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}return Object(y.a)(e,[{key:"evaluate",value:function(e){var t=this.parameterPositions,n=this._cachedIndex,i=t[n],r=t[n-1];e:{t:{var a;n:{i:if(!(e<i)){for(var o=n+2;;){if(void 0===i){if(e<r)break i;return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,e,r)}if(n===o)break;if(r=i,e<(i=t[++n]))break t}a=t.length;break n}if(e>=r)break e;var s=t[1];e<s&&(n=2,r=s);for(var l=n-2;;){if(void 0===r)return this._cachedIndex=0,this.beforeStart_(0,e,i);if(n===l)break;if(i=r,e>=(r=t[--n-1]))break t}a=n,n=0}for(;n<a;){var c=n+a>>>1;e<t[c]?a=c:n=c+1}if(i=t[n],void 0===(r=t[n-1]))return this._cachedIndex=0,this.beforeStart_(0,e,i);if(void 0===i)return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,r,e)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,e,i)}},{key:"getSettings_",value:function(){return this.settings||this.DefaultSettings_}},{key:"copySampleValue_",value:function(e){for(var t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i,a=0;a!==i;++a)t[a]=n[r+a];return t}},{key:"interpolate_",value:function(){throw new Error("call to abstract method")}},{key:"intervalChanged_",value:function(){}}]),e}();Ko.prototype.beforeStart_=Ko.prototype.copySampleValue_,Ko.prototype.afterEnd_=Ko.prototype.copySampleValue_;var Qo=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e,i,r,a){var o;return Object(v.a)(this,n),(o=t.call(this,e,i,r,a))._weightPrev=-0,o._offsetPrev=-0,o._weightNext=-0,o._offsetNext=-0,o.DefaultSettings_={endingStart:W,endingEnd:W},o}return Object(y.a)(n,[{key:"intervalChanged_",value:function(e,t,n){var i=this.parameterPositions,r=e-2,a=e+1,o=i[r],s=i[a];if(void 0===o)switch(this.getSettings_().endingStart){case q:r=e,o=2*t-n;break;case Z:o=t+i[r=i.length-2]-i[r+1];break;default:r=e,o=n}if(void 0===s)switch(this.getSettings_().endingEnd){case q:a=e,s=2*n-t;break;case Z:a=1,s=n+i[1]-i[0];break;default:a=e-1,s=t}var l=.5*(n-t),c=this.valueSize;this._weightPrev=l/(t-o),this._weightNext=l/(s-n),this._offsetPrev=r*c,this._offsetNext=a*c}},{key:"interpolate_",value:function(e,t,n,i){for(var r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=s-o,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(n-t)/(i-t),f=p*p,m=f*p,g=-h*m+2*h*f-h*p,v=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*p+1,y=(-1-d)*m+(1.5+d)*f+.5*p,_=d*m-d*f,x=0;x!==o;++x)r[x]=g*a[c+x]+v*a[l+x]+y*a[s+x]+_*a[u+x];return r}}]),n}(Ko),es=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e,i,r,a){return Object(v.a)(this,n),t.call(this,e,i,r,a)}return Object(y.a)(n,[{key:"interpolate_",value:function(e,t,n,i){for(var r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=s-o,c=(n-t)/(i-t),u=1-c,h=0;h!==o;++h)r[h]=a[l+h]*u+a[s+h]*c;return r}}]),n}(Ko),ts=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e,i,r,a){return Object(v.a)(this,n),t.call(this,e,i,r,a)}return Object(y.a)(n,[{key:"interpolate_",value:function(e){return this.copySampleValue_(e-1)}}]),n}(Ko),ns=function(){function e(t,n,i,r){if(Object(v.a)(this,e),void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===n||0===n.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=Jo.convertArray(n,this.TimeBufferType),this.values=Jo.convertArray(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}return Object(y.a)(e,[{key:"InterpolantFactoryMethodDiscrete",value:function(e){return new ts(this.times,this.values,this.getValueSize(),e)}},{key:"InterpolantFactoryMethodLinear",value:function(e){return new es(this.times,this.values,this.getValueSize(),e)}},{key:"InterpolantFactoryMethodSmooth",value:function(e){return new Qo(this.times,this.values,this.getValueSize(),e)}},{key:"setInterpolation",value:function(e){var t;switch(e){case j:t=this.InterpolantFactoryMethodDiscrete;break;case G:t=this.InterpolantFactoryMethodLinear;break;case H:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){var n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(n);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=t,this}},{key:"getInterpolation",value:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return j;case this.InterpolantFactoryMethodLinear:return G;case this.InterpolantFactoryMethodSmooth:return H}}},{key:"getValueSize",value:function(){return this.values.length/this.times.length}},{key:"shift",value:function(e){if(0!==e)for(var t=this.times,n=0,i=t.length;n!==i;++n)t[n]+=e;return this}},{key:"scale",value:function(e){if(1!==e)for(var t=this.times,n=0,i=t.length;n!==i;++n)t[n]*=e;return this}},{key:"trim",value:function(e,t){for(var n=this.times,i=n.length,r=0,a=i-1;r!==i&&n[r]<e;)++r;for(;-1!==a&&n[a]>t;)--a;if(++a,0!==r||a!==i){r>=a&&(r=(a=Math.max(a,1))-1);var o=this.getValueSize();this.times=Jo.arraySlice(n,r,a),this.values=Jo.arraySlice(this.values,r*o,a*o)}return this}},{key:"validate",value:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);var n=this.times,i=this.values,r=n.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);for(var a=null,o=0;o!==r;o++){var s=n[o];if("number"===typeof s&&isNaN(s)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,s),e=!1;break}if(null!==a&&a>s){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,s,a),e=!1;break}a=s}if(void 0!==i&&Jo.isTypedArray(i))for(var l=0,c=i.length;l!==c;++l){var u=i[l];if(isNaN(u)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,l,u),e=!1;break}}return e}},{key:"optimize",value:function(){for(var e=Jo.arraySlice(this.times),t=Jo.arraySlice(this.values),n=this.getValueSize(),i=this.getInterpolation()===H,r=e.length-1,a=1,o=1;o<r;++o){var s=!1,l=e[o];if(l!==e[o+1]&&(1!==o||l!==e[0]))if(i)s=!0;else for(var c=o*n,u=c-n,h=c+n,d=0;d!==n;++d){var p=t[c+d];if(p!==t[u+d]||p!==t[h+d]){s=!0;break}}if(s){if(o!==a){e[a]=e[o];for(var f=o*n,m=a*n,g=0;g!==n;++g)t[m+g]=t[f+g]}++a}}if(r>0){e[a]=e[r];for(var v=r*n,y=a*n,_=0;_!==n;++_)t[y+_]=t[v+_];++a}return a!==e.length?(this.times=Jo.arraySlice(e,0,a),this.values=Jo.arraySlice(t,0,a*n)):(this.times=e,this.values=t),this}},{key:"clone",value:function(){var e=Jo.arraySlice(this.times,0),t=Jo.arraySlice(this.values,0),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}],[{key:"toJSON",value:function(e){var t,n=e.constructor;if(n.toJSON!==this.toJSON)t=n.toJSON(e);else{t={name:e.name,times:Jo.convertArray(e.times,Array),values:Jo.convertArray(e.values,Array)};var i=e.getInterpolation();i!==e.DefaultInterpolation&&(t.interpolation=i)}return t.type=e.ValueTypeName,t}}]),e}();ns.prototype.TimeBufferType=Float32Array,ns.prototype.ValueBufferType=Float32Array,ns.prototype.DefaultInterpolation=G;var is=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(){return Object(v.a)(this,n),t.apply(this,arguments)}return n}(ns);is.prototype.ValueTypeName="bool",is.prototype.ValueBufferType=Array,is.prototype.DefaultInterpolation=j,is.prototype.InterpolantFactoryMethodLinear=void 0,is.prototype.InterpolantFactoryMethodSmooth=void 0;var rs=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(){return Object(v.a)(this,n),t.apply(this,arguments)}return n}(ns);rs.prototype.ValueTypeName="color";var as=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(){return Object(v.a)(this,n),t.apply(this,arguments)}return n}(ns);as.prototype.ValueTypeName="number";var os=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e,i,r,a){return Object(v.a)(this,n),t.call(this,e,i,r,a)}return Object(y.a)(n,[{key:"interpolate_",value:function(e,t,n,i){for(var r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=(n-t)/(i-t),l=e*o,c=l+o;l!==c;l+=4)Te.slerpFlat(r,0,a,l-o,a,l,s);return r}}]),n}(Ko),ss=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(){return Object(v.a)(this,n),t.apply(this,arguments)}return Object(y.a)(n,[{key:"InterpolantFactoryMethodLinear",value:function(e){return new os(this.times,this.values,this.getValueSize(),e)}}]),n}(ns);ss.prototype.ValueTypeName="quaternion",ss.prototype.DefaultInterpolation=G,ss.prototype.InterpolantFactoryMethodSmooth=void 0;var ls=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(){return Object(v.a)(this,n),t.apply(this,arguments)}return n}(ns);ls.prototype.ValueTypeName="string",ls.prototype.ValueBufferType=Array,ls.prototype.DefaultInterpolation=j,ls.prototype.InterpolantFactoryMethodLinear=void 0,ls.prototype.InterpolantFactoryMethodSmooth=void 0;var cs=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(){return Object(v.a)(this,n),t.apply(this,arguments)}return n}(ns);cs.prototype.ValueTypeName="vector";var us=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:$;Object(v.a)(this,e),this.name=t,this.tracks=i,this.duration=n,this.blendMode=r,this.uuid=ce(),this.duration<0&&this.resetDuration()}return Object(y.a)(e,[{key:"resetDuration",value:function(){for(var e=0,t=0,n=this.tracks.length;t!==n;++t){var i=this.tracks[t];e=Math.max(e,i.times[i.times.length-1])}return this.duration=e,this}},{key:"trim",value:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}},{key:"validate",value:function(){for(var e=!0,t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}},{key:"optimize",value:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}},{key:"clone",value:function(){for(var e=[],t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}},{key:"toJSON",value:function(){return this.constructor.toJSON(this)}}],[{key:"parse",value:function(e){for(var t=[],n=e.tracks,i=1/(e.fps||1),r=0,a=n.length;r!==a;++r)t.push(hs(n[r]).scale(i));var o=new this(e.name,e.duration,t,e.blendMode);return o.uuid=e.uuid,o}},{key:"toJSON",value:function(e){for(var t=[],n=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode},r=0,a=n.length;r!==a;++r)t.push(ns.toJSON(n[r]));return i}},{key:"CreateFromMorphTargetSequence",value:function(e,t,n,i){for(var r=t.length,a=[],o=0;o<r;o++){var s=[],l=[];s.push((o+r-1)%r,o,(o+1)%r),l.push(0,1,0);var c=Jo.getKeyframeOrder(s);s=Jo.sortedArray(s,1,c),l=Jo.sortedArray(l,1,c),i||0!==s[0]||(s.push(r),l.push(l[0])),a.push(new as(".morphTargetInfluences["+t[o].name+"]",s,l).scale(1/n))}return new this(e,-1,a)}},{key:"findByName",value:function(e,t){var n=e;if(!Array.isArray(e)){var i=e;n=i.geometry&&i.geometry.animations||i.animations}for(var r=0;r<n.length;r++)if(n[r].name===t)return n[r];return null}},{key:"CreateClipsFromMorphTargetSequences",value:function(e,t,n){for(var i={},r=/^([\w-]*?)([\d]+)$/,a=0,o=e.length;a<o;a++){var s=e[a],l=s.name.match(r);if(l&&l.length>1){var c=l[1],u=i[c];u||(i[c]=u=[]),u.push(s)}}var h=[];for(var d in i)h.push(this.CreateFromMorphTargetSequence(d,i[d],t,n));return h}},{key:"parseAnimation",value:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var n=function(e,t,n,i,r){if(0!==n.length){var a=[],o=[];Jo.flattenJSON(n,a,o,i),0!==a.length&&r.push(new e(t,a,o))}},i=[],r=e.name||"default",a=e.fps||30,o=e.blendMode,s=e.length||-1,l=e.hierarchy||[],c=0;c<l.length;c++){var u=l[c].keys;if(u&&0!==u.length)if(u[0].morphTargets){var h={},d=void 0;for(d=0;d<u.length;d++)if(u[d].morphTargets)for(var p=0;p<u[d].morphTargets.length;p++)h[u[d].morphTargets[p]]=-1;for(var f in h){for(var m=[],g=[],v=0;v!==u[d].morphTargets.length;++v){var y=u[d];m.push(y.time),g.push(y.morphTarget===f?1:0)}i.push(new as(".morphTargetInfluence["+f+"]",m,g))}s=h.length*(a||1)}else{var _=".bones["+t[c].name+"]";n(cs,_+".position",u,"pos",i),n(ss,_+".quaternion",u,"rot",i),n(cs,_+".scale",u,"scl",i)}}return 0===i.length?null:new this(r,s,i,o)}}]),e}();function hs(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return as;case"vector":case"vector2":case"vector3":case"vector4":return cs;case"color":return rs;case"quaternion":return ss;case"bool":case"boolean":return is;case"string":return ls}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){var n=[],i=[];Jo.flattenJSON(e.keys,n,i,"value"),e.times=n,e.values=i}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}var ds={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},ps=function e(t,n,i){Object(v.a)(this,e);var r=this,a=!1,o=0,s=0,l=void 0,c=[];this.onStart=void 0,this.onLoad=t,this.onProgress=n,this.onError=i,this.itemStart=function(e){s++,!1===a&&void 0!==r.onStart&&r.onStart(e,o,s),a=!0},this.itemEnd=function(e){o++,void 0!==r.onProgress&&r.onProgress(e,o,s),o===s&&(a=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(e){void 0!==r.onError&&r.onError(e)},this.resolveURL=function(e){return l?l(e):e},this.setURLModifier=function(e){return l=e,this},this.addHandler=function(e,t){return c.push(e,t),this},this.removeHandler=function(e){var t=c.indexOf(e);return-1!==t&&c.splice(t,2),this},this.getHandler=function(e){for(var t=0,n=c.length;t<n;t+=2){var i=c[t],r=c[t+1];if(i.global&&(i.lastIndex=0),i.test(e))return r}return null}},fs=new ps,ms=function(){function e(t){Object(v.a)(this,e),this.manager=void 0!==t?t:fs,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}return Object(y.a)(e,[{key:"load",value:function(){}},{key:"loadAsync",value:function(e,t){var n=this;return new Promise((function(i,r){n.load(e,i,t,r)}))}},{key:"parse",value:function(){}},{key:"setCrossOrigin",value:function(e){return this.crossOrigin=e,this}},{key:"setWithCredentials",value:function(e){return this.withCredentials=e,this}},{key:"setPath",value:function(e){return this.path=e,this}},{key:"setResourcePath",value:function(e){return this.resourcePath=e,this}},{key:"setRequestHeader",value:function(e){return this.requestHeader=e,this}}]),e}(),gs={},vs=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e){return Object(v.a)(this,n),t.call(this,e)}return Object(y.a)(n,[{key:"load",value:function(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var r=this,a=ds.get(e);if(void 0!==a)return r.manager.itemStart(e),setTimeout((function(){t&&t(a),r.manager.itemEnd(e)}),0),a;if(void 0===gs[e]){var o,s=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(s){var l=s[1],c=!!s[2],u=s[3];u=decodeURIComponent(u),c&&(u=atob(u));try{var h,d=(this.responseType||"").toLowerCase();switch(d){case"arraybuffer":case"blob":for(var p=new Uint8Array(u.length),f=0;f<u.length;f++)p[f]=u.charCodeAt(f);h="blob"===d?new Blob([p.buffer],{type:l}):p.buffer;break;case"document":var m=new DOMParser;h=m.parseFromString(u,l);break;case"json":h=JSON.parse(u);break;default:h=u}setTimeout((function(){t&&t(h),r.manager.itemEnd(e)}),0)}catch(v){setTimeout((function(){i&&i(v),r.manager.itemError(e),r.manager.itemEnd(e)}),0)}}else{for(var g in gs[e]=[],gs[e].push({onLoad:t,onProgress:n,onError:i}),(o=new XMLHttpRequest).open("GET",e,!0),o.addEventListener("load",(function(t){var n=this.response,i=gs[e];if(delete gs[e],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),ds.add(e,n);for(var a=0,o=i.length;a<o;a++){var s=i[a];s.onLoad&&s.onLoad(n)}r.manager.itemEnd(e)}else{for(var l=0,c=i.length;l<c;l++){var u=i[l];u.onError&&u.onError(t)}r.manager.itemError(e),r.manager.itemEnd(e)}}),!1),o.addEventListener("progress",(function(t){for(var n=gs[e],i=0,r=n.length;i<r;i++){var a=n[i];a.onProgress&&a.onProgress(t)}}),!1),o.addEventListener("error",(function(t){var n=gs[e];delete gs[e];for(var i=0,a=n.length;i<a;i++){var o=n[i];o.onError&&o.onError(t)}r.manager.itemError(e),r.manager.itemEnd(e)}),!1),o.addEventListener("abort",(function(t){var n=gs[e];delete gs[e];for(var i=0,a=n.length;i<a;i++){var o=n[i];o.onError&&o.onError(t)}r.manager.itemError(e),r.manager.itemEnd(e)}),!1),void 0!==this.responseType&&(o.responseType=this.responseType),void 0!==this.withCredentials&&(o.withCredentials=this.withCredentials),o.overrideMimeType&&o.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)o.setRequestHeader(g,this.requestHeader[g]);o.send(null)}return r.manager.itemStart(e),o}gs[e].push({onLoad:t,onProgress:n,onError:i})}},{key:"setResponseType",value:function(e){return this.responseType=e,this}},{key:"setMimeType",value:function(e){return this.mimeType=e,this}}]),n}(ms),ys=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e){return Object(v.a)(this,n),t.call(this,e)}return Object(y.a)(n,[{key:"load",value:function(e,t,n,i){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var r=this,a=ds.get(e);if(void 0!==a)return r.manager.itemStart(e),setTimeout((function(){t&&t(a),r.manager.itemEnd(e)}),0),a;var o=document.createElementNS("http://www.w3.org/1999/xhtml","img");function s(){o.removeEventListener("load",s,!1),o.removeEventListener("error",l,!1),ds.add(e,this),t&&t(this),r.manager.itemEnd(e)}function l(t){o.removeEventListener("load",s,!1),o.removeEventListener("error",l,!1),i&&i(t),r.manager.itemError(e),r.manager.itemEnd(e)}return o.addEventListener("load",s,!1),o.addEventListener("error",l,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),r.manager.itemStart(e),o.src=e,o}}]),n}(ms),_s=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e){return Object(v.a)(this,n),t.call(this,e)}return Object(y.a)(n,[{key:"load",value:function(e,t,n,i){var r=new Gn,a=new ys(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);var o=0;function s(n){a.load(e[n],(function(e){r.images[n]=e,6===++o&&(r.needsUpdate=!0,t&&t(r))}),void 0,i)}for(var l=0;l<e.length;++l)s(l);return r}}]),n}(ms),xs=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e){return Object(v.a)(this,n),t.call(this,e)}return Object(y.a)(n,[{key:"load",value:function(e,t,n,i){var r=new xe,a=new ys(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,(function(n){r.image=n;var i=e.search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/);r.format=i?F:N,r.needsUpdate=!0,void 0!==t&&t(r)}),n,i),r}}]),n}(ms),bs=function(){function e(){Object(v.a)(this,e),this.type="Curve",this.arcLengthDivisions=200}return Object(y.a)(e,[{key:"getPoint",value:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}},{key:"getPointAt",value:function(e,t){var n=this.getUtoTmapping(e);return this.getPoint(n,t)}},{key:"getPoints",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}},{key:"getSpacedPoints",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=[],n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}},{key:"getLength",value:function(){var e=this.getLengths();return e[e.length-1]}},{key:"getLengths",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.arcLengthDivisions;if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,n=[],i=this.getPoint(0),r=0;n.push(0);for(var a=1;a<=e;a++)r+=(t=this.getPoint(a/e)).distanceTo(i),n.push(r),i=t;return this.cacheArcLengths=n,n}},{key:"updateArcLengths",value:function(){this.needsUpdate=!0,this.getLengths()}},{key:"getUtoTmapping",value:function(e,t){var n,i=this.getLengths(),r=0,a=i.length;n=t||e*i[a-1];for(var o,s=0,l=a-1;s<=l;)if((o=i[r=Math.floor(s+(l-s)/2)]-n)<0)s=r+1;else{if(!(o>0)){l=r;break}l=r-1}if(i[r=l]===n)return r/(a-1);var c=i[r];return(r+(n-c)/(i[r+1]-c))/(a-1)}},{key:"getTangent",value:function(e,t){var n=1e-4,i=e-n,r=e+n;i<0&&(i=0),r>1&&(r=1);var a=this.getPoint(i),o=this.getPoint(r),s=t||(a.isVector2?new me:new Ee);return s.copy(o).sub(a).normalize(),s}},{key:"getTangentAt",value:function(e,t){var n=this.getUtoTmapping(e);return this.getTangent(n,t)}},{key:"computeFrenetFrames",value:function(e,t){for(var n=new Ee,i=[],r=[],a=[],o=new Ee,s=new nt,l=0;l<=e;l++){var c=l/e;i[l]=this.getTangentAt(c,new Ee),i[l].normalize()}r[0]=new Ee,a[0]=new Ee;var u=Number.MAX_VALUE,h=Math.abs(i[0].x),d=Math.abs(i[0].y),p=Math.abs(i[0].z);h<=u&&(u=h,n.set(1,0,0)),d<=u&&(u=d,n.set(0,1,0)),p<=u&&n.set(0,0,1),o.crossVectors(i[0],n).normalize(),r[0].crossVectors(i[0],o),a[0].crossVectors(i[0],r[0]);for(var f=1;f<=e;f++){if(r[f]=r[f-1].clone(),a[f]=a[f-1].clone(),o.crossVectors(i[f-1],i[f]),o.length()>Number.EPSILON){o.normalize();var m=Math.acos(ue(i[f-1].dot(i[f]),-1,1));r[f].applyMatrix4(s.makeRotationAxis(o,m))}a[f].crossVectors(i[f],r[f])}if(!0===t){var g=Math.acos(ue(r[0].dot(r[e]),-1,1));g/=e,i[0].dot(o.crossVectors(r[0],r[e]))>0&&(g=-g);for(var v=1;v<=e;v++)r[v].applyMatrix4(s.makeRotationAxis(i[v],g*v)),a[v].crossVectors(i[v],r[v])}return{tangents:i,normals:r,binormals:a}}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}},{key:"toJSON",value:function(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}},{key:"fromJSON",value:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}]),e}(),ws=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2*Math.PI,c=arguments.length>6&&void 0!==arguments[6]&&arguments[6],u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;return Object(v.a)(this,n),(e=t.call(this)).type="EllipseCurve",e.aX=i,e.aY=r,e.xRadius=a,e.yRadius=o,e.aStartAngle=s,e.aEndAngle=l,e.aClockwise=c,e.aRotation=u,e}return Object(y.a)(n,[{key:"getPoint",value:function(e,t){for(var n=t||new me,i=2*Math.PI,r=this.aEndAngle-this.aStartAngle,a=Math.abs(r)<Number.EPSILON;r<0;)r+=i;for(;r>i;)r-=i;r<Number.EPSILON&&(r=a?0:i),!0!==this.aClockwise||a||(r===i?r=-i:r-=i);var o=this.aStartAngle+e*r,s=this.aX+this.xRadius*Math.cos(o),l=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){var c=Math.cos(this.aRotation),u=Math.sin(this.aRotation),h=s-this.aX,d=l-this.aY;s=h*c-d*u+this.aX,l=h*u+d*c+this.aY}return n.set(s,l)}},{key:"copy",value:function(e){return h(Object(u.a)(n.prototype),"copy",this).call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}},{key:"toJSON",value:function(){var e=h(Object(u.a)(n.prototype),"toJSON",this).call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}},{key:"fromJSON",value:function(e){return h(Object(u.a)(n.prototype),"fromJSON",this).call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}]),n}(bs);ws.prototype.isEllipseCurve=!0;var Ss=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e,i,r,a,o,s){var l;return Object(v.a)(this,n),(l=t.call(this,e,i,r,r,a,o,s)).type="ArcCurve",l}return n}(ws);function Ts(){var e=0,t=0,n=0,i=0;function r(r,a,o,s){e=r,t=o,n=-3*r+3*a-2*o-s,i=2*r-2*a+o+s}return{initCatmullRom:function(e,t,n,i,a){r(t,n,a*(n-e),a*(i-t))},initNonuniformCatmullRom:function(e,t,n,i,a,o,s){var l=(t-e)/a-(n-e)/(a+o)+(n-t)/o,c=(n-t)/o-(i-t)/(o+s)+(i-n)/s;r(t,n,l*=o,c*=o)},calc:function(r){var a=r*r;return e+t*r+n*a+i*(a*r)}}}Ss.prototype.isArcCurve=!0;var Es=new Ee,Ms=new Ts,ks=new Ts,As=new Ts,Cs=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"centripetal",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;return Object(v.a)(this,n),(e=t.call(this)).type="CatmullRomCurve3",e.points=i,e.closed=r,e.curveType=a,e.tension=o,e}return Object(y.a)(n,[{key:"getPoint",value:function(e){var t,n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Ee,r=i,a=this.points,o=a.length,s=(o-(this.closed?0:1))*e,l=Math.floor(s),c=s-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/o)+1)*o:0===c&&l===o-1&&(l=o-2,c=1),this.closed||l>0?t=a[(l-1)%o]:(Es.subVectors(a[0],a[1]).add(a[0]),t=Es);var u=a[l%o],h=a[(l+1)%o];if(this.closed||l+2<o?n=a[(l+2)%o]:(Es.subVectors(a[o-1],a[o-2]).add(a[o-1]),n=Es),"centripetal"===this.curveType||"chordal"===this.curveType){var d="chordal"===this.curveType?.5:.25,p=Math.pow(t.distanceToSquared(u),d),f=Math.pow(u.distanceToSquared(h),d),m=Math.pow(h.distanceToSquared(n),d);f<1e-4&&(f=1),p<1e-4&&(p=f),m<1e-4&&(m=f),Ms.initNonuniformCatmullRom(t.x,u.x,h.x,n.x,p,f,m),ks.initNonuniformCatmullRom(t.y,u.y,h.y,n.y,p,f,m),As.initNonuniformCatmullRom(t.z,u.z,h.z,n.z,p,f,m)}else"catmullrom"===this.curveType&&(Ms.initCatmullRom(t.x,u.x,h.x,n.x,this.tension),ks.initCatmullRom(t.y,u.y,h.y,n.y,this.tension),As.initCatmullRom(t.z,u.z,h.z,n.z,this.tension));return r.set(Ms.calc(c),ks.calc(c),As.calc(c)),r}},{key:"copy",value:function(e){h(Object(u.a)(n.prototype),"copy",this).call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++){var r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}},{key:"toJSON",value:function(){var e=h(Object(u.a)(n.prototype),"toJSON",this).call(this);e.points=[];for(var t=0,i=this.points.length;t<i;t++){var r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}},{key:"fromJSON",value:function(e){h(Object(u.a)(n.prototype),"fromJSON",this).call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++){var r=e.points[t];this.points.push((new Ee).fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}]),n}(bs);function Ps(e,t,n,i,r){var a=.5*(i-t),o=.5*(r-n),s=e*e;return(2*n-2*i+a+o)*(e*s)+(-3*n+3*i-2*a-o)*s+a*e+n}function Ls(e,t,n,i){return function(e,t){var n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,i)}function Is(e,t,n,i,r){return function(e,t){var n=1-e;return n*n*n*t}(e,t)+function(e,t){var n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,i)+function(e,t){return e*e*e*t}(e,r)}Cs.prototype.isCatmullRomCurve3=!0;var Rs=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new me,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new me,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new me,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new me;return Object(v.a)(this,n),(e=t.call(this)).type="CubicBezierCurve",e.v0=i,e.v1=r,e.v2=a,e.v3=o,e}return Object(y.a)(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new me,n=t,i=this.v0,r=this.v1,a=this.v2,o=this.v3;return n.set(Is(e,i.x,r.x,a.x,o.x),Is(e,i.y,r.y,a.y,o.y)),n}},{key:"copy",value:function(e){return h(Object(u.a)(n.prototype),"copy",this).call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}},{key:"toJSON",value:function(){var e=h(Object(u.a)(n.prototype),"toJSON",this).call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}},{key:"fromJSON",value:function(e){return h(Object(u.a)(n.prototype),"fromJSON",this).call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}]),n}(bs);Rs.prototype.isCubicBezierCurve=!0;var zs=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Ee,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Ee,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Ee,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Ee;return Object(v.a)(this,n),(e=t.call(this)).type="CubicBezierCurve3",e.v0=i,e.v1=r,e.v2=a,e.v3=o,e}return Object(y.a)(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Ee,n=t,i=this.v0,r=this.v1,a=this.v2,o=this.v3;return n.set(Is(e,i.x,r.x,a.x,o.x),Is(e,i.y,r.y,a.y,o.y),Is(e,i.z,r.z,a.z,o.z)),n}},{key:"copy",value:function(e){return h(Object(u.a)(n.prototype),"copy",this).call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}},{key:"toJSON",value:function(){var e=h(Object(u.a)(n.prototype),"toJSON",this).call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}},{key:"fromJSON",value:function(e){return h(Object(u.a)(n.prototype),"fromJSON",this).call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}]),n}(bs);zs.prototype.isCubicBezierCurve3=!0;var Ds=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new me,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new me;return Object(v.a)(this,n),(e=t.call(this)).type="LineCurve",e.v1=i,e.v2=r,e}return Object(y.a)(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new me,n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}},{key:"getPointAt",value:function(e,t){return this.getPoint(e,t)}},{key:"getTangent",value:function(e,t){var n=t||new me;return n.copy(this.v2).sub(this.v1).normalize(),n}},{key:"copy",value:function(e){return h(Object(u.a)(n.prototype),"copy",this).call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}},{key:"toJSON",value:function(){var e=h(Object(u.a)(n.prototype),"toJSON",this).call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}},{key:"fromJSON",value:function(e){return h(Object(u.a)(n.prototype),"fromJSON",this).call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}]),n}(bs);Ds.prototype.isLineCurve=!0;var Os=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Ee,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Ee;return Object(v.a)(this,n),(e=t.call(this)).type="LineCurve3",e.isLineCurve3=!0,e.v1=i,e.v2=r,e}return Object(y.a)(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Ee,n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}},{key:"getPointAt",value:function(e,t){return this.getPoint(e,t)}},{key:"copy",value:function(e){return h(Object(u.a)(n.prototype),"copy",this).call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}},{key:"toJSON",value:function(){var e=h(Object(u.a)(n.prototype),"toJSON",this).call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}},{key:"fromJSON",value:function(e){return h(Object(u.a)(n.prototype),"fromJSON",this).call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}]),n}(bs),Bs=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new me,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new me,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new me;return Object(v.a)(this,n),(e=t.call(this)).type="QuadraticBezierCurve",e.v0=i,e.v1=r,e.v2=a,e}return Object(y.a)(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new me,n=t,i=this.v0,r=this.v1,a=this.v2;return n.set(Ls(e,i.x,r.x,a.x),Ls(e,i.y,r.y,a.y)),n}},{key:"copy",value:function(e){return h(Object(u.a)(n.prototype),"copy",this).call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}},{key:"toJSON",value:function(){var e=h(Object(u.a)(n.prototype),"toJSON",this).call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}},{key:"fromJSON",value:function(e){return h(Object(u.a)(n.prototype),"fromJSON",this).call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}]),n}(bs);Bs.prototype.isQuadraticBezierCurve=!0;var Fs=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Ee,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Ee,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Ee;return Object(v.a)(this,n),(e=t.call(this)).type="QuadraticBezierCurve3",e.v0=i,e.v1=r,e.v2=a,e}return Object(y.a)(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Ee,n=t,i=this.v0,r=this.v1,a=this.v2;return n.set(Ls(e,i.x,r.x,a.x),Ls(e,i.y,r.y,a.y),Ls(e,i.z,r.z,a.z)),n}},{key:"copy",value:function(e){return h(Object(u.a)(n.prototype),"copy",this).call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}},{key:"toJSON",value:function(){var e=h(Object(u.a)(n.prototype),"toJSON",this).call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}},{key:"fromJSON",value:function(e){return h(Object(u.a)(n.prototype),"fromJSON",this).call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}]),n}(bs);Fs.prototype.isQuadraticBezierCurve3=!0;var Ns=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return Object(v.a)(this,n),(e=t.call(this)).type="SplineCurve",e.points=i,e}return Object(y.a)(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new me,n=t,i=this.points,r=(i.length-1)*e,a=Math.floor(r),o=r-a,s=i[0===a?a:a-1],l=i[a],c=i[a>i.length-2?i.length-1:a+1],u=i[a>i.length-3?i.length-1:a+2];return n.set(Ps(o,s.x,l.x,c.x,u.x),Ps(o,s.y,l.y,c.y,u.y)),n}},{key:"copy",value:function(e){h(Object(u.a)(n.prototype),"copy",this).call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++){var r=e.points[t];this.points.push(r.clone())}return this}},{key:"toJSON",value:function(){var e=h(Object(u.a)(n.prototype),"toJSON",this).call(this);e.points=[];for(var t=0,i=this.points.length;t<i;t++){var r=this.points[t];e.points.push(r.toArray())}return e}},{key:"fromJSON",value:function(e){h(Object(u.a)(n.prototype),"fromJSON",this).call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++){var r=e.points[t];this.points.push((new me).fromArray(r))}return this}}]),n}(bs);Ns.prototype.isSplineCurve=!0;var Us=Object.freeze({__proto__:null,ArcCurve:Ss,CatmullRomCurve3:Cs,CubicBezierCurve:Rs,CubicBezierCurve3:zs,EllipseCurve:ws,LineCurve:Ds,LineCurve3:Os,QuadraticBezierCurve:Bs,QuadraticBezierCurve3:Fs,SplineCurve:Ns}),Vs=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e){var i;return Object(v.a)(this,n),(i=t.call(this)).type="Path",i.currentPoint=new me,e&&i.setFromPoints(e),i}return Object(y.a)(n,[{key:"setFromPoints",value:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}},{key:"moveTo",value:function(e,t){return this.currentPoint.set(e,t),this}},{key:"lineTo",value:function(e,t){var n=new Ds(this.currentPoint.clone(),new me(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}},{key:"quadraticCurveTo",value:function(e,t,n,i){var r=new Bs(this.currentPoint.clone(),new me(e,t),new me(n,i));return this.curves.push(r),this.currentPoint.set(n,i),this}},{key:"bezierCurveTo",value:function(e,t,n,i,r,a){var o=new Rs(this.currentPoint.clone(),new me(e,t),new me(n,i),new me(r,a));return this.curves.push(o),this.currentPoint.set(r,a),this}},{key:"splineThru",value:function(e){var t=[this.currentPoint.clone()].concat(e),n=new Ns(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}},{key:"arc",value:function(e,t,n,i,r,a){var o=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(e+o,t+s,n,i,r,a),this}},{key:"absarc",value:function(e,t,n,i,r,a){return this.absellipse(e,t,n,n,i,r,a),this}},{key:"ellipse",value:function(e,t,n,i,r,a,o,s){var l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,n,i,r,a,o,s),this}},{key:"absellipse",value:function(e,t,n,i,r,a,o,s){var l=new ws(e,t,n,i,r,a,o,s);if(this.curves.length>0){var c=l.getPoint(0);c.equals(this.currentPoint)||this.lineTo(c.x,c.y)}this.curves.push(l);var u=l.getPoint(1);return this.currentPoint.copy(u),this}},{key:"copy",value:function(e){return h(Object(u.a)(n.prototype),"copy",this).call(this,e),this.currentPoint.copy(e.currentPoint),this}},{key:"toJSON",value:function(){var e=h(Object(u.a)(n.prototype),"toJSON",this).call(this);return e.currentPoint=this.currentPoint.toArray(),e}},{key:"fromJSON",value:function(e){return h(Object(u.a)(n.prototype),"fromJSON",this).call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}]),n}(function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(){var e;return Object(v.a)(this,n),(e=t.call(this)).type="CurvePath",e.curves=[],e.autoClose=!1,e}return Object(y.a)(n,[{key:"add",value:function(e){this.curves.push(e)}},{key:"closePath",value:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Ds(t,e))}},{key:"getPoint",value:function(e){for(var t=e*this.getLength(),n=this.getCurveLengths(),i=0;i<n.length;){if(n[i]>=t){var r=n[i]-t,a=this.curves[i],o=a.getLength(),s=0===o?0:1-r/o;return a.getPointAt(s)}i++}return null}},{key:"getLength",value:function(){var e=this.getCurveLengths();return e[e.length-1]}},{key:"updateArcLengths",value:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}},{key:"getCurveLengths",value:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,n=0,i=this.curves.length;n<i;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}},{key:"getSpacedPoints",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:40,t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}},{key:"getPoints",value:function(){for(var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12,n=[],i=0,r=this.curves;i<r.length;i++)for(var a=r[i],o=a&&a.isEllipseCurve?2*t:a&&(a.isLineCurve||a.isLineCurve3)?1:a&&a.isSplineCurve?t*a.points.length:t,s=a.getPoints(o),l=0;l<s.length;l++){var c=s[l];e&&e.equals(c)||(n.push(c),e=c)}return this.autoClose&&n.length>1&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n}},{key:"copy",value:function(e){h(Object(u.a)(n.prototype),"copy",this).call(this,e),this.curves=[];for(var t=0,i=e.curves.length;t<i;t++){var r=e.curves[t];this.curves.push(r.clone())}return this.autoClose=e.autoClose,this}},{key:"toJSON",value:function(){var e=h(Object(u.a)(n.prototype),"toJSON",this).call(this);e.autoClose=this.autoClose,e.curves=[];for(var t=0,i=this.curves.length;t<i;t++){var r=this.curves[t];e.curves.push(r.toJSON())}return e}},{key:"fromJSON",value:function(e){h(Object(u.a)(n.prototype),"fromJSON",this).call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var t=0,i=e.curves.length;t<i;t++){var r=e.curves[t];this.curves.push((new Us[r.type]).fromJSON(r))}return this}}]),n}(bs)),js=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e){var i;return Object(v.a)(this,n),(i=t.call(this,e)).uuid=ce(),i.type="Shape",i.holes=[],i}return Object(y.a)(n,[{key:"getPointsHoles",value:function(e){for(var t=[],n=0,i=this.holes.length;n<i;n++)t[n]=this.holes[n].getPoints(e);return t}},{key:"extractPoints",value:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}},{key:"copy",value:function(e){h(Object(u.a)(n.prototype),"copy",this).call(this,e),this.holes=[];for(var t=0,i=e.holes.length;t<i;t++){var r=e.holes[t];this.holes.push(r.clone())}return this}},{key:"toJSON",value:function(){var e=h(Object(u.a)(n.prototype),"toJSON",this).call(this);e.uuid=this.uuid,e.holes=[];for(var t=0,i=this.holes.length;t<i;t++){var r=this.holes[t];e.holes.push(r.toJSON())}return e}},{key:"fromJSON",value:function(e){h(Object(u.a)(n.prototype),"fromJSON",this).call(this,e),this.uuid=e.uuid,this.holes=[];for(var t=0,i=e.holes.length;t<i;t++){var r=e.holes[t];this.holes.push((new Vs).fromJSON(r))}return this}}]),n}(Vs),Gs=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e){var i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return Object(v.a)(this,n),(i=t.call(this)).type="Light",i.color=new Jt(e),i.intensity=r,i}return Object(y.a)(n,[{key:"dispose",value:function(){}},{key:"copy",value:function(e){return h(Object(u.a)(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this}},{key:"toJSON",value:function(e){var t=h(Object(u.a)(n.prototype),"toJSON",this).call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}]),n}(kt);Gs.prototype.isLight=!0;var Hs=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e,i,r){var a;return Object(v.a)(this,n),(a=t.call(this,e,r)).type="HemisphereLight",a.position.copy(kt.DefaultUp),a.updateMatrix(),a.groundColor=new Jt(i),a}return Object(y.a)(n,[{key:"copy",value:function(e){return Gs.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}]),n}(Gs);Hs.prototype.isHemisphereLight=!0;var Ws=new nt,qs=new Ee,Zs=new Ee,$s=function(){function e(t){Object(v.a)(this,e),this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new me(512,512),this.map=null,this.mapPass=null,this.matrix=new nt,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Zn,this._frameExtents=new me(1,1),this._viewportCount=1,this._viewports=[new we(0,0,1,1)]}return Object(y.a)(e,[{key:"getViewportCount",value:function(){return this._viewportCount}},{key:"getFrustum",value:function(){return this._frustum}},{key:"updateMatrices",value:function(e){var t=this.camera,n=this.matrix;qs.setFromMatrixPosition(e.matrixWorld),t.position.copy(qs),Zs.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(Zs),t.updateMatrixWorld(),Ws.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Ws),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(t.projectionMatrix),n.multiply(t.matrixWorldInverse)}},{key:"getViewport",value:function(e){return this._viewports[e]}},{key:"getFrameExtents",value:function(){return this._frameExtents}},{key:"dispose",value:function(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}},{key:"copy",value:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"toJSON",value:function(){var e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}]),e}(),Xs=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(){var e;return Object(v.a)(this,n),(e=t.call(this,new Un(50,1,.5,500))).focus=1,e}return Object(y.a)(n,[{key:"updateMatrices",value:function(e){var t=this.camera,i=2*le*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,a=e.distance||t.far;i===t.fov&&r===t.aspect&&a===t.far||(t.fov=i,t.aspect=r,t.far=a,t.updateProjectionMatrix()),h(Object(u.a)(n.prototype),"updateMatrices",this).call(this,e)}},{key:"copy",value:function(e){return h(Object(u.a)(n.prototype),"copy",this).call(this,e),this.focus=e.focus,this}}]),n}($s);Xs.prototype.isSpotLightShadow=!0;var Ys=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e,i){var r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Math.PI/3,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;return Object(v.a)(this,n),(r=t.call(this,e,i)).type="SpotLight",r.position.copy(kt.DefaultUp),r.updateMatrix(),r.target=new kt,r.distance=a,r.angle=o,r.penumbra=s,r.decay=l,r.shadow=new Xs,r}return Object(y.a)(n,[{key:"power",get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}},{key:"dispose",value:function(){this.shadow.dispose()}},{key:"copy",value:function(e){return h(Object(u.a)(n.prototype),"copy",this).call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}]),n}(Gs);Ys.prototype.isSpotLight=!0;var Js=new nt,Ks=new Ee,Qs=new Ee,el=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(){var e;return Object(v.a)(this,n),(e=t.call(this,new Un(90,1,.5,500)))._frameExtents=new me(4,2),e._viewportCount=6,e._viewports=[new we(2,1,1,1),new we(0,1,1,1),new we(3,1,1,1),new we(1,1,1,1),new we(3,0,1,1),new we(1,0,1,1)],e._cubeDirections=[new Ee(1,0,0),new Ee(-1,0,0),new Ee(0,0,1),new Ee(0,0,-1),new Ee(0,1,0),new Ee(0,-1,0)],e._cubeUps=[new Ee(0,1,0),new Ee(0,1,0),new Ee(0,1,0),new Ee(0,1,0),new Ee(0,0,1),new Ee(0,0,-1)],e}return Object(y.a)(n,[{key:"updateMatrices",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.camera,i=this.matrix,r=e.distance||n.far;r!==n.far&&(n.far=r,n.updateProjectionMatrix()),Ks.setFromMatrixPosition(e.matrixWorld),n.position.copy(Ks),Qs.copy(n.position),Qs.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(Qs),n.updateMatrixWorld(),i.makeTranslation(-Ks.x,-Ks.y,-Ks.z),Js.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Js)}}]),n}($s);el.prototype.isPointLightShadow=!0;var tl=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e,i){var r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return Object(v.a)(this,n),(r=t.call(this,e,i)).type="PointLight",r.distance=a,r.decay=o,r.shadow=new el,r}return Object(y.a)(n,[{key:"power",get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}},{key:"dispose",value:function(){this.shadow.dispose()}},{key:"copy",value:function(e){return h(Object(u.a)(n.prototype),"copy",this).call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}]),n}(Gs);tl.prototype.isPointLight=!0;var nl=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.1,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2e3;return Object(v.a)(this,n),(e=t.call(this)).type="OrthographicCamera",e.zoom=1,e.view=null,e.left=i,e.right=r,e.top=a,e.bottom=o,e.near=s,e.far=l,e.updateProjectionMatrix(),e}return Object(y.a)(n,[{key:"copy",value:function(e,t){return h(Object(u.a)(n.prototype),"copy",this).call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}},{key:"setViewOffset",value:function(e,t,n,i,r,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}},{key:"clearViewOffset",value:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}},{key:"updateProjectionMatrix",value:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2,r=n-e,a=n+e,o=i+t,s=i-t;if(null!==this.view&&this.view.enabled){var l=(this.right-this.left)/this.view.fullWidth/this.zoom,c=(this.top-this.bottom)/this.view.fullHeight/this.zoom;a=(r+=l*this.view.offsetX)+l*this.view.width,s=(o-=c*this.view.offsetY)-c*this.view.height}this.projectionMatrix.makeOrthographic(r,a,o,s,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}},{key:"toJSON",value:function(e){var t=h(Object(u.a)(n.prototype),"toJSON",this).call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}]),n}(Nn);nl.prototype.isOrthographicCamera=!0;var il=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(){return Object(v.a)(this,n),t.call(this,new nl(-5,5,5,-5,.5,500))}return n}($s);il.prototype.isDirectionalLightShadow=!0;var rl=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e,i){var r;return Object(v.a)(this,n),(r=t.call(this,e,i)).type="DirectionalLight",r.position.copy(kt.DefaultUp),r.updateMatrix(),r.target=new kt,r.shadow=new il,r}return Object(y.a)(n,[{key:"dispose",value:function(){this.shadow.dispose()}},{key:"copy",value:function(e){return h(Object(u.a)(n.prototype),"copy",this).call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}]),n}(Gs);rl.prototype.isDirectionalLight=!0;var al=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e,i){var r;return Object(v.a)(this,n),(r=t.call(this,e,i)).type="AmbientLight",r}return n}(Gs);al.prototype.isAmbientLight=!0;var ol=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e,i){var r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return Object(v.a)(this,n),(r=t.call(this,e,i)).type="RectAreaLight",r.width=a,r.height=o,r}return Object(y.a)(n,[{key:"copy",value:function(e){return h(Object(u.a)(n.prototype),"copy",this).call(this,e),this.width=e.width,this.height=e.height,this}},{key:"toJSON",value:function(e){var t=h(Object(u.a)(n.prototype),"toJSON",this).call(this,e);return t.object.width=this.width,t.object.height=this.height,t}}]),n}(Gs);ol.prototype.isRectAreaLight=!0;var sl=function(){function e(){Object(v.a)(this,e),this.coefficients=[];for(var t=0;t<9;t++)this.coefficients.push(new Ee)}return Object(y.a)(e,[{key:"set",value:function(e){for(var t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}},{key:"zero",value:function(){for(var e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}},{key:"getAt",value:function(e,t){var n=e.x,i=e.y,r=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.282095),t.addScaledVector(a[1],.488603*i),t.addScaledVector(a[2],.488603*r),t.addScaledVector(a[3],.488603*n),t.addScaledVector(a[4],n*i*1.092548),t.addScaledVector(a[5],i*r*1.092548),t.addScaledVector(a[6],.315392*(3*r*r-1)),t.addScaledVector(a[7],n*r*1.092548),t.addScaledVector(a[8],.546274*(n*n-i*i)),t}},{key:"getIrradianceAt",value:function(e,t){var n=e.x,i=e.y,r=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.886227),t.addScaledVector(a[1],1.023328*i),t.addScaledVector(a[2],1.023328*r),t.addScaledVector(a[3],1.023328*n),t.addScaledVector(a[4],.858086*n*i),t.addScaledVector(a[5],.858086*i*r),t.addScaledVector(a[6],.743125*r*r-.247708),t.addScaledVector(a[7],.858086*n*r),t.addScaledVector(a[8],.429043*(n*n-i*i)),t}},{key:"add",value:function(e){for(var t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}},{key:"addScaledSH",value:function(e,t){for(var n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}},{key:"scale",value:function(e){for(var t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}},{key:"lerp",value:function(e,t){for(var n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}},{key:"equals",value:function(e){for(var t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}},{key:"copy",value:function(e){return this.set(e.coefficients)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"fromArray",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.coefficients,i=0;i<9;i++)n[i].fromArray(e,t+3*i);return this}},{key:"toArray",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.coefficients,i=0;i<9;i++)n[i].toArray(e,t+3*i);return e}}],[{key:"getBasisAt",value:function(e,t){var n=e.x,i=e.y,r=e.z;t[0]=.282095,t[1]=.488603*i,t[2]=.488603*r,t[3]=.488603*n,t[4]=1.092548*n*i,t[5]=1.092548*i*r,t[6]=.315392*(3*r*r-1),t[7]=1.092548*n*r,t[8]=.546274*(n*n-i*i)}}]),e}();sl.prototype.isSphericalHarmonics3=!0;var ll=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new sl,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return Object(v.a)(this,n),(e=t.call(this,void 0,r)).sh=i,e}return Object(y.a)(n,[{key:"copy",value:function(e){return h(Object(u.a)(n.prototype),"copy",this).call(this,e),this.sh.copy(e.sh),this}},{key:"fromJSON",value:function(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}},{key:"toJSON",value:function(e){var t=h(Object(u.a)(n.prototype),"toJSON",this).call(this,e);return t.object.sh=this.sh.toArray(),t}}]),n}(Gs);ll.prototype.isLightProbe=!0;var cl=function(){function e(){Object(v.a)(this,e)}return Object(y.a)(e,null,[{key:"decodeText",value:function(e){if("undefined"!==typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",n=0,i=e.length;n<i;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(r){return t}}},{key:"extractUrlBase",value:function(e){var t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}}]),e}(),ul=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(){var e;return Object(v.a)(this,n),(e=t.call(this)).type="InstancedBufferGeometry",e.instanceCount=1/0,e}return Object(y.a)(n,[{key:"copy",value:function(e){return h(Object(u.a)(n.prototype),"copy",this).call(this,e),this.instanceCount=e.instanceCount,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"toJSON",value:function(){var e=h(Object(u.a)(n.prototype),"toJSON",this).call(this,this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}]),n}(fn);ul.prototype.isInstancedBufferGeometry=!0;var hl=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e,i,r,a){var o;return Object(v.a)(this,n),"number"===typeof r&&(a=r,r=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),(o=t.call(this,e,i,r)).meshPerAttribute=a||1,o}return Object(y.a)(n,[{key:"copy",value:function(e){return h(Object(u.a)(n.prototype),"copy",this).call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}},{key:"toJSON",value:function(){var e=h(Object(u.a)(n.prototype),"toJSON",this).call(this);return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}]),n}(tn);hl.prototype.isInstancedBufferAttribute=!0;(function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e){var i;return Object(v.a)(this,n),i=t.call(this,e),"undefined"===typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"===typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),i.options={premultiplyAlpha:"none"},i}return Object(y.a)(n,[{key:"setOptions",value:function(e){return this.options=e,this}},{key:"load",value:function(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var r=this,a=ds.get(e);if(void 0!==a)return r.manager.itemStart(e),setTimeout((function(){t&&t(a),r.manager.itemEnd(e)}),0),a;var o={};o.credentials="anonymous"===this.crossOrigin?"same-origin":"include",o.headers=this.requestHeader,fetch(e,o).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e,Object.assign(r.options,{colorSpaceConversion:"none"}))})).then((function(n){ds.add(e,n),t&&t(n),r.manager.itemEnd(e)})).catch((function(t){i&&i(t),r.manager.itemError(e),r.manager.itemEnd(e)})),r.manager.itemStart(e)}}]),n})(ms).prototype.isImageBitmapLoader=!0;var dl=function(){function e(){Object(v.a)(this,e),this.type="ShapePath",this.color=new Jt,this.subPaths=[],this.currentPath=null}return Object(y.a)(e,[{key:"moveTo",value:function(e,t){return this.currentPath=new Vs,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}},{key:"lineTo",value:function(e,t){return this.currentPath.lineTo(e,t),this}},{key:"quadraticCurveTo",value:function(e,t,n,i){return this.currentPath.quadraticCurveTo(e,t,n,i),this}},{key:"bezierCurveTo",value:function(e,t,n,i,r,a){return this.currentPath.bezierCurveTo(e,t,n,i,r,a),this}},{key:"splineThru",value:function(e){return this.currentPath.splineThru(e),this}},{key:"toShapes",value:function(e,t){function n(e){for(var t=[],n=0,i=e.length;n<i;n++){var r=e[n],a=new js;a.curves=r.curves,t.push(a)}return t}function i(e,t){for(var n=t.length,i=!1,r=n-1,a=0;a<n;r=a++){var o=t[r],s=t[a],l=s.x-o.x,c=s.y-o.y;if(Math.abs(c)>Number.EPSILON){if(c<0&&(o=t[a],l=-l,s=t[r],c=-c),e.y<o.y||e.y>s.y)continue;if(e.y===o.y){if(e.x===o.x)return!0}else{var u=c*(e.x-o.x)-l*(e.y-o.y);if(0===u)return!0;if(u<0)continue;i=!i}}else{if(e.y!==o.y)continue;if(s.x<=e.x&&e.x<=o.x||o.x<=e.x&&e.x<=s.x)return!0}}return i}var r,a,o,s=Do.isClockWise,l=this.subPaths;if(0===l.length)return[];if(!0===t)return n(l);var c=[];if(1===l.length)return a=l[0],(o=new js).curves=a.curves,c.push(o),c;var u=!s(l[0].getPoints());u=e?!u:u;var h,d,p=[],f=[],m=[],g=0;f[g]=void 0,m[g]=[];for(var v=0,y=l.length;v<y;v++)r=s(h=(a=l[v]).getPoints()),(r=e?!r:r)?(!u&&f[g]&&g++,f[g]={s:new js,p:h},f[g].s.curves=a.curves,u&&g++,m[g]=[]):m[g].push({h:a,p:h[0]});if(!f[0])return n(l);if(f.length>1){for(var _=!1,x=[],b=0,w=f.length;b<w;b++)p[b]=[];for(var S=0,T=f.length;S<T;S++)for(var E=m[S],M=0;M<E.length;M++){for(var k=E[M],A=!0,C=0;C<f.length;C++)i(k.p,f[C].p)&&(S!==C&&x.push({froms:S,tos:C,hole:M}),A?(A=!1,p[C].push(k)):_=!0);A&&p[S].push(k)}x.length>0&&(_||(m=p))}for(var P=0,L=f.length;P<L;P++){o=f[P].s,c.push(o);for(var I=0,R=(d=m[P]).length;I<R;I++)o.holes.push(d[I].h)}return c}}]),e}(),pl=function(){function e(t){Object(v.a)(this,e),this.type="Font",this.data=t}return Object(y.a)(e,[{key:"generateShapes",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,n=[],i=fl(e,t,this.data),r=0,a=i.length;r<a;r++)Array.prototype.push.apply(n,i[r].toShapes());return n}}]),e}();function fl(e,t,n){for(var i=Array.from(e),r=t/n.resolution,a=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*r,o=[],s=0,l=0,c=0;c<i.length;c++){var u=i[c];if("\n"===u)s=0,l-=a;else{var h=ml(u,r,s,l,n);s+=h.offsetX,o.push(h.path)}}return o}function ml(e,t,n,i,r){var a=r.glyphs[e]||r.glyphs["?"];if(a){var o,s,l,c,u,h,d,p,f=new dl;if(a.o)for(var m=a._cachedOutline||(a._cachedOutline=a.o.split(" ")),g=0,v=m.length;g<v;){switch(m[g++]){case"m":o=m[g++]*t+n,s=m[g++]*t+i,f.moveTo(o,s);break;case"l":o=m[g++]*t+n,s=m[g++]*t+i,f.lineTo(o,s);break;case"q":l=m[g++]*t+n,c=m[g++]*t+i,u=m[g++]*t+n,h=m[g++]*t+i,f.quadraticCurveTo(u,h,l,c);break;case"b":l=m[g++]*t+n,c=m[g++]*t+i,u=m[g++]*t+n,h=m[g++]*t+i,d=m[g++]*t+n,p=m[g++]*t+i,f.bezierCurveTo(u,h,d,p,l,c)}}return{offsetX:a.ha*t,path:f}}console.error('THREE.Font: character "'+e+'" does not exists in font family '+r.familyName+".")}pl.prototype.isFont=!0;var gl,vl=function(){return void 0===gl&&(gl=new(window.AudioContext||window.webkitAudioContext)),gl},yl=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e){return Object(v.a)(this,n),t.call(this,e)}return Object(y.a)(n,[{key:"load",value:function(e,t,n,i){var r=this,a=new vs(this.manager);a.setResponseType("arraybuffer"),a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(n){try{var a=n.slice(0);vl().decodeAudioData(a,(function(e){t(e)}))}catch(o){i?i(o):console.error(o),r.manager.itemError(e)}}),n,i)}}]),n}(ms);(function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e,i){var r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;Object(v.a)(this,n),r=t.call(this,void 0,a);var o=(new Jt).set(e),s=(new Jt).set(i),l=new Ee(o.r,o.g,o.b),c=new Ee(s.r,s.g,s.b),u=Math.sqrt(Math.PI),h=u*Math.sqrt(.75);return r.sh.coefficients[0].copy(l).add(c).multiplyScalar(u),r.sh.coefficients[1].copy(l).sub(c).multiplyScalar(h),r}return n})(ll).prototype.isHemisphereLightProbe=!0,function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e){var i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;Object(v.a)(this,n),i=t.call(this,void 0,r);var a=(new Jt).set(e);return i.sh.coefficients[0].set(a.r,a.g,a.b).multiplyScalar(2*Math.sqrt(Math.PI)),i}return n}(ll).prototype.isAmbientLightProbe=!0;var _l=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e){var i;return Object(v.a)(this,n),(i=t.call(this)).type="Audio",i.listener=e,i.context=e.context,i.gain=i.context.createGain(),i.gain.connect(e.getInput()),i.autoplay=!1,i.buffer=null,i.detune=0,i.loop=!1,i.loopStart=0,i.loopEnd=0,i.offset=0,i.duration=void 0,i.playbackRate=1,i.isPlaying=!1,i.hasPlaybackControl=!0,i.source=null,i.sourceType="empty",i._startedAt=0,i._progress=0,i._connected=!1,i.filters=[],i}return Object(y.a)(n,[{key:"getOutput",value:function(){return this.gain}},{key:"setNodeSource",value:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}},{key:"setMediaElementSource",value:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}},{key:"setMediaStreamSource",value:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}},{key:"setBuffer",value:function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}},{key:"play",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){this._startedAt=this.context.currentTime+e;var t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")}},{key:"pause",value:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}},{key:"stop",value:function(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}},{key:"connect",value:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}},{key:"disconnect",value:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}},{key:"getFilters",value:function(){return this.filters}},{key:"setFilters",value:function(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}},{key:"setDetune",value:function(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}},{key:"getDetune",value:function(){return this.detune}},{key:"getFilter",value:function(){return this.getFilters()[0]}},{key:"setFilter",value:function(e){return this.setFilters(e?[e]:[])}},{key:"setPlaybackRate",value:function(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}},{key:"getPlaybackRate",value:function(){return this.playbackRate}},{key:"onEnded",value:function(){this.isPlaying=!1}},{key:"getLoop",value:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}},{key:"setLoop",value:function(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}},{key:"setLoopStart",value:function(e){return this.loopStart=e,this}},{key:"setLoopEnd",value:function(e){return this.loopEnd=e,this}},{key:"getVolume",value:function(){return this.gain.gain.value}},{key:"setVolume",value:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}]),n}(kt),xl=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2048;Object(v.a)(this,e),this.analyser=t.context.createAnalyser(),this.analyser.fftSize=n,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}return Object(y.a)(e,[{key:"getFrequencyData",value:function(){return this.analyser.getByteFrequencyData(this.data),this.data}},{key:"getAverageFrequency",value:function(){for(var e=0,t=this.getFrequencyData(),n=0;n<t.length;n++)e+=t[n];return e/t.length}}]),e}(),bl=function(){function e(t,n,i){var r,a,o;switch(Object(v.a)(this,e),this.binding=t,this.valueSize=i,n){case"quaternion":r=this._slerp,a=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*i),this._workIndex=5;break;case"string":case"bool":r=this._select,a=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(5*i);break;default:r=this._lerp,a=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*i)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=a,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}return Object(y.a)(e,[{key:"accumulate",value:function(e,t){var n=this.buffer,i=this.valueSize,r=e*i+i,a=this.cumulativeWeight;if(0===a){for(var o=0;o!==i;++o)n[r+o]=n[o];a=t}else{var s=t/(a+=t);this._mixBufferRegion(n,r,0,s,i)}this.cumulativeWeight=a}},{key:"accumulateAdditive",value:function(e){var t=this.buffer,n=this.valueSize,i=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,i,0,e,n),this.cumulativeWeightAdditive+=e}},{key:"apply",value:function(e){var t=this.valueSize,n=this.buffer,i=e*t+t,r=this.cumulativeWeight,a=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){var s=t*this._origIndex;this._mixBufferRegion(n,i,s,1-r,t)}a>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*t,1,t);for(var l=t,c=t+t;l!==c;++l)if(n[l]!==n[l+t]){o.setValue(n,i);break}}},{key:"saveOriginalState",value:function(){var e=this.binding,t=this.buffer,n=this.valueSize,i=n*this._origIndex;e.getValue(t,i);for(var r=n,a=i;r!==a;++r)t[r]=t[i+r%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}},{key:"restoreOriginalState",value:function(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)}},{key:"_setAdditiveIdentityNumeric",value:function(){for(var e=this._addIndex*this.valueSize,t=e+this.valueSize,n=e;n<t;n++)this.buffer[n]=0}},{key:"_setAdditiveIdentityQuaternion",value:function(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}},{key:"_setAdditiveIdentityOther",value:function(){for(var e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize,n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}},{key:"_select",value:function(e,t,n,i,r){if(i>=.5)for(var a=0;a!==r;++a)e[t+a]=e[n+a]}},{key:"_slerp",value:function(e,t,n,i){Te.slerpFlat(e,t,e,t,e,n,i)}},{key:"_slerpAdditive",value:function(e,t,n,i,r){var a=this._workIndex*r;Te.multiplyQuaternionsFlat(e,a,e,t,e,n),Te.slerpFlat(e,t,e,t,e,a,i)}},{key:"_lerp",value:function(e,t,n,i,r){for(var a=1-i,o=0;o!==r;++o){var s=t+o;e[s]=e[s]*a+e[n+o]*i}}},{key:"_lerpAdditive",value:function(e,t,n,i,r){for(var a=0;a!==r;++a){var o=t+a;e[o]=e[o]+e[n+a]*i}}}]),e}(),wl="\\[\\]\\.:\\/",Sl=new RegExp("[\\[\\]\\.:\\/]","g"),Tl="[^\\[\\]\\.:\\/]",El="[^"+wl.replace("\\.","")+"]",Ml=/((?:WC+[\/:])*)/.source.replace("WC",Tl),kl=/(WCOD+)?/.source.replace("WCOD",El),Al=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Tl),Cl=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Tl),Pl=new RegExp("^"+Ml+kl+Al+Cl+"$"),Ll=["material","materials","bones"],Il=function(){function e(t,n,i){Object(v.a)(this,e);var r=i||Rl.parseTrackName(n);this._targetGroup=t,this._bindings=t.subscribe_(n,r)}return Object(y.a)(e,[{key:"getValue",value:function(e,t){this.bind();var n=this._targetGroup.nCachedObjects_,i=this._bindings[n];void 0!==i&&i.getValue(e,t)}},{key:"setValue",value:function(e,t){for(var n=this._bindings,i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(e,t)}},{key:"bind",value:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}},{key:"unbind",value:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}]),e}(),Rl=function(){function e(t,n,i){Object(v.a)(this,e),this.path=n,this.parsedPath=i||e.parseTrackName(n),this.node=e.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}return Object(y.a)(e,[{key:"_getValue_unavailable",value:function(){}},{key:"_setValue_unavailable",value:function(){}},{key:"_getValue_direct",value:function(e,t){e[t]=this.node[this.propertyName]}},{key:"_getValue_array",value:function(e,t){for(var n=this.resolvedProperty,i=0,r=n.length;i!==r;++i)e[t++]=n[i]}},{key:"_getValue_arrayElement",value:function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}},{key:"_getValue_toArray",value:function(e,t){this.resolvedProperty.toArray(e,t)}},{key:"_setValue_direct",value:function(e,t){this.targetObject[this.propertyName]=e[t]}},{key:"_setValue_direct_setNeedsUpdate",value:function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}},{key:"_setValue_direct_setMatrixWorldNeedsUpdate",value:function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_setValue_array",value:function(e,t){for(var n=this.resolvedProperty,i=0,r=n.length;i!==r;++i)n[i]=e[t++]}},{key:"_setValue_array_setNeedsUpdate",value:function(e,t){for(var n=this.resolvedProperty,i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.needsUpdate=!0}},{key:"_setValue_array_setMatrixWorldNeedsUpdate",value:function(e,t){for(var n=this.resolvedProperty,i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_setValue_arrayElement",value:function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}},{key:"_setValue_arrayElement_setNeedsUpdate",value:function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}},{key:"_setValue_arrayElement_setMatrixWorldNeedsUpdate",value:function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_setValue_fromArray",value:function(e,t){this.resolvedProperty.fromArray(e,t)}},{key:"_setValue_fromArray_setNeedsUpdate",value:function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}},{key:"_setValue_fromArray_setMatrixWorldNeedsUpdate",value:function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_getValue_unbound",value:function(e,t){this.bind(),this.getValue(e,t)}},{key:"_setValue_unbound",value:function(e,t){this.bind(),this.setValue(e,t)}},{key:"bind",value:function(){var t=this.node,n=this.parsedPath,i=n.objectName,r=n.propertyName,a=n.propertyIndex;if(t||(t=e.findNode(this.rootNode,n.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,t){if(i){var o=n.objectIndex;switch(i){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(var s=0;s<t.length;s++)if(t[s].name===o){o=s;break}break;default:if(void 0===t[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[i]}if(void 0!==o){if(void 0===t[o])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[o]}}var l=t[r];if(void 0!==l){var c=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?c=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(c=this.Versioning.MatrixWorldNeedsUpdate);var u=this.BindingType.Direct;if(void 0!==a){if("morphTargetInfluences"===r){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[a]&&(a=t.morphTargetDictionary[a])}u=this.BindingType.ArrayElement,this.resolvedProperty=l,this.propertyIndex=a}else void 0!==l.fromArray&&void 0!==l.toArray?(u=this.BindingType.HasFromToArray,this.resolvedProperty=l):Array.isArray(l)?(u=this.BindingType.EntireArray,this.resolvedProperty=l):this.propertyName=r;this.getValue=this.GetterByBindingType[u],this.setValue=this.SetterByBindingTypeAndVersioning[u][c]}else{var h=n.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+h+"."+r+" but it wasn't found.",t)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")}},{key:"unbind",value:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}],[{key:"create",value:function(t,n,i){return t&&t.isAnimationObjectGroup?new e.Composite(t,n,i):new e(t,n,i)}},{key:"sanitizeNodeName",value:function(e){return e.replace(/\s/g,"_").replace(Sl,"")}},{key:"parseTrackName",value:function(e){var t=Pl.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);var n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){var r=n.nodeName.substring(i+1);-1!==Ll.indexOf(r)&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=r)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}},{key:"findNode",value:function(e,t){if(!t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){var n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){var i=function e(n){for(var i=0;i<n.length;i++){var r=n[i];if(r.name===t||r.uuid===t)return r;var a=e(r.children);if(a)return a}return null}(e.children);if(i)return i}return null}}]),e}();Rl.Composite=Il,Rl.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Rl.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Rl.prototype.GetterByBindingType=[Rl.prototype._getValue_direct,Rl.prototype._getValue_array,Rl.prototype._getValue_arrayElement,Rl.prototype._getValue_toArray],Rl.prototype.SetterByBindingTypeAndVersioning=[[Rl.prototype._setValue_direct,Rl.prototype._setValue_direct_setNeedsUpdate,Rl.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Rl.prototype._setValue_array,Rl.prototype._setValue_array_setNeedsUpdate,Rl.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Rl.prototype._setValue_arrayElement,Rl.prototype._setValue_arrayElement_setNeedsUpdate,Rl.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Rl.prototype._setValue_fromArray,Rl.prototype._setValue_fromArray_setNeedsUpdate,Rl.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]],function(){function e(){Object(v.a)(this,e),this.uuid=ce(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var t={};this._indicesByUUID=t;for(var n=0,i=arguments.length;n!==i;++n)t[arguments[n].uuid]=n;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var r=this;this.stats={objects:{get total(){return r._objects.length},get inUse(){return this.total-r.nCachedObjects_}},get bindingsPerObject(){return r._bindings.length}}}return Object(y.a)(e,[{key:"add",value:function(){for(var e=this._objects,t=this._indicesByUUID,n=this._paths,i=this._parsedPaths,r=this._bindings,a=r.length,o=void 0,s=e.length,l=this.nCachedObjects_,c=0,u=arguments.length;c!==u;++c){var h=arguments[c],d=h.uuid,p=t[d];if(void 0===p){p=s++,t[d]=p,e.push(h);for(var f=0,m=a;f!==m;++f)r[f].push(new Rl(h,n[f],i[f]))}else if(p<l){o=e[p];var g=--l,v=e[g];t[v.uuid]=p,e[p]=v,t[d]=g,e[g]=h;for(var y=0,_=a;y!==_;++y){var x=r[y],b=x[g],w=x[p];x[p]=b,void 0===w&&(w=new Rl(h,n[y],i[y])),x[g]=w}}else e[p]!==o&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l}},{key:"remove",value:function(){for(var e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length,r=this.nCachedObjects_,a=0,o=arguments.length;a!==o;++a){var s=arguments[a],l=s.uuid,c=t[l];if(void 0!==c&&c>=r){var u=r++,h=e[u];t[h.uuid]=c,e[c]=h,t[l]=u,e[u]=s;for(var d=0,p=i;d!==p;++d){var f=n[d],m=f[u],g=f[c];f[c]=m,f[u]=g}}}this.nCachedObjects_=r}},{key:"uncache",value:function(){for(var e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length,r=this.nCachedObjects_,a=e.length,o=0,s=arguments.length;o!==s;++o){var l=arguments[o],c=l.uuid,u=t[c];if(void 0!==u)if(delete t[c],u<r){var h=--r,d=e[h],p=--a,f=e[p];t[d.uuid]=u,e[u]=d,t[f.uuid]=h,e[h]=f,e.pop();for(var m=0,g=i;m!==g;++m){var v=n[m],y=v[h],_=v[p];v[u]=y,v[h]=_,v.pop()}}else{var x=--a,b=e[x];x>0&&(t[b.uuid]=u),e[u]=b,e.pop();for(var w=0,S=i;w!==S;++w){var T=n[w];T[u]=T[x],T.pop()}}}this.nCachedObjects_=r}},{key:"subscribe_",value:function(e,t){var n=this._bindingsIndicesByPath,i=n[e],r=this._bindings;if(void 0!==i)return r[i];var a=this._paths,o=this._parsedPaths,s=this._objects,l=s.length,c=this.nCachedObjects_,u=new Array(l);i=r.length,n[e]=i,a.push(e),o.push(t),r.push(u);for(var h=c,d=s.length;h!==d;++h){var p=s[h];u[h]=new Rl(p,e,t)}return u}},{key:"unsubscribe_",value:function(e){var t=this._bindingsIndicesByPath,n=t[e];if(void 0!==n){var i=this._paths,r=this._parsedPaths,a=this._bindings,o=a.length-1,s=a[o];t[e[o]]=n,a[n]=s,a.pop(),r[n]=r[o],r.pop(),i[n]=i[o],i.pop()}}}]),e}().prototype.isAnimationObjectGroup=!0;var zl=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n.blendMode;Object(v.a)(this,e),this._mixer=t,this._clip=n,this._localRoot=i,this.blendMode=r;for(var a=n.tracks,o=a.length,s=new Array(o),l={endingStart:W,endingEnd:W},c=0;c!==o;++c){var u=a[c].createInterpolant(null);s[c]=u,u.settings=l}this._interpolantSettings=l,this._interpolants=s,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}return Object(y.a)(e,[{key:"play",value:function(){return this._mixer._activateAction(this),this}},{key:"stop",value:function(){return this._mixer._deactivateAction(this),this.reset()}},{key:"reset",value:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}},{key:"isRunning",value:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}},{key:"isScheduled",value:function(){return this._mixer._isActiveAction(this)}},{key:"startAt",value:function(e){return this._startTime=e,this}},{key:"setLoop",value:function(e,t){return this.loop=e,this.repetitions=t,this}},{key:"setEffectiveWeight",value:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}},{key:"getEffectiveWeight",value:function(){return this._effectiveWeight}},{key:"fadeIn",value:function(e){return this._scheduleFading(e,0,1)}},{key:"fadeOut",value:function(e){return this._scheduleFading(e,1,0)}},{key:"crossFadeFrom",value:function(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){var i=this._clip.duration,r=e._clip.duration,a=r/i,o=i/r;e.warp(1,a,t),this.warp(o,1,t)}return this}},{key:"crossFadeTo",value:function(e,t,n){return e.crossFadeFrom(this,t,n)}},{key:"stopFading",value:function(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}},{key:"setEffectiveTimeScale",value:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}},{key:"getEffectiveTimeScale",value:function(){return this._effectiveTimeScale}},{key:"setDuration",value:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}},{key:"syncWith",value:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}},{key:"halt",value:function(e){return this.warp(this._effectiveTimeScale,0,e)}},{key:"warp",value:function(e,t,n){var i=this._mixer,r=i.time,a=this.timeScale,o=this._timeScaleInterpolant;null===o&&(o=i._lendControlInterpolant(),this._timeScaleInterpolant=o);var s=o.parameterPositions,l=o.sampleValues;return s[0]=r,s[1]=r+n,l[0]=e/a,l[1]=t/a,this}},{key:"stopWarping",value:function(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}},{key:"getMixer",value:function(){return this._mixer}},{key:"getClip",value:function(){return this._clip}},{key:"getRoot",value:function(){return this._localRoot||this._mixer._root}},{key:"_update",value:function(e,t,n,i){if(this.enabled){var r=this._startTime;if(null!==r){var a=(e-r)*n;if(a<0||0===n)return;this._startTime=null,t=n*a}t*=this._updateTimeScale(e);var o=this._updateTime(t),s=this._updateWeight(e);if(s>0){var l=this._interpolants,c=this._propertyBindings;switch(this.blendMode){case X:for(var u=0,h=l.length;u!==h;++u)l[u].evaluate(o),c[u].accumulateAdditive(s);break;case $:default:for(var d=0,p=l.length;d!==p;++d)l[d].evaluate(o),c[d].accumulate(i,s)}}}else this._updateWeight(e)}},{key:"_updateWeight",value:function(e){var t=0;if(this.enabled){t=this.weight;var n=this._weightInterpolant;if(null!==n){var i=n.evaluate(e)[0];t*=i,e>n.parameterPositions[1]&&(this.stopFading(),0===i&&(this.enabled=!1))}}return this._effectiveWeight=t,t}},{key:"_updateTimeScale",value:function(e){var t=0;if(!this.paused){t=this.timeScale;var n=this._timeScaleInterpolant;if(null!==n)t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}return this._effectiveTimeScale=t,t}},{key:"_updateTime",value:function(e){var t=this._clip.duration,n=this.loop,i=this.time+e,r=this._loopCount,a=2202===n;if(0===e)return-1===r?i:a&&1===(1&r)?t-i:i;if(2200===n){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(i>=t)i=t;else{if(!(i<0)){this.time=i;break e}i=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===r&&(e>=0?(r=0,this._setEndings(!0,0===this.repetitions,a)):this._setEndings(0===this.repetitions,!0,a)),i>=t||i<0){var o=Math.floor(i/t);i-=t*o,r+=Math.abs(o);var s=this.repetitions-r;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=e>0?t:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===s){var l=e<0;this._setEndings(l,!l,a)}else this._setEndings(!1,!1,a);this._loopCount=r,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=i;if(a&&1===(1&r))return t-i}return i}},{key:"_setEndings",value:function(e,t,n){var i=this._interpolantSettings;n?(i.endingStart=q,i.endingEnd=q):(i.endingStart=e?this.zeroSlopeAtStart?q:W:Z,i.endingEnd=t?this.zeroSlopeAtEnd?q:W:Z)}},{key:"_scheduleFading",value:function(e,t,n){var i=this._mixer,r=i.time,a=this._weightInterpolant;null===a&&(a=i._lendControlInterpolant(),this._weightInterpolant=a);var o=a.parameterPositions,s=a.sampleValues;return o[0]=r,s[0]=t,o[1]=r+e,s[1]=n,this}}]),e}();(function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e){var i;return Object(v.a)(this,n),(i=t.call(this))._root=e,i._initMemoryManager(),i._accuIndex=0,i.time=0,i.timeScale=1,i}return Object(y.a)(n,[{key:"_bindAction",value:function(e,t){var n=e._localRoot||this._root,i=e._clip.tracks,r=i.length,a=e._propertyBindings,o=e._interpolants,s=n.uuid,l=this._bindingsByRootAndName,c=l[s];void 0===c&&(c={},l[s]=c);for(var u=0;u!==r;++u){var h=i[u],d=h.name,p=c[d];if(void 0!==p)a[u]=p;else{if(void 0!==(p=a[u])){null===p._cacheIndex&&(++p.referenceCount,this._addInactiveBinding(p,s,d));continue}var f=t&&t._propertyBindings[u].binding.parsedPath;++(p=new bl(Rl.create(n,d,f),h.ValueTypeName,h.getValueSize())).referenceCount,this._addInactiveBinding(p,s,d),a[u]=p}o[u].resultBuffer=p.buffer}}},{key:"_activateAction",value:function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){var t=(e._localRoot||this._root).uuid,n=e._clip.uuid,i=this._actionsByClip[n];this._bindAction(e,i&&i.knownActions[0]),this._addInactiveAction(e,n,t)}for(var r=e._propertyBindings,a=0,o=r.length;a!==o;++a){var s=r[a];0===s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}}},{key:"_deactivateAction",value:function(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,n=0,i=t.length;n!==i;++n){var r=t[n];0===--r.useCount&&(r.restoreOriginalState(),this._takeBackBinding(r))}this._takeBackAction(e)}}},{key:"_initMemoryManager",value:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}},{key:"_isActiveAction",value:function(e){var t=e._cacheIndex;return null!==t&&t<this._nActiveActions}},{key:"_addInactiveAction",value:function(e,t,n){var i=this._actions,r=this._actionsByClip,a=r[t];if(void 0===a)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=a;else{var o=a.knownActions;e._byClipCacheIndex=o.length,o.push(e)}e._cacheIndex=i.length,i.push(e),a.actionByRoot[n]=e}},{key:"_removeInactiveAction",value:function(e){var t=this._actions,n=t[t.length-1],i=e._cacheIndex;n._cacheIndex=i,t[i]=n,t.pop(),e._cacheIndex=null;var r=e._clip.uuid,a=this._actionsByClip,o=a[r],s=o.knownActions,l=s[s.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,s[c]=l,s.pop(),e._byClipCacheIndex=null,delete o.actionByRoot[(e._localRoot||this._root).uuid],0===s.length&&delete a[r],this._removeInactiveBindingsForAction(e)}},{key:"_removeInactiveBindingsForAction",value:function(e){for(var t=e._propertyBindings,n=0,i=t.length;n!==i;++n){var r=t[n];0===--r.referenceCount&&this._removeInactiveBinding(r)}}},{key:"_lendAction",value:function(e){var t=this._actions,n=e._cacheIndex,i=this._nActiveActions++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}},{key:"_takeBackAction",value:function(e){var t=this._actions,n=e._cacheIndex,i=--this._nActiveActions,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}},{key:"_addInactiveBinding",value:function(e,t,n){var i=this._bindingsByRootAndName,r=this._bindings,a=i[t];void 0===a&&(a={},i[t]=a),a[n]=e,e._cacheIndex=r.length,r.push(e)}},{key:"_removeInactiveBinding",value:function(e){var t=this._bindings,n=e.binding,i=n.rootNode.uuid,r=n.path,a=this._bindingsByRootAndName,o=a[i],s=t[t.length-1],l=e._cacheIndex;s._cacheIndex=l,t[l]=s,t.pop(),delete o[r],0===Object.keys(o).length&&delete a[i]}},{key:"_lendBinding",value:function(e){var t=this._bindings,n=e._cacheIndex,i=this._nActiveBindings++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}},{key:"_takeBackBinding",value:function(e){var t=this._bindings,n=e._cacheIndex,i=--this._nActiveBindings,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}},{key:"_lendControlInterpolant",value:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,n=e[t];return void 0===n&&((n=new es(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=t,e[t]=n),n}},{key:"_takeBackControlInterpolant",value:function(e){var t=this._controlInterpolants,n=e.__cacheIndex,i=--this._nActiveControlInterpolants,r=t[i];e.__cacheIndex=i,t[i]=e,r.__cacheIndex=n,t[n]=r}},{key:"clipAction",value:function(e,t,n){var i=t||this._root,r=i.uuid,a="string"===typeof e?us.findByName(i,e):e,o=null!==a?a.uuid:e,s=this._actionsByClip[o],l=null;if(void 0===n&&(n=null!==a?a.blendMode:$),void 0!==s){var c=s.actionByRoot[r];if(void 0!==c&&c.blendMode===n)return c;l=s.knownActions[0],null===a&&(a=l._clip)}if(null===a)return null;var u=new zl(this,a,t,n);return this._bindAction(u,l),this._addInactiveAction(u,o,r),u}},{key:"existingAction",value:function(e,t){var n=t||this._root,i=n.uuid,r="string"===typeof e?us.findByName(n,e):e,a=r?r.uuid:e,o=this._actionsByClip[a];return void 0!==o&&o.actionByRoot[i]||null}},{key:"stopAllAction",value:function(){for(var e=this._actions,t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}},{key:"update",value:function(e){e*=this.timeScale;for(var t=this._actions,n=this._nActiveActions,i=this.time+=e,r=Math.sign(e),a=this._accuIndex^=1,o=0;o!==n;++o){t[o]._update(i,e,r,a)}for(var s=this._bindings,l=this._nActiveBindings,c=0;c!==l;++c)s[c].apply(a);return this}},{key:"setTime",value:function(e){this.time=0;for(var t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}},{key:"getRoot",value:function(){return this._root}},{key:"uncacheClip",value:function(e){var t=this._actions,n=e.uuid,i=this._actionsByClip,r=i[n];if(void 0!==r){for(var a=r.knownActions,o=0,s=a.length;o!==s;++o){var l=a[o];this._deactivateAction(l);var c=l._cacheIndex,u=t[t.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,u._cacheIndex=c,t[c]=u,t.pop(),this._removeInactiveBindingsForAction(l)}delete i[n]}}},{key:"uncacheRoot",value:function(e){var t=e.uuid,n=this._actionsByClip;for(var i in n){var r=n[i].actionByRoot[t];void 0!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}var a=this._bindingsByRootAndName[t];if(void 0!==a)for(var o in a){var s=a[o];s.restoreOriginalState(),this._removeInactiveBinding(s)}}},{key:"uncacheAction",value:function(e,t){var n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}]),n})(re).prototype._controlInterpolantsResultBuffer=new Float32Array(1);var Dl=function(){function e(t){Object(v.a)(this,e),"string"===typeof t&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=arguments[1]),this.value=t}return Object(y.a)(e,[{key:"clone",value:function(){return new e(void 0===this.value.clone?this.value:this.value.clone())}}]),e}();(function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e,i){var r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Object(v.a)(this,n),(r=t.call(this,e,i)).meshPerAttribute=a||1,r}return Object(y.a)(n,[{key:"copy",value:function(e){return h(Object(u.a)(n.prototype),"copy",this).call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}},{key:"clone",value:function(e){var t=h(Object(u.a)(n.prototype),"clone",this).call(this,e);return t.meshPerAttribute=this.meshPerAttribute,t}},{key:"toJSON",value:function(e){var t=h(Object(u.a)(n.prototype),"toJSON",this).call(this,e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}]),n})(da).prototype.isInstancedInterleavedBuffer=!0,function(){function e(t,n,i,r,a){Object(v.a)(this,e),this.buffer=t,this.type=n,this.itemSize=i,this.elementSize=r,this.count=a,this.version=0}return Object(y.a)(e,[{key:"needsUpdate",set:function(e){!0===e&&this.version++}},{key:"setBuffer",value:function(e){return this.buffer=e,this}},{key:"setType",value:function(e,t){return this.type=e,this.elementSize=t,this}},{key:"setItemSize",value:function(e){return this.itemSize=e,this}},{key:"setCount",value:function(e){return this.count=e,this}}]),e}().prototype.isGLBufferAttribute=!0;var Ol=new me,Bl=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new me(1/0,1/0),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new me(-1/0,-1/0);Object(v.a)(this,e),this.min=t,this.max=n}return Object(y.a)(e,[{key:"set",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:"setFromPoints",value:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}},{key:"setFromCenterAndSize",value:function(e,t){var n=Ol.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y}},{key:"getCenter",value:function(e){return void 0===e&&(console.warn("THREE.Box2: .getCenter() target is now required"),e=new me),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(e){return void 0===e&&(console.warn("THREE.Box2: .getSize() target is now required"),e=new me),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}},{key:"expandByPoint",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:"expandByVector",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:"expandByScalar",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:"containsPoint",value:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}},{key:"containsBox",value:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}},{key:"getParameter",value:function(e,t){return void 0===t&&(console.warn("THREE.Box2: .getParameter() target is now required"),t=new me),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}},{key:"intersectsBox",value:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}},{key:"clampPoint",value:function(e,t){return void 0===t&&(console.warn("THREE.Box2: .clampPoint() target is now required"),t=new me),t.copy(e).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(e){return Ol.copy(e).clamp(this.min,this.max).sub(e).length()}},{key:"intersect",value:function(e){return this.min.max(e.min),this.max.min(e.max),this}},{key:"union",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:"translate",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:"equals",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),e}();Bl.prototype.isBox2=!0;var Fl=new Ee,Nl=new Ee,Ul=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Ee,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Ee;Object(v.a)(this,e),this.start=t,this.end=n}return Object(y.a)(e,[{key:"set",value:function(e,t){return this.start.copy(e),this.end.copy(t),this}},{key:"copy",value:function(e){return this.start.copy(e.start),this.end.copy(e.end),this}},{key:"getCenter",value:function(e){return void 0===e&&(console.warn("THREE.Line3: .getCenter() target is now required"),e=new Ee),e.addVectors(this.start,this.end).multiplyScalar(.5)}},{key:"delta",value:function(e){return void 0===e&&(console.warn("THREE.Line3: .delta() target is now required"),e=new Ee),e.subVectors(this.end,this.start)}},{key:"distanceSq",value:function(){return this.start.distanceToSquared(this.end)}},{key:"distance",value:function(){return this.start.distanceTo(this.end)}},{key:"at",value:function(e,t){return void 0===t&&(console.warn("THREE.Line3: .at() target is now required"),t=new Ee),this.delta(t).multiplyScalar(e).add(this.start)}},{key:"closestPointToPointParameter",value:function(e,t){Fl.subVectors(e,this.start),Nl.subVectors(this.end,this.start);var n=Nl.dot(Nl),i=Nl.dot(Fl)/n;return t&&(i=ue(i,0,1)),i}},{key:"closestPointToPoint",value:function(e,t,n){var i=this.closestPointToPointParameter(e,t);return void 0===n&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),n=new Ee),this.delta(n).multiplyScalar(i).add(this.start)}},{key:"applyMatrix4",value:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}},{key:"equals",value:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}();(function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e){var i;return Object(v.a)(this,n),(i=t.call(this)).material=e,i.render=function(){},i.hasPositions=!1,i.hasNormals=!1,i.hasColors=!1,i.hasUvs=!1,i.positionArray=null,i.normalArray=null,i.colorArray=null,i.uvArray=null,i.count=0,i}return n})(kt).prototype.isImmediateRenderObject=!0;var Vl=new Ee,jl=new nt,Gl=new nt,Hl=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e){var i;Object(v.a)(this,n);for(var r=Wl(e),a=new fn,o=[],s=[],l=new Jt(0,0,1),c=new Jt(0,1,0),u=0;u<r.length;u++){var h=r[u];h.parent&&h.parent.isBone&&(o.push(0,0,0),o.push(0,0,0),s.push(l.r,l.g,l.b),s.push(c.r,c.g,c.b))}a.setAttribute("position",new an(o,3)),a.setAttribute("color",new an(s,3));var d=new Ha({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});return(i=t.call(this,a,d)).type="SkeletonHelper",i.isSkeletonHelper=!0,i.root=e,i.bones=r,i.matrix=e.matrixWorld,i.matrixAutoUpdate=!1,i}return Object(y.a)(n,[{key:"updateMatrixWorld",value:function(e){var t=this.bones,i=this.geometry,r=i.getAttribute("position");Gl.copy(this.root.matrixWorld).invert();for(var a=0,o=0;a<t.length;a++){var s=t[a];s.parent&&s.parent.isBone&&(jl.multiplyMatrices(Gl,s.matrixWorld),Vl.setFromMatrixPosition(jl),r.setXYZ(o,Vl.x,Vl.y,Vl.z),jl.multiplyMatrices(Gl,s.parent.matrixWorld),Vl.setFromMatrixPosition(jl),r.setXYZ(o+1,Vl.x,Vl.y,Vl.z),o+=2)}i.getAttribute("position").needsUpdate=!0,h(Object(u.a)(n.prototype),"updateMatrixWorld",this).call(this,e)}}]),n}(Qa);function Wl(e){var t=[];e&&e.isBone&&t.push(e);for(var n=0;n<e.children.length;n++)t.push.apply(t,Wl(e.children[n]));return t}var ql=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4473924,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8947848;Object(v.a)(this,n),a=new Jt(a),o=new Jt(o);for(var s=r/2,l=i/r,c=i/2,u=[],h=[],d=0,p=0,f=-c;d<=r;d++,f+=l){u.push(-c,0,f,c,0,f),u.push(f,0,-c,f,0,c);var m=d===s?a:o;m.toArray(h,p),p+=3,m.toArray(h,p),p+=3,m.toArray(h,p),p+=3,m.toArray(h,p),p+=3}var g=new fn;g.setAttribute("position",new an(u,3)),g.setAttribute("color",new an(h,3));var y=new Ha({vertexColors:!0,toneMapped:!1});return(e=t.call(this,g,y)).type="GridHelper",e}return n}(Qa);var Zl=new Float32Array(1),$l=(new Int32Array(Zl.buffer),Math.pow(2,8),[.125,.215,.35,.446,.526,.582]),Xl=5+$l.length,Yl=(s(p={},Y,0),s(p,J,1),s(p,Q,2),s(p,3004,3),s(p,3005,4),s(p,3006,5),s(p,K,6),new Kt({side:1,depthWrite:!1,depthTest:!1})),Jl=(new In(new zn,Yl),Kl());Jl._lodPlanes,Jl._sizeLods,Jl._sigmas,Math.sqrt(5);function Kl(){for(var e=[],t=[],n=[],i=8,r=0;r<Xl;r++){var a=Math.pow(2,i);t.push(a);var o=1/a;r>4?o=$l[r-8+4-1]:0==r&&(o=0),n.push(o);for(var s=1/(a-1),l=-s/2,c=1+s/2,u=[l,l,c,l,c,c,l,l,c,c,l,c],h=new Float32Array(108),d=new Float32Array(72),p=new Float32Array(36),f=0;f<6;f++){var m=f%3*2/3-1,g=f>2?0:-1,v=[m,g,0,m+2/3,g,0,m+2/3,g+1,0,m,g,0,m+2/3,g+1,0,m,g+1,0];h.set(v,18*f),d.set(u,12*f);var y=[f,f,f,f,f,f];p.set(y,6*f)}var _=new fn;_.setAttribute("position",new tn(h,3)),_.setAttribute("uv",new tn(d,2)),_.setAttribute("faceIndex",new tn(p,1)),e.push(_),i>4&&i--}return{_lodPlanes:e,_sizeLods:t,_sigmas:n}}bs.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(bs.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},Vs.prototype.fromPoints=function(e){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)},ql.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},Hl.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},ms.prototype.extractUrlBase=function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),cl.extractUrlBase(e)},ms.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Bl.prototype.center=function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},Bl.prototype.empty=function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Bl.prototype.isIntersectionBox=function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},Bl.prototype.size=function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)},Ae.prototype.center=function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Ae.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Ae.prototype.isIntersectionBox=function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},Ae.prototype.isIntersectionSphere=function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},Ae.prototype.size=function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)},Ze.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Zn.prototype.setFromMatrix=function(e){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(e)},Ul.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},ve.prototype.flattenToArrayOffset=function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},ve.prototype.multiplyVector3=function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},ve.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},ve.prototype.applyToBufferAttribute=function(e){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},ve.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},ve.prototype.getInverse=function(e){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()},nt.prototype.extractPosition=function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},nt.prototype.flattenToArrayOffset=function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},nt.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new Ee).setFromMatrixColumn(this,3)},nt.prototype.setRotationFromQuaternion=function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},nt.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},nt.prototype.multiplyVector3=function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},nt.prototype.multiplyVector4=function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},nt.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},nt.prototype.rotateAxis=function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},nt.prototype.crossVector=function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},nt.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},nt.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},nt.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},nt.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},nt.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},nt.prototype.applyToBufferAttribute=function(e){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},nt.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},nt.prototype.makeFrustum=function(e,t,n,i,r,a){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,i,n,r,a)},nt.prototype.getInverse=function(e){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()},Lt.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},Te.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},Te.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},tt.prototype.isIntersectionBox=function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},tt.prototype.isIntersectionPlane=function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},tt.prototype.isIntersectionSphere=function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},jt.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},jt.prototype.barycoordFromPoint=function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},jt.prototype.midpoint=function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},jt.prototypenormal=function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},jt.prototype.plane=function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)},jt.barycoordFromPoint=function(e,t,n,i,r){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),jt.getBarycoord(e,t,n,i,r)},jt.normal=function(e,t,n,i){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),jt.getNormal(e,t,n,i)},js.prototype.extractAllPoints=function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},js.prototype.extrude=function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Fo(this,e)},js.prototype.makeGeometry=function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Uo(this,e)},me.prototype.fromAttribute=function(e,t,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},me.prototype.distanceToManhattan=function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},me.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Ee.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},Ee.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},Ee.prototype.getPositionFromMatrix=function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},Ee.prototype.getScaleFromMatrix=function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},Ee.prototype.getColumnFromMatrix=function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},Ee.prototype.applyProjection=function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},Ee.prototype.fromAttribute=function(e,t,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},Ee.prototype.distanceToManhattan=function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},Ee.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},we.prototype.fromAttribute=function(e,t,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},we.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},kt.prototype.getChildByName=function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},kt.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},kt.prototype.translate=function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},kt.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},kt.prototype.applyMatrix=function(e){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)},Object.defineProperties(kt.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),In.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(In.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Oa.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Un.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(Gs.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(tn.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===ne},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(ne)}}}),tn.prototype.setDynamic=function(e){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?ne:te),this},tn.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},tn.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},fn.prototype.addIndex=function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},fn.prototype.addAttribute=function(e,t){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(e,new tn(arguments[1],arguments[2])))},fn.prototype.addDrawCall=function(e,t,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},fn.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},fn.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},fn.prototype.removeAttribute=function(e){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(e)},fn.prototype.applyMatrix=function(e){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)},Object.defineProperties(fn.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),da.prototype.setDynamic=function(e){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?ne:te),this},da.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},Fo.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},Fo.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},Fo.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},ha.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},Dl.prototype.onUpdate=function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this},Object.defineProperties(Ht.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Jt}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===e}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(e){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=e}}}),Object.defineProperties(Fn.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),la.prototype.clearTarget=function(e,t,n,i){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,n,i)},la.prototype.animate=function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},la.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},la.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},la.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},la.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},la.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},la.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},la.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},la.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},la.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},la.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},la.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},la.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},la.prototype.enableScissorTest=function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},la.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},la.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},la.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},la.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},la.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},la.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},la.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},la.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},la.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},la.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties(la.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(e){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===e?J:Y}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(Kr.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(Se.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),_l.prototype.load=function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var t=this;return(new yl).load(e,(function(e){t.setBuffer(e)})),this},xl.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},jn.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)},jn.prototype.clear=function(e,t,n,i){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(e,t,n,i)},ye.crossOrigin=void 0,ye.loadTexture=function(e,t,n,i){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var r=new xs;r.setCrossOrigin(this.crossOrigin);var a=r.load(e,n,void 0,i);return t&&(a.mapping=t),a},ye.loadTextureCube=function(e,t,n,i){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var r=new _s;r.setCrossOrigin(this.crossOrigin);var a=r.load(e,n,void 0,i);return t&&(a.mapping=t),a},ye.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},ye.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"129"}})),"undefined"!==typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="129")},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var i=n(16);var r=n(13);function a(e){return function(e){if(Array.isArray(e))return Object(i.a)(e)}(e)||function(e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||Object(r.a)(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},function(e,t,n){"use strict";e.exports=function(e,t){return function(){for(var n=new Array(arguments.length),i=0;i<n.length;i++)n[i]=arguments[i];return e.apply(t,n)}}},function(e,t,n){"use strict";var i=n(9);function r(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}e.exports=function(e,t,n){if(!t)return e;var a;if(n)a=n(t);else if(i.isURLSearchParams(t))a=t.toString();else{var o=[];i.forEach(t,(function(e,t){null!==e&&"undefined"!==typeof e&&(i.isArray(e)?t+="[]":e=[e],i.forEach(e,(function(e){i.isDate(e)?e=e.toISOString():i.isObject(e)&&(e=JSON.stringify(e)),o.push(r(t)+"="+r(e))})))})),a=o.join("&")}if(a){var s=e.indexOf("#");-1!==s&&(e=e.slice(0,s)),e+=(-1===e.indexOf("?")?"?":"&")+a}return e}},function(e,t,n){"use strict";e.exports=function(e){return!(!e||!e.__CANCEL__)}},function(e,t,n){"use strict";(function(t){var i=n(9),r=n(59),a={"Content-Type":"application/x-www-form-urlencoded"};function o(e,t){!i.isUndefined(e)&&i.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var s={adapter:function(){var e;return("undefined"!==typeof XMLHttpRequest||"undefined"!==typeof t&&"[object process]"===Object.prototype.toString.call(t))&&(e=n(28)),e}(),transformRequest:[function(e,t){return r(t,"Accept"),r(t,"Content-Type"),i.isFormData(e)||i.isArrayBuffer(e)||i.isBuffer(e)||i.isStream(e)||i.isFile(e)||i.isBlob(e)?e:i.isArrayBufferView(e)?e.buffer:i.isURLSearchParams(e)?(o(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):i.isObject(e)?(o(t,"application/json;charset=utf-8"),JSON.stringify(e)):e}],transformResponse:[function(e){if("string"===typeof e)try{e=JSON.parse(e)}catch(t){}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};i.forEach(["delete","get","head"],(function(e){s.headers[e]={}})),i.forEach(["post","put","patch"],(function(e){s.headers[e]=i.merge(a)})),e.exports=s}).call(this,n(58))},function(e,t,n){"use strict";var i=n(9),r=n(60),a=n(62),o=n(25),s=n(63),l=n(66),c=n(67),u=n(29);e.exports=function(e){return new Promise((function(t,n){var h=e.data,d=e.headers;i.isFormData(h)&&delete d["Content-Type"];var p=new XMLHttpRequest;if(e.auth){var f=e.auth.username||"",m=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";d.Authorization="Basic "+btoa(f+":"+m)}var g=s(e.baseURL,e.url);if(p.open(e.method.toUpperCase(),o(g,e.params,e.paramsSerializer),!0),p.timeout=e.timeout,p.onreadystatechange=function(){if(p&&4===p.readyState&&(0!==p.status||p.responseURL&&0===p.responseURL.indexOf("file:"))){var i="getAllResponseHeaders"in p?l(p.getAllResponseHeaders()):null,a={data:e.responseType&&"text"!==e.responseType?p.response:p.responseText,status:p.status,statusText:p.statusText,headers:i,config:e,request:p};r(t,n,a),p=null}},p.onabort=function(){p&&(n(u("Request aborted",e,"ECONNABORTED",p)),p=null)},p.onerror=function(){n(u("Network Error",e,null,p)),p=null},p.ontimeout=function(){var t="timeout of "+e.timeout+"ms exceeded";e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),n(u(t,e,"ECONNABORTED",p)),p=null},i.isStandardBrowserEnv()){var v=(e.withCredentials||c(g))&&e.xsrfCookieName?a.read(e.xsrfCookieName):void 0;v&&(d[e.xsrfHeaderName]=v)}if("setRequestHeader"in p&&i.forEach(d,(function(e,t){"undefined"===typeof h&&"content-type"===t.toLowerCase()?delete d[t]:p.setRequestHeader(t,e)})),i.isUndefined(e.withCredentials)||(p.withCredentials=!!e.withCredentials),e.responseType)try{p.responseType=e.responseType}catch(y){if("json"!==e.responseType)throw y}"function"===typeof e.onDownloadProgress&&p.addEventListener("progress",e.onDownloadProgress),"function"===typeof e.onUploadProgress&&p.upload&&p.upload.addEventListener("progress",e.onUploadProgress),e.cancelToken&&e.cancelToken.promise.then((function(e){p&&(p.abort(),n(e),p=null)})),h||(h=null),p.send(h)}))}},function(e,t,n){"use strict";var i=n(61);e.exports=function(e,t,n,r,a){var o=new Error(e);return i(o,t,n,r,a)}},function(e,t,n){"use strict";var i=n(9);e.exports=function(e,t){t=t||{};var n={},r=["url","method","data"],a=["headers","auth","proxy","params"],o=["baseURL","transformRequest","transformResponse","paramsSerializer","timeout","timeoutMessage","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","decompress","maxContentLength","maxBodyLength","maxRedirects","transport","httpAgent","httpsAgent","cancelToken","socketPath","responseEncoding"],s=["validateStatus"];function l(e,t){return i.isPlainObject(e)&&i.isPlainObject(t)?i.merge(e,t):i.isPlainObject(t)?i.merge({},t):i.isArray(t)?t.slice():t}function c(r){i.isUndefined(t[r])?i.isUndefined(e[r])||(n[r]=l(void 0,e[r])):n[r]=l(e[r],t[r])}i.forEach(r,(function(e){i.isUndefined(t[e])||(n[e]=l(void 0,t[e]))})),i.forEach(a,c),i.forEach(o,(function(r){i.isUndefined(t[r])?i.isUndefined(e[r])||(n[r]=l(void 0,e[r])):n[r]=l(void 0,t[r])})),i.forEach(s,(function(i){i in t?n[i]=l(e[i],t[i]):i in e&&(n[i]=l(void 0,e[i]))}));var u=r.concat(a).concat(o).concat(s),h=Object.keys(e).concat(Object.keys(t)).filter((function(e){return-1===u.indexOf(e)}));return i.forEach(h,c),n}},function(e,t,n){"use strict";function i(e){this.message=e}i.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},i.prototype.__CANCEL__=!0,e.exports=i},function(e,t,n){"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(38)},function(e,t,n){var i,r;window,e.exports=(i=n(44),r=n(7),function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t){e.exports=i},function(e,t){e.exports=r},function(e,t,n){e.exports=n(3)},function(e,t,n){"use strict";n.r(t);var i,r,a,o=n(1),s=n.n(o),l=n(0),c=new(window.AudioContext||window.webkitAudioContext),u=c.createAnalyser(),h={getAudioContext:function(){return c},getAnalyser:function(){return u},resetAnalyser:function(){u=c.createAnalyser()},decodeAudioData:function(){c.decodeAudioData(audioData).then((function(e){}))}};function d(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var p,f,m,g,v,y,_,x,b=[];navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;var w,S=function(){function e(t,n,o,s,l,c){var u,d,w,S=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),w=function(){if(p=Date.now(),a){if(r&&"suspended"===r.state&&r.resume(),a&&"paused"===a.state)return void a.resume();r&&a&&"inactive"===a.state&&(a.start(10),r.createMediaStreamSource(f).connect(i),g&&g())}else navigator.mediaDevices?(console.log("getUserMedia supported."),navigator.mediaDevices.getUserMedia(x).then((function(e){f=e,a=MediaRecorder.isTypeSupported(m.mimeType)?new MediaRecorder(e,m):new MediaRecorder(e),g&&g(),a.onstop=S.onStop,a.ondataavailable=function(e){b.push(e.data),_&&_(e.data)},(r=h.getAudioContext()).resume().then((function(){i=h.getAnalyser(),a.start(10),r.createMediaStreamSource(f).connect(i)}))}))):alert("Your browser does not support audio recording")},(d="startRecording")in(u=this)?Object.defineProperty(u,d,{value:w,enumerable:!0,configurable:!0,writable:!0}):u[d]=w;var T=c.echoCancellation,E=c.autoGainControl,M=c.noiseSuppression,k=c.channelCount;g=t,v=n,y=o,_=s,m=l,x={audio:{echoCancellation:T,autoGainControl:E,noiseSuppression:M,channelCount:k},video:!1}}var t,n,o;return t=e,(n=[{key:"stopRecording",value:function(){a&&"inactive"!==a.state&&(a.stop(),f.getAudioTracks().forEach((function(e){e.stop()})),a=null,h.resetAnalyser())}},{key:"onStop",value:function(){var e=new Blob(b,{type:m.mimeType});b=[];var t={blob:e,startTime:p,stopTime:Date.now(),options:m,blobURL:window.URL.createObjectURL(e)};v&&v(t),y&&y(t)}}])&&d(t.prototype,n),o&&d(t,o),e}(),T={create:function(e){var t=h.getAudioContext(),n=h.getAnalyser();if(void 0===w){var i=t.createMediaElementSource(e);i.connect(n),w=i}n.connect(t.destination)}},E={visualizeSineWave:function(e,t,n,i,r,a){var o=h.getAnalyser(),s=o.fftSize,l=new Uint8Array(s);e.clearRect(0,0,n,i),function c(){requestAnimationFrame(c),(o=h.getAnalyser()).getByteTimeDomainData(l),e.fillStyle=r,e.fillRect(0,0,n,i),e.lineWidth=2,e.strokeStyle=a,e.beginPath();for(var u=1*n/s,d=0,p=0;p<s;p++){var f=l[p]/128*i/2;0===p?e.moveTo(d,f):e.lineTo(d,f),d+=u}e.lineTo(t.width,t.height/2),e.stroke()}()},visualizeFrequencyBars:function(e,t,n,i,r,a){var o=this,s=h.getAnalyser();s.fftSize=256;var l=s.frequencyBinCount,c=new Uint8Array(l);e.clearRect(0,0,n,i),function t(){requestAnimationFrame(t),(s=h.getAnalyser()).getByteFrequencyData(c),e.fillStyle=r,e.fillRect(0,0,n,i);for(var u,d=n/l*2.5,p=0,f=0;f<l;f++)u=c[f],o.hexToRgb(a),e.fillStyle=a,e.fillRect(p,i-u/2,d,u/2),p+=d+1}()},visualizeFrequencyCircles:function(e,t,n,i,r,a){var o=h.getAnalyser();o.fftSize=32;var s=o.frequencyBinCount,l=new Uint8Array(s);e.clearRect(0,0,n,i),function t(){requestAnimationFrame(t),(o=h.getAnalyser()).getByteFrequencyData(l);for(var c=new Uint8Array(s/3),u=0;u<s;u+=3){for(var d=0,p=0;p<3;p++)d+=l[u+p];c[u/3]=d/3}e.clearRect(0,0,n,i),e.beginPath(),e.arc(n/2,i/2,Math.min(i,n)/2,0,2*Math.PI),e.fillStyle=r,e.fill();var f=Math.min(i,n)/2/c.length;e.strokeStyle=a;for(var m=0;m<c.length;m++){e.beginPath();var g=f*m+f*(c[m]/128);e.arc(n/2,i/2,g,0,2*Math.PI),e.stroke()}}()},hexToRgb:function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}};function M(e){return(M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function k(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function A(e){return(A=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function C(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function P(e,t){return(P=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var L=function(e){function t(e){var n,i,r,a,o,l;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),i=this,r=A(t).call(this,e),n=!r||"object"!==M(r)&&"function"!=typeof r?C(i):r,l=function(){var e=n.props,t=e.backgroundColor,i=e.strokeColor,r=e.width,a=e.height,o=e.visualSetting,s=n.state,l=s.canvas,c=s.canvasCtx;"sinewave"===o?E.visualizeSineWave(c,l,r,a,t,i):"frequencyBars"===o?E.visualizeFrequencyBars(c,l,r,a,t,i):"frequencyCircles"===o&&E.visualizeFrequencyCircles(c,l,r,a,t,i)},(o="visualize")in(a=C(n))?Object.defineProperty(a,o,{value:l,enumerable:!0,configurable:!0,writable:!0}):a[o]=l,n.visualizerRef=s.a.createRef(),n.state={microphoneRecorder:null,canvas:null,canvasCtx:null},n}var n,i,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&P(e,t)}(t,e),n=t,(i=[{key:"componentDidUpdate",value:function(e){var t=this.props,n=t.record,i=t.onStop,r=this.state.microphoneRecorder;e.record!==n&&(n?r&&r.startRecording():r&&(r.stopRecording(i),this.clear()))}},{key:"componentDidMount",value:function(){var e=this,t=this.props,n=t.onSave,i=t.onStop,r=t.onStart,a=t.onData,o=t.audioElem,s=t.audioBitsPerSecond,l=t.echoCancellation,c=t.autoGainControl,u=t.noiseSuppression,h=(t.channelCount,t.mimeType),d=this.visualizerRef.current,p=d.getContext("2d"),f={audioBitsPerSecond:s,mimeType:h},m={echoCancellation:l,autoGainControl:c,noiseSuppression:u};o?(T.create(o),this.setState({canvas:d,canvasCtx:p},(function(){e.visualize()}))):this.setState({microphoneRecorder:new S(r,i,n,a,f,m),canvas:d,canvasCtx:p},(function(){e.visualize()}))}},{key:"clear",value:function(){var e=this.props,t=e.width,n=e.height;this.state.canvasCtx.clearRect(0,0,t,n)}},{key:"render",value:function(){var e=this.props,t=e.width,n=e.height;return s.a.createElement("canvas",{ref:this.visualizerRef,height:n,width:t,className:this.props.className})}}])&&k(n.prototype,i),r&&k(n,r),t}(o.Component);L.propTypes={backgroundColor:l.string,strokeColor:l.string,className:l.string,audioBitsPerSecond:l.number,mimeType:l.string,height:l.number,record:l.bool.isRequired,onStop:l.func,onData:l.func,onSave:l.func},L.defaultProps={backgroundColor:"rgba(255, 255, 255, 0.5)",strokeColor:"#000000",className:"visualizer",audioBitsPerSecond:128e3,mimeType:"audio/webm;codecs=opus",record:!1,width:640,height:100,visualSetting:"sinewave",echoCancellation:!1,autoGainControl:!1,noiseSuppression:!1,channelCount:2},n.d(t,"ReactMic",(function(){return L}))}]))},,function(e,t,n){var i;i=function(e){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s="./src/react-webcam.tsx")}({"./src/react-webcam.tsx":function(e,t,n){"use strict";n.r(t);var i=n("react"),r=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),a=function(){return(a=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},o=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n};function s(){return!(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)}"undefined"!==typeof window&&(void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),void 0===navigator.mediaDevices.getUserMedia&&(navigator.mediaDevices.getUserMedia=function(e){var t=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return t?new Promise((function(n,i){t.call(navigator,e,n,i)})):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}));var l=function(e){function t(t){var n=e.call(this,t)||this;return n.canvas=null,n.ctx=null,n.unmounted=!1,n.state={hasUserMedia:!1},n}return r(t,e),t.prototype.componentDidMount=function(){var e=this.state,t=this.props;s()?e.hasUserMedia||this.requestUserMedia():t.onUserMediaError("getUserMedia not supported")},t.prototype.componentDidUpdate=function(e){var t=this.props;if(s()){var n=JSON.stringify(e.audioConstraints)!==JSON.stringify(t.audioConstraints),i=JSON.stringify(e.videoConstraints)!==JSON.stringify(t.videoConstraints),r=e.minScreenshotWidth!==t.minScreenshotWidth,a=e.minScreenshotHeight!==t.minScreenshotHeight;(i||r||a)&&(this.canvas=null,this.ctx=null),(n||i)&&(this.stopAndCleanup(),this.requestUserMedia())}else t.onUserMediaError("getUserMedia not supported")},t.prototype.componentWillUnmount=function(){this.unmounted=!0,this.stopAndCleanup()},t.stopMediaStream=function(e){e&&(e.getVideoTracks&&e.getAudioTracks?(e.getVideoTracks().map((function(t){e.removeTrack(t),t.stop()})),e.getAudioTracks().map((function(t){e.removeTrack(t),t.stop()}))):e.stop())},t.prototype.stopAndCleanup=function(){var e=this.state;e.hasUserMedia&&(t.stopMediaStream(this.stream),e.src&&window.URL.revokeObjectURL(e.src))},t.prototype.getScreenshot=function(e){var t=this.state,n=this.props;if(!t.hasUserMedia)return null;var i=this.getCanvas(e);return i&&i.toDataURL(n.screenshotFormat,n.screenshotQuality)},t.prototype.getCanvas=function(e){var t=this.state,n=this.props;if(!this.video)return null;if(!t.hasUserMedia||!this.video.videoHeight)return null;if(!this.ctx){var i=this.video.videoWidth,r=this.video.videoHeight;if(!this.props.forceScreenshotSourceSize){var a=i/r;r=(i=n.minScreenshotWidth||this.video.clientWidth)/a,n.minScreenshotHeight&&r<n.minScreenshotHeight&&(i=(r=n.minScreenshotHeight)*a)}this.canvas=document.createElement("canvas"),this.canvas.width=(null===e||void 0===e?void 0:e.width)||i,this.canvas.height=(null===e||void 0===e?void 0:e.height)||r,this.ctx=this.canvas.getContext("2d")}var o=this.ctx,s=this.canvas;return o&&s&&(n.mirrored&&(o.translate(s.width,0),o.scale(-1,1)),o.imageSmoothingEnabled=n.imageSmoothing,o.drawImage(this.video,0,0,(null===e||void 0===e?void 0:e.width)||s.width,(null===e||void 0===e?void 0:e.height)||s.height),n.mirrored&&(o.scale(-1,1),o.translate(-s.width,0))),s},t.prototype.requestUserMedia=function(){var e=this,n=this.props,i=function(i,r){var a={video:"undefined"===typeof r||r};n.audio&&(a.audio="undefined"===typeof i||i),navigator.mediaDevices.getUserMedia(a).then((function(n){e.unmounted?t.stopMediaStream(n):e.handleUserMedia(null,n)})).catch((function(t){e.handleUserMedia(t)}))};if("mediaDevices"in navigator)i(n.audioConstraints,n.videoConstraints);else{var r=function(e){return{optional:[{sourceId:e}]}},a=function(e){var t=e.deviceId;return"string"===typeof t?t:Array.isArray(t)&&t.length>0?t[0]:"object"===typeof t&&t.ideal?t.ideal:null};MediaStreamTrack.getSources((function(e){var t=null,o=null;e.forEach((function(e){"audio"===e.kind?t=e.id:"video"===e.kind&&(o=e.id)}));var s=a(n.audioConstraints);s&&(t=s);var l=a(n.videoConstraints);l&&(o=l),i(r(t),r(o))}))}},t.prototype.handleUserMedia=function(e,t){var n=this.props;if(e||!t)return this.setState({hasUserMedia:!1}),void n.onUserMediaError(e);this.stream=t;try{this.video&&(this.video.srcObject=t),this.setState({hasUserMedia:!0})}catch(i){this.setState({hasUserMedia:!0,src:window.URL.createObjectURL(t)})}n.onUserMedia(t)},t.prototype.render=function(){var e=this,t=this.state,n=this.props,r=n.audio,s=(n.forceScreenshotSourceSize,n.onUserMedia,n.onUserMediaError,n.screenshotFormat,n.screenshotQuality,n.minScreenshotWidth,n.minScreenshotHeight,n.audioConstraints,n.videoConstraints,n.imageSmoothing,n.mirrored),l=n.style,c=void 0===l?{}:l,u=o(n,["audio","forceScreenshotSourceSize","onUserMedia","onUserMediaError","screenshotFormat","screenshotQuality","minScreenshotWidth","minScreenshotHeight","audioConstraints","videoConstraints","imageSmoothing","mirrored","style"]),h=s?a(a({},c),{transform:(c.transform||"")+" scaleX(-1)"}):c;return i.createElement("video",a({autoPlay:!0,src:t.src,muted:r,playsInline:!0,ref:function(t){e.video=t},style:h},u))},t.defaultProps={audio:!0,forceScreenshotSourceSize:!1,imageSmoothing:!0,mirrored:!1,onUserMedia:function(){},onUserMediaError:function(){},screenshotFormat:"image/webp",screenshotQuality:.92},t}(i.Component);t.default=l},react:function(t,n){t.exports=e}}).default},e.exports=i(n(7))},function(e,t,n){"use strict";n.d(t,"a",(function(){return P}));var i=n(3),r=n(6),a=n(19),o=n(0),s=n(1),l=n(2),c=n(4),u=n(14);var h=n(17);function d(e){var t="function"===typeof Map?new Map:void 0;return(d=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!==typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof t){if(t.has(e))return t.get(e);t.set(e,i)}function i(){return Object(h.a)(e,arguments,Object(c.a)(this).constructor)}return i.prototype=Object.create(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),Object(u.a)(i,e)})(e)}var p=Symbol("__sensor__"),f=p;function m(e,t){for(var n in t)Object.defineProperty(e,n,{configurable:!0,value:t[n]})}var g=function(e){Object(s.a)(n,e);var t=Object(l.a)(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return n}(function(e){Object(s.a)(n,e);var t=Object(l.a)(n);function n(){var e;Object(o.a)(this,n);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];e=t.call(this,a);var l=document.createDocumentFragment();return e.addEventListener=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return l.addEventListener.apply(l,[e].concat(n))},e.removeEventListener=function(){return l.removeEventListener.apply(l,arguments)},e.dispatchEvent=function(t){m(t,{currentTarget:Object(r.a)(e)}),t.target||m(t,{target:Object(r.a)(e)});var n="on".concat(t.type);"function"==typeof e[n]&&e[n](t);var i=l.dispatchEvent(t);return i&&e.parentNode&&e.parentNode.dispatchEvent(t),m(t,{currentTarget:null,target:null}),i},e}return n}(Object));function v(e,t,n){var i=e[t],r=function(t){i[t]=n[t],Object.defineProperty(e,t,{get:function(){return i[t]}})};for(var a in n)r(a)}var y=function(e){Object(s.a)(n,e);var t=Object(l.a)(n);function n(e,i){var a;if(Object(o.a)(this,n),a=t.call(this,e,i),!i||!(i.error instanceof DOMException))throw TypeError("Failed to construct 'SensorErrorEvent':2nd argument much contain 'error' property");return Object.defineProperty(Object(r.a)(a),"error",{configurable:!1,writable:!1,value:i.error}),a}return n}(d(Event));function _(e,t){Object.defineProperty(e,"on".concat(t),{enumerable:!0,configurable:!1,writable:!0,value:null})}var x,b=1,w=2,S=3,T=function(e){Object(s.a)(n,e);var t=Object(l.a)(n);function n(e){var i;if(Object(o.a)(this,n),(i=t.call(this))[f]=new WeakMap,_(Object(r.a)(i),"reading"),_(Object(r.a)(i),"activate"),_(Object(r.a)(i),"error"),v(Object(r.a)(i),f,{activated:!1,hasReading:!1,timestamp:null}),i[f].state=b,i[f].notifyError=function(e,t){var n=new y("error",{error:new DOMException(e,t)});i.dispatchEvent(n),i.stop()},i[f].notifyActivatedState=function(){var e=new Event("activate");i[f].activated=!0,i.dispatchEvent(e),i[f].state=S},i[f].activateCallback=function(){},i[f].deactivateCallback=function(){},i[f].frequency=null,window&&window.parent!=window.top)throw new DOMException("Only instantiable in a top-level browsing context","SecurityError");return e&&"number"==typeof e.frequency&&e.frequency>60&&(i.frequency=e.frequency),i}return Object(i.a)(n,[{key:"start",value:function(){this[f].state!==w&&this[f].state!==S&&(this[f].state=w,this[f].activateCallback())}},{key:"stop",value:function(){this[f].state!==b&&(this[f].activated=!1,this[f].hasReading=!1,this[f].timestamp=null,this[f].deactivateCallback(),this[f].state=b)}}]),n}(g),E=p;screen.orientation?x=screen.orientation:screen.msOrientation?x=screen.msOrientation:(x={},Object.defineProperty(x,"angle",{get:function(){return window.orientation||0}}));var M=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return function(e){Object(s.a)(i,e);var t=Object(l.a)(i);function i(){var e;Object(o.a)(this,i);for(var r=arguments.length,s=new Array(r),l=0;l<r;l++)s[l]=arguments[l];e=t.call(this,s);var c,u=Object(a.a)(n);try{for(u.s();!(c=u.n()).done;){var h=c.value;if("on".concat(h)in window){e[E].eventName=h;break}}}catch(d){u.e(d)}finally{u.f()}return e[E].activateCallback=function(){window.addEventListener(e[E].eventName,e[E].handleEvent,{capture:!0})},e[E].deactivateCallback=function(){window.removeEventListener(e[E].eventName,e[E].handleEvent,{capture:!0})},e}return i}(e)};function k(e,t,n){var i=Math.PI/180,r=(t||0)*i,a=(n||0)*i,o=(e||0)*i,s=Math.cos(.5*o),l=Math.sin(.5*o),c=Math.cos(.5*a),u=Math.sin(.5*a),h=Math.cos(.5*r),d=Math.sin(.5*r);return[d*c*s-h*u*l,h*u*s+d*c*l,h*c*l+d*u*s,h*c*s-d*u*l]}function A(e,t){return(e instanceof Float32Array||e instanceof Float64Array)&&e.length>=16&&(e[0]=1-2*(Math.pow(t[1],2)+Math.pow(t[2],2)),e[1]=2*(t[0]*t[1]-t[2]*t[3]),e[2]=2*(t[0]*t[2]+t[1]*t[3]),e[3]=0,e[4]=2*(t[0]*t[1]+t[2]*t[3]),e[5]=1-2*(Math.pow(t[0],2)+Math.pow(t[2],2)),e[6]=2*(t[1]*t[2]-t[0]*t[3]),e[7]=0,e[8]=2*(t[0]*t[2]-t[1]*t[3]),e[9]=2*(t[1]*t[2]+t[0]*t[3]),e[10]=1-2*(Math.pow(t[0],2)+Math.pow(t[1],2)),e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1),e}function C(e){return e?function(e,t,n){var i,r,a=Math.sin(n/2),o=Math.cos(n/2),s=[t[0]*a,t[1]*a,t[2]*a,o];return function(e){var t=Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2));return 0===t?[0,0,0,1]:e.map((function(e){return e/t}))}((r=s,[(i=e)[0]*r[3]+i[3]*r[0]+i[1]*r[2]-i[2]*r[1],i[1]*r[3]+i[3]*r[1]+i[2]*r[0]-i[0]*r[2],i[2]*r[3]+i[3]*r[2]+i[0]*r[1]-i[1]*r[0],i[3]*r[3]-i[0]*r[0]-i[1]*r[1]-i[2]*r[2]]))}(e,[0,0,1],-x.angle*Math.PI/180):null}window.RelativeOrientationSensor||M(T,"deviceorientation");var P=window.AbsoluteOrientationSensor||function(e){Object(s.a)(n,e);var t=Object(l.a)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};switch(Object(o.a)(this,n),e=t.call(this,i),i.coordinateSystem||"world"){case"screen":Object.defineProperty(Object(r.a)(e),"quaternion",{get:function(){return C(e[E].quaternion)}});break;case"world":default:Object.defineProperty(Object(r.a)(e),"quaternion",{get:function(){return e[E].quaternion}})}return e[E].handleEvent=function(t){var n=!0===t.absolute||"webkitCompassHeading"in t,i=null!==t.alpha||void 0!==t.webkitCompassHeading;if(n&&i){e[E].activated||e[E].notifyActivatedState(),e[E].hasReading=!0,e[E].timestamp=performance.now();var r=null!=t.webkitCompassHeading?360-t.webkitCompassHeading:t.alpha;e[E].quaternion=k(r,t.beta,t.gamma),e.dispatchEvent(new Event("reading"))}else e[E].notifyError("Could not connect to a sensor","NotReadableError")},e[E].deactivateCallback=function(){e[E].quaternion=null},e}return Object(i.a)(n,[{key:"populateMatrix",value:function(e){A(e,this.quaternion)}}]),n}(M(T,"deviceorientationabsolute","deviceorientation"));window.Gyroscope||M(T,"devicemotion"),window.Accelerometer||M(T,"devicemotion"),window.LinearAccelerationSensor||M(T,"devicemotion"),window.GravitySensor||M(T,"devicemotion")},function(e,t,n){"use strict";var i=n(21),r=60103,a=60106;t.Fragment=60107,t.StrictMode=60108,t.Profiler=60114;var o=60109,s=60110,l=60112;t.Suspense=60113;var c=60115,u=60116;if("function"===typeof Symbol&&Symbol.for){var h=Symbol.for;r=h("react.element"),a=h("react.portal"),t.Fragment=h("react.fragment"),t.StrictMode=h("react.strict_mode"),t.Profiler=h("react.profiler"),o=h("react.provider"),s=h("react.context"),l=h("react.forward_ref"),t.Suspense=h("react.suspense"),c=h("react.memo"),u=h("react.lazy")}var d="function"===typeof Symbol&&Symbol.iterator;function p(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m={};function g(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||f}function v(){}function y(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||f}g.prototype.isReactComponent={},g.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error(p(85));this.updater.enqueueSetState(this,e,t,"setState")},g.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},v.prototype=g.prototype;var _=y.prototype=new v;_.constructor=y,i(_,g.prototype),_.isPureReactComponent=!0;var x={current:null},b=Object.prototype.hasOwnProperty,w={key:!0,ref:!0,__self:!0,__source:!0};function S(e,t,n){var i,a={},o=null,s=null;if(null!=t)for(i in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(o=""+t.key),t)b.call(t,i)&&!w.hasOwnProperty(i)&&(a[i]=t[i]);var l=arguments.length-2;if(1===l)a.children=n;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];a.children=c}if(e&&e.defaultProps)for(i in l=e.defaultProps)void 0===a[i]&&(a[i]=l[i]);return{$$typeof:r,type:e,key:o,ref:s,props:a,_owner:x.current}}function T(e){return"object"===typeof e&&null!==e&&e.$$typeof===r}var E=/\/+/g;function M(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function k(e,t,n,i,o){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var l=!1;if(null===e)l=!0;else switch(s){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case r:case a:l=!0}}if(l)return o=o(l=e),e=""===i?"."+M(l,0):i,Array.isArray(o)?(n="",null!=e&&(n=e.replace(E,"$&/")+"/"),k(o,t,n,"",(function(e){return e}))):null!=o&&(T(o)&&(o=function(e,t){return{$$typeof:r,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(o,n+(!o.key||l&&l.key===o.key?"":(""+o.key).replace(E,"$&/")+"/")+e)),t.push(o)),1;if(l=0,i=""===i?".":i+":",Array.isArray(e))for(var c=0;c<e.length;c++){var u=i+M(s=e[c],c);l+=k(s,t,n,u,o)}else if("function"===typeof(u=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=d&&e[d]||e["@@iterator"])?e:null}(e)))for(e=u.call(e),c=0;!(s=e.next()).done;)l+=k(s=s.value,t,n,u=i+M(s,c++),o);else if("object"===s)throw t=""+e,Error(p(31,"[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t));return l}function A(e,t,n){if(null==e)return e;var i=[],r=0;return k(e,i,"","",(function(e){return t.call(n,e,r++)})),i}function C(e){if(-1===e._status){var t=e._result;t=t(),e._status=0,e._result=t,t.then((function(t){0===e._status&&(t=t.default,e._status=1,e._result=t)}),(function(t){0===e._status&&(e._status=2,e._result=t)}))}if(1===e._status)return e._result;throw e._result}var P={current:null};function L(){var e=P.current;if(null===e)throw Error(p(321));return e}var I={ReactCurrentDispatcher:P,ReactCurrentBatchConfig:{transition:0},ReactCurrentOwner:x,IsSomeRendererActing:{current:!1},assign:i};t.Children={map:A,forEach:function(e,t,n){A(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return A(e,(function(){t++})),t},toArray:function(e){return A(e,(function(e){return e}))||[]},only:function(e){if(!T(e))throw Error(p(143));return e}},t.Component=g,t.PureComponent=y,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=I,t.cloneElement=function(e,t,n){if(null===e||void 0===e)throw Error(p(267,e));var a=i({},e.props),o=e.key,s=e.ref,l=e._owner;if(null!=t){if(void 0!==t.ref&&(s=t.ref,l=x.current),void 0!==t.key&&(o=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(u in t)b.call(t,u)&&!w.hasOwnProperty(u)&&(a[u]=void 0===t[u]&&void 0!==c?c[u]:t[u])}var u=arguments.length-2;if(1===u)a.children=n;else if(1<u){c=Array(u);for(var h=0;h<u;h++)c[h]=arguments[h+2];a.children=c}return{$$typeof:r,type:e.type,key:o,ref:s,props:a,_owner:l}},t.createContext=function(e,t){return void 0===t&&(t=null),(e={$$typeof:s,_calculateChangedBits:t,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider={$$typeof:o,_context:e},e.Consumer=e},t.createElement=S,t.createFactory=function(e){var t=S.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:l,render:e}},t.isValidElement=T,t.lazy=function(e){return{$$typeof:u,_payload:{_status:-1,_result:e},_init:C}},t.memo=function(e,t){return{$$typeof:c,type:e,compare:void 0===t?null:t}},t.useCallback=function(e,t){return L().useCallback(e,t)},t.useContext=function(e,t){return L().useContext(e,t)},t.useDebugValue=function(){},t.useEffect=function(e,t){return L().useEffect(e,t)},t.useImperativeHandle=function(e,t,n){return L().useImperativeHandle(e,t,n)},t.useLayoutEffect=function(e,t){return L().useLayoutEffect(e,t)},t.useMemo=function(e,t){return L().useMemo(e,t)},t.useReducer=function(e,t,n){return L().useReducer(e,t,n)},t.useRef=function(e){return L().useRef(e)},t.useState=function(e){return L().useState(e)},t.version="17.0.2"},function(e,t,n){"use strict";var i=n(7),r=n(21),a=n(39);function o(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!i)throw Error(o(227));var s=new Set,l={};function c(e,t){u(e,t),u(e+"Capture",t)}function u(e,t){for(l[e]=t,e=0;e<t.length;e++)s.add(t[e])}var h=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p=Object.prototype.hasOwnProperty,f={},m={};function g(e,t,n,i,r,a,o){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=a,this.removeEmptyString=o}var v={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){v[e]=new g(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];v[t]=new g(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){v[e]=new g(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){v[e]=new g(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){v[e]=new g(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){v[e]=new g(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){v[e]=new g(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){v[e]=new g(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){v[e]=new g(e,5,!1,e.toLowerCase(),null,!1,!1)}));var y=/[\-:]([a-z])/g;function _(e){return e[1].toUpperCase()}function x(e,t,n,i){var r=v.hasOwnProperty(t)?v[t]:null;(null!==r?0===r.type:!i&&(2<t.length&&("o"===t[0]||"O"===t[0])&&("n"===t[1]||"N"===t[1])))||(function(e,t,n,i){if(null===t||"undefined"===typeof t||function(e,t,n,i){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!i&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,i))return!0;if(i)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,r,i)&&(n=null),i||null===r?function(e){return!!p.call(m,e)||!p.call(f,e)&&(d.test(e)?m[e]=!0:(f[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):r.mustUseProperty?e[r.propertyName]=null===n?3!==r.type&&"":n:(t=r.attributeName,i=r.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(r=r.type)||4===r&&!0===n?"":""+n,i?e.setAttributeNS(i,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(y,_);v[t]=new g(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(y,_);v[t]=new g(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(y,_);v[t]=new g(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){v[e]=new g(e,1,!1,e.toLowerCase(),null,!1,!1)})),v.xlinkHref=new g("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){v[e]=new g(e,1,!1,e.toLowerCase(),null,!0,!0)}));var b=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,w=60103,S=60106,T=60107,E=60108,M=60114,k=60109,A=60110,C=60112,P=60113,L=60120,I=60115,R=60116,z=60121,D=60128,O=60129,B=60130,F=60131;if("function"===typeof Symbol&&Symbol.for){var N=Symbol.for;w=N("react.element"),S=N("react.portal"),T=N("react.fragment"),E=N("react.strict_mode"),M=N("react.profiler"),k=N("react.provider"),A=N("react.context"),C=N("react.forward_ref"),P=N("react.suspense"),L=N("react.suspense_list"),I=N("react.memo"),R=N("react.lazy"),z=N("react.block"),N("react.scope"),D=N("react.opaque.id"),O=N("react.debug_trace_mode"),B=N("react.offscreen"),F=N("react.legacy_hidden")}var U,V="function"===typeof Symbol&&Symbol.iterator;function j(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=V&&e[V]||e["@@iterator"])?e:null}function G(e){if(void 0===U)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);U=t&&t[1]||""}return"\n"+U+e}var H=!1;function W(e,t){if(!e||H)return"";H=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(l){var i=l}Reflect.construct(e,[],t)}else{try{t.call()}catch(l){i=l}e.call(t.prototype)}else{try{throw Error()}catch(l){i=l}e()}}catch(l){if(l&&i&&"string"===typeof l.stack){for(var r=l.stack.split("\n"),a=i.stack.split("\n"),o=r.length-1,s=a.length-1;1<=o&&0<=s&&r[o]!==a[s];)s--;for(;1<=o&&0<=s;o--,s--)if(r[o]!==a[s]){if(1!==o||1!==s)do{if(o--,0>--s||r[o]!==a[s])return"\n"+r[o].replace(" at new "," at ")}while(1<=o&&0<=s);break}}}finally{H=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?G(e):""}function q(e){switch(e.tag){case 5:return G(e.type);case 16:return G("Lazy");case 13:return G("Suspense");case 19:return G("SuspenseList");case 0:case 2:case 15:return e=W(e.type,!1);case 11:return e=W(e.type.render,!1);case 22:return e=W(e.type._render,!1);case 1:return e=W(e.type,!0);default:return""}}function Z(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case T:return"Fragment";case S:return"Portal";case M:return"Profiler";case E:return"StrictMode";case P:return"Suspense";case L:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case A:return(e.displayName||"Context")+".Consumer";case k:return(e._context.displayName||"Context")+".Provider";case C:var t=e.render;return t=t.displayName||t.name||"",e.displayName||(""!==t?"ForwardRef("+t+")":"ForwardRef");case I:return Z(e.type);case z:return Z(e._render);case R:t=e._payload,e=e._init;try{return Z(e(t))}catch(n){}}return null}function $(e){switch(typeof e){case"boolean":case"number":case"object":case"string":case"undefined":return e;default:return""}}function X(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function Y(e){e._valueTracker||(e._valueTracker=function(e){var t=X(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),i=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var r=n.get,a=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(e){i=""+e,a.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(e){i=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function J(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),i="";return e&&(i=X(e)?e.checked?"true":"false":e.value),(e=i)!==n&&(t.setValue(e),!0)}function K(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Q(e,t){var n=t.checked;return r({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function ee(e,t){var n=null==t.defaultValue?"":t.defaultValue,i=null!=t.checked?t.checked:t.defaultChecked;n=$(null!=t.value?t.value:n),e._wrapperState={initialChecked:i,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function te(e,t){null!=(t=t.checked)&&x(e,"checked",t,!1)}function ne(e,t){te(e,t);var n=$(t.value),i=t.type;if(null!=n)"number"===i?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===i||"reset"===i)return void e.removeAttribute("value");t.hasOwnProperty("value")?re(e,t.type,n):t.hasOwnProperty("defaultValue")&&re(e,t.type,$(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function ie(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var i=t.type;if(!("submit"!==i&&"reset"!==i||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function re(e,t,n){"number"===t&&K(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}function ae(e,t){return e=r({children:void 0},t),(t=function(e){var t="";return i.Children.forEach(e,(function(e){null!=e&&(t+=e)})),t}(t.children))&&(e.children=t),e}function oe(e,t,n,i){if(e=e.options,t){t={};for(var r=0;r<n.length;r++)t["$"+n[r]]=!0;for(n=0;n<e.length;n++)r=t.hasOwnProperty("$"+e[n].value),e[n].selected!==r&&(e[n].selected=r),r&&i&&(e[n].defaultSelected=!0)}else{for(n=""+$(n),t=null,r=0;r<e.length;r++){if(e[r].value===n)return e[r].selected=!0,void(i&&(e[r].defaultSelected=!0));null!==t||e[r].disabled||(t=e[r])}null!==t&&(t.selected=!0)}}function se(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(o(91));return r({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function le(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(o(92));if(Array.isArray(n)){if(!(1>=n.length))throw Error(o(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:$(n)}}function ce(e,t){var n=$(t.value),i=$(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=i&&(e.defaultValue=""+i)}function ue(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}var he="http://www.w3.org/1999/xhtml",de="http://www.w3.org/2000/svg";function pe(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function fe(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?pe(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var me,ge,ve=(ge=function(e,t){if(e.namespaceURI!==de||"innerHTML"in e)e.innerHTML=t;else{for((me=me||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=me.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,i){MSApp.execUnsafeLocalFunction((function(){return ge(e,t)}))}:ge);function ye(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var _e={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},xe=["Webkit","ms","Moz","O"];function be(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||_e.hasOwnProperty(e)&&_e[e]?(""+t).trim():t+"px"}function we(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var i=0===n.indexOf("--"),r=be(n,t[n],i);"float"===n&&(n="cssFloat"),i?e.setProperty(n,r):e[n]=r}}Object.keys(_e).forEach((function(e){xe.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),_e[t]=_e[e]}))}));var Se=r({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Te(e,t){if(t){if(Se[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(o(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(o(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(o(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(o(62))}}function Ee(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}function Me(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var ke=null,Ae=null,Ce=null;function Pe(e){if(e=er(e)){if("function"!==typeof ke)throw Error(o(280));var t=e.stateNode;t&&(t=nr(t),ke(e.stateNode,e.type,t))}}function Le(e){Ae?Ce?Ce.push(e):Ce=[e]:Ae=e}function Ie(){if(Ae){var e=Ae,t=Ce;if(Ce=Ae=null,Pe(e),t)for(e=0;e<t.length;e++)Pe(t[e])}}function Re(e,t){return e(t)}function ze(e,t,n,i,r){return e(t,n,i,r)}function De(){}var Oe=Re,Be=!1,Fe=!1;function Ne(){null===Ae&&null===Ce||(De(),Ie())}function Ue(e,t){var n=e.stateNode;if(null===n)return null;var i=nr(n);if(null===i)return null;n=i[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(i=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!i;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(o(231,t,typeof n));return n}var Ve=!1;if(h)try{var je={};Object.defineProperty(je,"passive",{get:function(){Ve=!0}}),window.addEventListener("test",je,je),window.removeEventListener("test",je,je)}catch(ge){Ve=!1}function Ge(e,t,n,i,r,a,o,s,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(u){this.onError(u)}}var He=!1,We=null,qe=!1,Ze=null,$e={onError:function(e){He=!0,We=e}};function Xe(e,t,n,i,r,a,o,s,l){He=!1,We=null,Ge.apply($e,arguments)}function Ye(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(1026&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function Je(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function Ke(e){if(Ye(e)!==e)throw Error(o(188))}function Qe(e){if(!(e=function(e){var t=e.alternate;if(!t){if(null===(t=Ye(e)))throw Error(o(188));return t!==e?null:e}for(var n=e,i=t;;){var r=n.return;if(null===r)break;var a=r.alternate;if(null===a){if(null!==(i=r.return)){n=i;continue}break}if(r.child===a.child){for(a=r.child;a;){if(a===n)return Ke(r),e;if(a===i)return Ke(r),t;a=a.sibling}throw Error(o(188))}if(n.return!==i.return)n=r,i=a;else{for(var s=!1,l=r.child;l;){if(l===n){s=!0,n=r,i=a;break}if(l===i){s=!0,i=r,n=a;break}l=l.sibling}if(!s){for(l=a.child;l;){if(l===n){s=!0,n=a,i=r;break}if(l===i){s=!0,i=a,n=r;break}l=l.sibling}if(!s)throw Error(o(189))}}if(n.alternate!==i)throw Error(o(190))}if(3!==n.tag)throw Error(o(188));return n.stateNode.current===n?e:t}(e)))return null;for(var t=e;;){if(5===t.tag||6===t.tag)return t;if(t.child)t.child.return=t,t=t.child;else{if(t===e)break;for(;!t.sibling;){if(!t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}}return null}function et(e,t){for(var n=e.alternate;null!==t;){if(t===e||t===n)return!0;t=t.return}return!1}var tt,nt,it,rt,at=!1,ot=[],st=null,lt=null,ct=null,ut=new Map,ht=new Map,dt=[],pt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function ft(e,t,n,i,r){return{blockedOn:e,domEventName:t,eventSystemFlags:16|n,nativeEvent:r,targetContainers:[i]}}function mt(e,t){switch(e){case"focusin":case"focusout":st=null;break;case"dragenter":case"dragleave":lt=null;break;case"mouseover":case"mouseout":ct=null;break;case"pointerover":case"pointerout":ut.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":ht.delete(t.pointerId)}}function gt(e,t,n,i,r,a){return null===e||e.nativeEvent!==a?(e=ft(t,n,i,r,a),null!==t&&(null!==(t=er(t))&&nt(t)),e):(e.eventSystemFlags|=i,t=e.targetContainers,null!==r&&-1===t.indexOf(r)&&t.push(r),e)}function vt(e){var t=Qi(e.target);if(null!==t){var n=Ye(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=Je(n)))return e.blockedOn=t,void rt(e.lanePriority,(function(){a.unstable_runWithPriority(e.priority,(function(){it(n)}))}))}else if(3===t&&n.stateNode.hydrate)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function yt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Qt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=er(n))&&nt(t),e.blockedOn=n,!1;t.shift()}return!0}function _t(e,t,n){yt(e)&&n.delete(t)}function xt(){for(at=!1;0<ot.length;){var e=ot[0];if(null!==e.blockedOn){null!==(e=er(e.blockedOn))&&tt(e);break}for(var t=e.targetContainers;0<t.length;){var n=Qt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n){e.blockedOn=n;break}t.shift()}null===e.blockedOn&&ot.shift()}null!==st&&yt(st)&&(st=null),null!==lt&&yt(lt)&&(lt=null),null!==ct&&yt(ct)&&(ct=null),ut.forEach(_t),ht.forEach(_t)}function bt(e,t){e.blockedOn===t&&(e.blockedOn=null,at||(at=!0,a.unstable_scheduleCallback(a.unstable_NormalPriority,xt)))}function wt(e){function t(t){return bt(t,e)}if(0<ot.length){bt(ot[0],e);for(var n=1;n<ot.length;n++){var i=ot[n];i.blockedOn===e&&(i.blockedOn=null)}}for(null!==st&&bt(st,e),null!==lt&&bt(lt,e),null!==ct&&bt(ct,e),ut.forEach(t),ht.forEach(t),n=0;n<dt.length;n++)(i=dt[n]).blockedOn===e&&(i.blockedOn=null);for(;0<dt.length&&null===(n=dt[0]).blockedOn;)vt(n),null===n.blockedOn&&dt.shift()}function St(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Tt={animationend:St("Animation","AnimationEnd"),animationiteration:St("Animation","AnimationIteration"),animationstart:St("Animation","AnimationStart"),transitionend:St("Transition","TransitionEnd")},Et={},Mt={};function kt(e){if(Et[e])return Et[e];if(!Tt[e])return e;var t,n=Tt[e];for(t in n)if(n.hasOwnProperty(t)&&t in Mt)return Et[e]=n[t];return e}h&&(Mt=document.createElement("div").style,"AnimationEvent"in window||(delete Tt.animationend.animation,delete Tt.animationiteration.animation,delete Tt.animationstart.animation),"TransitionEvent"in window||delete Tt.transitionend.transition);var At=kt("animationend"),Ct=kt("animationiteration"),Pt=kt("animationstart"),Lt=kt("transitionend"),It=new Map,Rt=new Map,zt=["abort","abort",At,"animationEnd",Ct,"animationIteration",Pt,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",Lt,"transitionEnd","waiting","waiting"];function Dt(e,t){for(var n=0;n<e.length;n+=2){var i=e[n],r=e[n+1];r="on"+(r[0].toUpperCase()+r.slice(1)),Rt.set(i,t),It.set(i,r),c(r,[i])}}(0,a.unstable_now)();var Ot=8;function Bt(e){if(0!==(1&e))return Ot=15,1;if(0!==(2&e))return Ot=14,2;if(0!==(4&e))return Ot=13,4;var t=24&e;return 0!==t?(Ot=12,t):0!==(32&e)?(Ot=11,32):0!==(t=192&e)?(Ot=10,t):0!==(256&e)?(Ot=9,256):0!==(t=3584&e)?(Ot=8,t):0!==(4096&e)?(Ot=7,4096):0!==(t=4186112&e)?(Ot=6,t):0!==(t=62914560&e)?(Ot=5,t):67108864&e?(Ot=4,67108864):0!==(134217728&e)?(Ot=3,134217728):0!==(t=805306368&e)?(Ot=2,t):0!==(1073741824&e)?(Ot=1,1073741824):(Ot=8,e)}function Ft(e,t){var n=e.pendingLanes;if(0===n)return Ot=0;var i=0,r=0,a=e.expiredLanes,o=e.suspendedLanes,s=e.pingedLanes;if(0!==a)i=a,r=Ot=15;else if(0!==(a=134217727&n)){var l=a&~o;0!==l?(i=Bt(l),r=Ot):0!==(s&=a)&&(i=Bt(s),r=Ot)}else 0!==(a=n&~o)?(i=Bt(a),r=Ot):0!==s&&(i=Bt(s),r=Ot);if(0===i)return 0;if(i=n&((0>(i=31-Ht(i))?0:1<<i)<<1)-1,0!==t&&t!==i&&0===(t&o)){if(Bt(t),r<=Ot)return t;Ot=r}if(0!==(t=e.entangledLanes))for(e=e.entanglements,t&=i;0<t;)r=1<<(n=31-Ht(t)),i|=e[n],t&=~r;return i}function Nt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function Ut(e,t){switch(e){case 15:return 1;case 14:return 2;case 12:return 0===(e=Vt(24&~t))?Ut(10,t):e;case 10:return 0===(e=Vt(192&~t))?Ut(8,t):e;case 8:return 0===(e=Vt(3584&~t))&&(0===(e=Vt(4186112&~t))&&(e=512)),e;case 2:return 0===(t=Vt(805306368&~t))&&(t=268435456),t}throw Error(o(358,e))}function Vt(e){return e&-e}function jt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function Gt(e,t,n){e.pendingLanes|=t;var i=t-1;e.suspendedLanes&=i,e.pingedLanes&=i,(e=e.eventTimes)[t=31-Ht(t)]=n}var Ht=Math.clz32?Math.clz32:function(e){return 0===e?32:31-(Wt(e)/qt|0)|0},Wt=Math.log,qt=Math.LN2;var Zt=a.unstable_UserBlockingPriority,$t=a.unstable_runWithPriority,Xt=!0;function Yt(e,t,n,i){Be||De();var r=Kt,a=Be;Be=!0;try{ze(r,e,t,n,i)}finally{(Be=a)||Ne()}}function Jt(e,t,n,i){$t(Zt,Kt.bind(null,e,t,n,i))}function Kt(e,t,n,i){var r;if(Xt)if((r=0===(4&t))&&0<ot.length&&-1<pt.indexOf(e))e=ft(null,e,t,n,i),ot.push(e);else{var a=Qt(e,t,n,i);if(null===a)r&&mt(e,i);else{if(r){if(-1<pt.indexOf(e))return e=ft(a,e,t,n,i),void ot.push(e);if(function(e,t,n,i,r){switch(t){case"focusin":return st=gt(st,e,t,n,i,r),!0;case"dragenter":return lt=gt(lt,e,t,n,i,r),!0;case"mouseover":return ct=gt(ct,e,t,n,i,r),!0;case"pointerover":var a=r.pointerId;return ut.set(a,gt(ut.get(a)||null,e,t,n,i,r)),!0;case"gotpointercapture":return a=r.pointerId,ht.set(a,gt(ht.get(a)||null,e,t,n,i,r)),!0}return!1}(a,e,t,n,i))return;mt(e,i)}Ii(e,t,i,null,n)}}}function Qt(e,t,n,i){var r=Me(i);if(null!==(r=Qi(r))){var a=Ye(r);if(null===a)r=null;else{var o=a.tag;if(13===o){if(null!==(r=Je(a)))return r;r=null}else if(3===o){if(a.stateNode.hydrate)return 3===a.tag?a.stateNode.containerInfo:null;r=null}else a!==r&&(r=null)}}return Ii(e,t,i,r,n),null}var en=null,tn=null,nn=null;function rn(){if(nn)return nn;var e,t,n=tn,i=n.length,r="value"in en?en.value:en.textContent,a=r.length;for(e=0;e<i&&n[e]===r[e];e++);var o=i-e;for(t=1;t<=o&&n[i-t]===r[a-t];t++);return nn=r.slice(e,1<t?1-t:void 0)}function an(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function on(){return!0}function sn(){return!1}function ln(e){function t(t,n,i,r,a){for(var o in this._reactName=t,this._targetInst=i,this.type=n,this.nativeEvent=r,this.target=a,this.currentTarget=null,e)e.hasOwnProperty(o)&&(t=e[o],this[o]=t?t(r):r[o]);return this.isDefaultPrevented=(null!=r.defaultPrevented?r.defaultPrevented:!1===r.returnValue)?on:sn,this.isPropagationStopped=sn,this}return r(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=on)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=on)},persist:function(){},isPersistent:on}),t}var cn,un,hn,dn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},pn=ln(dn),fn=r({},dn,{view:0,detail:0}),mn=ln(fn),gn=r({},fn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:kn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==hn&&(hn&&"mousemove"===e.type?(cn=e.screenX-hn.screenX,un=e.screenY-hn.screenY):un=cn=0,hn=e),cn)},movementY:function(e){return"movementY"in e?e.movementY:un}}),vn=ln(gn),yn=ln(r({},gn,{dataTransfer:0})),_n=ln(r({},fn,{relatedTarget:0})),xn=ln(r({},dn,{animationName:0,elapsedTime:0,pseudoElement:0})),bn=ln(r({},dn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}})),wn=ln(r({},dn,{data:0})),Sn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Tn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},En={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Mn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=En[e])&&!!t[e]}function kn(){return Mn}var An=ln(r({},fn,{key:function(e){if(e.key){var t=Sn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=an(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?Tn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:kn,charCode:function(e){return"keypress"===e.type?an(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?an(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}})),Cn=ln(r({},gn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Pn=ln(r({},fn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:kn})),Ln=ln(r({},dn,{propertyName:0,elapsedTime:0,pseudoElement:0})),In=ln(r({},gn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0})),Rn=[9,13,27,32],zn=h&&"CompositionEvent"in window,Dn=null;h&&"documentMode"in document&&(Dn=document.documentMode);var On=h&&"TextEvent"in window&&!Dn,Bn=h&&(!zn||Dn&&8<Dn&&11>=Dn),Fn=String.fromCharCode(32),Nn=!1;function Un(e,t){switch(e){case"keyup":return-1!==Rn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Vn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var jn=!1;var Gn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Hn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Gn[e.type]:"textarea"===t}function Wn(e,t,n,i){Le(i),0<(t=zi(t,"onChange")).length&&(n=new pn("onChange","change",null,n,i),e.push({event:n,listeners:t}))}var qn=null,Zn=null;function $n(e){Mi(e,0)}function Xn(e){if(J(tr(e)))return e}function Yn(e,t){if("change"===e)return t}var Jn=!1;if(h){var Kn;if(h){var Qn="oninput"in document;if(!Qn){var ei=document.createElement("div");ei.setAttribute("oninput","return;"),Qn="function"===typeof ei.oninput}Kn=Qn}else Kn=!1;Jn=Kn&&(!document.documentMode||9<document.documentMode)}function ti(){qn&&(qn.detachEvent("onpropertychange",ni),Zn=qn=null)}function ni(e){if("value"===e.propertyName&&Xn(Zn)){var t=[];if(Wn(t,Zn,e,Me(e)),e=$n,Be)e(t);else{Be=!0;try{Re(e,t)}finally{Be=!1,Ne()}}}}function ii(e,t,n){"focusin"===e?(ti(),Zn=n,(qn=t).attachEvent("onpropertychange",ni)):"focusout"===e&&ti()}function ri(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Xn(Zn)}function ai(e,t){if("click"===e)return Xn(t)}function oi(e,t){if("input"===e||"change"===e)return Xn(t)}var si="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t},li=Object.prototype.hasOwnProperty;function ci(e,t){if(si(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++)if(!li.call(t,n[i])||!si(e[n[i]],t[n[i]]))return!1;return!0}function ui(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function hi(e,t){var n,i=ui(e);for(e=0;i;){if(3===i.nodeType){if(n=e+i.textContent.length,e<=t&&n>=t)return{node:i,offset:t-e};e=n}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=ui(i)}}function di(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?di(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function pi(){for(var e=window,t=K();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(i){n=!1}if(!n)break;t=K((e=t.contentWindow).document)}return t}function fi(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var mi=h&&"documentMode"in document&&11>=document.documentMode,gi=null,vi=null,yi=null,_i=!1;function xi(e,t,n){var i=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;_i||null==gi||gi!==K(i)||("selectionStart"in(i=gi)&&fi(i)?i={start:i.selectionStart,end:i.selectionEnd}:i={anchorNode:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset},yi&&ci(yi,i)||(yi=i,0<(i=zi(vi,"onSelect")).length&&(t=new pn("onSelect","select",null,t,n),e.push({event:t,listeners:i}),t.target=gi)))}Dt("cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focusin focus focusout blur input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),0),Dt("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1),Dt(zt,2);for(var bi="change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),wi=0;wi<bi.length;wi++)Rt.set(bi[wi],0);u("onMouseEnter",["mouseout","mouseover"]),u("onMouseLeave",["mouseout","mouseover"]),u("onPointerEnter",["pointerout","pointerover"]),u("onPointerLeave",["pointerout","pointerover"]),c("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),c("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),c("onBeforeInput",["compositionend","keypress","textInput","paste"]),c("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Si="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Ti=new Set("cancel close invalid load scroll toggle".split(" ").concat(Si));function Ei(e,t,n){var i=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,i,r,a,s,l,c){if(Xe.apply(this,arguments),He){if(!He)throw Error(o(198));var u=We;He=!1,We=null,qe||(qe=!0,Ze=u)}}(i,t,void 0,e),e.currentTarget=null}function Mi(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var i=e[n],r=i.event;i=i.listeners;e:{var a=void 0;if(t)for(var o=i.length-1;0<=o;o--){var s=i[o],l=s.instance,c=s.currentTarget;if(s=s.listener,l!==a&&r.isPropagationStopped())break e;Ei(r,s,c),a=l}else for(o=0;o<i.length;o++){if(l=(s=i[o]).instance,c=s.currentTarget,s=s.listener,l!==a&&r.isPropagationStopped())break e;Ei(r,s,c),a=l}}}if(qe)throw e=Ze,qe=!1,Ze=null,e}function ki(e,t){var n=ir(t),i=e+"__bubble";n.has(i)||(Li(t,e,2,!1),n.add(i))}var Ai="_reactListening"+Math.random().toString(36).slice(2);function Ci(e){e[Ai]||(e[Ai]=!0,s.forEach((function(t){Ti.has(t)||Pi(t,!1,e,null),Pi(t,!0,e,null)})))}function Pi(e,t,n,i){var r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,a=n;if("selectionchange"===e&&9!==n.nodeType&&(a=n.ownerDocument),null!==i&&!t&&Ti.has(e)){if("scroll"!==e)return;r|=2,a=i}var o=ir(a),s=e+"__"+(t?"capture":"bubble");o.has(s)||(t&&(r|=4),Li(a,e,r,t),o.add(s))}function Li(e,t,n,i){var r=Rt.get(t);switch(void 0===r?2:r){case 0:r=Yt;break;case 1:r=Jt;break;default:r=Kt}n=r.bind(null,t,n,e),r=void 0,!Ve||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(r=!0),i?void 0!==r?e.addEventListener(t,n,{capture:!0,passive:r}):e.addEventListener(t,n,!0):void 0!==r?e.addEventListener(t,n,{passive:r}):e.addEventListener(t,n,!1)}function Ii(e,t,n,i,r){var a=i;if(0===(1&t)&&0===(2&t)&&null!==i)e:for(;;){if(null===i)return;var o=i.tag;if(3===o||4===o){var s=i.stateNode.containerInfo;if(s===r||8===s.nodeType&&s.parentNode===r)break;if(4===o)for(o=i.return;null!==o;){var l=o.tag;if((3===l||4===l)&&((l=o.stateNode.containerInfo)===r||8===l.nodeType&&l.parentNode===r))return;o=o.return}for(;null!==s;){if(null===(o=Qi(s)))return;if(5===(l=o.tag)||6===l){i=a=o;continue e}s=s.parentNode}}i=i.return}!function(e,t,n){if(Fe)return e(t,n);Fe=!0;try{Oe(e,t,n)}finally{Fe=!1,Ne()}}((function(){var i=a,r=Me(n),o=[];e:{var s=It.get(e);if(void 0!==s){var l=pn,c=e;switch(e){case"keypress":if(0===an(n))break e;case"keydown":case"keyup":l=An;break;case"focusin":c="focus",l=_n;break;case"focusout":c="blur",l=_n;break;case"beforeblur":case"afterblur":l=_n;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=vn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=yn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=Pn;break;case At:case Ct:case Pt:l=xn;break;case Lt:l=Ln;break;case"scroll":l=mn;break;case"wheel":l=In;break;case"copy":case"cut":case"paste":l=bn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=Cn}var u=0!==(4&t),h=!u&&"scroll"===e,d=u?null!==s?s+"Capture":null:s;u=[];for(var p,f=i;null!==f;){var m=(p=f).stateNode;if(5===p.tag&&null!==m&&(p=m,null!==d&&(null!=(m=Ue(f,d))&&u.push(Ri(f,m,p)))),h)break;f=f.return}0<u.length&&(s=new l(s,c,null,n,r),o.push({event:s,listeners:u}))}}if(0===(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||0!==(16&t)||!(c=n.relatedTarget||n.fromElement)||!Qi(c)&&!c[Ji])&&(l||s)&&(s=r.window===r?r:(s=r.ownerDocument)?s.defaultView||s.parentWindow:window,l?(l=i,null!==(c=(c=n.relatedTarget||n.toElement)?Qi(c):null)&&(c!==(h=Ye(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=i),l!==c)){if(u=vn,m="onMouseLeave",d="onMouseEnter",f="mouse","pointerout"!==e&&"pointerover"!==e||(u=Cn,m="onPointerLeave",d="onPointerEnter",f="pointer"),h=null==l?s:tr(l),p=null==c?s:tr(c),(s=new u(m,f+"leave",l,n,r)).target=h,s.relatedTarget=p,m=null,Qi(r)===i&&((u=new u(d,f+"enter",c,n,r)).target=p,u.relatedTarget=h,m=u),h=m,l&&c)e:{for(d=c,f=0,p=u=l;p;p=Di(p))f++;for(p=0,m=d;m;m=Di(m))p++;for(;0<f-p;)u=Di(u),f--;for(;0<p-f;)d=Di(d),p--;for(;f--;){if(u===d||null!==d&&u===d.alternate)break e;u=Di(u),d=Di(d)}u=null}else u=null;null!==l&&Oi(o,s,l,u,!1),null!==c&&null!==h&&Oi(o,h,c,u,!0)}if("select"===(l=(s=i?tr(i):window).nodeName&&s.nodeName.toLowerCase())||"input"===l&&"file"===s.type)var g=Yn;else if(Hn(s))if(Jn)g=oi;else{g=ri;var v=ii}else(l=s.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(g=ai);switch(g&&(g=g(e,i))?Wn(o,g,n,r):(v&&v(e,s,i),"focusout"===e&&(v=s._wrapperState)&&v.controlled&&"number"===s.type&&re(s,"number",s.value)),v=i?tr(i):window,e){case"focusin":(Hn(v)||"true"===v.contentEditable)&&(gi=v,vi=i,yi=null);break;case"focusout":yi=vi=gi=null;break;case"mousedown":_i=!0;break;case"contextmenu":case"mouseup":case"dragend":_i=!1,xi(o,n,r);break;case"selectionchange":if(mi)break;case"keydown":case"keyup":xi(o,n,r)}var y;if(zn)e:{switch(e){case"compositionstart":var _="onCompositionStart";break e;case"compositionend":_="onCompositionEnd";break e;case"compositionupdate":_="onCompositionUpdate";break e}_=void 0}else jn?Un(e,n)&&(_="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(_="onCompositionStart");_&&(Bn&&"ko"!==n.locale&&(jn||"onCompositionStart"!==_?"onCompositionEnd"===_&&jn&&(y=rn()):(tn="value"in(en=r)?en.value:en.textContent,jn=!0)),0<(v=zi(i,_)).length&&(_=new wn(_,e,null,n,r),o.push({event:_,listeners:v}),y?_.data=y:null!==(y=Vn(n))&&(_.data=y))),(y=On?function(e,t){switch(e){case"compositionend":return Vn(t);case"keypress":return 32!==t.which?null:(Nn=!0,Fn);case"textInput":return(e=t.data)===Fn&&Nn?null:e;default:return null}}(e,n):function(e,t){if(jn)return"compositionend"===e||!zn&&Un(e,t)?(e=rn(),nn=tn=en=null,jn=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Bn&&"ko"!==t.locale?null:t.data;default:return null}}(e,n))&&(0<(i=zi(i,"onBeforeInput")).length&&(r=new wn("onBeforeInput","beforeinput",null,n,r),o.push({event:r,listeners:i}),r.data=y))}Mi(o,t)}))}function Ri(e,t,n){return{instance:e,listener:t,currentTarget:n}}function zi(e,t){for(var n=t+"Capture",i=[];null!==e;){var r=e,a=r.stateNode;5===r.tag&&null!==a&&(r=a,null!=(a=Ue(e,n))&&i.unshift(Ri(e,a,r)),null!=(a=Ue(e,t))&&i.push(Ri(e,a,r))),e=e.return}return i}function Di(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Oi(e,t,n,i,r){for(var a=t._reactName,o=[];null!==n&&n!==i;){var s=n,l=s.alternate,c=s.stateNode;if(null!==l&&l===i)break;5===s.tag&&null!==c&&(s=c,r?null!=(l=Ue(n,a))&&o.unshift(Ri(n,l,s)):r||null!=(l=Ue(n,a))&&o.push(Ri(n,l,s))),n=n.return}0!==o.length&&e.push({event:t,listeners:o})}function Bi(){}var Fi=null,Ni=null;function Ui(e,t){switch(e){case"button":case"input":case"select":case"textarea":return!!t.autoFocus}return!1}function Vi(e,t){return"textarea"===e||"option"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ji="function"===typeof setTimeout?setTimeout:void 0,Gi="function"===typeof clearTimeout?clearTimeout:void 0;function Hi(e){1===e.nodeType?e.textContent="":9===e.nodeType&&(null!=(e=e.body)&&(e.textContent=""))}function Wi(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break}return e}function qi(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var Zi=0;var $i=Math.random().toString(36).slice(2),Xi="__reactFiber$"+$i,Yi="__reactProps$"+$i,Ji="__reactContainer$"+$i,Ki="__reactEvents$"+$i;function Qi(e){var t=e[Xi];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Ji]||n[Xi]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=qi(e);null!==e;){if(n=e[Xi])return n;e=qi(e)}return t}n=(e=n).parentNode}return null}function er(e){return!(e=e[Xi]||e[Ji])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function tr(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(o(33))}function nr(e){return e[Yi]||null}function ir(e){var t=e[Ki];return void 0===t&&(t=e[Ki]=new Set),t}var rr=[],ar=-1;function or(e){return{current:e}}function sr(e){0>ar||(e.current=rr[ar],rr[ar]=null,ar--)}function lr(e,t){ar++,rr[ar]=e.current,e.current=t}var cr={},ur=or(cr),hr=or(!1),dr=cr;function pr(e,t){var n=e.type.contextTypes;if(!n)return cr;var i=e.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===t)return i.__reactInternalMemoizedMaskedChildContext;var r,a={};for(r in n)a[r]=t[r];return i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function fr(e){return null!==(e=e.childContextTypes)&&void 0!==e}function mr(){sr(hr),sr(ur)}function gr(e,t,n){if(ur.current!==cr)throw Error(o(168));lr(ur,t),lr(hr,n)}function vr(e,t,n){var i=e.stateNode;if(e=t.childContextTypes,"function"!==typeof i.getChildContext)return n;for(var a in i=i.getChildContext())if(!(a in e))throw Error(o(108,Z(t)||"Unknown",a));return r({},n,i)}function yr(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||cr,dr=ur.current,lr(ur,e),lr(hr,hr.current),!0}function _r(e,t,n){var i=e.stateNode;if(!i)throw Error(o(169));n?(e=vr(e,t,dr),i.__reactInternalMemoizedMergedChildContext=e,sr(hr),sr(ur),lr(ur,e)):sr(hr),lr(hr,n)}var xr=null,br=null,wr=a.unstable_runWithPriority,Sr=a.unstable_scheduleCallback,Tr=a.unstable_cancelCallback,Er=a.unstable_shouldYield,Mr=a.unstable_requestPaint,kr=a.unstable_now,Ar=a.unstable_getCurrentPriorityLevel,Cr=a.unstable_ImmediatePriority,Pr=a.unstable_UserBlockingPriority,Lr=a.unstable_NormalPriority,Ir=a.unstable_LowPriority,Rr=a.unstable_IdlePriority,zr={},Dr=void 0!==Mr?Mr:function(){},Or=null,Br=null,Fr=!1,Nr=kr(),Ur=1e4>Nr?kr:function(){return kr()-Nr};function Vr(){switch(Ar()){case Cr:return 99;case Pr:return 98;case Lr:return 97;case Ir:return 96;case Rr:return 95;default:throw Error(o(332))}}function jr(e){switch(e){case 99:return Cr;case 98:return Pr;case 97:return Lr;case 96:return Ir;case 95:return Rr;default:throw Error(o(332))}}function Gr(e,t){return e=jr(e),wr(e,t)}function Hr(e,t,n){return e=jr(e),Sr(e,t,n)}function Wr(){if(null!==Br){var e=Br;Br=null,Tr(e)}qr()}function qr(){if(!Fr&&null!==Or){Fr=!0;var e=0;try{var t=Or;Gr(99,(function(){for(;e<t.length;e++){var n=t[e];do{n=n(!0)}while(null!==n)}})),Or=null}catch(n){throw null!==Or&&(Or=Or.slice(e+1)),Sr(Cr,Wr),n}finally{Fr=!1}}}var Zr=b.ReactCurrentBatchConfig;function $r(e,t){if(e&&e.defaultProps){for(var n in t=r({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var Xr=or(null),Yr=null,Jr=null,Kr=null;function Qr(){Kr=Jr=Yr=null}function ea(e){var t=Xr.current;sr(Xr),e.type._context._currentValue=t}function ta(e,t){for(;null!==e;){var n=e.alternate;if((e.childLanes&t)===t){if(null===n||(n.childLanes&t)===t)break;n.childLanes|=t}else e.childLanes|=t,null!==n&&(n.childLanes|=t);e=e.return}}function na(e,t){Yr=e,Kr=Jr=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(zo=!0),e.firstContext=null)}function ia(e,t){if(Kr!==e&&!1!==t&&0!==t)if("number"===typeof t&&1073741823!==t||(Kr=e,t=1073741823),t={context:e,observedBits:t,next:null},null===Jr){if(null===Yr)throw Error(o(308));Jr=t,Yr.dependencies={lanes:0,firstContext:t,responders:null}}else Jr=Jr.next=t;return e._currentValue}var ra=!1;function aa(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null},effects:null}}function oa(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function sa(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function la(e,t){if(null!==(e=e.updateQueue)){var n=(e=e.shared).pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}}function ca(e,t){var n=e.updateQueue,i=e.alternate;if(null!==i&&n===(i=i.updateQueue)){var r=null,a=null;if(null!==(n=n.firstBaseUpdate)){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===a?r=a=o:a=a.next=o,n=n.next}while(null!==n);null===a?r=a=t:a=a.next=t}else r=a=t;return n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:a,shared:i.shared,effects:i.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function ua(e,t,n,i){var a=e.updateQueue;ra=!1;var o=a.firstBaseUpdate,s=a.lastBaseUpdate,l=a.shared.pending;if(null!==l){a.shared.pending=null;var c=l,u=c.next;c.next=null,null===s?o=u:s.next=u,s=c;var h=e.alternate;if(null!==h){var d=(h=h.updateQueue).lastBaseUpdate;d!==s&&(null===d?h.firstBaseUpdate=u:d.next=u,h.lastBaseUpdate=c)}}if(null!==o){for(d=a.baseState,s=0,h=u=c=null;;){l=o.lane;var p=o.eventTime;if((i&l)===l){null!==h&&(h=h.next={eventTime:p,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var f=e,m=o;switch(l=t,p=n,m.tag){case 1:if("function"===typeof(f=m.payload)){d=f.call(p,d,l);break e}d=f;break e;case 3:f.flags=-4097&f.flags|64;case 0:if(null===(l="function"===typeof(f=m.payload)?f.call(p,d,l):f)||void 0===l)break e;d=r({},d,l);break e;case 2:ra=!0}}null!==o.callback&&(e.flags|=32,null===(l=a.effects)?a.effects=[o]:l.push(o))}else p={eventTime:p,lane:l,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===h?(u=h=p,c=d):h=h.next=p,s|=l;if(null===(o=o.next)){if(null===(l=a.shared.pending))break;o=l.next,l.next=null,a.lastBaseUpdate=l,a.shared.pending=null}}null===h&&(c=d),a.baseState=c,a.firstBaseUpdate=u,a.lastBaseUpdate=h,Fs|=s,e.lanes=s,e.memoizedState=d}}function ha(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var i=e[t],r=i.callback;if(null!==r){if(i.callback=null,i=n,"function"!==typeof r)throw Error(o(191,r));r.call(i)}}}var da=(new i.Component).refs;function pa(e,t,n,i){n=null===(n=n(i,t=e.memoizedState))||void 0===n?t:r({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var fa={isMounted:function(e){return!!(e=e._reactInternals)&&Ye(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var i=cl(),r=ul(e),a=sa(i,r);a.payload=t,void 0!==n&&null!==n&&(a.callback=n),la(e,a),hl(e,r,i)},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var i=cl(),r=ul(e),a=sa(i,r);a.tag=1,a.payload=t,void 0!==n&&null!==n&&(a.callback=n),la(e,a),hl(e,r,i)},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=cl(),i=ul(e),r=sa(n,i);r.tag=2,void 0!==t&&null!==t&&(r.callback=t),la(e,r),hl(e,i,n)}};function ma(e,t,n,i,r,a,o){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(i,a,o):!t.prototype||!t.prototype.isPureReactComponent||(!ci(n,i)||!ci(r,a))}function ga(e,t,n){var i=!1,r=cr,a=t.contextType;return"object"===typeof a&&null!==a?a=ia(a):(r=fr(t)?dr:ur.current,a=(i=null!==(i=t.contextTypes)&&void 0!==i)?pr(e,r):cr),t=new t(n,a),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=fa,e.stateNode=t,t._reactInternals=e,i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=a),t}function va(e,t,n,i){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,i),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,i),t.state!==e&&fa.enqueueReplaceState(t,t.state,null)}function ya(e,t,n,i){var r=e.stateNode;r.props=n,r.state=e.memoizedState,r.refs=da,aa(e);var a=t.contextType;"object"===typeof a&&null!==a?r.context=ia(a):(a=fr(t)?dr:ur.current,r.context=pr(e,a)),ua(e,n,r,i),r.state=e.memoizedState,"function"===typeof(a=t.getDerivedStateFromProps)&&(pa(e,t,a,n),r.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof r.getSnapshotBeforeUpdate||"function"!==typeof r.UNSAFE_componentWillMount&&"function"!==typeof r.componentWillMount||(t=r.state,"function"===typeof r.componentWillMount&&r.componentWillMount(),"function"===typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),t!==r.state&&fa.enqueueReplaceState(r,r.state,null),ua(e,n,r,i),r.state=e.memoizedState),"function"===typeof r.componentDidMount&&(e.flags|=4)}var _a=Array.isArray;function xa(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(o(309));var i=n.stateNode}if(!i)throw Error(o(147,e));var r=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===r?t.ref:((t=function(e){var t=i.refs;t===da&&(t=i.refs={}),null===e?delete t[r]:t[r]=e})._stringRef=r,t)}if("string"!==typeof e)throw Error(o(284));if(!n._owner)throw Error(o(290,e))}return e}function ba(e,t){if("textarea"!==e.type)throw Error(o(31,"[object Object]"===Object.prototype.toString.call(t)?"object with keys {"+Object.keys(t).join(", ")+"}":t))}function wa(e){function t(t,n){if(e){var i=t.lastEffect;null!==i?(i.nextEffect=n,t.lastEffect=n):t.firstEffect=t.lastEffect=n,n.nextEffect=null,n.flags=8}}function n(n,i){if(!e)return null;for(;null!==i;)t(n,i),i=i.sibling;return null}function i(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function r(e,t){return(e=Gl(e,t)).index=0,e.sibling=null,e}function a(t,n,i){return t.index=i,e?null!==(i=t.alternate)?(i=i.index)<n?(t.flags=2,n):i:(t.flags=2,n):n}function s(t){return e&&null===t.alternate&&(t.flags=2),t}function l(e,t,n,i){return null===t||6!==t.tag?((t=Zl(n,e.mode,i)).return=e,t):((t=r(t,n)).return=e,t)}function c(e,t,n,i){return null!==t&&t.elementType===n.type?((i=r(t,n.props)).ref=xa(e,t,n),i.return=e,i):((i=Hl(n.type,n.key,n.props,null,e.mode,i)).ref=xa(e,t,n),i.return=e,i)}function u(e,t,n,i){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=$l(n,e.mode,i)).return=e,t):((t=r(t,n.children||[])).return=e,t)}function h(e,t,n,i,a){return null===t||7!==t.tag?((t=Wl(n,e.mode,i,a)).return=e,t):((t=r(t,n)).return=e,t)}function d(e,t,n){if("string"===typeof t||"number"===typeof t)return(t=Zl(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case w:return(n=Hl(t.type,t.key,t.props,null,e.mode,n)).ref=xa(e,null,t),n.return=e,n;case S:return(t=$l(t,e.mode,n)).return=e,t}if(_a(t)||j(t))return(t=Wl(t,e.mode,n,null)).return=e,t;ba(e,t)}return null}function p(e,t,n,i){var r=null!==t?t.key:null;if("string"===typeof n||"number"===typeof n)return null!==r?null:l(e,t,""+n,i);if("object"===typeof n&&null!==n){switch(n.$$typeof){case w:return n.key===r?n.type===T?h(e,t,n.props.children,i,r):c(e,t,n,i):null;case S:return n.key===r?u(e,t,n,i):null}if(_a(n)||j(n))return null!==r?null:h(e,t,n,i,null);ba(e,n)}return null}function f(e,t,n,i,r){if("string"===typeof i||"number"===typeof i)return l(t,e=e.get(n)||null,""+i,r);if("object"===typeof i&&null!==i){switch(i.$$typeof){case w:return e=e.get(null===i.key?n:i.key)||null,i.type===T?h(t,e,i.props.children,r,i.key):c(t,e,i,r);case S:return u(t,e=e.get(null===i.key?n:i.key)||null,i,r)}if(_a(i)||j(i))return h(t,e=e.get(n)||null,i,r,null);ba(t,i)}return null}function m(r,o,s,l){for(var c=null,u=null,h=o,m=o=0,g=null;null!==h&&m<s.length;m++){h.index>m?(g=h,h=null):g=h.sibling;var v=p(r,h,s[m],l);if(null===v){null===h&&(h=g);break}e&&h&&null===v.alternate&&t(r,h),o=a(v,o,m),null===u?c=v:u.sibling=v,u=v,h=g}if(m===s.length)return n(r,h),c;if(null===h){for(;m<s.length;m++)null!==(h=d(r,s[m],l))&&(o=a(h,o,m),null===u?c=h:u.sibling=h,u=h);return c}for(h=i(r,h);m<s.length;m++)null!==(g=f(h,r,m,s[m],l))&&(e&&null!==g.alternate&&h.delete(null===g.key?m:g.key),o=a(g,o,m),null===u?c=g:u.sibling=g,u=g);return e&&h.forEach((function(e){return t(r,e)})),c}function g(r,s,l,c){var u=j(l);if("function"!==typeof u)throw Error(o(150));if(null==(l=u.call(l)))throw Error(o(151));for(var h=u=null,m=s,g=s=0,v=null,y=l.next();null!==m&&!y.done;g++,y=l.next()){m.index>g?(v=m,m=null):v=m.sibling;var _=p(r,m,y.value,c);if(null===_){null===m&&(m=v);break}e&&m&&null===_.alternate&&t(r,m),s=a(_,s,g),null===h?u=_:h.sibling=_,h=_,m=v}if(y.done)return n(r,m),u;if(null===m){for(;!y.done;g++,y=l.next())null!==(y=d(r,y.value,c))&&(s=a(y,s,g),null===h?u=y:h.sibling=y,h=y);return u}for(m=i(r,m);!y.done;g++,y=l.next())null!==(y=f(m,r,g,y.value,c))&&(e&&null!==y.alternate&&m.delete(null===y.key?g:y.key),s=a(y,s,g),null===h?u=y:h.sibling=y,h=y);return e&&m.forEach((function(e){return t(r,e)})),u}return function(e,i,a,l){var c="object"===typeof a&&null!==a&&a.type===T&&null===a.key;c&&(a=a.props.children);var u="object"===typeof a&&null!==a;if(u)switch(a.$$typeof){case w:e:{for(u=a.key,c=i;null!==c;){if(c.key===u){switch(c.tag){case 7:if(a.type===T){n(e,c.sibling),(i=r(c,a.props.children)).return=e,e=i;break e}break;default:if(c.elementType===a.type){n(e,c.sibling),(i=r(c,a.props)).ref=xa(e,c,a),i.return=e,e=i;break e}}n(e,c);break}t(e,c),c=c.sibling}a.type===T?((i=Wl(a.props.children,e.mode,l,a.key)).return=e,e=i):((l=Hl(a.type,a.key,a.props,null,e.mode,l)).ref=xa(e,i,a),l.return=e,e=l)}return s(e);case S:e:{for(c=a.key;null!==i;){if(i.key===c){if(4===i.tag&&i.stateNode.containerInfo===a.containerInfo&&i.stateNode.implementation===a.implementation){n(e,i.sibling),(i=r(i,a.children||[])).return=e,e=i;break e}n(e,i);break}t(e,i),i=i.sibling}(i=$l(a,e.mode,l)).return=e,e=i}return s(e)}if("string"===typeof a||"number"===typeof a)return a=""+a,null!==i&&6===i.tag?(n(e,i.sibling),(i=r(i,a)).return=e,e=i):(n(e,i),(i=Zl(a,e.mode,l)).return=e,e=i),s(e);if(_a(a))return m(e,i,a,l);if(j(a))return g(e,i,a,l);if(u&&ba(e,a),"undefined"===typeof a&&!c)switch(e.tag){case 1:case 22:case 0:case 11:case 15:throw Error(o(152,Z(e.type)||"Component"))}return n(e,i)}}var Sa=wa(!0),Ta=wa(!1),Ea={},Ma=or(Ea),ka=or(Ea),Aa=or(Ea);function Ca(e){if(e===Ea)throw Error(o(174));return e}function Pa(e,t){switch(lr(Aa,t),lr(ka,e),lr(Ma,Ea),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:fe(null,"");break;default:t=fe(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}sr(Ma),lr(Ma,t)}function La(){sr(Ma),sr(ka),sr(Aa)}function Ia(e){Ca(Aa.current);var t=Ca(Ma.current),n=fe(t,e.type);t!==n&&(lr(ka,e),lr(Ma,n))}function Ra(e){ka.current===e&&(sr(Ma),sr(ka))}var za=or(0);function Da(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(64&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Oa=null,Ba=null,Fa=!1;function Na(e,t){var n=Vl(5,null,null,0);n.elementType="DELETED",n.type="DELETED",n.stateNode=t,n.return=e,n.flags=8,null!==e.lastEffect?(e.lastEffect.nextEffect=n,e.lastEffect=n):e.firstEffect=e.lastEffect=n}function Ua(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,!0);case 13:default:return!1}}function Va(e){if(Fa){var t=Ba;if(t){var n=t;if(!Ua(e,t)){if(!(t=Wi(n.nextSibling))||!Ua(e,t))return e.flags=-1025&e.flags|2,Fa=!1,void(Oa=e);Na(Oa,n)}Oa=e,Ba=Wi(t.firstChild)}else e.flags=-1025&e.flags|2,Fa=!1,Oa=e}}function ja(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;Oa=e}function Ga(e){if(e!==Oa)return!1;if(!Fa)return ja(e),Fa=!0,!1;var t=e.type;if(5!==e.tag||"head"!==t&&"body"!==t&&!Vi(t,e.memoizedProps))for(t=Ba;t;)Na(e,t),t=Wi(t.nextSibling);if(ja(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(o(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){Ba=Wi(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}Ba=null}}else Ba=Oa?Wi(e.stateNode.nextSibling):null;return!0}function Ha(){Ba=Oa=null,Fa=!1}var Wa=[];function qa(){for(var e=0;e<Wa.length;e++)Wa[e]._workInProgressVersionPrimary=null;Wa.length=0}var Za=b.ReactCurrentDispatcher,$a=b.ReactCurrentBatchConfig,Xa=0,Ya=null,Ja=null,Ka=null,Qa=!1,eo=!1;function to(){throw Error(o(321))}function no(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!si(e[n],t[n]))return!1;return!0}function io(e,t,n,i,r,a){if(Xa=a,Ya=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Za.current=null===e||null===e.memoizedState?Po:Lo,e=n(i,r),eo){a=0;do{if(eo=!1,!(25>a))throw Error(o(301));a+=1,Ka=Ja=null,t.updateQueue=null,Za.current=Io,e=n(i,r)}while(eo)}if(Za.current=Co,t=null!==Ja&&null!==Ja.next,Xa=0,Ka=Ja=Ya=null,Qa=!1,t)throw Error(o(300));return e}function ro(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===Ka?Ya.memoizedState=Ka=e:Ka=Ka.next=e,Ka}function ao(){if(null===Ja){var e=Ya.alternate;e=null!==e?e.memoizedState:null}else e=Ja.next;var t=null===Ka?Ya.memoizedState:Ka.next;if(null!==t)Ka=t,Ja=e;else{if(null===e)throw Error(o(310));e={memoizedState:(Ja=e).memoizedState,baseState:Ja.baseState,baseQueue:Ja.baseQueue,queue:Ja.queue,next:null},null===Ka?Ya.memoizedState=Ka=e:Ka=Ka.next=e}return Ka}function oo(e,t){return"function"===typeof t?t(e):t}function so(e){var t=ao(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var i=Ja,r=i.baseQueue,a=n.pending;if(null!==a){if(null!==r){var s=r.next;r.next=a.next,a.next=s}i.baseQueue=r=a,n.pending=null}if(null!==r){r=r.next,i=i.baseState;var l=s=a=null,c=r;do{var u=c.lane;if((Xa&u)===u)null!==l&&(l=l.next={lane:0,action:c.action,eagerReducer:c.eagerReducer,eagerState:c.eagerState,next:null}),i=c.eagerReducer===e?c.eagerState:e(i,c.action);else{var h={lane:u,action:c.action,eagerReducer:c.eagerReducer,eagerState:c.eagerState,next:null};null===l?(s=l=h,a=i):l=l.next=h,Ya.lanes|=u,Fs|=u}c=c.next}while(null!==c&&c!==r);null===l?a=i:l.next=s,si(i,t.memoizedState)||(zo=!0),t.memoizedState=i,t.baseState=a,t.baseQueue=l,n.lastRenderedState=i}return[t.memoizedState,n.dispatch]}function lo(e){var t=ao(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var i=n.dispatch,r=n.pending,a=t.memoizedState;if(null!==r){n.pending=null;var s=r=r.next;do{a=e(a,s.action),s=s.next}while(s!==r);si(a,t.memoizedState)||(zo=!0),t.memoizedState=a,null===t.baseQueue&&(t.baseState=a),n.lastRenderedState=a}return[a,i]}function co(e,t,n){var i=t._getVersion;i=i(t._source);var r=t._workInProgressVersionPrimary;if(null!==r?e=r===i:(e=e.mutableReadLanes,(e=(Xa&e)===e)&&(t._workInProgressVersionPrimary=i,Wa.push(t))),e)return n(t._source);throw Wa.push(t),Error(o(350))}function uo(e,t,n,i){var r=Ps;if(null===r)throw Error(o(349));var a=t._getVersion,s=a(t._source),l=Za.current,c=l.useState((function(){return co(r,t,n)})),u=c[1],h=c[0];c=Ka;var d=e.memoizedState,p=d.refs,f=p.getSnapshot,m=d.source;d=d.subscribe;var g=Ya;return e.memoizedState={refs:p,source:t,subscribe:i},l.useEffect((function(){p.getSnapshot=n,p.setSnapshot=u;var e=a(t._source);if(!si(s,e)){e=n(t._source),si(h,e)||(u(e),e=ul(g),r.mutableReadLanes|=e&r.pendingLanes),e=r.mutableReadLanes,r.entangledLanes|=e;for(var i=r.entanglements,o=e;0<o;){var l=31-Ht(o),c=1<<l;i[l]|=e,o&=~c}}}),[n,t,i]),l.useEffect((function(){return i(t._source,(function(){var e=p.getSnapshot,n=p.setSnapshot;try{n(e(t._source));var i=ul(g);r.mutableReadLanes|=i&r.pendingLanes}catch(a){n((function(){throw a}))}}))}),[t,i]),si(f,n)&&si(m,t)&&si(d,i)||((e={pending:null,dispatch:null,lastRenderedReducer:oo,lastRenderedState:h}).dispatch=u=Ao.bind(null,Ya,e),c.queue=e,c.baseQueue=null,h=co(r,t,n),c.memoizedState=c.baseState=h),h}function ho(e,t,n){return uo(ao(),e,t,n)}function po(e){var t=ro();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e=(e=t.queue={pending:null,dispatch:null,lastRenderedReducer:oo,lastRenderedState:e}).dispatch=Ao.bind(null,Ya,e),[t.memoizedState,e]}function fo(e,t,n,i){return e={tag:e,create:t,destroy:n,deps:i,next:null},null===(t=Ya.updateQueue)?(t={lastEffect:null},Ya.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(i=n.next,n.next=e,e.next=i,t.lastEffect=e),e}function mo(e){return e={current:e},ro().memoizedState=e}function go(){return ao().memoizedState}function vo(e,t,n,i){var r=ro();Ya.flags|=e,r.memoizedState=fo(1|t,n,void 0,void 0===i?null:i)}function yo(e,t,n,i){var r=ao();i=void 0===i?null:i;var a=void 0;if(null!==Ja){var o=Ja.memoizedState;if(a=o.destroy,null!==i&&no(i,o.deps))return void fo(t,n,a,i)}Ya.flags|=e,r.memoizedState=fo(1|t,n,a,i)}function _o(e,t){return vo(516,4,e,t)}function xo(e,t){return yo(516,4,e,t)}function bo(e,t){return yo(4,2,e,t)}function wo(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function So(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,yo(4,2,wo.bind(null,t,e),n)}function To(){}function Eo(e,t){var n=ao();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&no(t,i[1])?i[0]:(n.memoizedState=[e,t],e)}function Mo(e,t){var n=ao();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&no(t,i[1])?i[0]:(e=e(),n.memoizedState=[e,t],e)}function ko(e,t){var n=Vr();Gr(98>n?98:n,(function(){e(!0)})),Gr(97<n?97:n,(function(){var n=$a.transition;$a.transition=1;try{e(!1),t()}finally{$a.transition=n}}))}function Ao(e,t,n){var i=cl(),r=ul(e),a={lane:r,action:n,eagerReducer:null,eagerState:null,next:null},o=t.pending;if(null===o?a.next=a:(a.next=o.next,o.next=a),t.pending=a,o=e.alternate,e===Ya||null!==o&&o===Ya)eo=Qa=!0;else{if(0===e.lanes&&(null===o||0===o.lanes)&&null!==(o=t.lastRenderedReducer))try{var s=t.lastRenderedState,l=o(s,n);if(a.eagerReducer=o,a.eagerState=l,si(l,s))return}catch(c){}hl(e,r,i)}}var Co={readContext:ia,useCallback:to,useContext:to,useEffect:to,useImperativeHandle:to,useLayoutEffect:to,useMemo:to,useReducer:to,useRef:to,useState:to,useDebugValue:to,useDeferredValue:to,useTransition:to,useMutableSource:to,useOpaqueIdentifier:to,unstable_isNewReconciler:!1},Po={readContext:ia,useCallback:function(e,t){return ro().memoizedState=[e,void 0===t?null:t],e},useContext:ia,useEffect:_o,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,vo(4,2,wo.bind(null,t,e),n)},useLayoutEffect:function(e,t){return vo(4,2,e,t)},useMemo:function(e,t){var n=ro();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var i=ro();return t=void 0!==n?n(t):t,i.memoizedState=i.baseState=t,e=(e=i.queue={pending:null,dispatch:null,lastRenderedReducer:e,lastRenderedState:t}).dispatch=Ao.bind(null,Ya,e),[i.memoizedState,e]},useRef:mo,useState:po,useDebugValue:To,useDeferredValue:function(e){var t=po(e),n=t[0],i=t[1];return _o((function(){var t=$a.transition;$a.transition=1;try{i(e)}finally{$a.transition=t}}),[e]),n},useTransition:function(){var e=po(!1),t=e[0];return mo(e=ko.bind(null,e[1])),[e,t]},useMutableSource:function(e,t,n){var i=ro();return i.memoizedState={refs:{getSnapshot:t,setSnapshot:null},source:e,subscribe:n},uo(i,e,t,n)},useOpaqueIdentifier:function(){if(Fa){var e=!1,t=function(e){return{$$typeof:D,toString:e,valueOf:e}}((function(){throw e||(e=!0,n("r:"+(Zi++).toString(36))),Error(o(355))})),n=po(t)[1];return 0===(2&Ya.mode)&&(Ya.flags|=516,fo(5,(function(){n("r:"+(Zi++).toString(36))}),void 0,null)),t}return po(t="r:"+(Zi++).toString(36)),t},unstable_isNewReconciler:!1},Lo={readContext:ia,useCallback:Eo,useContext:ia,useEffect:xo,useImperativeHandle:So,useLayoutEffect:bo,useMemo:Mo,useReducer:so,useRef:go,useState:function(){return so(oo)},useDebugValue:To,useDeferredValue:function(e){var t=so(oo),n=t[0],i=t[1];return xo((function(){var t=$a.transition;$a.transition=1;try{i(e)}finally{$a.transition=t}}),[e]),n},useTransition:function(){var e=so(oo)[0];return[go().current,e]},useMutableSource:ho,useOpaqueIdentifier:function(){return so(oo)[0]},unstable_isNewReconciler:!1},Io={readContext:ia,useCallback:Eo,useContext:ia,useEffect:xo,useImperativeHandle:So,useLayoutEffect:bo,useMemo:Mo,useReducer:lo,useRef:go,useState:function(){return lo(oo)},useDebugValue:To,useDeferredValue:function(e){var t=lo(oo),n=t[0],i=t[1];return xo((function(){var t=$a.transition;$a.transition=1;try{i(e)}finally{$a.transition=t}}),[e]),n},useTransition:function(){var e=lo(oo)[0];return[go().current,e]},useMutableSource:ho,useOpaqueIdentifier:function(){return lo(oo)[0]},unstable_isNewReconciler:!1},Ro=b.ReactCurrentOwner,zo=!1;function Do(e,t,n,i){t.child=null===e?Ta(t,null,n,i):Sa(t,e.child,n,i)}function Oo(e,t,n,i,r){n=n.render;var a=t.ref;return na(t,r),i=io(e,t,n,i,a,r),null===e||zo?(t.flags|=1,Do(e,t,i,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-517,e.lanes&=~r,ns(e,t,r))}function Bo(e,t,n,i,r,a){if(null===e){var o=n.type;return"function"!==typeof o||jl(o)||void 0!==o.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Hl(n.type,null,i,t,t.mode,a)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=o,Fo(e,t,o,i,r,a))}return o=e.child,0===(r&a)&&(r=o.memoizedProps,(n=null!==(n=n.compare)?n:ci)(r,i)&&e.ref===t.ref)?ns(e,t,a):(t.flags|=1,(e=Gl(o,i)).ref=t.ref,e.return=t,t.child=e)}function Fo(e,t,n,i,r,a){if(null!==e&&ci(e.memoizedProps,i)&&e.ref===t.ref){if(zo=!1,0===(a&r))return t.lanes=e.lanes,ns(e,t,a);0!==(16384&e.flags)&&(zo=!0)}return Vo(e,t,n,i,a)}function No(e,t,n){var i=t.pendingProps,r=i.children,a=null!==e?e.memoizedState:null;if("hidden"===i.mode||"unstable-defer-without-hiding"===i.mode)if(0===(4&t.mode))t.memoizedState={baseLanes:0},_l(t,n);else{if(0===(1073741824&n))return e=null!==a?a.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e},_l(t,e),null;t.memoizedState={baseLanes:0},_l(t,null!==a?a.baseLanes:n)}else null!==a?(i=a.baseLanes|n,t.memoizedState=null):i=n,_l(t,i);return Do(e,t,r,n),t.child}function Uo(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=128)}function Vo(e,t,n,i,r){var a=fr(n)?dr:ur.current;return a=pr(t,a),na(t,r),n=io(e,t,n,i,a,r),null===e||zo?(t.flags|=1,Do(e,t,n,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-517,e.lanes&=~r,ns(e,t,r))}function jo(e,t,n,i,r){if(fr(n)){var a=!0;yr(t)}else a=!1;if(na(t,r),null===t.stateNode)null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),ga(t,n,i),ya(t,n,i,r),i=!0;else if(null===e){var o=t.stateNode,s=t.memoizedProps;o.props=s;var l=o.context,c=n.contextType;"object"===typeof c&&null!==c?c=ia(c):c=pr(t,c=fr(n)?dr:ur.current);var u=n.getDerivedStateFromProps,h="function"===typeof u||"function"===typeof o.getSnapshotBeforeUpdate;h||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==i||l!==c)&&va(t,o,i,c),ra=!1;var d=t.memoizedState;o.state=d,ua(t,i,o,r),l=t.memoizedState,s!==i||d!==l||hr.current||ra?("function"===typeof u&&(pa(t,n,u,i),l=t.memoizedState),(s=ra||ma(t,n,s,i,d,l,c))?(h||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||("function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"===typeof o.componentDidMount&&(t.flags|=4)):("function"===typeof o.componentDidMount&&(t.flags|=4),t.memoizedProps=i,t.memoizedState=l),o.props=i,o.state=l,o.context=c,i=s):("function"===typeof o.componentDidMount&&(t.flags|=4),i=!1)}else{o=t.stateNode,oa(e,t),s=t.memoizedProps,c=t.type===t.elementType?s:$r(t.type,s),o.props=c,h=t.pendingProps,d=o.context,"object"===typeof(l=n.contextType)&&null!==l?l=ia(l):l=pr(t,l=fr(n)?dr:ur.current);var p=n.getDerivedStateFromProps;(u="function"===typeof p||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==h||d!==l)&&va(t,o,i,l),ra=!1,d=t.memoizedState,o.state=d,ua(t,i,o,r);var f=t.memoizedState;s!==h||d!==f||hr.current||ra?("function"===typeof p&&(pa(t,n,p,i),f=t.memoizedState),(c=ra||ma(t,n,c,i,d,f,l))?(u||"function"!==typeof o.UNSAFE_componentWillUpdate&&"function"!==typeof o.componentWillUpdate||("function"===typeof o.componentWillUpdate&&o.componentWillUpdate(i,f,l),"function"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(i,f,l)),"function"===typeof o.componentDidUpdate&&(t.flags|=4),"function"===typeof o.getSnapshotBeforeUpdate&&(t.flags|=256)):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=256),t.memoizedProps=i,t.memoizedState=f),o.props=i,o.state=f,o.context=l,i=c):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=256),i=!1)}return Go(e,t,n,i,a,r)}function Go(e,t,n,i,r,a){Uo(e,t);var o=0!==(64&t.flags);if(!i&&!o)return r&&_r(t,n,!1),ns(e,t,a);i=t.stateNode,Ro.current=t;var s=o&&"function"!==typeof n.getDerivedStateFromError?null:i.render();return t.flags|=1,null!==e&&o?(t.child=Sa(t,e.child,null,a),t.child=Sa(t,null,s,a)):Do(e,t,s,a),t.memoizedState=i.state,r&&_r(t,n,!0),t.child}function Ho(e){var t=e.stateNode;t.pendingContext?gr(0,t.pendingContext,t.pendingContext!==t.context):t.context&&gr(0,t.context,!1),Pa(e,t.containerInfo)}var Wo,qo,Zo,$o={dehydrated:null,retryLane:0};function Xo(e,t,n){var i,r=t.pendingProps,a=za.current,o=!1;return(i=0!==(64&t.flags))||(i=(null===e||null!==e.memoizedState)&&0!==(2&a)),i?(o=!0,t.flags&=-65):null!==e&&null===e.memoizedState||void 0===r.fallback||!0===r.unstable_avoidThisFallback||(a|=1),lr(za,1&a),null===e?(void 0!==r.fallback&&Va(t),e=r.children,a=r.fallback,o?(e=Yo(t,e,a,n),t.child.memoizedState={baseLanes:n},t.memoizedState=$o,e):"number"===typeof r.unstable_expectedLoadTime?(e=Yo(t,e,a,n),t.child.memoizedState={baseLanes:n},t.memoizedState=$o,t.lanes=33554432,e):((n=ql({mode:"visible",children:e},t.mode,n,null)).return=t,t.child=n)):(e.memoizedState,o?(r=Ko(e,t,r.children,r.fallback,n),o=t.child,a=e.child.memoizedState,o.memoizedState=null===a?{baseLanes:n}:{baseLanes:a.baseLanes|n},o.childLanes=e.childLanes&~n,t.memoizedState=$o,r):(n=Jo(e,t,r.children,n),t.memoizedState=null,n))}function Yo(e,t,n,i){var r=e.mode,a=e.child;return t={mode:"hidden",children:t},0===(2&r)&&null!==a?(a.childLanes=0,a.pendingProps=t):a=ql(t,r,0,null),n=Wl(n,r,i,null),a.return=e,n.return=e,a.sibling=n,e.child=a,n}function Jo(e,t,n,i){var r=e.child;return e=r.sibling,n=Gl(r,{mode:"visible",children:n}),0===(2&t.mode)&&(n.lanes=i),n.return=t,n.sibling=null,null!==e&&(e.nextEffect=null,e.flags=8,t.firstEffect=t.lastEffect=e),t.child=n}function Ko(e,t,n,i,r){var a=t.mode,o=e.child;e=o.sibling;var s={mode:"hidden",children:n};return 0===(2&a)&&t.child!==o?((n=t.child).childLanes=0,n.pendingProps=s,null!==(o=n.lastEffect)?(t.firstEffect=n.firstEffect,t.lastEffect=o,o.nextEffect=null):t.firstEffect=t.lastEffect=null):n=Gl(o,s),null!==e?i=Gl(e,i):(i=Wl(i,a,r,null)).flags|=2,i.return=t,n.return=t,n.sibling=i,t.child=n,i}function Qo(e,t){e.lanes|=t;var n=e.alternate;null!==n&&(n.lanes|=t),ta(e.return,t)}function es(e,t,n,i,r,a){var o=e.memoizedState;null===o?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r,lastEffect:a}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=i,o.tail=n,o.tailMode=r,o.lastEffect=a)}function ts(e,t,n){var i=t.pendingProps,r=i.revealOrder,a=i.tail;if(Do(e,t,i.children,n),0!==(2&(i=za.current)))i=1&i|2,t.flags|=64;else{if(null!==e&&0!==(64&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Qo(e,n);else if(19===e.tag)Qo(e,n);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}if(lr(za,i),0===(2&t.mode))t.memoizedState=null;else switch(r){case"forwards":for(n=t.child,r=null;null!==n;)null!==(e=n.alternate)&&null===Da(e)&&(r=n),n=n.sibling;null===(n=r)?(r=t.child,t.child=null):(r=n.sibling,n.sibling=null),es(t,!1,r,n,a,t.lastEffect);break;case"backwards":for(n=null,r=t.child,t.child=null;null!==r;){if(null!==(e=r.alternate)&&null===Da(e)){t.child=r;break}e=r.sibling,r.sibling=n,n=r,r=e}es(t,!0,n,null,a,t.lastEffect);break;case"together":es(t,!1,null,null,void 0,t.lastEffect);break;default:t.memoizedState=null}return t.child}function ns(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Fs|=t.lanes,0!==(n&t.childLanes)){if(null!==e&&t.child!==e.child)throw Error(o(153));if(null!==t.child){for(n=Gl(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Gl(e,e.pendingProps)).return=t;n.sibling=null}return t.child}return null}function is(e,t){if(!Fa)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var i=null;null!==n;)null!==n.alternate&&(i=n),n=n.sibling;null===i?t||null===e.tail?e.tail=null:e.tail.sibling=null:i.sibling=null}}function rs(e,t,n){var i=t.pendingProps;switch(t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return fr(t.type)&&mr(),null;case 3:return La(),sr(hr),sr(ur),qa(),(i=t.stateNode).pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),null!==e&&null!==e.child||(Ga(t)?t.flags|=4:i.hydrate||(t.flags|=256)),null;case 5:Ra(t);var a=Ca(Aa.current);if(n=t.type,null!==e&&null!=t.stateNode)qo(e,t,n,i),e.ref!==t.ref&&(t.flags|=128);else{if(!i){if(null===t.stateNode)throw Error(o(166));return null}if(e=Ca(Ma.current),Ga(t)){i=t.stateNode,n=t.type;var s=t.memoizedProps;switch(i[Xi]=t,i[Yi]=s,n){case"dialog":ki("cancel",i),ki("close",i);break;case"iframe":case"object":case"embed":ki("load",i);break;case"video":case"audio":for(e=0;e<Si.length;e++)ki(Si[e],i);break;case"source":ki("error",i);break;case"img":case"image":case"link":ki("error",i),ki("load",i);break;case"details":ki("toggle",i);break;case"input":ee(i,s),ki("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!s.multiple},ki("invalid",i);break;case"textarea":le(i,s),ki("invalid",i)}for(var c in Te(n,s),e=null,s)s.hasOwnProperty(c)&&(a=s[c],"children"===c?"string"===typeof a?i.textContent!==a&&(e=["children",a]):"number"===typeof a&&i.textContent!==""+a&&(e=["children",""+a]):l.hasOwnProperty(c)&&null!=a&&"onScroll"===c&&ki("scroll",i));switch(n){case"input":Y(i),ie(i,s,!0);break;case"textarea":Y(i),ue(i);break;case"select":case"option":break;default:"function"===typeof s.onClick&&(i.onclick=Bi)}i=e,t.updateQueue=i,null!==i&&(t.flags|=4)}else{switch(c=9===a.nodeType?a:a.ownerDocument,e===he&&(e=pe(n)),e===he?"script"===n?((e=c.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof i.is?e=c.createElement(n,{is:i.is}):(e=c.createElement(n),"select"===n&&(c=e,i.multiple?c.multiple=!0:i.size&&(c.size=i.size))):e=c.createElementNS(e,n),e[Xi]=t,e[Yi]=i,Wo(e,t),t.stateNode=e,c=Ee(n,i),n){case"dialog":ki("cancel",e),ki("close",e),a=i;break;case"iframe":case"object":case"embed":ki("load",e),a=i;break;case"video":case"audio":for(a=0;a<Si.length;a++)ki(Si[a],e);a=i;break;case"source":ki("error",e),a=i;break;case"img":case"image":case"link":ki("error",e),ki("load",e),a=i;break;case"details":ki("toggle",e),a=i;break;case"input":ee(e,i),a=Q(e,i),ki("invalid",e);break;case"option":a=ae(e,i);break;case"select":e._wrapperState={wasMultiple:!!i.multiple},a=r({},i,{value:void 0}),ki("invalid",e);break;case"textarea":le(e,i),a=se(e,i),ki("invalid",e);break;default:a=i}Te(n,a);var u=a;for(s in u)if(u.hasOwnProperty(s)){var h=u[s];"style"===s?we(e,h):"dangerouslySetInnerHTML"===s?null!=(h=h?h.__html:void 0)&&ve(e,h):"children"===s?"string"===typeof h?("textarea"!==n||""!==h)&&ye(e,h):"number"===typeof h&&ye(e,""+h):"suppressContentEditableWarning"!==s&&"suppressHydrationWarning"!==s&&"autoFocus"!==s&&(l.hasOwnProperty(s)?null!=h&&"onScroll"===s&&ki("scroll",e):null!=h&&x(e,s,h,c))}switch(n){case"input":Y(e),ie(e,i,!1);break;case"textarea":Y(e),ue(e);break;case"option":null!=i.value&&e.setAttribute("value",""+$(i.value));break;case"select":e.multiple=!!i.multiple,null!=(s=i.value)?oe(e,!!i.multiple,s,!1):null!=i.defaultValue&&oe(e,!!i.multiple,i.defaultValue,!0);break;default:"function"===typeof a.onClick&&(e.onclick=Bi)}Ui(n,i)&&(t.flags|=4)}null!==t.ref&&(t.flags|=128)}return null;case 6:if(e&&null!=t.stateNode)Zo(0,t,e.memoizedProps,i);else{if("string"!==typeof i&&null===t.stateNode)throw Error(o(166));n=Ca(Aa.current),Ca(Ma.current),Ga(t)?(i=t.stateNode,n=t.memoizedProps,i[Xi]=t,i.nodeValue!==n&&(t.flags|=4)):((i=(9===n.nodeType?n:n.ownerDocument).createTextNode(i))[Xi]=t,t.stateNode=i)}return null;case 13:return sr(za),i=t.memoizedState,0!==(64&t.flags)?(t.lanes=n,t):(i=null!==i,n=!1,null===e?void 0!==t.memoizedProps.fallback&&Ga(t):n=null!==e.memoizedState,i&&!n&&0!==(2&t.mode)&&(null===e&&!0!==t.memoizedProps.unstable_avoidThisFallback||0!==(1&za.current)?0===Ds&&(Ds=3):(0!==Ds&&3!==Ds||(Ds=4),null===Ps||0===(134217727&Fs)&&0===(134217727&Ns)||ml(Ps,Is))),(i||n)&&(t.flags|=4),null);case 4:return La(),null===e&&Ci(t.stateNode.containerInfo),null;case 10:return ea(t),null;case 17:return fr(t.type)&&mr(),null;case 19:if(sr(za),null===(i=t.memoizedState))return null;if(s=0!==(64&t.flags),null===(c=i.rendering))if(s)is(i,!1);else{if(0!==Ds||null!==e&&0!==(64&e.flags))for(e=t.child;null!==e;){if(null!==(c=Da(e))){for(t.flags|=64,is(i,!1),null!==(s=c.updateQueue)&&(t.updateQueue=s,t.flags|=4),null===i.lastEffect&&(t.firstEffect=null),t.lastEffect=i.lastEffect,i=n,n=t.child;null!==n;)e=i,(s=n).flags&=2,s.nextEffect=null,s.firstEffect=null,s.lastEffect=null,null===(c=s.alternate)?(s.childLanes=0,s.lanes=e,s.child=null,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=c.childLanes,s.lanes=c.lanes,s.child=c.child,s.memoizedProps=c.memoizedProps,s.memoizedState=c.memoizedState,s.updateQueue=c.updateQueue,s.type=c.type,e=c.dependencies,s.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return lr(za,1&za.current|2),t.child}e=e.sibling}null!==i.tail&&Ur()>Gs&&(t.flags|=64,s=!0,is(i,!1),t.lanes=33554432)}else{if(!s)if(null!==(e=Da(c))){if(t.flags|=64,s=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),is(i,!0),null===i.tail&&"hidden"===i.tailMode&&!c.alternate&&!Fa)return null!==(t=t.lastEffect=i.lastEffect)&&(t.nextEffect=null),null}else 2*Ur()-i.renderingStartTime>Gs&&1073741824!==n&&(t.flags|=64,s=!0,is(i,!1),t.lanes=33554432);i.isBackwards?(c.sibling=t.child,t.child=c):(null!==(n=i.last)?n.sibling=c:t.child=c,i.last=c)}return null!==i.tail?(n=i.tail,i.rendering=n,i.tail=n.sibling,i.lastEffect=t.lastEffect,i.renderingStartTime=Ur(),n.sibling=null,t=za.current,lr(za,s?1&t|2:1&t),n):null;case 23:case 24:return xl(),null!==e&&null!==e.memoizedState!==(null!==t.memoizedState)&&"unstable-defer-without-hiding"!==i.mode&&(t.flags|=4),null}throw Error(o(156,t.tag))}function as(e){switch(e.tag){case 1:fr(e.type)&&mr();var t=e.flags;return 4096&t?(e.flags=-4097&t|64,e):null;case 3:if(La(),sr(hr),sr(ur),qa(),0!==(64&(t=e.flags)))throw Error(o(285));return e.flags=-4097&t|64,e;case 5:return Ra(e),null;case 13:return sr(za),4096&(t=e.flags)?(e.flags=-4097&t|64,e):null;case 19:return sr(za),null;case 4:return La(),null;case 10:return ea(e),null;case 23:case 24:return xl(),null;default:return null}}function os(e,t){try{var n="",i=t;do{n+=q(i),i=i.return}while(i);var r=n}catch(a){r="\nError generating stack: "+a.message+"\n"+a.stack}return{value:e,source:t,stack:r}}function ss(e,t){try{console.error(t.value)}catch(n){setTimeout((function(){throw n}))}}Wo=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},qo=function(e,t,n,i){var a=e.memoizedProps;if(a!==i){e=t.stateNode,Ca(Ma.current);var o,s=null;switch(n){case"input":a=Q(e,a),i=Q(e,i),s=[];break;case"option":a=ae(e,a),i=ae(e,i),s=[];break;case"select":a=r({},a,{value:void 0}),i=r({},i,{value:void 0}),s=[];break;case"textarea":a=se(e,a),i=se(e,i),s=[];break;default:"function"!==typeof a.onClick&&"function"===typeof i.onClick&&(e.onclick=Bi)}for(h in Te(n,i),n=null,a)if(!i.hasOwnProperty(h)&&a.hasOwnProperty(h)&&null!=a[h])if("style"===h){var c=a[h];for(o in c)c.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else"dangerouslySetInnerHTML"!==h&&"children"!==h&&"suppressContentEditableWarning"!==h&&"suppressHydrationWarning"!==h&&"autoFocus"!==h&&(l.hasOwnProperty(h)?s||(s=[]):(s=s||[]).push(h,null));for(h in i){var u=i[h];if(c=null!=a?a[h]:void 0,i.hasOwnProperty(h)&&u!==c&&(null!=u||null!=c))if("style"===h)if(c){for(o in c)!c.hasOwnProperty(o)||u&&u.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in u)u.hasOwnProperty(o)&&c[o]!==u[o]&&(n||(n={}),n[o]=u[o])}else n||(s||(s=[]),s.push(h,n)),n=u;else"dangerouslySetInnerHTML"===h?(u=u?u.__html:void 0,c=c?c.__html:void 0,null!=u&&c!==u&&(s=s||[]).push(h,u)):"children"===h?"string"!==typeof u&&"number"!==typeof u||(s=s||[]).push(h,""+u):"suppressContentEditableWarning"!==h&&"suppressHydrationWarning"!==h&&(l.hasOwnProperty(h)?(null!=u&&"onScroll"===h&&ki("scroll",e),s||c===u||(s=[])):"object"===typeof u&&null!==u&&u.$$typeof===D?u.toString():(s=s||[]).push(h,u))}n&&(s=s||[]).push("style",n);var h=s;(t.updateQueue=h)&&(t.flags|=4)}},Zo=function(e,t,n,i){n!==i&&(t.flags|=4)};var ls="function"===typeof WeakMap?WeakMap:Map;function cs(e,t,n){(n=sa(-1,n)).tag=3,n.payload={element:null};var i=t.value;return n.callback=function(){Zs||(Zs=!0,$s=i),ss(0,t)},n}function us(e,t,n){(n=sa(-1,n)).tag=3;var i=e.type.getDerivedStateFromError;if("function"===typeof i){var r=t.value;n.payload=function(){return ss(0,t),i(r)}}var a=e.stateNode;return null!==a&&"function"===typeof a.componentDidCatch&&(n.callback=function(){"function"!==typeof i&&(null===Xs?Xs=new Set([this]):Xs.add(this),ss(0,t));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}var hs="function"===typeof WeakSet?WeakSet:Set;function ds(e){var t=e.ref;if(null!==t)if("function"===typeof t)try{t(null)}catch(n){Bl(e,n)}else t.current=null}function ps(e,t){switch(t.tag){case 0:case 11:case 15:case 22:return;case 1:if(256&t.flags&&null!==e){var n=e.memoizedProps,i=e.memoizedState;t=(e=t.stateNode).getSnapshotBeforeUpdate(t.elementType===t.type?n:$r(t.type,n),i),e.__reactInternalSnapshotBeforeUpdate=t}return;case 3:return void(256&t.flags&&Hi(t.stateNode.containerInfo));case 5:case 6:case 4:case 17:return}throw Error(o(163))}function fs(e,t,n){switch(n.tag){case 0:case 11:case 15:case 22:if(null!==(t=null!==(t=n.updateQueue)?t.lastEffect:null)){e=t=t.next;do{if(3===(3&e.tag)){var i=e.create;e.destroy=i()}e=e.next}while(e!==t)}if(null!==(t=null!==(t=n.updateQueue)?t.lastEffect:null)){e=t=t.next;do{var r=e;i=r.next,0!==(4&(r=r.tag))&&0!==(1&r)&&(zl(n,e),Rl(n,e)),e=i}while(e!==t)}return;case 1:return e=n.stateNode,4&n.flags&&(null===t?e.componentDidMount():(i=n.elementType===n.type?t.memoizedProps:$r(n.type,t.memoizedProps),e.componentDidUpdate(i,t.memoizedState,e.__reactInternalSnapshotBeforeUpdate))),void(null!==(t=n.updateQueue)&&ha(n,t,e));case 3:if(null!==(t=n.updateQueue)){if(e=null,null!==n.child)switch(n.child.tag){case 5:e=n.child.stateNode;break;case 1:e=n.child.stateNode}ha(n,t,e)}return;case 5:return e=n.stateNode,void(null===t&&4&n.flags&&Ui(n.type,n.memoizedProps)&&e.focus());case 6:case 4:case 12:return;case 13:return void(null===n.memoizedState&&(n=n.alternate,null!==n&&(n=n.memoizedState,null!==n&&(n=n.dehydrated,null!==n&&wt(n)))));case 19:case 17:case 20:case 21:case 23:case 24:return}throw Error(o(163))}function ms(e,t){for(var n=e;;){if(5===n.tag){var i=n.stateNode;if(t)"function"===typeof(i=i.style).setProperty?i.setProperty("display","none","important"):i.display="none";else{i=n.stateNode;var r=n.memoizedProps.style;r=void 0!==r&&null!==r&&r.hasOwnProperty("display")?r.display:null,i.style.display=be("display",r)}}else if(6===n.tag)n.stateNode.nodeValue=t?"":n.memoizedProps;else if((23!==n.tag&&24!==n.tag||null===n.memoizedState||n===e)&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===e)break;for(;null===n.sibling;){if(null===n.return||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}}function gs(e,t){if(br&&"function"===typeof br.onCommitFiberUnmount)try{br.onCommitFiberUnmount(xr,t)}catch(a){}switch(t.tag){case 0:case 11:case 14:case 15:case 22:if(null!==(e=t.updateQueue)&&null!==(e=e.lastEffect)){var n=e=e.next;do{var i=n,r=i.destroy;if(i=i.tag,void 0!==r)if(0!==(4&i))zl(t,n);else{i=t;try{r()}catch(a){Bl(i,a)}}n=n.next}while(n!==e)}break;case 1:if(ds(t),"function"===typeof(e=t.stateNode).componentWillUnmount)try{e.props=t.memoizedProps,e.state=t.memoizedState,e.componentWillUnmount()}catch(a){Bl(t,a)}break;case 5:ds(t);break;case 4:ws(e,t)}}function vs(e){e.alternate=null,e.child=null,e.dependencies=null,e.firstEffect=null,e.lastEffect=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.return=null,e.updateQueue=null}function ys(e){return 5===e.tag||3===e.tag||4===e.tag}function _s(e){e:{for(var t=e.return;null!==t;){if(ys(t))break e;t=t.return}throw Error(o(160))}var n=t;switch(t=n.stateNode,n.tag){case 5:var i=!1;break;case 3:case 4:t=t.containerInfo,i=!0;break;default:throw Error(o(161))}16&n.flags&&(ye(t,""),n.flags&=-17);e:t:for(n=e;;){for(;null===n.sibling;){if(null===n.return||ys(n.return)){n=null;break e}n=n.return}for(n.sibling.return=n.return,n=n.sibling;5!==n.tag&&6!==n.tag&&18!==n.tag;){if(2&n.flags)continue t;if(null===n.child||4===n.tag)continue t;n.child.return=n,n=n.child}if(!(2&n.flags)){n=n.stateNode;break e}}i?xs(e,n,t):bs(e,n,t)}function xs(e,t,n){var i=e.tag,r=5===i||6===i;if(r)e=r?e.stateNode:e.stateNode.instance,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=Bi));else if(4!==i&&null!==(e=e.child))for(xs(e,t,n),e=e.sibling;null!==e;)xs(e,t,n),e=e.sibling}function bs(e,t,n){var i=e.tag,r=5===i||6===i;if(r)e=r?e.stateNode:e.stateNode.instance,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==i&&null!==(e=e.child))for(bs(e,t,n),e=e.sibling;null!==e;)bs(e,t,n),e=e.sibling}function ws(e,t){for(var n,i,r=t,a=!1;;){if(!a){a=r.return;e:for(;;){if(null===a)throw Error(o(160));switch(n=a.stateNode,a.tag){case 5:i=!1;break e;case 3:case 4:n=n.containerInfo,i=!0;break e}a=a.return}a=!0}if(5===r.tag||6===r.tag){e:for(var s=e,l=r,c=l;;)if(gs(s,c),null!==c.child&&4!==c.tag)c.child.return=c,c=c.child;else{if(c===l)break e;for(;null===c.sibling;){if(null===c.return||c.return===l)break e;c=c.return}c.sibling.return=c.return,c=c.sibling}i?(s=n,l=r.stateNode,8===s.nodeType?s.parentNode.removeChild(l):s.removeChild(l)):n.removeChild(r.stateNode)}else if(4===r.tag){if(null!==r.child){n=r.stateNode.containerInfo,i=!0,r.child.return=r,r=r.child;continue}}else if(gs(e,r),null!==r.child){r.child.return=r,r=r.child;continue}if(r===t)break;for(;null===r.sibling;){if(null===r.return||r.return===t)return;4===(r=r.return).tag&&(a=!1)}r.sibling.return=r.return,r=r.sibling}}function Ss(e,t){switch(t.tag){case 0:case 11:case 14:case 15:case 22:var n=t.updateQueue;if(null!==(n=null!==n?n.lastEffect:null)){var i=n=n.next;do{3===(3&i.tag)&&(e=i.destroy,i.destroy=void 0,void 0!==e&&e()),i=i.next}while(i!==n)}return;case 1:return;case 5:if(null!=(n=t.stateNode)){i=t.memoizedProps;var r=null!==e?e.memoizedProps:i;e=t.type;var a=t.updateQueue;if(t.updateQueue=null,null!==a){for(n[Yi]=i,"input"===e&&"radio"===i.type&&null!=i.name&&te(n,i),Ee(e,r),t=Ee(e,i),r=0;r<a.length;r+=2){var s=a[r],l=a[r+1];"style"===s?we(n,l):"dangerouslySetInnerHTML"===s?ve(n,l):"children"===s?ye(n,l):x(n,s,l,t)}switch(e){case"input":ne(n,i);break;case"textarea":ce(n,i);break;case"select":e=n._wrapperState.wasMultiple,n._wrapperState.wasMultiple=!!i.multiple,null!=(a=i.value)?oe(n,!!i.multiple,a,!1):e!==!!i.multiple&&(null!=i.defaultValue?oe(n,!!i.multiple,i.defaultValue,!0):oe(n,!!i.multiple,i.multiple?[]:"",!1))}}}return;case 6:if(null===t.stateNode)throw Error(o(162));return void(t.stateNode.nodeValue=t.memoizedProps);case 3:return void((n=t.stateNode).hydrate&&(n.hydrate=!1,wt(n.containerInfo)));case 12:return;case 13:return null!==t.memoizedState&&(js=Ur(),ms(t.child,!0)),void Ts(t);case 19:return void Ts(t);case 17:return;case 23:case 24:return void ms(t,null!==t.memoizedState)}throw Error(o(163))}function Ts(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new hs),t.forEach((function(t){var i=Nl.bind(null,e,t);n.has(t)||(n.add(t),t.then(i,i))}))}}function Es(e,t){return null!==e&&(null===(e=e.memoizedState)||null!==e.dehydrated)&&(null!==(t=t.memoizedState)&&null===t.dehydrated)}var Ms=Math.ceil,ks=b.ReactCurrentDispatcher,As=b.ReactCurrentOwner,Cs=0,Ps=null,Ls=null,Is=0,Rs=0,zs=or(0),Ds=0,Os=null,Bs=0,Fs=0,Ns=0,Us=0,Vs=null,js=0,Gs=1/0;function Hs(){Gs=Ur()+500}var Ws,qs=null,Zs=!1,$s=null,Xs=null,Ys=!1,Js=null,Ks=90,Qs=[],el=[],tl=null,nl=0,il=null,rl=-1,al=0,ol=0,sl=null,ll=!1;function cl(){return 0!==(48&Cs)?Ur():-1!==rl?rl:rl=Ur()}function ul(e){if(0===(2&(e=e.mode)))return 1;if(0===(4&e))return 99===Vr()?1:2;if(0===al&&(al=Bs),0!==Zr.transition){0!==ol&&(ol=null!==Vs?Vs.pendingLanes:0),e=al;var t=4186112&~ol;return 0===(t&=-t)&&(0===(t=(e=4186112&~e)&-e)&&(t=8192)),t}return e=Vr(),0!==(4&Cs)&&98===e?e=Ut(12,al):e=Ut(e=function(e){switch(e){case 99:return 15;case 98:return 10;case 97:case 96:return 8;case 95:return 2;default:return 0}}(e),al),e}function hl(e,t,n){if(50<nl)throw nl=0,il=null,Error(o(185));if(null===(e=dl(e,t)))return null;Gt(e,t,n),e===Ps&&(Ns|=t,4===Ds&&ml(e,Is));var i=Vr();1===t?0!==(8&Cs)&&0===(48&Cs)?gl(e):(pl(e,n),0===Cs&&(Hs(),Wr())):(0===(4&Cs)||98!==i&&99!==i||(null===tl?tl=new Set([e]):tl.add(e)),pl(e,n)),Vs=e}function dl(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}function pl(e,t){for(var n=e.callbackNode,i=e.suspendedLanes,r=e.pingedLanes,a=e.expirationTimes,s=e.pendingLanes;0<s;){var l=31-Ht(s),c=1<<l,u=a[l];if(-1===u){if(0===(c&i)||0!==(c&r)){u=t,Bt(c);var h=Ot;a[l]=10<=h?u+250:6<=h?u+5e3:-1}}else u<=t&&(e.expiredLanes|=c);s&=~c}if(i=Ft(e,e===Ps?Is:0),t=Ot,0===i)null!==n&&(n!==zr&&Tr(n),e.callbackNode=null,e.callbackPriority=0);else{if(null!==n){if(e.callbackPriority===t)return;n!==zr&&Tr(n)}15===t?(n=gl.bind(null,e),null===Or?(Or=[n],Br=Sr(Cr,qr)):Or.push(n),n=zr):14===t?n=Hr(99,gl.bind(null,e)):n=Hr(n=function(e){switch(e){case 15:case 14:return 99;case 13:case 12:case 11:case 10:return 98;case 9:case 8:case 7:case 6:case 4:case 5:return 97;case 3:case 2:case 1:return 95;case 0:return 90;default:throw Error(o(358,e))}}(t),fl.bind(null,e)),e.callbackPriority=t,e.callbackNode=n}}function fl(e){if(rl=-1,ol=al=0,0!==(48&Cs))throw Error(o(327));var t=e.callbackNode;if(Il()&&e.callbackNode!==t)return null;var n=Ft(e,e===Ps?Is:0);if(0===n)return null;var i=n,r=Cs;Cs|=16;var a=Sl();for(Ps===e&&Is===i||(Hs(),bl(e,i));;)try{Ml();break}catch(l){wl(e,l)}if(Qr(),ks.current=a,Cs=r,null!==Ls?i=0:(Ps=null,Is=0,i=Ds),0!==(Bs&Ns))bl(e,0);else if(0!==i){if(2===i&&(Cs|=64,e.hydrate&&(e.hydrate=!1,Hi(e.containerInfo)),0!==(n=Nt(e))&&(i=Tl(e,n))),1===i)throw t=Os,bl(e,0),ml(e,n),pl(e,Ur()),t;switch(e.finishedWork=e.current.alternate,e.finishedLanes=n,i){case 0:case 1:throw Error(o(345));case 2:Cl(e);break;case 3:if(ml(e,n),(62914560&n)===n&&10<(i=js+500-Ur())){if(0!==Ft(e,0))break;if(((r=e.suspendedLanes)&n)!==n){cl(),e.pingedLanes|=e.suspendedLanes&r;break}e.timeoutHandle=ji(Cl.bind(null,e),i);break}Cl(e);break;case 4:if(ml(e,n),(4186112&n)===n)break;for(i=e.eventTimes,r=-1;0<n;){var s=31-Ht(n);a=1<<s,(s=i[s])>r&&(r=s),n&=~a}if(n=r,10<(n=(120>(n=Ur()-n)?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*Ms(n/1960))-n)){e.timeoutHandle=ji(Cl.bind(null,e),n);break}Cl(e);break;case 5:Cl(e);break;default:throw Error(o(329))}}return pl(e,Ur()),e.callbackNode===t?fl.bind(null,e):null}function ml(e,t){for(t&=~Us,t&=~Ns,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-Ht(t),i=1<<n;e[n]=-1,t&=~i}}function gl(e){if(0!==(48&Cs))throw Error(o(327));if(Il(),e===Ps&&0!==(e.expiredLanes&Is)){var t=Is,n=Tl(e,t);0!==(Bs&Ns)&&(n=Tl(e,t=Ft(e,t)))}else n=Tl(e,t=Ft(e,0));if(0!==e.tag&&2===n&&(Cs|=64,e.hydrate&&(e.hydrate=!1,Hi(e.containerInfo)),0!==(t=Nt(e))&&(n=Tl(e,t))),1===n)throw n=Os,bl(e,0),ml(e,t),pl(e,Ur()),n;return e.finishedWork=e.current.alternate,e.finishedLanes=t,Cl(e),pl(e,Ur()),null}function vl(e,t){var n=Cs;Cs|=1;try{return e(t)}finally{0===(Cs=n)&&(Hs(),Wr())}}function yl(e,t){var n=Cs;Cs&=-2,Cs|=8;try{return e(t)}finally{0===(Cs=n)&&(Hs(),Wr())}}function _l(e,t){lr(zs,Rs),Rs|=t,Bs|=t}function xl(){Rs=zs.current,sr(zs)}function bl(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,Gi(n)),null!==Ls)for(n=Ls.return;null!==n;){var i=n;switch(i.tag){case 1:null!==(i=i.type.childContextTypes)&&void 0!==i&&mr();break;case 3:La(),sr(hr),sr(ur),qa();break;case 5:Ra(i);break;case 4:La();break;case 13:case 19:sr(za);break;case 10:ea(i);break;case 23:case 24:xl()}n=n.return}Ps=e,Ls=Gl(e.current,null),Is=Rs=Bs=t,Ds=0,Os=null,Us=Ns=Fs=0}function wl(e,t){for(;;){var n=Ls;try{if(Qr(),Za.current=Co,Qa){for(var i=Ya.memoizedState;null!==i;){var r=i.queue;null!==r&&(r.pending=null),i=i.next}Qa=!1}if(Xa=0,Ka=Ja=Ya=null,eo=!1,As.current=null,null===n||null===n.return){Ds=1,Os=t,Ls=null;break}e:{var a=e,o=n.return,s=n,l=t;if(t=Is,s.flags|=2048,s.firstEffect=s.lastEffect=null,null!==l&&"object"===typeof l&&"function"===typeof l.then){var c=l;if(0===(2&s.mode)){var u=s.alternate;u?(s.updateQueue=u.updateQueue,s.memoizedState=u.memoizedState,s.lanes=u.lanes):(s.updateQueue=null,s.memoizedState=null)}var h=0!==(1&za.current),d=o;do{var p;if(p=13===d.tag){var f=d.memoizedState;if(null!==f)p=null!==f.dehydrated;else{var m=d.memoizedProps;p=void 0!==m.fallback&&(!0!==m.unstable_avoidThisFallback||!h)}}if(p){var g=d.updateQueue;if(null===g){var v=new Set;v.add(c),d.updateQueue=v}else g.add(c);if(0===(2&d.mode)){if(d.flags|=64,s.flags|=16384,s.flags&=-2981,1===s.tag)if(null===s.alternate)s.tag=17;else{var y=sa(-1,1);y.tag=2,la(s,y)}s.lanes|=1;break e}l=void 0,s=t;var _=a.pingCache;if(null===_?(_=a.pingCache=new ls,l=new Set,_.set(c,l)):void 0===(l=_.get(c))&&(l=new Set,_.set(c,l)),!l.has(s)){l.add(s);var x=Fl.bind(null,a,c,s);c.then(x,x)}d.flags|=4096,d.lanes=t;break e}d=d.return}while(null!==d);l=Error((Z(s.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display.")}5!==Ds&&(Ds=2),l=os(l,s),d=o;do{switch(d.tag){case 3:a=l,d.flags|=4096,t&=-t,d.lanes|=t,ca(d,cs(0,a,t));break e;case 1:a=l;var b=d.type,w=d.stateNode;if(0===(64&d.flags)&&("function"===typeof b.getDerivedStateFromError||null!==w&&"function"===typeof w.componentDidCatch&&(null===Xs||!Xs.has(w)))){d.flags|=4096,t&=-t,d.lanes|=t,ca(d,us(d,a,t));break e}}d=d.return}while(null!==d)}Al(n)}catch(S){t=S,Ls===n&&null!==n&&(Ls=n=n.return);continue}break}}function Sl(){var e=ks.current;return ks.current=Co,null===e?Co:e}function Tl(e,t){var n=Cs;Cs|=16;var i=Sl();for(Ps===e&&Is===t||bl(e,t);;)try{El();break}catch(r){wl(e,r)}if(Qr(),Cs=n,ks.current=i,null!==Ls)throw Error(o(261));return Ps=null,Is=0,Ds}function El(){for(;null!==Ls;)kl(Ls)}function Ml(){for(;null!==Ls&&!Er();)kl(Ls)}function kl(e){var t=Ws(e.alternate,e,Rs);e.memoizedProps=e.pendingProps,null===t?Al(e):Ls=t,As.current=null}function Al(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(2048&t.flags)){if(null!==(n=rs(n,t,Rs)))return void(Ls=n);if(24!==(n=t).tag&&23!==n.tag||null===n.memoizedState||0!==(1073741824&Rs)||0===(4&n.mode)){for(var i=0,r=n.child;null!==r;)i|=r.lanes|r.childLanes,r=r.sibling;n.childLanes=i}null!==e&&0===(2048&e.flags)&&(null===e.firstEffect&&(e.firstEffect=t.firstEffect),null!==t.lastEffect&&(null!==e.lastEffect&&(e.lastEffect.nextEffect=t.firstEffect),e.lastEffect=t.lastEffect),1<t.flags&&(null!==e.lastEffect?e.lastEffect.nextEffect=t:e.firstEffect=t,e.lastEffect=t))}else{if(null!==(n=as(t)))return n.flags&=2047,void(Ls=n);null!==e&&(e.firstEffect=e.lastEffect=null,e.flags|=2048)}if(null!==(t=t.sibling))return void(Ls=t);Ls=t=e}while(null!==t);0===Ds&&(Ds=5)}function Cl(e){var t=Vr();return Gr(99,Pl.bind(null,e,t)),null}function Pl(e,t){do{Il()}while(null!==Js);if(0!==(48&Cs))throw Error(o(327));var n=e.finishedWork;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(o(177));e.callbackNode=null;var i=n.lanes|n.childLanes,r=i,a=e.pendingLanes&~r;e.pendingLanes=r,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=r,e.mutableReadLanes&=r,e.entangledLanes&=r,r=e.entanglements;for(var s=e.eventTimes,l=e.expirationTimes;0<a;){var c=31-Ht(a),u=1<<c;r[c]=0,s[c]=-1,l[c]=-1,a&=~u}if(null!==tl&&0===(24&i)&&tl.has(e)&&tl.delete(e),e===Ps&&(Ls=Ps=null,Is=0),1<n.flags?null!==n.lastEffect?(n.lastEffect.nextEffect=n,i=n.firstEffect):i=n:i=n.firstEffect,null!==i){if(r=Cs,Cs|=32,As.current=null,Fi=Xt,fi(s=pi())){if("selectionStart"in s)l={start:s.selectionStart,end:s.selectionEnd};else e:if(l=(l=s.ownerDocument)&&l.defaultView||window,(u=l.getSelection&&l.getSelection())&&0!==u.rangeCount){l=u.anchorNode,a=u.anchorOffset,c=u.focusNode,u=u.focusOffset;try{l.nodeType,c.nodeType}catch(M){l=null;break e}var h=0,d=-1,p=-1,f=0,m=0,g=s,v=null;t:for(;;){for(var y;g!==l||0!==a&&3!==g.nodeType||(d=h+a),g!==c||0!==u&&3!==g.nodeType||(p=h+u),3===g.nodeType&&(h+=g.nodeValue.length),null!==(y=g.firstChild);)v=g,g=y;for(;;){if(g===s)break t;if(v===l&&++f===a&&(d=h),v===c&&++m===u&&(p=h),null!==(y=g.nextSibling))break;v=(g=v).parentNode}g=y}l=-1===d||-1===p?null:{start:d,end:p}}else l=null;l=l||{start:0,end:0}}else l=null;Ni={focusedElem:s,selectionRange:l},Xt=!1,sl=null,ll=!1,qs=i;do{try{Ll()}catch(M){if(null===qs)throw Error(o(330));Bl(qs,M),qs=qs.nextEffect}}while(null!==qs);sl=null,qs=i;do{try{for(s=e;null!==qs;){var _=qs.flags;if(16&_&&ye(qs.stateNode,""),128&_){var x=qs.alternate;if(null!==x){var b=x.ref;null!==b&&("function"===typeof b?b(null):b.current=null)}}switch(1038&_){case 2:_s(qs),qs.flags&=-3;break;case 6:_s(qs),qs.flags&=-3,Ss(qs.alternate,qs);break;case 1024:qs.flags&=-1025;break;case 1028:qs.flags&=-1025,Ss(qs.alternate,qs);break;case 4:Ss(qs.alternate,qs);break;case 8:ws(s,l=qs);var w=l.alternate;vs(l),null!==w&&vs(w)}qs=qs.nextEffect}}catch(M){if(null===qs)throw Error(o(330));Bl(qs,M),qs=qs.nextEffect}}while(null!==qs);if(b=Ni,x=pi(),_=b.focusedElem,s=b.selectionRange,x!==_&&_&&_.ownerDocument&&di(_.ownerDocument.documentElement,_)){null!==s&&fi(_)&&(x=s.start,void 0===(b=s.end)&&(b=x),"selectionStart"in _?(_.selectionStart=x,_.selectionEnd=Math.min(b,_.value.length)):(b=(x=_.ownerDocument||document)&&x.defaultView||window).getSelection&&(b=b.getSelection(),l=_.textContent.length,w=Math.min(s.start,l),s=void 0===s.end?w:Math.min(s.end,l),!b.extend&&w>s&&(l=s,s=w,w=l),l=hi(_,w),a=hi(_,s),l&&a&&(1!==b.rangeCount||b.anchorNode!==l.node||b.anchorOffset!==l.offset||b.focusNode!==a.node||b.focusOffset!==a.offset)&&((x=x.createRange()).setStart(l.node,l.offset),b.removeAllRanges(),w>s?(b.addRange(x),b.extend(a.node,a.offset)):(x.setEnd(a.node,a.offset),b.addRange(x))))),x=[];for(b=_;b=b.parentNode;)1===b.nodeType&&x.push({element:b,left:b.scrollLeft,top:b.scrollTop});for("function"===typeof _.focus&&_.focus(),_=0;_<x.length;_++)(b=x[_]).element.scrollLeft=b.left,b.element.scrollTop=b.top}Xt=!!Fi,Ni=Fi=null,e.current=n,qs=i;do{try{for(_=e;null!==qs;){var S=qs.flags;if(36&S&&fs(_,qs.alternate,qs),128&S){x=void 0;var T=qs.ref;if(null!==T){var E=qs.stateNode;switch(qs.tag){case 5:x=E;break;default:x=E}"function"===typeof T?T(x):T.current=x}}qs=qs.nextEffect}}catch(M){if(null===qs)throw Error(o(330));Bl(qs,M),qs=qs.nextEffect}}while(null!==qs);qs=null,Dr(),Cs=r}else e.current=n;if(Ys)Ys=!1,Js=e,Ks=t;else for(qs=i;null!==qs;)t=qs.nextEffect,qs.nextEffect=null,8&qs.flags&&((S=qs).sibling=null,S.stateNode=null),qs=t;if(0===(i=e.pendingLanes)&&(Xs=null),1===i?e===il?nl++:(nl=0,il=e):nl=0,n=n.stateNode,br&&"function"===typeof br.onCommitFiberRoot)try{br.onCommitFiberRoot(xr,n,void 0,64===(64&n.current.flags))}catch(M){}if(pl(e,Ur()),Zs)throw Zs=!1,e=$s,$s=null,e;return 0!==(8&Cs)||Wr(),null}function Ll(){for(;null!==qs;){var e=qs.alternate;ll||null===sl||(0!==(8&qs.flags)?et(qs,sl)&&(ll=!0):13===qs.tag&&Es(e,qs)&&et(qs,sl)&&(ll=!0));var t=qs.flags;0!==(256&t)&&ps(e,qs),0===(512&t)||Ys||(Ys=!0,Hr(97,(function(){return Il(),null}))),qs=qs.nextEffect}}function Il(){if(90!==Ks){var e=97<Ks?97:Ks;return Ks=90,Gr(e,Dl)}return!1}function Rl(e,t){Qs.push(t,e),Ys||(Ys=!0,Hr(97,(function(){return Il(),null})))}function zl(e,t){el.push(t,e),Ys||(Ys=!0,Hr(97,(function(){return Il(),null})))}function Dl(){if(null===Js)return!1;var e=Js;if(Js=null,0!==(48&Cs))throw Error(o(331));var t=Cs;Cs|=32;var n=el;el=[];for(var i=0;i<n.length;i+=2){var r=n[i],a=n[i+1],s=r.destroy;if(r.destroy=void 0,"function"===typeof s)try{s()}catch(c){if(null===a)throw Error(o(330));Bl(a,c)}}for(n=Qs,Qs=[],i=0;i<n.length;i+=2){r=n[i],a=n[i+1];try{var l=r.create;r.destroy=l()}catch(c){if(null===a)throw Error(o(330));Bl(a,c)}}for(l=e.current.firstEffect;null!==l;)e=l.nextEffect,l.nextEffect=null,8&l.flags&&(l.sibling=null,l.stateNode=null),l=e;return Cs=t,Wr(),!0}function Ol(e,t,n){la(e,t=cs(0,t=os(n,t),1)),t=cl(),null!==(e=dl(e,1))&&(Gt(e,1,t),pl(e,t))}function Bl(e,t){if(3===e.tag)Ol(e,e,t);else for(var n=e.return;null!==n;){if(3===n.tag){Ol(n,e,t);break}if(1===n.tag){var i=n.stateNode;if("function"===typeof n.type.getDerivedStateFromError||"function"===typeof i.componentDidCatch&&(null===Xs||!Xs.has(i))){var r=us(n,e=os(t,e),1);if(la(n,r),r=cl(),null!==(n=dl(n,1)))Gt(n,1,r),pl(n,r);else if("function"===typeof i.componentDidCatch&&(null===Xs||!Xs.has(i)))try{i.componentDidCatch(t,e)}catch(a){}break}}n=n.return}}function Fl(e,t,n){var i=e.pingCache;null!==i&&i.delete(t),t=cl(),e.pingedLanes|=e.suspendedLanes&n,Ps===e&&(Is&n)===n&&(4===Ds||3===Ds&&(62914560&Is)===Is&&500>Ur()-js?bl(e,0):Us|=n),pl(e,t)}function Nl(e,t){var n=e.stateNode;null!==n&&n.delete(t),0===(t=0)&&(0===(2&(t=e.mode))?t=1:0===(4&t)?t=99===Vr()?1:2:(0===al&&(al=Bs),0===(t=Vt(62914560&~al))&&(t=4194304))),n=cl(),null!==(e=dl(e,t))&&(Gt(e,t,n),pl(e,n))}function Ul(e,t,n,i){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.flags=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childLanes=this.lanes=0,this.alternate=null}function Vl(e,t,n,i){return new Ul(e,t,n,i)}function jl(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Gl(e,t){var n=e.alternate;return null===n?((n=Vl(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.nextEffect=null,n.firstEffect=null,n.lastEffect=null),n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Hl(e,t,n,i,r,a){var s=2;if(i=e,"function"===typeof e)jl(e)&&(s=1);else if("string"===typeof e)s=5;else e:switch(e){case T:return Wl(n.children,r,a,t);case O:s=8,r|=16;break;case E:s=8,r|=1;break;case M:return(e=Vl(12,n,t,8|r)).elementType=M,e.type=M,e.lanes=a,e;case P:return(e=Vl(13,n,t,r)).type=P,e.elementType=P,e.lanes=a,e;case L:return(e=Vl(19,n,t,r)).elementType=L,e.lanes=a,e;case B:return ql(n,r,a,t);case F:return(e=Vl(24,n,t,r)).elementType=F,e.lanes=a,e;default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case k:s=10;break e;case A:s=9;break e;case C:s=11;break e;case I:s=14;break e;case R:s=16,i=null;break e;case z:s=22;break e}throw Error(o(130,null==e?e:typeof e,""))}return(t=Vl(s,n,t,r)).elementType=e,t.type=i,t.lanes=a,t}function Wl(e,t,n,i){return(e=Vl(7,e,i,t)).lanes=n,e}function ql(e,t,n,i){return(e=Vl(23,e,i,t)).elementType=B,e.lanes=n,e}function Zl(e,t,n){return(e=Vl(6,e,null,t)).lanes=n,e}function $l(e,t,n){return(t=Vl(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Xl(e,t,n){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=n,this.callbackNode=null,this.callbackPriority=0,this.eventTimes=jt(0),this.expirationTimes=jt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=jt(0),this.mutableSourceEagerHydrationData=null}function Yl(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:S,key:null==i?null:""+i,children:e,containerInfo:t,implementation:n}}function Jl(e,t,n,i){var r=t.current,a=cl(),s=ul(r);e:if(n){t:{if(Ye(n=n._reactInternals)!==n||1!==n.tag)throw Error(o(170));var l=n;do{switch(l.tag){case 3:l=l.stateNode.context;break t;case 1:if(fr(l.type)){l=l.stateNode.__reactInternalMemoizedMergedChildContext;break t}}l=l.return}while(null!==l);throw Error(o(171))}if(1===n.tag){var c=n.type;if(fr(c)){n=vr(n,c,l);break e}}n=l}else n=cr;return null===t.context?t.context=n:t.pendingContext=n,(t=sa(a,s)).payload={element:e},null!==(i=void 0===i?null:i)&&(t.callback=i),la(r,t),hl(r,s,a),s}function Kl(e){if(!(e=e.current).child)return null;switch(e.child.tag){case 5:default:return e.child.stateNode}}function Ql(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function ec(e,t){Ql(e,t),(e=e.alternate)&&Ql(e,t)}function tc(e,t,n){var i=null!=n&&null!=n.hydrationOptions&&n.hydrationOptions.mutableSources||null;if(n=new Xl(e,t,null!=n&&!0===n.hydrate),t=Vl(3,null,null,2===t?7:1===t?3:0),n.current=t,t.stateNode=n,aa(t),e[Ji]=n.current,Ci(8===e.nodeType?e.parentNode:e),i)for(e=0;e<i.length;e++){var r=(t=i[e])._getVersion;r=r(t._source),null==n.mutableSourceEagerHydrationData?n.mutableSourceEagerHydrationData=[t,r]:n.mutableSourceEagerHydrationData.push(t,r)}this._internalRoot=n}function nc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function ic(e,t,n,i,r){var a=n._reactRootContainer;if(a){var o=a._internalRoot;if("function"===typeof r){var s=r;r=function(){var e=Kl(o);s.call(e)}}Jl(t,o,e,r)}else{if(a=n._reactRootContainer=function(e,t){if(t||(t=!(!(t=e?9===e.nodeType?e.documentElement:e.firstChild:null)||1!==t.nodeType||!t.hasAttribute("data-reactroot"))),!t)for(var n;n=e.lastChild;)e.removeChild(n);return new tc(e,0,t?{hydrate:!0}:void 0)}(n,i),o=a._internalRoot,"function"===typeof r){var l=r;r=function(){var e=Kl(o);l.call(e)}}yl((function(){Jl(t,o,e,r)}))}return Kl(o)}function rc(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!nc(t))throw Error(o(200));return Yl(e,t,null,n)}Ws=function(e,t,n){var i=t.lanes;if(null!==e)if(e.memoizedProps!==t.pendingProps||hr.current)zo=!0;else{if(0===(n&i)){switch(zo=!1,t.tag){case 3:Ho(t),Ha();break;case 5:Ia(t);break;case 1:fr(t.type)&&yr(t);break;case 4:Pa(t,t.stateNode.containerInfo);break;case 10:i=t.memoizedProps.value;var r=t.type._context;lr(Xr,r._currentValue),r._currentValue=i;break;case 13:if(null!==t.memoizedState)return 0!==(n&t.child.childLanes)?Xo(e,t,n):(lr(za,1&za.current),null!==(t=ns(e,t,n))?t.sibling:null);lr(za,1&za.current);break;case 19:if(i=0!==(n&t.childLanes),0!==(64&e.flags)){if(i)return ts(e,t,n);t.flags|=64}if(null!==(r=t.memoizedState)&&(r.rendering=null,r.tail=null,r.lastEffect=null),lr(za,za.current),i)break;return null;case 23:case 24:return t.lanes=0,No(e,t,n)}return ns(e,t,n)}zo=0!==(16384&e.flags)}else zo=!1;switch(t.lanes=0,t.tag){case 2:if(i=t.type,null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,r=pr(t,ur.current),na(t,n),r=io(null,t,i,e,r,n),t.flags|=1,"object"===typeof r&&null!==r&&"function"===typeof r.render&&void 0===r.$$typeof){if(t.tag=1,t.memoizedState=null,t.updateQueue=null,fr(i)){var a=!0;yr(t)}else a=!1;t.memoizedState=null!==r.state&&void 0!==r.state?r.state:null,aa(t);var s=i.getDerivedStateFromProps;"function"===typeof s&&pa(t,i,s,e),r.updater=fa,t.stateNode=r,r._reactInternals=t,ya(t,i,e,n),t=Go(null,t,i,!0,a,n)}else t.tag=0,Do(null,t,r,n),t=t.child;return t;case 16:r=t.elementType;e:{switch(null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,r=(a=r._init)(r._payload),t.type=r,a=t.tag=function(e){if("function"===typeof e)return jl(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===C)return 11;if(e===I)return 14}return 2}(r),e=$r(r,e),a){case 0:t=Vo(null,t,r,e,n);break e;case 1:t=jo(null,t,r,e,n);break e;case 11:t=Oo(null,t,r,e,n);break e;case 14:t=Bo(null,t,r,$r(r.type,e),i,n);break e}throw Error(o(306,r,""))}return t;case 0:return i=t.type,r=t.pendingProps,Vo(e,t,i,r=t.elementType===i?r:$r(i,r),n);case 1:return i=t.type,r=t.pendingProps,jo(e,t,i,r=t.elementType===i?r:$r(i,r),n);case 3:if(Ho(t),i=t.updateQueue,null===e||null===i)throw Error(o(282));if(i=t.pendingProps,r=null!==(r=t.memoizedState)?r.element:null,oa(e,t),ua(t,i,null,n),(i=t.memoizedState.element)===r)Ha(),t=ns(e,t,n);else{if((a=(r=t.stateNode).hydrate)&&(Ba=Wi(t.stateNode.containerInfo.firstChild),Oa=t,a=Fa=!0),a){if(null!=(e=r.mutableSourceEagerHydrationData))for(r=0;r<e.length;r+=2)(a=e[r])._workInProgressVersionPrimary=e[r+1],Wa.push(a);for(n=Ta(t,null,i,n),t.child=n;n;)n.flags=-3&n.flags|1024,n=n.sibling}else Do(e,t,i,n),Ha();t=t.child}return t;case 5:return Ia(t),null===e&&Va(t),i=t.type,r=t.pendingProps,a=null!==e?e.memoizedProps:null,s=r.children,Vi(i,r)?s=null:null!==a&&Vi(i,a)&&(t.flags|=16),Uo(e,t),Do(e,t,s,n),t.child;case 6:return null===e&&Va(t),null;case 13:return Xo(e,t,n);case 4:return Pa(t,t.stateNode.containerInfo),i=t.pendingProps,null===e?t.child=Sa(t,null,i,n):Do(e,t,i,n),t.child;case 11:return i=t.type,r=t.pendingProps,Oo(e,t,i,r=t.elementType===i?r:$r(i,r),n);case 7:return Do(e,t,t.pendingProps,n),t.child;case 8:case 12:return Do(e,t,t.pendingProps.children,n),t.child;case 10:e:{i=t.type._context,r=t.pendingProps,s=t.memoizedProps,a=r.value;var l=t.type._context;if(lr(Xr,l._currentValue),l._currentValue=a,null!==s)if(l=s.value,0===(a=si(l,a)?0:0|("function"===typeof i._calculateChangedBits?i._calculateChangedBits(l,a):1073741823))){if(s.children===r.children&&!hr.current){t=ns(e,t,n);break e}}else for(null!==(l=t.child)&&(l.return=t);null!==l;){var c=l.dependencies;if(null!==c){s=l.child;for(var u=c.firstContext;null!==u;){if(u.context===i&&0!==(u.observedBits&a)){1===l.tag&&((u=sa(-1,n&-n)).tag=2,la(l,u)),l.lanes|=n,null!==(u=l.alternate)&&(u.lanes|=n),ta(l.return,n),c.lanes|=n;break}u=u.next}}else s=10===l.tag&&l.type===t.type?null:l.child;if(null!==s)s.return=l;else for(s=l;null!==s;){if(s===t){s=null;break}if(null!==(l=s.sibling)){l.return=s.return,s=l;break}s=s.return}l=s}Do(e,t,r.children,n),t=t.child}return t;case 9:return r=t.type,i=(a=t.pendingProps).children,na(t,n),i=i(r=ia(r,a.unstable_observedBits)),t.flags|=1,Do(e,t,i,n),t.child;case 14:return a=$r(r=t.type,t.pendingProps),Bo(e,t,r,a=$r(r.type,a),i,n);case 15:return Fo(e,t,t.type,t.pendingProps,i,n);case 17:return i=t.type,r=t.pendingProps,r=t.elementType===i?r:$r(i,r),null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),t.tag=1,fr(i)?(e=!0,yr(t)):e=!1,na(t,n),ga(t,i,r),ya(t,i,r,n),Go(null,t,i,!0,e,n);case 19:return ts(e,t,n);case 23:case 24:return No(e,t,n)}throw Error(o(156,t.tag))},tc.prototype.render=function(e){Jl(e,this._internalRoot,null,null)},tc.prototype.unmount=function(){var e=this._internalRoot,t=e.containerInfo;Jl(null,e,null,(function(){t[Ji]=null}))},tt=function(e){13===e.tag&&(hl(e,4,cl()),ec(e,4))},nt=function(e){13===e.tag&&(hl(e,67108864,cl()),ec(e,67108864))},it=function(e){if(13===e.tag){var t=cl(),n=ul(e);hl(e,n,t),ec(e,n)}},rt=function(e,t){return t()},ke=function(e,t,n){switch(t){case"input":if(ne(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var i=n[t];if(i!==e&&i.form===e.form){var r=nr(i);if(!r)throw Error(o(90));J(i),ne(i,r)}}}break;case"textarea":ce(e,n);break;case"select":null!=(t=n.value)&&oe(e,!!n.multiple,t,!1)}},Re=vl,ze=function(e,t,n,i,r){var a=Cs;Cs|=4;try{return Gr(98,e.bind(null,t,n,i,r))}finally{0===(Cs=a)&&(Hs(),Wr())}},De=function(){0===(49&Cs)&&(function(){if(null!==tl){var e=tl;tl=null,e.forEach((function(e){e.expiredLanes|=24&e.pendingLanes,pl(e,Ur())}))}Wr()}(),Il())},Oe=function(e,t){var n=Cs;Cs|=2;try{return e(t)}finally{0===(Cs=n)&&(Hs(),Wr())}};var ac={Events:[er,tr,nr,Le,Ie,Il,{current:!1}]},oc={findFiberByHostInstance:Qi,bundleType:0,version:"17.0.2",rendererPackageName:"react-dom"},sc={bundleType:oc.bundleType,version:oc.version,rendererPackageName:oc.rendererPackageName,rendererConfig:oc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:b.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=Qe(e))?null:e.stateNode},findFiberByHostInstance:oc.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var lc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!lc.isDisabled&&lc.supportsFiber)try{xr=lc.inject(sc),br=lc}catch(ge){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ac,t.createPortal=rc,t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(o(188));throw Error(o(268,Object.keys(e)))}return e=null===(e=Qe(t))?null:e.stateNode},t.flushSync=function(e,t){var n=Cs;if(0!==(48&n))return e(t);Cs|=1;try{if(e)return Gr(99,e.bind(null,t))}finally{Cs=n,Wr()}},t.hydrate=function(e,t,n){if(!nc(t))throw Error(o(200));return ic(null,e,t,!0,n)},t.render=function(e,t,n){if(!nc(t))throw Error(o(200));return ic(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!nc(e))throw Error(o(40));return!!e._reactRootContainer&&(yl((function(){ic(null,null,e,!1,(function(){e._reactRootContainer=null,e[Ji]=null}))})),!0)},t.unstable_batchedUpdates=vl,t.unstable_createPortal=function(e,t){return rc(e,t,2<arguments.length&&void 0!==arguments[2]?arguments[2]:null)},t.unstable_renderSubtreeIntoContainer=function(e,t,n,i){if(!nc(n))throw Error(o(200));if(null==e||void 0===e._reactInternals)throw Error(o(38));return ic(e,t,n,!1,i)},t.version="17.0.2"},function(e,t,n){"use strict";e.exports=n(40)},function(e,t,n){"use strict";var i,r,a,o;if("object"===typeof performance&&"function"===typeof performance.now){var s=performance;t.unstable_now=function(){return s.now()}}else{var l=Date,c=l.now();t.unstable_now=function(){return l.now()-c}}if("undefined"===typeof window||"function"!==typeof MessageChannel){var u=null,h=null,d=function e(){if(null!==u)try{var n=t.unstable_now();u(!0,n),u=null}catch(i){throw setTimeout(e,0),i}};i=function(e){null!==u?setTimeout(i,0,e):(u=e,setTimeout(d,0))},r=function(e,t){h=setTimeout(e,t)},a=function(){clearTimeout(h)},t.unstable_shouldYield=function(){return!1},o=t.unstable_forceFrameRate=function(){}}else{var p=window.setTimeout,f=window.clearTimeout;if("undefined"!==typeof console){var m=window.cancelAnimationFrame;"function"!==typeof window.requestAnimationFrame&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills"),"function"!==typeof m&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills")}var g=!1,v=null,y=-1,_=5,x=0;t.unstable_shouldYield=function(){return t.unstable_now()>=x},o=function(){},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):_=0<e?Math.floor(1e3/e):5};var b=new MessageChannel,w=b.port2;b.port1.onmessage=function(){if(null!==v){var e=t.unstable_now();x=e+_;try{v(!0,e)?w.postMessage(null):(g=!1,v=null)}catch(n){throw w.postMessage(null),n}}else g=!1},i=function(e){v=e,g||(g=!0,w.postMessage(null))},r=function(e,n){y=p((function(){e(t.unstable_now())}),n)},a=function(){f(y),y=-1}}function S(e,t){var n=e.length;e.push(t);e:for(;;){var i=n-1>>>1,r=e[i];if(!(void 0!==r&&0<M(r,t)))break e;e[i]=t,e[n]=r,n=i}}function T(e){return void 0===(e=e[0])?null:e}function E(e){var t=e[0];if(void 0!==t){var n=e.pop();if(n!==t){e[0]=n;e:for(var i=0,r=e.length;i<r;){var a=2*(i+1)-1,o=e[a],s=a+1,l=e[s];if(void 0!==o&&0>M(o,n))void 0!==l&&0>M(l,o)?(e[i]=l,e[s]=n,i=s):(e[i]=o,e[a]=n,i=a);else{if(!(void 0!==l&&0>M(l,n)))break e;e[i]=l,e[s]=n,i=s}}}return t}return null}function M(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}var k=[],A=[],C=1,P=null,L=3,I=!1,R=!1,z=!1;function D(e){for(var t=T(A);null!==t;){if(null===t.callback)E(A);else{if(!(t.startTime<=e))break;E(A),t.sortIndex=t.expirationTime,S(k,t)}t=T(A)}}function O(e){if(z=!1,D(e),!R)if(null!==T(k))R=!0,i(B);else{var t=T(A);null!==t&&r(O,t.startTime-e)}}function B(e,n){R=!1,z&&(z=!1,a()),I=!0;var i=L;try{for(D(n),P=T(k);null!==P&&(!(P.expirationTime>n)||e&&!t.unstable_shouldYield());){var o=P.callback;if("function"===typeof o){P.callback=null,L=P.priorityLevel;var s=o(P.expirationTime<=n);n=t.unstable_now(),"function"===typeof s?P.callback=s:P===T(k)&&E(k),D(n)}else E(k);P=T(k)}if(null!==P)var l=!0;else{var c=T(A);null!==c&&r(O,c.startTime-n),l=!1}return l}finally{P=null,L=i,I=!1}}var F=o;t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){R||I||(R=!0,i(B))},t.unstable_getCurrentPriorityLevel=function(){return L},t.unstable_getFirstCallbackNode=function(){return T(k)},t.unstable_next=function(e){switch(L){case 1:case 2:case 3:var t=3;break;default:t=L}var n=L;L=t;try{return e()}finally{L=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=F,t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=L;L=e;try{return t()}finally{L=n}},t.unstable_scheduleCallback=function(e,n,o){var s=t.unstable_now();switch("object"===typeof o&&null!==o?o="number"===typeof(o=o.delay)&&0<o?s+o:s:o=s,e){case 1:var l=-1;break;case 2:l=250;break;case 5:l=1073741823;break;case 4:l=1e4;break;default:l=5e3}return e={id:C++,callback:n,priorityLevel:e,startTime:o,expirationTime:l=o+l,sortIndex:-1},o>s?(e.sortIndex=o,S(A,e),null===T(k)&&e===T(A)&&(z?a():z=!0,r(O,o-s))):(e.sortIndex=l,S(k,e),R||I||(R=!0,i(B))),e},t.unstable_wrapCallback=function(e){var t=L;return function(){var n=L;L=t;try{return e.apply(this,arguments)}finally{L=n}}}},,,function(e,t,n){"use strict";n(21);var i=n(7),r=60103;if(t.Fragment=60107,"function"===typeof Symbol&&Symbol.for){var a=Symbol.for;r=a("react.element"),t.Fragment=a("react.fragment")}var o=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s=Object.prototype.hasOwnProperty,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var i,a={},c=null,u=null;for(i in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)s.call(t,i)&&!l.hasOwnProperty(i)&&(a[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps)void 0===a[i]&&(a[i]=t[i]);return{$$typeof:r,type:e,key:c,ref:u,props:a,_owner:o.current}}t.jsx=c,t.jsxs=c},function(e,t,n){e.exports=n(45)()},function(e,t,n){"use strict";var i=n(46);function r(){}function a(){}a.resetWarningCache=r,e.exports=function(){function e(e,t,n,r,a,o){if(o!==i){var s=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw s.name="Invariant Violation",s}}function t(){return e}e.isRequired=e;var n={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:a,resetWarningCache:r};return n.PropTypes=n,n}},function(e,t,n){"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},function(e,t,n){"use strict";(function(e){var i=n(49),r=n(50),a=n(51);function o(){return l.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(e,t){if(o()<t)throw new RangeError("Invalid typed array length");return l.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=l.prototype:(null===e&&(e=new l(t)),e.length=t),e}function l(e,t,n){if(!l.TYPED_ARRAY_SUPPORT&&!(this instanceof l))return new l(e,t,n);if("number"===typeof e){if("string"===typeof t)throw new Error("If encoding is specified then the first argument must be a string");return h(this,e)}return c(this,e,t,n)}function c(e,t,n,i){if("number"===typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!==typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,i){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(i||0))throw new RangeError("'length' is out of bounds");t=void 0===n&&void 0===i?new Uint8Array(t):void 0===i?new Uint8Array(t,n):new Uint8Array(t,n,i);l.TYPED_ARRAY_SUPPORT?(e=t).__proto__=l.prototype:e=d(e,t);return e}(e,t,n,i):"string"===typeof t?function(e,t,n){"string"===typeof n&&""!==n||(n="utf8");if(!l.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var i=0|f(t,n),r=(e=s(e,i)).write(t,n);r!==i&&(e=e.slice(0,r));return e}(e,t,n):function(e,t){if(l.isBuffer(t)){var n=0|p(t.length);return 0===(e=s(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!==typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!==typeof t.length||(i=t.length)!==i?s(e,0):d(e,t);if("Buffer"===t.type&&a(t.data))return d(e,t.data)}var i;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function u(e){if("number"!==typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function h(e,t){if(u(t),e=s(e,t<0?0:0|p(t)),!l.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function d(e,t){var n=t.length<0?0:0|p(t.length);e=s(e,n);for(var i=0;i<n;i+=1)e[i]=255&t[i];return e}function p(e){if(e>=o())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o().toString(16)+" bytes");return 0|e}function f(e,t){if(l.isBuffer(e))return e.length;if("undefined"!==typeof ArrayBuffer&&"function"===typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!==typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return V(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return j(e).length;default:if(i)return V(e).length;t=(""+t).toLowerCase(),i=!0}}function m(e,t,n){var i=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return P(this,t,n);case"utf8":case"utf-8":return M(this,t,n);case"ascii":return A(this,t,n);case"latin1":case"binary":return C(this,t,n);case"base64":return E(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return L(this,t,n);default:if(i)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),i=!0}}function g(e,t,n){var i=e[t];e[t]=e[n],e[n]=i}function v(e,t,n,i,r){if(0===e.length)return-1;if("string"===typeof n?(i=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=r?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(r)return-1;n=e.length-1}else if(n<0){if(!r)return-1;n=0}if("string"===typeof t&&(t=l.from(t,i)),l.isBuffer(t))return 0===t.length?-1:y(e,t,n,i,r);if("number"===typeof t)return t&=255,l.TYPED_ARRAY_SUPPORT&&"function"===typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):y(e,[t],n,i,r);throw new TypeError("val must be string, number or Buffer")}function y(e,t,n,i,r){var a,o=1,s=e.length,l=t.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(e.length<2||t.length<2)return-1;o=2,s/=2,l/=2,n/=2}function c(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(r){var u=-1;for(a=n;a<s;a++)if(c(e,a)===c(t,-1===u?0:a-u)){if(-1===u&&(u=a),a-u+1===l)return u*o}else-1!==u&&(a-=a-u),u=-1}else for(n+l>s&&(n=s-l),a=n;a>=0;a--){for(var h=!0,d=0;d<l;d++)if(c(e,a+d)!==c(t,d)){h=!1;break}if(h)return a}return-1}function _(e,t,n,i){n=Number(n)||0;var r=e.length-n;i?(i=Number(i))>r&&(i=r):i=r;var a=t.length;if(a%2!==0)throw new TypeError("Invalid hex string");i>a/2&&(i=a/2);for(var o=0;o<i;++o){var s=parseInt(t.substr(2*o,2),16);if(isNaN(s))return o;e[n+o]=s}return o}function x(e,t,n,i){return G(V(t,e.length-n),e,n,i)}function b(e,t,n,i){return G(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,i)}function w(e,t,n,i){return b(e,t,n,i)}function S(e,t,n,i){return G(j(t),e,n,i)}function T(e,t,n,i){return G(function(e,t){for(var n,i,r,a=[],o=0;o<e.length&&!((t-=2)<0);++o)i=(n=e.charCodeAt(o))>>8,r=n%256,a.push(r),a.push(i);return a}(t,e.length-n),e,n,i)}function E(e,t,n){return 0===t&&n===e.length?i.fromByteArray(e):i.fromByteArray(e.slice(t,n))}function M(e,t,n){n=Math.min(e.length,n);for(var i=[],r=t;r<n;){var a,o,s,l,c=e[r],u=null,h=c>239?4:c>223?3:c>191?2:1;if(r+h<=n)switch(h){case 1:c<128&&(u=c);break;case 2:128===(192&(a=e[r+1]))&&(l=(31&c)<<6|63&a)>127&&(u=l);break;case 3:a=e[r+1],o=e[r+2],128===(192&a)&&128===(192&o)&&(l=(15&c)<<12|(63&a)<<6|63&o)>2047&&(l<55296||l>57343)&&(u=l);break;case 4:a=e[r+1],o=e[r+2],s=e[r+3],128===(192&a)&&128===(192&o)&&128===(192&s)&&(l=(15&c)<<18|(63&a)<<12|(63&o)<<6|63&s)>65535&&l<1114112&&(u=l)}null===u?(u=65533,h=1):u>65535&&(u-=65536,i.push(u>>>10&1023|55296),u=56320|1023&u),i.push(u),r+=h}return function(e){var t=e.length;if(t<=k)return String.fromCharCode.apply(String,e);var n="",i=0;for(;i<t;)n+=String.fromCharCode.apply(String,e.slice(i,i+=k));return n}(i)}t.Buffer=l,t.SlowBuffer=function(e){+e!=e&&(e=0);return l.alloc(+e)},t.INSPECT_MAX_BYTES=50,l.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"===typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(t){return!1}}(),t.kMaxLength=o(),l.poolSize=8192,l._augment=function(e){return e.__proto__=l.prototype,e},l.from=function(e,t,n){return c(null,e,t,n)},l.TYPED_ARRAY_SUPPORT&&(l.prototype.__proto__=Uint8Array.prototype,l.__proto__=Uint8Array,"undefined"!==typeof Symbol&&Symbol.species&&l[Symbol.species]===l&&Object.defineProperty(l,Symbol.species,{value:null,configurable:!0})),l.alloc=function(e,t,n){return function(e,t,n,i){return u(t),t<=0?s(e,t):void 0!==n?"string"===typeof i?s(e,t).fill(n,i):s(e,t).fill(n):s(e,t)}(null,e,t,n)},l.allocUnsafe=function(e){return h(null,e)},l.allocUnsafeSlow=function(e){return h(null,e)},l.isBuffer=function(e){return!(null==e||!e._isBuffer)},l.compare=function(e,t){if(!l.isBuffer(e)||!l.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,i=t.length,r=0,a=Math.min(n,i);r<a;++r)if(e[r]!==t[r]){n=e[r],i=t[r];break}return n<i?-1:i<n?1:0},l.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(e,t){if(!a(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return l.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var i=l.allocUnsafe(t),r=0;for(n=0;n<e.length;++n){var o=e[n];if(!l.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(i,r),r+=o.length}return i},l.byteLength=f,l.prototype._isBuffer=!0,l.prototype.swap16=function(){var e=this.length;if(e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)g(this,t,t+1);return this},l.prototype.swap32=function(){var e=this.length;if(e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)g(this,t,t+3),g(this,t+1,t+2);return this},l.prototype.swap64=function(){var e=this.length;if(e%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)g(this,t,t+7),g(this,t+1,t+6),g(this,t+2,t+5),g(this,t+3,t+4);return this},l.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?M(this,0,e):m.apply(this,arguments)},l.prototype.equals=function(e){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===l.compare(this,e)},l.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},l.prototype.compare=function(e,t,n,i,r){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===i&&(i=0),void 0===r&&(r=this.length),t<0||n>e.length||i<0||r>this.length)throw new RangeError("out of range index");if(i>=r&&t>=n)return 0;if(i>=r)return-1;if(t>=n)return 1;if(this===e)return 0;for(var a=(r>>>=0)-(i>>>=0),o=(n>>>=0)-(t>>>=0),s=Math.min(a,o),c=this.slice(i,r),u=e.slice(t,n),h=0;h<s;++h)if(c[h]!==u[h]){a=c[h],o=u[h];break}return a<o?-1:o<a?1:0},l.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},l.prototype.indexOf=function(e,t,n){return v(this,e,t,n,!0)},l.prototype.lastIndexOf=function(e,t,n){return v(this,e,t,n,!1)},l.prototype.write=function(e,t,n,i){if(void 0===t)i="utf8",n=this.length,t=0;else if(void 0===n&&"string"===typeof t)i=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===i&&(i="utf8")):(i=n,n=void 0)}var r=this.length-t;if((void 0===n||n>r)&&(n=r),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var a=!1;;)switch(i){case"hex":return _(this,e,t,n);case"utf8":case"utf-8":return x(this,e,t,n);case"ascii":return b(this,e,t,n);case"latin1":case"binary":return w(this,e,t,n);case"base64":return S(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return T(this,e,t,n);default:if(a)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),a=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var k=4096;function A(e,t,n){var i="";n=Math.min(e.length,n);for(var r=t;r<n;++r)i+=String.fromCharCode(127&e[r]);return i}function C(e,t,n){var i="";n=Math.min(e.length,n);for(var r=t;r<n;++r)i+=String.fromCharCode(e[r]);return i}function P(e,t,n){var i=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>i)&&(n=i);for(var r="",a=t;a<n;++a)r+=U(e[a]);return r}function L(e,t,n){for(var i=e.slice(t,n),r="",a=0;a<i.length;a+=2)r+=String.fromCharCode(i[a]+256*i[a+1]);return r}function I(e,t,n){if(e%1!==0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function R(e,t,n,i,r,a){if(!l.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>r||t<a)throw new RangeError('"value" argument is out of bounds');if(n+i>e.length)throw new RangeError("Index out of range")}function z(e,t,n,i){t<0&&(t=65535+t+1);for(var r=0,a=Math.min(e.length-n,2);r<a;++r)e[n+r]=(t&255<<8*(i?r:1-r))>>>8*(i?r:1-r)}function D(e,t,n,i){t<0&&(t=4294967295+t+1);for(var r=0,a=Math.min(e.length-n,4);r<a;++r)e[n+r]=t>>>8*(i?r:3-r)&255}function O(e,t,n,i,r,a){if(n+i>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function B(e,t,n,i,a){return a||O(e,0,n,4),r.write(e,t,n,i,23,4),n+4}function F(e,t,n,i,a){return a||O(e,0,n,8),r.write(e,t,n,i,52,8),n+8}l.prototype.slice=function(e,t){var n,i=this.length;if((e=~~e)<0?(e+=i)<0&&(e=0):e>i&&(e=i),(t=void 0===t?i:~~t)<0?(t+=i)<0&&(t=0):t>i&&(t=i),t<e&&(t=e),l.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=l.prototype;else{var r=t-e;n=new l(r,void 0);for(var a=0;a<r;++a)n[a]=this[a+e]}return n},l.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||I(e,t,this.length);for(var i=this[e],r=1,a=0;++a<t&&(r*=256);)i+=this[e+a]*r;return i},l.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||I(e,t,this.length);for(var i=this[e+--t],r=1;t>0&&(r*=256);)i+=this[e+--t]*r;return i},l.prototype.readUInt8=function(e,t){return t||I(e,1,this.length),this[e]},l.prototype.readUInt16LE=function(e,t){return t||I(e,2,this.length),this[e]|this[e+1]<<8},l.prototype.readUInt16BE=function(e,t){return t||I(e,2,this.length),this[e]<<8|this[e+1]},l.prototype.readUInt32LE=function(e,t){return t||I(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},l.prototype.readUInt32BE=function(e,t){return t||I(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},l.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||I(e,t,this.length);for(var i=this[e],r=1,a=0;++a<t&&(r*=256);)i+=this[e+a]*r;return i>=(r*=128)&&(i-=Math.pow(2,8*t)),i},l.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||I(e,t,this.length);for(var i=t,r=1,a=this[e+--i];i>0&&(r*=256);)a+=this[e+--i]*r;return a>=(r*=128)&&(a-=Math.pow(2,8*t)),a},l.prototype.readInt8=function(e,t){return t||I(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},l.prototype.readInt16LE=function(e,t){t||I(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},l.prototype.readInt16BE=function(e,t){t||I(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},l.prototype.readInt32LE=function(e,t){return t||I(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},l.prototype.readInt32BE=function(e,t){return t||I(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},l.prototype.readFloatLE=function(e,t){return t||I(e,4,this.length),r.read(this,e,!0,23,4)},l.prototype.readFloatBE=function(e,t){return t||I(e,4,this.length),r.read(this,e,!1,23,4)},l.prototype.readDoubleLE=function(e,t){return t||I(e,8,this.length),r.read(this,e,!0,52,8)},l.prototype.readDoubleBE=function(e,t){return t||I(e,8,this.length),r.read(this,e,!1,52,8)},l.prototype.writeUIntLE=function(e,t,n,i){(e=+e,t|=0,n|=0,i)||R(this,e,t,n,Math.pow(2,8*n)-1,0);var r=1,a=0;for(this[t]=255&e;++a<n&&(r*=256);)this[t+a]=e/r&255;return t+n},l.prototype.writeUIntBE=function(e,t,n,i){(e=+e,t|=0,n|=0,i)||R(this,e,t,n,Math.pow(2,8*n)-1,0);var r=n-1,a=1;for(this[t+r]=255&e;--r>=0&&(a*=256);)this[t+r]=e/a&255;return t+n},l.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,1,255,0),l.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},l.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):z(this,e,t,!0),t+2},l.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):z(this,e,t,!1),t+2},l.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):D(this,e,t,!0),t+4},l.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):D(this,e,t,!1),t+4},l.prototype.writeIntLE=function(e,t,n,i){if(e=+e,t|=0,!i){var r=Math.pow(2,8*n-1);R(this,e,t,n,r-1,-r)}var a=0,o=1,s=0;for(this[t]=255&e;++a<n&&(o*=256);)e<0&&0===s&&0!==this[t+a-1]&&(s=1),this[t+a]=(e/o>>0)-s&255;return t+n},l.prototype.writeIntBE=function(e,t,n,i){if(e=+e,t|=0,!i){var r=Math.pow(2,8*n-1);R(this,e,t,n,r-1,-r)}var a=n-1,o=1,s=0;for(this[t+a]=255&e;--a>=0&&(o*=256);)e<0&&0===s&&0!==this[t+a+1]&&(s=1),this[t+a]=(e/o>>0)-s&255;return t+n},l.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,1,127,-128),l.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},l.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):z(this,e,t,!0),t+2},l.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):z(this,e,t,!1),t+2},l.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,4,2147483647,-2147483648),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):D(this,e,t,!0),t+4},l.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):D(this,e,t,!1),t+4},l.prototype.writeFloatLE=function(e,t,n){return B(this,e,t,!0,n)},l.prototype.writeFloatBE=function(e,t,n){return B(this,e,t,!1,n)},l.prototype.writeDoubleLE=function(e,t,n){return F(this,e,t,!0,n)},l.prototype.writeDoubleBE=function(e,t,n){return F(this,e,t,!1,n)},l.prototype.copy=function(e,t,n,i){if(n||(n=0),i||0===i||(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&i<n&&(i=n),i===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-n&&(i=e.length-t+n);var r,a=i-n;if(this===e&&n<t&&t<i)for(r=a-1;r>=0;--r)e[r+t]=this[r+n];else if(a<1e3||!l.TYPED_ARRAY_SUPPORT)for(r=0;r<a;++r)e[r+t]=this[r+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+a),t);return a},l.prototype.fill=function(e,t,n,i){if("string"===typeof e){if("string"===typeof t?(i=t,t=0,n=this.length):"string"===typeof n&&(i=n,n=this.length),1===e.length){var r=e.charCodeAt(0);r<256&&(e=r)}if(void 0!==i&&"string"!==typeof i)throw new TypeError("encoding must be a string");if("string"===typeof i&&!l.isEncoding(i))throw new TypeError("Unknown encoding: "+i)}else"number"===typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var a;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"===typeof e)for(a=t;a<n;++a)this[a]=e;else{var o=l.isBuffer(e)?e:V(new l(e,i).toString()),s=o.length;for(a=0;a<n-t;++a)this[a+t]=o[a%s]}return this};var N=/[^+\/0-9A-Za-z-_]/g;function U(e){return e<16?"0"+e.toString(16):e.toString(16)}function V(e,t){var n;t=t||1/0;for(var i=e.length,r=null,a=[],o=0;o<i;++o){if((n=e.charCodeAt(o))>55295&&n<57344){if(!r){if(n>56319){(t-=3)>-1&&a.push(239,191,189);continue}if(o+1===i){(t-=3)>-1&&a.push(239,191,189);continue}r=n;continue}if(n<56320){(t-=3)>-1&&a.push(239,191,189),r=n;continue}n=65536+(r-55296<<10|n-56320)}else r&&(t-=3)>-1&&a.push(239,191,189);if(r=null,n<128){if((t-=1)<0)break;a.push(n)}else if(n<2048){if((t-=2)<0)break;a.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;a.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return a}function j(e){return i.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(N,"")).length<2)return"";for(;e.length%4!==0;)e+="=";return e}(e))}function G(e,t,n,i){for(var r=0;r<i&&!(r+n>=t.length||r>=e.length);++r)t[r+n]=e[r];return r}}).call(this,n(48))},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(i){"object"===typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";t.byteLength=function(e){var t=c(e),n=t[0],i=t[1];return 3*(n+i)/4-i},t.toByteArray=function(e){var t,n,i=c(e),o=i[0],s=i[1],l=new a(function(e,t,n){return 3*(t+n)/4-n}(0,o,s)),u=0,h=s>0?o-4:o;for(n=0;n<h;n+=4)t=r[e.charCodeAt(n)]<<18|r[e.charCodeAt(n+1)]<<12|r[e.charCodeAt(n+2)]<<6|r[e.charCodeAt(n+3)],l[u++]=t>>16&255,l[u++]=t>>8&255,l[u++]=255&t;2===s&&(t=r[e.charCodeAt(n)]<<2|r[e.charCodeAt(n+1)]>>4,l[u++]=255&t);1===s&&(t=r[e.charCodeAt(n)]<<10|r[e.charCodeAt(n+1)]<<4|r[e.charCodeAt(n+2)]>>2,l[u++]=t>>8&255,l[u++]=255&t);return l},t.fromByteArray=function(e){for(var t,n=e.length,r=n%3,a=[],o=16383,s=0,l=n-r;s<l;s+=o)a.push(u(e,s,s+o>l?l:s+o));1===r?(t=e[n-1],a.push(i[t>>2]+i[t<<4&63]+"==")):2===r&&(t=(e[n-2]<<8)+e[n-1],a.push(i[t>>10]+i[t>>4&63]+i[t<<2&63]+"="));return a.join("")};for(var i=[],r=[],a="undefined"!==typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,l=o.length;s<l;++s)i[s]=o[s],r[o.charCodeAt(s)]=s;function c(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function u(e,t,n){for(var r,a,o=[],s=t;s<n;s+=3)r=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),o.push(i[(a=r)>>18&63]+i[a>>12&63]+i[a>>6&63]+i[63&a]);return o.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,n,i,r){var a,o,s=8*r-i-1,l=(1<<s)-1,c=l>>1,u=-7,h=n?r-1:0,d=n?-1:1,p=e[t+h];for(h+=d,a=p&(1<<-u)-1,p>>=-u,u+=s;u>0;a=256*a+e[t+h],h+=d,u-=8);for(o=a&(1<<-u)-1,a>>=-u,u+=i;u>0;o=256*o+e[t+h],h+=d,u-=8);if(0===a)a=1-c;else{if(a===l)return o?NaN:1/0*(p?-1:1);o+=Math.pow(2,i),a-=c}return(p?-1:1)*o*Math.pow(2,a-i)},t.write=function(e,t,n,i,r,a){var o,s,l,c=8*a-r-1,u=(1<<c)-1,h=u>>1,d=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,p=i?0:a-1,f=i?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=u):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),(t+=o+h>=1?d/l:d*Math.pow(2,1-h))*l>=2&&(o++,l/=2),o+h>=u?(s=0,o=u):o+h>=1?(s=(t*l-1)*Math.pow(2,r),o+=h):(s=t*Math.pow(2,h-1)*Math.pow(2,r),o=0));r>=8;e[n+p]=255&s,p+=f,s/=256,r-=8);for(o=o<<r|s,c+=r;c>0;e[n+p]=255&o,p+=f,o/=256,c-=8);e[n+p-f]|=128*m}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){var i=function(e){"use strict";var t,n=Object.prototype,i=n.hasOwnProperty,r="function"===typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",s=r.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(L){l=function(e,t,n){return e[t]=n}}function c(e,t,n,i){var r=t&&t.prototype instanceof g?t:g,a=Object.create(r.prototype),o=new A(i||[]);return a._invoke=function(e,t,n){var i=h;return function(r,a){if(i===p)throw new Error("Generator is already running");if(i===f){if("throw"===r)throw a;return P()}for(n.method=r,n.arg=a;;){var o=n.delegate;if(o){var s=E(o,n);if(s){if(s===m)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===h)throw i=f,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=p;var l=u(e,t,n);if("normal"===l.type){if(i=n.done?f:d,l.arg===m)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i=f,n.method="throw",n.arg=l.arg)}}}(e,n,o),a}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(L){return{type:"throw",arg:L}}}e.wrap=c;var h="suspendedStart",d="suspendedYield",p="executing",f="completed",m={};function g(){}function v(){}function y(){}var _={};_[a]=function(){return this};var x=Object.getPrototypeOf,b=x&&x(x(C([])));b&&b!==n&&i.call(b,a)&&(_=b);var w=y.prototype=g.prototype=Object.create(_);function S(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function T(e,t){function n(r,a,o,s){var l=u(e[r],e,a);if("throw"!==l.type){var c=l.arg,h=c.value;return h&&"object"===typeof h&&i.call(h,"__await")?t.resolve(h.__await).then((function(e){n("next",e,o,s)}),(function(e){n("throw",e,o,s)})):t.resolve(h).then((function(e){c.value=e,o(c)}),(function(e){return n("throw",e,o,s)}))}s(l.arg)}var r;this._invoke=function(e,i){function a(){return new t((function(t,r){n(e,i,t,r)}))}return r=r?r.then(a,a):a()}}function E(e,n){var i=e.iterator[n.method];if(i===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=t,E(e,n),"throw"===n.method))return m;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var r=u(i,e.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,m;var a=r.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,m):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function M(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(M,this),this.reset(!0)}function C(e){if(e){var n=e[a];if(n)return n.call(e);if("function"===typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function n(){for(;++r<e.length;)if(i.call(e,r))return n.value=e[r],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}return{next:P}}function P(){return{value:t,done:!0}}return v.prototype=w.constructor=y,y.constructor=v,v.displayName=l(y,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"===typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,l(e,s,"GeneratorFunction")),e.prototype=Object.create(w),e},e.awrap=function(e){return{__await:e}},S(T.prototype),T.prototype[o]=function(){return this},e.AsyncIterator=T,e.async=function(t,n,i,r,a){void 0===a&&(a=Promise);var o=new T(c(t,n,i,r),a);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},S(w),l(w,s,"Generator"),w[a]=function(){return this},w.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var i=t.pop();if(i in e)return n.value=i,n.done=!1,n}return n.done=!0,n}},e.values=C,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(k),!e)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function r(i,r){return s.type="throw",s.arg=e,n.next=i,r&&(n.method="next",n.arg=t),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var l=i.call(o,"catchLoc"),c=i.call(o,"finallyLoc");if(l&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(l){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,m):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),k(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var r=i.arg;k(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,i){return this.delegate={iterator:C(e),resultName:n,nextLoc:i},"next"===this.method&&(this.arg=t),m}},e}(e.exports);try{regeneratorRuntime=i}catch(r){Function("r","regeneratorRuntime = r")(i)}},function(e,t,n){"use strict";var i=n(9),r=n(24),a=n(54),o=n(30);function s(e){var t=new a(e),n=r(a.prototype.request,t);return i.extend(n,a.prototype,t),i.extend(n,t),n}var l=s(n(27));l.Axios=a,l.create=function(e){return s(o(l.defaults,e))},l.Cancel=n(31),l.CancelToken=n(68),l.isCancel=n(26),l.all=function(e){return Promise.all(e)},l.spread=n(69),l.isAxiosError=n(70),e.exports=l,e.exports.default=l},function(e,t,n){"use strict";var i=n(9),r=n(25),a=n(55),o=n(56),s=n(30);function l(e){this.defaults=e,this.interceptors={request:new a,response:new a}}l.prototype.request=function(e){"string"===typeof e?(e=arguments[1]||{}).url=arguments[0]:e=e||{},(e=s(this.defaults,e)).method?e.method=e.method.toLowerCase():this.defaults.method?e.method=this.defaults.method.toLowerCase():e.method="get";var t=[o,void 0],n=Promise.resolve(e);for(this.interceptors.request.forEach((function(e){t.unshift(e.fulfilled,e.rejected)})),this.interceptors.response.forEach((function(e){t.push(e.fulfilled,e.rejected)}));t.length;)n=n.then(t.shift(),t.shift());return n},l.prototype.getUri=function(e){return e=s(this.defaults,e),r(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},i.forEach(["delete","get","head","options"],(function(e){l.prototype[e]=function(t,n){return this.request(s(n||{},{method:e,url:t,data:(n||{}).data}))}})),i.forEach(["post","put","patch"],(function(e){l.prototype[e]=function(t,n,i){return this.request(s(i||{},{method:e,url:t,data:n}))}})),e.exports=l},function(e,t,n){"use strict";var i=n(9);function r(){this.handlers=[]}r.prototype.use=function(e,t){return this.handlers.push({fulfilled:e,rejected:t}),this.handlers.length-1},r.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},r.prototype.forEach=function(e){i.forEach(this.handlers,(function(t){null!==t&&e(t)}))},e.exports=r},function(e,t,n){"use strict";var i=n(9),r=n(57),a=n(26),o=n(27);function s(e){e.cancelToken&&e.cancelToken.throwIfRequested()}e.exports=function(e){return s(e),e.headers=e.headers||{},e.data=r(e.data,e.headers,e.transformRequest),e.headers=i.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),i.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||o.adapter)(e).then((function(t){return s(e),t.data=r(t.data,t.headers,e.transformResponse),t}),(function(t){return a(t)||(s(e),t&&t.response&&(t.response.data=r(t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))}},function(e,t,n){"use strict";var i=n(9);e.exports=function(e,t,n){return i.forEach(n,(function(n){e=n(e,t)})),e}},function(e,t){var n,i,r=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===a||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"===typeof setTimeout?setTimeout:a}catch(e){n=a}try{i="function"===typeof clearTimeout?clearTimeout:o}catch(e){i=o}}();var l,c=[],u=!1,h=-1;function d(){u&&l&&(u=!1,l.length?c=l.concat(c):h=-1,c.length&&p())}function p(){if(!u){var e=s(d);u=!0;for(var t=c.length;t;){for(l=c,c=[];++h<t;)l&&l[h].run();h=-1,t=c.length}l=null,u=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===o||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function m(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new f(e,t)),1!==c.length||u||s(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=m,r.addListener=m,r.once=m,r.off=m,r.removeListener=m,r.removeAllListeners=m,r.emit=m,r.prependListener=m,r.prependOnceListener=m,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(e,t,n){"use strict";var i=n(9);e.exports=function(e,t){i.forEach(e,(function(n,i){i!==t&&i.toUpperCase()===t.toUpperCase()&&(e[t]=n,delete e[i])}))}},function(e,t,n){"use strict";var i=n(29);e.exports=function(e,t,n){var r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(i("Request failed with status code "+n.status,n.config,null,n.request,n)):e(n)}},function(e,t,n){"use strict";e.exports=function(e,t,n,i,r){return e.config=t,n&&(e.code=n),e.request=i,e.response=r,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},e}},function(e,t,n){"use strict";var i=n(9);e.exports=i.isStandardBrowserEnv()?{write:function(e,t,n,r,a,o){var s=[];s.push(e+"="+encodeURIComponent(t)),i.isNumber(n)&&s.push("expires="+new Date(n).toGMTString()),i.isString(r)&&s.push("path="+r),i.isString(a)&&s.push("domain="+a),!0===o&&s.push("secure"),document.cookie=s.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},function(e,t,n){"use strict";var i=n(64),r=n(65);e.exports=function(e,t){return e&&!i(t)?r(e,t):t}},function(e,t,n){"use strict";e.exports=function(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)}},function(e,t,n){"use strict";e.exports=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}},function(e,t,n){"use strict";var i=n(9),r=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];e.exports=function(e){var t,n,a,o={};return e?(i.forEach(e.split("\n"),(function(e){if(a=e.indexOf(":"),t=i.trim(e.substr(0,a)).toLowerCase(),n=i.trim(e.substr(a+1)),t){if(o[t]&&r.indexOf(t)>=0)return;o[t]="set-cookie"===t?(o[t]?o[t]:[]).concat([n]):o[t]?o[t]+", "+n:n}})),o):o}},function(e,t,n){"use strict";var i=n(9);e.exports=i.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function r(e){var i=e;return t&&(n.setAttribute("href",i),i=n.href),n.setAttribute("href",i),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:"/"===n.pathname.charAt(0)?n.pathname:"/"+n.pathname}}return e=r(window.location.href),function(t){var n=i.isString(t)?r(t):t;return n.protocol===e.protocol&&n.host===e.host}}():function(){return!0}},function(e,t,n){"use strict";var i=n(31);function r(e){if("function"!==typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var n=this;e((function(e){n.reason||(n.reason=new i(e),t(n.reason))}))}r.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},r.source=function(){var e;return{token:new r((function(t){e=t})),cancel:e}},e.exports=r},function(e,t,n){"use strict";e.exports=function(e){return function(t){return e.apply(null,t)}}},function(e,t,n){"use strict";e.exports=function(e){return"object"===typeof e&&!0===e.isAxiosError}}]]);
//# sourceMappingURL=2.37eb986c.chunk.js.map