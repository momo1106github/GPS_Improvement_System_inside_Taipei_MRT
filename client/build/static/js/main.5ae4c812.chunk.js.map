{"version":3,"sources":["Components/Header.js","Components/Map.js","Containers/Recorder.js","hooks/useRoute.js","hooks/useSensor.js","Containers/WebCam.js","Containers/MapController.js","App.js","reportWebVitals.js","index.js"],"names":["Header","className","Map","mapContainer","lng","lat","zoom","onMove","ref","Recorder","sendAudio","useState","record","setRecord","mimeType","onStop","recordedBlob","onData","strokeColor","timeSlice","backgroundColor","onClick","type","useRoute","setLng","setLat","blob","a","formData","FormData","append","axios","post","headers","Accept","result","parseFloat","data","sendPic","imgSrc","file","dataURLtoFile","console","log","dataurl","filename","arr","split","mime","match","bstr","atob","n","length","u8arr","Uint8Array","charCodeAt","File","sendBearing","bearing","useSensor","setBearing","orientation","sensor","AbsoluteOrientationSensor","frequency","Promise","all","navigator","permissions","query","name","then","results","every","state","addEventListener","euler","THREE","quaternion","setFromQuaternion","z","event","error","start","videoConstraints","width","height","facingMode","WebCamContainer","webcamRef","React","useRef","capture","useCallback","imageSrc","current","getScreenshot","audio","screenshotFormat","mapboxgl","accessToken","MapController","map","marker","setMarker","lastBearing","setLastBearing","useEffect","flyTo","center","setLngLat","addTo","Math","abs","container","style","pitch","Marker","color","draggable","App","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.5ae4c812.chunk.js","sourcesContent":["const Header = () => {\n  return (\n    <div className=\"header\">\n      <h1>GPS Improment System</h1>\n      <p>\n        This Website helps you to improve your GPS location when taking the Taipei MRT.\n      </p>\n    </div>\n  );\n};\n\nexport default Header;","const Map = ({mapContainer, lng, lat, zoom, onMove}) => {\n  return (\n    <div>\n      <div className=\"sidebar\">\n        Longitude: {lng} | Latitude: {lat} | Zoom: {zoom}\n      </div>\n      <div ref={mapContainer} className=\"map-container\" />\n    </div>\n  );\n};\nexport default Map;","import { useState } from \"react\";\nimport { ReactMic } from \"react-mic\";\n\nconst Recorder = ({ sendAudio }) => {\n  // const [blob, setBlob] = useState(null);\n  const [record, setRecord] = useState(false);\n\n  const startRecording = () => {\n    setRecord(true);\n  };\n\n  const stopRecording = () => {\n    setRecord(false);\n  };\n\n  const onData = (recordedBlob) => {\n    // console.log(\"chunk of real-time data is: \", recordedBlob);\n    // console.log(recordedBlob)\n    // sendAudio(recordedBlob)\n  };\n\n  const onStop = (recordedBlob) => {\n    // console.log('recordedBlob is: ', recordedBlob);\n    sendAudio(recordedBlob);\n  };\n  return (\n    <div>\n      <ReactMic\n        record={record}\n        mimeType=\"audio/wav\"\n        className=\"sound-wave\"\n        onStop={onStop}\n        onData={onData}\n        strokeColor=\"#000000\"\n        timeSlice={30000}\n        backgroundColor=\"#FF4081\"\n      />\n      <button onClick={startRecording} type=\"button\">\n        Start\n      </button>\n      <button onClick={stopRecording} type=\"button\">\n        Stop\n      </button>\n    </div>\n  );\n};\nexport default Recorder;\n","import axios from \"axios\";\nimport { useState } from \"react\";\n\nconst useRoute = () => {\n  const [lng, setLng] = useState(121.573145);\n  const [lat, setLat] = useState(24.998241);\n  const development = process.env.NODE_ENV !== 'production'  \n  const url = (development) ? \"http://localhost:5000/audio\":\"https://obscure-spire-00084.herokuapp.com/audio\";\n  // console.log(\"development: \", development);\n\n  const sendAudio = async (blob) => {\n    let formData = new FormData();\n    formData.append(\"wav_file\", blob.blob);\n    // console.log(blob);\n    const result = await axios.post(\"http://localhost:5000/audio\", formData, {\n      headers: {\n        Accept: \"*/*\",\n        \"Content-Type\": \"multipart/form-data\",\n      },\n    });\n\n    setLng(parseFloat(result.data[0]));\n    setLat(parseFloat(result.data[1]));\n  };\n\n  const sendPic = async (imgSrc) =>{\n    let formData = new FormData();\n    const file = dataURLtoFile(imgSrc);\n    formData.append('image_file', file);\n    // console.log(formData.get(\"image_file\"));\n    const result = await axios.post(\"http://localhost:5000/image\", formData, {\n      headers: {\n        'Content-Type': `multipart/form-data;`,\n      }\n    });\n    console.log(result);\n  }\n\n  const sendBearing = async (bearing) =>{\n    console.log(\"send Bearing\", bearing);\n    const result = await axios.post(\"http://localhost:5000/bearing\", { bearing: bearing });\n    console.log(result);\n  }\n\n\n  const dataURLtoFile = (dataurl, filename) => {\n    const arr = dataurl.split(',')\n    const mime = arr[0].match(/:(.*?);/)[1]\n    const bstr = atob(arr[1])\n    let n = bstr.length\n    const u8arr = new Uint8Array(n)\n    while (n) {\n      u8arr[n - 1] = bstr.charCodeAt(n - 1)\n      n -= 1 // to make eslint happy\n    }\n    return new File([u8arr], filename, { type: mime })\n  }\n\n  return { lng, lat, sendAudio, sendPic, sendBearing };\n};\nexport default useRoute;\n","import { useState } from \"react\";\nimport * as THREE from \"three\";\nimport { Gyroscope, AbsoluteOrientationSensor } from \"motion-sensors-polyfill\";\n\nconst useSensor = () => {\n  const [bearing, setBearing] = useState(0);\n  \n  const orientation = () => {\n    const options = { frequency: 60 };\n    const sensor = new AbsoluteOrientationSensor(options);\n    Promise.all([\n      navigator.permissions.query({ name: \"accelerometer\" }),\n      navigator.permissions.query({ name: \"magnetometer\" }),\n      navigator.permissions.query({ name: \"gyroscope\" }),\n    ]).then((results) => {\n      if (results.every((result) => result.state === \"granted\")) {\n        sensor.addEventListener(\"reading\", () => {\n          const euler = new THREE.Euler();\n          const quaternion = new THREE.Quaternion(...sensor.quaternion);\n          // console.log(euler.setFromQuaternion(quaternion, \"XYZ\").z);\n          setBearing(45 * euler.setFromQuaternion(quaternion, \"XYZ\").z);\n        });\n        sensor.addEventListener(\"error\", (event) => {\n          if (event.error.name === \"NotReadableError\") {\n            console.log(\"Sensor is not available.\", event);\n          }\n        });\n        sensor.start();\n      } else {\n        console.log(\"No permissions to use AbsoluteOrientationSensor.\");\n      }\n    });\n  };\n  return {\n    bearing,\n    orientation,\n  };\n};\n\nexport default useSensor;\n","import Webcam from \"react-webcam\";\nimport React, {useRef} from 'react';\n\nconst videoConstraints = {\n    width: 1280,\n    height: 720,\n    facingMode: \"user\"\n  };\n\nconst WebCamContainer = ({sendPic}) =>{\n  const webcamRef = React.useRef(null);\n  const capture = React.useCallback(\n    () => {\n      const imageSrc = webcamRef.current.getScreenshot();\n    //   console.log(imageSrc);\n      sendPic(imageSrc);\n    },\n    [webcamRef]\n  );\n\n  return (\n    <>\n    <button onClick={capture}>Capture photo</button>\n    <Webcam\n        audio={false}\n        height={720}\n        ref={webcamRef}\n        screenshotFormat=\"image/jpeg\"\n        width={1280}\n        videoConstraints={videoConstraints}\n    />\n    </>\n);\n}\n\nexport default WebCamContainer;","import { useEffect, useRef, useState } from \"react\";\nimport mapboxgl from \"!mapbox-gl\"; // eslint-disable-line\nimport Map from \"../Components/Map\";\nimport Recorder from \"./Recorder\";\nimport useRoute from \"../hooks/useRoute\";\nimport useSensor from \"../hooks/useSensor\";\nimport Webcam from \"./WebCam\";\n// import orientation from \"../Functions/Orientation\";\n\nmapboxgl.accessToken =\n  \"pk.eyJ1Ijoic2hpbmUtY2hhbmciLCJhIjoiY2tvODhkdGw3MXU2dDJ2bHJrNDZmNHp6ZSJ9.-cSgmT-mTMNGs-to2jNmAw\";\n\nconst MapController = () => {\n  const mapContainer = useRef(null);\n  const map = useRef(null);\n  const { lat, lng, sendAudio, sendPic, sendBearing } = useRoute();\n  const [marker, setMarker] = useState(null);\n  const [zoom, setZoom] = useState(13);\n  const { bearing, orientation } = useSensor();\n  const [lastBearing, setLastBearing] = useState(0);\n  const bearingThreshhold = 50;\n  // const onMove = () => {\n  //   setLng(map.current.getCenter().lng.toFixed(4));\n  //   setLat(map.current.getCenter().lat.toFixed(4));\n  //   setZoom(map.current.getZoom().toFixed(2));\n  // };\n\n  useEffect(() => {\n    if (map.current) {\n      map.current.flyTo({ center: [lng, lat], zoom: 14 });\n      let newMarker = marker;\n      setMarker(newMarker.setLngLat([lng, lat]).addTo(map.current));\n    }\n  }, [lng, lat, marker]);\n\n  useEffect(() => {\n    if (!map.current) return;\n    map.current.setBearing(bearing);\n    console.log(\"bearing: \",bearing, lastBearing);\n    if(Math.abs(bearing - lastBearing) > bearingThreshhold){\n        setLastBearing(bearing)\n        sendBearing(bearing);\n      }\n  }, [bearing]);\n\n  useEffect(() => {\n    if (map.current) return; // initialize map only once\n    map.current = new mapboxgl.Map({\n      container: mapContainer.current,\n      style: \"mapbox://styles/mapbox/streets-v11\",\n      center: [lng, lat],\n      pitch: 30,\n      zoom: zoom,\n    });\n    orientation();\n    setMarker(\n      new mapboxgl.Marker({\n        color: \"#1e90ff\",\n        draggable: true,\n      })\n        .setLngLat([lng, lat])\n        .addTo(map.current)\n    );\n  });\n  return (\n    <>\n      <Map mapContainer={mapContainer} lng={lng} lat={lat} zoom={zoom}></Map>\n      <Recorder sendAudio={sendAudio} />\n      <Webcam sendPic={sendPic}/>\n    </>\n  );\n};\nexport default MapController;\n\n// const setUsersLocation = (location) => {\n//   renderMap([data.coords.longitude, data.coords.latitude]);\n//   map.flyTo({ center: [location.longitude, location.latitude] });\n// };\n","import \"./App.css\";\nimport Header from \"./Components/Header\";\nimport MapController from \"./Containers/MapController\";\n\nfunction App() {\n  return (\n    <>\n      <Header />\n      <MapController />\n    </>\n  );\n}\n\nexport default App;\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}