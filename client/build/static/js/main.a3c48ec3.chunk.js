(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{34:function(e,t,n){"use strict";(function(e){var a=n(8),r=n.n(a),o=n(11),c=n(10),i=n(15),s=n.n(i),u=n(7);t.a=function(){var t=Object(u.useState)(121.573145),n=Object(c.a)(t,2),a=n[0],i=n[1],l=Object(u.useState)(24.998241),d=Object(c.a)(l,2),f=d[0],b=d[1],j=function(){var e=Object(o.a)(r.a.mark((function e(){var t,n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.a.get("/id");case 2:t=e.sent,n=t.data,console.log("getUserId",n),p=n;case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Object(u.useEffect)((function(){(function(){var e=Object(o.a)(r.a.mark((function e(){var t,n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.a.get("/id");case 2:t=e.sent,n=t.data,console.log("getUserId",n),p=n;case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[]);var p=null,g=function(){var t=Object(o.a)(r.a.mark((function t(n){var a,o;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(a=new FormData).append("wav_file",n.blob),console.log("id:",p),t.next=5,s.a.post("/audio",a,{headers:{Accept:"*/*","Content-Type":"multipart/form-data",Authorization:"Basic ".concat(e.from("111:".concat(p),"utf8").toString("base64"))}});case 5:o=t.sent,i(parseFloat(o.data[0])),b(parseFloat(o.data[1]));case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),m=function(){var t=Object(o.a)(r.a.mark((function t(n){var a,o,c;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=new FormData,o=h(n),a.append("image_file",o),t.next=5,s.a.post("/image",a,{headers:{"Content-Type":"multipart/form-data",Authorization:"Basic ".concat(e.from("111:".concat(p),"utf8").toString("base64"))}});case 5:c=t.sent,console.log(c);case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),h=function(e,t){for(var n=e.split(","),a=n[0].match(/:(.*?);/)[1],r=atob(n[1]),o=r.length,c=new Uint8Array(o);o;)c[o-1]=r.charCodeAt(o-1),o-=1;return new File([c],t,{type:a})};return{lng:a,lat:f,sendAudio:g,sendPic:m,sendBearing:function(){var t=Object(o.a)(r.a.mark((function t(n){var a;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(p){t.next=3;break}return t.next=3,j();case 3:return console.log("send Bearing",n),t.next=6,s.a.post("/bearing",{bearing:n},{headers:{Authorization:"Basic ".concat(e.from("111:".concat(p),"utf8").toString("base64"))}});case 6:a=t.sent,console.log(a);case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),getUserId:j}}}).call(this,n(47).Buffer)},41:function(e,t,n){},42:function(e,t,n){},71:function(e,t,n){"use strict";n.r(t);var a=n(7),r=n.n(a),o=n(32),c=n.n(o),i=(n(41),n(42),n(5)),s=function(){return Object(i.jsxs)("div",{className:"header",children:[Object(i.jsx)("h1",{children:"GPS Improment System"}),Object(i.jsx)("p",{children:"This Website helps you to improve your GPS location when taking the Taipei MRT."})]})},u=n(20),l=n(10),d=n(21),f=n.n(d),b=function(e){var t=e.mapContainer,n=e.lng,a=e.lat,r=e.zoom;e.onMove;return Object(i.jsxs)("div",{children:[Object(i.jsxs)("div",{className:"sidebar",children:["Longitude: ",n," | Latitude: ",a," | Zoom: ",r]}),Object(i.jsx)("div",{ref:t,className:"map-container"})]})},j=n(33),p=function(e){var t=e.sendAudio,n=Object(a.useState)(!1),r=Object(l.a)(n,2),o=r[0],c=r[1];return Object(i.jsxs)("div",{children:[Object(i.jsx)(j.ReactMic,{record:o,mimeType:"audio/wav",className:"sound-wave",onStop:function(e){t(e)},onData:function(e){},strokeColor:"#000000",timeSlice:3e4,backgroundColor:"#FF4081"}),Object(i.jsx)("button",{onClick:function(){c(!0)},type:"button",children:"Start"}),Object(i.jsx)("button",{onClick:function(){c(!1)},type:"button",children:"Stop"})]})},g=n(34),m=n(17),h=n(23),v=n(36),O=function(){var e=Object(a.useState)(0),t=Object(l.a)(e,2),n=t[0],r=t[1];return{bearing:n,orientation:function(){var e=new v.a({frequency:60});Promise.all([navigator.permissions.query({name:"accelerometer"}),navigator.permissions.query({name:"magnetometer"}),navigator.permissions.query({name:"gyroscope"})]).then((function(t){t.every((function(e){return"granted"===e.state}))?(e.addEventListener("reading",(function(){var t=new h.a,n=Object(m.a)(h.b,Object(u.a)(e.quaternion));r(180/Math.PI*t.setFromQuaternion(n,"XYZ").z)})),e.addEventListener("error",(function(e){"NotReadableError"===e.error.name&&console.log("Sensor is not available.",e)})),e.start()):console.log("No permissions to use AbsoluteOrientationSensor.")}))}}},x=n(35),w=n.n(x),S={width:1280,height:720,facingMode:"user"},y=function(e){var t=e.sendPic,n=r.a.useRef(null),a=r.a.useCallback((function(){var e=n.current.getScreenshot();t(e)}),[n]);return Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)("button",{onClick:a,children:"Capture photo"}),Object(i.jsx)(w.a,{audio:!1,height:720,ref:n,screenshotFormat:"image/jpeg",width:1280,videoConstraints:S})]})};f.a.accessToken="pk.eyJ1Ijoic2hpbmUtY2hhbmciLCJhIjoiY2tvODhkdGw3MXU2dDJ2bHJrNDZmNHp6ZSJ9.-cSgmT-mTMNGs-to2jNmAw";var k=function(){var e=Object(a.useRef)(null),t=Object(a.useRef)(null),n=Object(g.a)(),r=n.lat,o=n.lng,c=(n.id,n.sendAudio),s=n.sendPic,d=n.sendBearing,j=Object(a.useState)(null),m=Object(l.a)(j,2),h=m[0],v=m[1],x=Object(a.useState)(13),w=Object(l.a)(x,2),S=w[0],k=(w[1],O()),I=k.bearing,C=k.orientation,F=Object(a.useState)(0),T=Object(l.a)(F,2),A=T[0],L=T[1];Object(a.useEffect)((function(){setInterval((function(){N(I)}),3e3),setInterval((function(){B()}),6e3)}),[]),Object(a.useEffect)((function(){t.current&&(t.current.flyTo({center:[o,r],zoom:14}),v(h.setLngLat([o,r]).addTo(t.current)))}),[o,r,h]),Object(a.useEffect)((function(){t.current&&(t.current.setBearing(I),Math.abs(I-A)>10&&(L(I),d(I)))}),[I]),Object(a.useEffect)((function(){t.current||(t.current=new f.a.Map({container:e.current,style:"mapbox://styles/mapbox/streets-v11",center:[o,r],pitch:30,zoom:S}),C(),v(new f.a.Marker({color:"#1e90ff",draggable:!0}).setLngLat([o,r]).addTo(t.current)))}));var N=function(e){var t=JSON.parse(localStorage.getItem("data")||"[]"),n={bearing:e,time:Date.now(),location:[o,r]};t=[].concat(Object(u.a)(t),[n]),localStorage.setItem("data",JSON.stringify(t)),console.log("localstorage:",t)},B=function(){var e=localStorage.getItem("data"),t=new Blob([e],{type:"text/csv"}),n=window.URL.createObjectURL(t),a=document.createElement("a");a.href=n;var r=localStorage.getItem("count")||"0";r=parseInt(r)+1,localStorage.setItem("count",r),a.setAttribute("download","".concat(r,".csv")),a.click(),localStorage.setItem("data",[])};return Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)(b,{mapContainer:e,lng:o,lat:r,zoom:S}),Object(i.jsx)(p,{sendAudio:c}),Object(i.jsx)(y,{sendPic:s})]})};var I=function(){return Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)(s,{}),Object(i.jsx)(k,{})]})},C=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,72)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,o=t.getLCP,c=t.getTTFB;n(e),a(e),r(e),o(e),c(e)}))};c.a.render(Object(i.jsx)(r.a.StrictMode,{children:Object(i.jsx)(I,{})}),document.getElementById("root")),C()}},[[71,1,2]]]);
//# sourceMappingURL=main.a3c48ec3.chunk.js.map